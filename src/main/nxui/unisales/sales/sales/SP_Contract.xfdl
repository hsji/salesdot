<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="SP_Contract" width="1274" height="487" onload="SP_Contract_onload" titletext="매출계약" onsize="SP_Contract_onsize">
    <Layouts>
      <Layout height="487" mobileorientation="landscape" width="1274">
        <Div id="div_ContractInfo" taborder="1" top="0" text="" cssclass="div_WF_detailBg" bottom="156" formscrolltype="none" right="0" width="713">
          <Layouts>
            <Layout>
              <Div id="div_Attachment" taborder="6" width="110" height="22" async="false" BINDDATASET="ds_MainContract" SOURCE_CD="CL" SOURCE_SEQ="CONTRACT_NO" USE_NEXT_FILE_TYPE="true" USE_LINK_TYPE="true" USE_MULTI_FILE="true" USE_OPEN_ADD_DIALOG="false" USE_DELETE_ALL="false" USE_BUTTON_ONLY="true" url="Common::COM_Attachment.xfdl" right="8" PROJECT_CODE="PROJECT_CODE" enable="false" bottom="8"/>
              <Button id="btn_RequestLicense" taborder="5" text="라이선스요청" height="22" onclick="btn_RequestLicense_onclick" width="90" right="div_Attachment:6" enable="false" bottom="7" TL_SEQ="130"/>
              <Button id="btn_Online" taborder="1" text="온라인LIC요청" height="22" onclick="btn_Online_onclick" bottom="7" right="btn_RequestLicense:6" width="90" enable="false" TL_SEQ="625"/>
              <Button id="btn_DeliveryConfirm" taborder="4" text="납품확인서" height="22" onclick="btn_DeliveryConfirm_onclick" width="90" right="btn_Online:6" enable="false" bottom="7" TL_SEQ="626"/>
              <Button id="btn_CostSheet" taborder="3" text="매출원가표" height="22" onclick="btn_CostSheet_onclick" width="90" right="btn_DeliveryConfirm:6" enable="false" bottom="7" TL_SEQ="129"/>
              <Button id="btn_CommCode" taborder="2" text="공통코드추가" height="22" width="90" right="btn_CostSheet:6" onclick="btn_CommCode_onclick" enable="false" bottom="7" TL_SEQ="627"/>
              <Button id="btn_HistoryMail" taborder="7" text="변경이력메일" height="22" right="btn_CommCode:6" width="90" onclick="div_ContractInfo_btn_HistoryMail_onclick" bottom="7" enable="false" TL_SEQ="628"/>
              <Div id="div_ContractMain_K" taborder="8" text="Div00" left="2" top="0" bottom="146" right="0">
                <Layouts>
                  <Layout>
                    <Static id="stc_SubSalesEmpNo" taborder="0" text="Sub 영업" left="5" top="126" width="52" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="605"/>
                    <Static id="stc_ContractPrice" taborder="1" text="계약금액" left="5" top="156" width="52" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="40"/>
                    <Static id="stc_ContractType" taborder="2" text="계약구분 " top="6" width="48" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="9" TL_SEQ="123"/>
                    <Combo id="cmb_ContractType" taborder="3" text="제품계약" left="65" top="6" width="120" height="22" value="1" index="0" innerdataset="ds_cmm_ContractType" codecolumn="CODE" datacolumn="CAPTION" readonly="true" onitemchanged="cmb_ContractType_onitemchanged"/>
                    <Static id="stc_ContractProductCode" taborder="4" text="계약제품" left="193" top="6" width="48" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="332"/>
                    <Static id="stc_ContractName" taborder="5" text="계약명" left="9" top="36" width="48" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="33"/>
                    <Edit id="edt_ContractName" taborder="6" left="65" top="36" width="471" height="22"/>
                    <Combo id="cmb_SalesProduct" taborder="7" text="Combo00" left="249" top="6" width="204" height="22" innerdataset="ds_cmm_Product" codecolumn="PRODUCT_CODE" datacolumn="PRODUCT_NAME"/>
                    <CheckBox id="chb_Export" taborder="8" text="수출" left="461" top="6" width="48" height="22" cssclass="sta_WF_DetailTit" falsevalue="0" truevalue="1" TL_SEQ="584"/>
                    <Static id="stc_ContractMain" taborder="9" text="계약처" left="9" top="66" width="48" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="34"/>
                    <Div id="div_ContractMain" taborder="10" left="65" top="66" width="259" height="22" url="Common::COM_Search.xfdl" binddataset="ds_MainContract" codecolumn="CONTRACT_MAIN" datacolumn="CONTRACT_MAIN_NAME" kind="COMPANY" param="" user_onchanged="Com_Search_onChanged" autoSearch="false"/>
                    <CheckBox id="chb_StrategySales" taborder="11" text="전략영업" left="517" top="6" width="73" height="22" cssclass="sta_WF_DetailTit" falsevalue="0" truevalue="1" TL_SEQ="613"/>
                    <Static id="stc_SalesStatus" taborder="12" text="영업 상태" left="324" top="66" width="60" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="620"/>
                    <Combo id="cmb_SalesStatus" taborder="13" text="" left="389" top="66" height="22" innerdataset="ds_cmm_SalesStatus" codecolumn="CODE" datacolumn="CAPTION" width="120"/>
                    <Static id="stc_PayMethod" taborder="14" text="결제조건" left="518" top="66" width="48" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="219"/>
                    <Combo id="cmb_PayMethod" taborder="15" text="" top="66" height="22" innerdataset="ds_cmm_PayMethod" codecolumn="CODE" datacolumn="CAPTION" right="7" left="572"/>
                    <Static id="stc_SalesEmpNo" taborder="16" text="담당영업" left="5" top="96" width="52" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="37"/>
                    <MaskEdit id="medt_ContractPrice" taborder="17" left="64" top="156" width="134" height="22" format="#,##0" textAlign="right" readonly="true"/>
                    <Combo id="cmb_SalesEmpNo" taborder="18" text="" left="65" top="96" width="90" height="22" innerdataset="ds_cmm_SalesEmp" codecolumn="EMP_NO" datacolumn="EMP_NAME" displayrowcount="15" onitemchanged="cmb_SalesEmpNo_onitemchanged"/>
                    <Static id="stc_Incentive" taborder="19" text="인센티브" left="165" top="96" width="48" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="615"/>
                    <Combo id="cmb_Incentive" taborder="20" text="" left="218" top="96" width="90" height="22" innerdataset="ds_cmm_SalesEmp" codecolumn="EMP_NO" datacolumn="EMP_NAME" displayrowcount="15" readonly="true"/>
                    <Static id="stc_ContractEnroll" taborder="21" text="계약등록" left="312" top="96" width="54" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="616"/>
                    <Edit id="edt_ContractEnroll" taborder="22" left="374" top="96" width="80" height="22" readonly="true"/>
                    <Static id="stc_ContractExecutionRate" taborder="23" text="계약이행율" left="211" top="156" width="64" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="617"/>
                    <Edit id="medt_ContractExecutionRate" taborder="24" left="281" top="156" width="65" height="22" textAlign="right" inputtype="number"/>
                    <Static id="stc_ContractDefectExecutionRate" taborder="25" text="하자이행율" left="354" top="156" width="68" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="618"/>
                    <Edit id="medt_ContractDefectExecutionRate" taborder="26" left="427" top="156" width="65" height="22" textAlign="right" inputtype="number"/>
                    <Static id="stc_PrepaymentExecutionRate" taborder="27" text="선급금이행율" left="505" top="156" width="74" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="619"/>
                    <Edit id="medt_PrepaymentExecutionRate" taborder="28" left="583" top="156" width="65" height="22" textAlign="right" inputtype="number"/>
                    <Static id="stc_SalesStatus00" taborder="29" text="사업구분" left="532" top="36" width="60" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="112"/>
                    <Combo id="cmb_BusinessType" taborder="30" text="" top="36" height="22" innerdataset="ds_cmm_BusinessType" codecolumn="CODE" datacolumn="CAPTION" right="7" width="84"/>
                    <Static id="stc_ClientPoNo" taborder="31" text="전자구매 계약번호" left="462" top="96" width="104" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="621"/>
                    <Edit id="edt_ClientPoNo" taborder="32" top="96" height="22" textAlign="left" left="571" right="7"/>
                    <CheckBox id="chb_UnionFlag" taborder="33" text="통합" left="517" top="6" width="49" height="22" cssclass="sta_WF_DetailTit" falsevalue="0" truevalue="1" visible="false" TL_SEQ="622"/>
                    <CheckBox id="chb_AutoExtension" taborder="34" text="자동" left="574" top="6" width="48" height="22" cssclass="sta_WF_DetailTit" falsevalue="0" truevalue="1" visible="false" TL_SEQ="44"/>
                    <CheckBox id="chk_SitecheckFlag" taborder="35" text="검수" top="156" height="22" cssclass="sta_WF_DetailTit" truevalue="1" falsevalue="0" TL_SEQ="623" width="47" left="655"/>
                    <Button id="btn_CopyAdd" taborder="36" text="복사추가" left="623" top="6" width="59" height="22" visible="false" TL_SEQ="210" onclick="btn_CopyAdd_onclick"/>
                    <Combo id="cmb_SubSalesEmpNo" taborder="37" text="" left="65" top="126" width="90" height="22" innerdataset="ds_cmm_SalesEmp" codecolumn="EMP_NO" datacolumn="EMP_NAME" onitemchanged="div_ContractInfo_cmb_SalesEmpNo_onitemchanged" displayrowcount="15"/>
                    <Static id="stc_SubContractPrice" taborder="38" text="Sub 계약금액" left="165" top="126" width="72" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="624"/>
                    <MaskEdit id="medt_SubContractPrice" taborder="39" left="242" top="126" width="126" height="22" format="#,##0" textAlign="right"/>
                    <CheckBox id="chb_NetSales" taborder="40" text="순매출" top="6" width="60" height="22" falsevalue="0" truevalue="1" left="598" enable="false" visible="false" TL_SEQ="279"/>
                    <CheckBox id="chb_DivisionFlag" taborder="41" text="분리등록" width="73" height="22" cssclass="sta_WF_DetailTit" truevalue="1" falsevalue="0" right="242" top="126" TL_SEQ="629"/>
                    <Button id="btn_Account" taborder="42" text="회계용" top="126" width="59" height="22" visible="false" TL_SEQ="630" right="7" onclick="btn_Account_onclick"/>
                    <Button id="btn_MaintenceEmail" taborder="43" text="점검이력메일" left="613" top="126" height="22" right="7" visible="false" enable="false" onclick="btn_MaintenceEmail_onclick"/>
                    <Static id="stc_ConsumptionTax" taborder="44" text="소비세액" left="462" top="106" width="104" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="12469" visible="false"/>
                    <Combo id="cmb_ConsumptionTax" taborder="45" left="571" top="106" width="131" height="22" visible="false" innerdataset="ds_cmm_ConsumptionTax" codecolumn="CODE" datacolumn="CAPTION"/>
                  </Layout>
                </Layouts>
              </Div>
              <Div id="div_ContractSub" taborder="0" left="2" top="188" height="114" async="false" text="" right="0" url="Sales::SP_ContractProduct.xfdl"/>
            </Layout>
          </Layouts>
        </Div>
        <Grid id="grd_ContractList" binddataset="ds_MainContract" taborder="0" left="0" top="4" autofittype="col" right="717" height="37.42%">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="110"/>
                <Column size="110"/>
                <Column size="110"/>
                <Column size="110"/>
                <Column size="110"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="계약구분" TL_SEQ="123"/>
                <Cell col="1" text="계약번호" TL_SEQ="316"/>
                <Cell col="2" text="계약일자" TL_SEQ="156"/>
                <Cell col="3" text="계약금액" TL_SEQ="40"/>
                <Cell col="4" text="매출담당" TL_SEQ="631"/>
              </Band>
              <Band id="body">
                <Cell text="bind:CONTRACT_TYPE" displaytype="combotext" combodataset="ds_cmm_ContractType" combocodecol="CODE" combodatacol="CAPTION"/>
                <Cell col="1" text="bind:CONTRACT_NO"/>
                <Cell col="2" text="bind:CONTRACT_DATE" displaytype="date" calendardateformat="yyyy-MM-dd"/>
                <Cell col="3" text="bind:CONTRACT_PRICE" textAlign="right" displaytype="expr:comp.parent.gfn_getPriceDisplayType('normal')" maskeditformat="expr:comp.parent.gfn_getPriceMaskformat(CONTRACT_PRICE)" maskedittype="expr:comp.parent.gfn_getPriceMaskEdtType()"/>
                <Cell col="4" text="bind:SALES_EMP_NAME"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Tab id="tab_Progress" taborder="2" left="0" tabindex="2" scrollbars="autoboth" top="grd_ContractList:0.9970000000000141" right="717" onchanged="tab_Progress_onchanged" bottom="155">
          <Tabpages>
            <Tabpage id="tpg_SalesProgess" text="진행사항" TL_SEQ="65">
              <Layouts>
                <Layout>
                  <Grid id="grd_Date" taborder="0" left="0" width="95" autofittype="col" binddataset="ds_ScheduleList" top="4" bottom="0" formatid="default">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="80"/>
                        </Columns>
                        <Rows>
                          <Row size="24" band="head"/>
                          <Row size="24"/>
                        </Rows>
                        <Band id="head">
                          <Cell text="일자" TL_SEQ="67"/>
                        </Band>
                        <Band id="body">
                          <Cell displaytype="date" text="bind:ISSUE_DATE" calendardateformat="yyyy-MM-dd"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Static id="stc_ProgressTypeCode" taborder="1" text="구 분" left="102" top="4" width="34" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="68"/>
                  <Combo id="cmb_ProgressTypeCode" taborder="3" text="" left="stc_ProgressTypeCode:10" top="4" width="84" height="22" innerdataset="ds_cmm_Type" codecolumn="CODE" datacolumn="CAPTION"/>
                  <Static id="stc_ProgessIssueDate" taborder="2" text="일 자" left="cmb_ProgressTypeCode:6" top="4" width="34" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="67"/>
                  <Calendar id="cal_ProgessIssueDate" taborder="4" left="stc_ProgessIssueDate:9" top="4" width="108" height="22" autoselect="true"/>
                  <TextArea id="txt_ProgessContents" taborder="5" left="102" top="34" right="10" scrollbartype="autoindicator autoindicator" bottom="0.9969999999999999"/>
                  <Static id="stc_Importance" taborder="7" text="중요도" left="cal_ProgessIssueDate:10" top="4" width="36" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="72"/>
                  <Combo id="cmb_Importance" taborder="8" text="" left="stc_Importance:9" top="4" width="55" height="22" innerdataset="ds_cmm_Importance" codecolumn="CODE" datacolumn="CAPTION"/>
                  <CheckBox id="chb_ProgressReport" taborder="6" text="보고" left="cmb_Importance:10" top="4" width="44" height="22" truevalue="1" falsevalue="0" TL_SEQ="70"/>
                </Layout>
              </Layouts>
            </Tabpage>
            <Tabpage id="tpg_PersonInCharge" text="담당자" TL_SEQ="66">
              <Layouts>
                <Layout>
                  <Grid id="grd_PersonInCharge" taborder="0" scrollbars="alwaysvert" autoenter="select" useinputpanel="false" cellsizingtype="col" left="0" top="4" visible="true" right="0" bottom="0.9969999999999999" binddataset="ds_AddressbookList" formatid="default" oncelldblclick="tab_Progress_tpg_PersonInCharge_grd_PersonInCharge_oncelldblclick">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="50"/>
                          <Column size="150"/>
                          <Column size="40"/>
                          <Column size="40"/>
                          <Column size="70"/>
                          <Column size="70"/>
                          <Column size="80"/>
                          <Column size="100"/>
                          <Column size="100"/>
                          <Column size="150"/>
                          <Column size="250"/>
                          <Column size="80"/>
                          <Column size="60"/>
                        </Columns>
                        <Rows>
                          <Row size="24" band="head"/>
                          <Row size="24"/>
                        </Rows>
                        <Band id="head">
                          <Cell text="구분" TL_SEQ="68"/>
                          <Cell col="1" text="회사" TL_SEQ="73"/>
                          <Cell col="2" text="E-Tax" TL_SEQ="635"/>
                          <Cell col="3" text="발주" TL_SEQ="636"/>
                          <Cell col="4" text="담당자" TL_SEQ="66"/>
                          <Cell col="5" text="직급" TL_SEQ="26"/>
                          <Cell col="6" text="역할" TL_SEQ="75"/>
                          <Cell col="7" text="연락처(휴대폰)" TL_SEQ="637"/>
                          <Cell col="8" text="연락처(유선)" TL_SEQ="638"/>
                          <Cell col="9" text="EMAIL" TL_SEQ="639"/>
                          <Cell col="10" text="비고" TL_SEQ="45"/>
                          <Cell col="11" text="등록일" TL_SEQ="77"/>
                          <Cell col="12" text="등록자" TL_SEQ="81"/>
                        </Band>
                        <Band id="body">
                          <Cell text="bind:SOURCE_CD" textAlign="left" combodataset="ds_CAType" combodatacol="CAPTION" combocodecol="CODE" displaytype="combocontrol" edittype="combo"/>
                          <Cell col="1" text="bind:COMPANY_NAME" textAlign="left"/>
                          <Cell col="2" displaytype="checkboxcontrol" text="bind:ETAX_FLAG" edittype="checkbox"/>
                          <Cell col="3" displaytype="checkboxcontrol" text="bind:ORDER_FLAG" edittype="checkbox"/>
                          <Cell col="4" text="bind:EMP_NAME"/>
                          <Cell col="5" text="bind:GRADE_CODE" displaytype="combotext" combodataset="ds_cmm_CaGrade" combocodecol="CODE" combodatacol="CAPTION" edittype="combo"/>
                          <Cell col="6" displaytype="combotext" text="bind:ROLE_CODE" combodataset="ds_cmm_CaRole" combocodecol="CODE" combodatacol="CAPTION" edittype="combo"/>
                          <Cell col="7" text="bind:H_PHONE_NO" edittype="normal"/>
                          <Cell col="8" text="bind:O_PHONE_NO" edittype="normal"/>
                          <Cell col="9" text="bind:EMAIL" textAlign="left" edittype="normal"/>
                          <Cell col="10" text="bind:REMARKS" textAlign="left" edittype="normal"/>
                          <Cell col="11" text="bind:INSERT_DATE" displaytype="date" calendardateformat="yyyy-MM-dd"/>
                          <Cell col="12" text="bind:INSERT_EMP_NAME"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                </Layout>
              </Layouts>
            </Tabpage>
            <Tabpage id="tpg_Remark" text="비고" TL_SEQ="45">
              <Layouts>
                <Layout>
                  <TextArea id="ta_Remark" taborder="0" left="0" top="4" right="0" bottom="0" scrollbartype="auto auto"/>
                </Layout>
              </Layouts>
            </Tabpage>
            <Tabpage id="tpg_Maintenance" text="통합유지보수" TL_SEQ="43">
              <Layouts>
                <Layout>
                  <Grid id="grd_ContractNumberList" taborder="0" left="0" top="4" right="0" bottom="0" binddataset="ds_MaUnion" formatid="default" cellsizingtype="col" onexpandup="tab_Progress_tpg_Maintenance_grd_ContractNumberList_onexpandup" autoenter="select" oncelldblclick="tab_Progress_tpg_Maintenance_grd_ContractNumberList_oncelldblclick">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="170"/>
                          <Column size="80"/>
                          <Column size="175"/>
                          <Column size="100"/>
                          <Column size="100"/>
                          <Column size="100"/>
                          <Column size="100"/>
                          <Column size="300"/>
                        </Columns>
                        <Rows>
                          <Row size="24" band="head"/>
                          <Row size="24"/>
                        </Rows>
                        <Band id="head">
                          <Cell text="고객사" TL_SEQ="32"/>
                          <Cell col="1" text="계약번호" TL_SEQ="316"/>
                          <Cell col="2" text="계약명" TL_SEQ="33"/>
                          <Cell col="3" text="계약제품" TL_SEQ="332"/>
                          <Cell col="4" text="상태" TL_SEQ="209"/>
                          <Cell col="5" text="중단시작일" TL_SEQ="523"/>
                          <Cell col="6" text="중단종료일" TL_SEQ="524"/>
                          <Cell col="7" text="비고" TL_SEQ="45"/>
                        </Band>
                        <Band id="body">
                          <Cell text="bind:CLIENT_NAME" textAlign="left"/>
                          <Cell col="1" text="bind:UNION_CONTRACT_NO"/>
                          <Cell col="2" text="bind:UNION_CONTRACT_NAME" textAlign="left"/>
                          <Cell col="3" text="bind:PRODUCT_NAME"/>
                          <Cell col="4" text="bind:SUPPORT_STATUS" textAlign="center" displaytype="combotext" edittype="expr:dataset.getRowType(currow)==2?'none':'combo'" combodataset="ds_CD_SUPPORT_STATUS" combodatacol="CAPTION" combocodecol="CODE"/>
                          <Cell col="5" text="bind:SUPPORT_STOP_START_DATE" displaytype="date" textAlign="center" calendardateformat="yyyy-MM-dd" edittype="expr:dataset.getRowType(currow)==2?'none':'date'"/>
                          <Cell col="6" text="bind:SUPPORT_STOP_END_DATE" displaytype="date" textAlign="center" calendardateformat="yyyy-MM-dd" edittype="expr:dataset.getRowType(currow)==2?'none':'date'"/>
                          <Cell col="7" text="bind:SUPPORT_REMARKS" textAlign="left" displaytype="text" tooltiptext="bind:SUPPORT_REMARKS" expandimage="url('theme://images/btn_WF_Sch_P.png')" expandshow="show" expandsize="22" edittype="expr:dataset.getRowType(currow)==2?'none':'text'"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                </Layout>
              </Layouts>
            </Tabpage>
            <Tabpage id="tpg_Promise" text="약속" TL_SEQ="632">
              <Layouts>
                <Layout>
                  <Static id="Static06" taborder="9" text="" left="4" cssclass="sta_WF_detailLbl01" top="4" right="4" bottom="4"/>
                  <Grid id="grd_Date" taborder="10" left="0" width="95" autofittype="col" binddataset="ds_Promise" top="4" bottom="0" formatid="default">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="80"/>
                        </Columns>
                        <Rows>
                          <Row size="24" band="head"/>
                          <Row size="24"/>
                        </Rows>
                        <Band id="head">
                          <Cell text="일자" TL_SEQ="67"/>
                        </Band>
                        <Band id="body">
                          <Cell displaytype="date" text="bind:PROMISE_DATE" calendardateformat="yyyy-MM-dd"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Static id="stc_PromiseTitle" taborder="0" text="약속제목" left="grd_Date:5" top="4" width="48" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="640"/>
                  <Static id="stc_PromiseDate" taborder="1" text="약속일자" left="grd_Date:5" top="34" width="48" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="641"/>
                  <Static id="stc_PromiseDueDate" taborder="2" text="약속기한" left="grd_Date:5" top="64" width="48" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="642"/>
                  <Combo id="cmb_PromiseType" taborder="5" text="" top="4" height="22" innerdataset="ds_cmm_PromiseKind" codecolumn="CODE" datacolumn="CAPTION" right="0" width="100"/>
                  <Static id="stc_PromiseType" taborder="3" text="약속종류" top="4" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="643" right="104" width="67"/>
                  <Edit id="edt_PromiseTitle" taborder="4" top="4" height="22" right="179" left="stc_PromiseTitle:8"/>
                  <Calendar id="cal_PromiseDueDate" taborder="6" left="stc_PromiseDueDate:8" top="64" width="100" height="22" dateformat="yyyy-MM-dd"/>
                  <Calendar id="cal_PromiseDate" taborder="7" left="stc_PromiseDate:8" top="34" width="100" height="22" dateformat="yyyy-MM-dd"/>
                  <TextArea id="txt_ContractPromise" taborder="8" left="cal_PromiseDueDate:8" top="34" right="0" bottom="0"/>
                </Layout>
              </Layouts>
            </Tabpage>
            <Tabpage id="tpg_Royalty" text="Royalty" TL_SEQ="22569">
              <Layouts>
                <Layout>
                  <Static id="stc_ContractType" taborder="0" text="구분" top="5" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="8" width="60" TL_SEQ="68"/>
                  <Combo id="cmb_RoyaltyType" taborder="6" text="" left="stc_ContractType:8" top="5" height="22" innerdataset="ds_cmm_RoyaltyType" codecolumn="CODE" datacolumn="CAPTION" displayrowcount="15" onitemchanged="tab_Progress_tpg_Royalty_cmb_RoyaltyType_onitemchanged" width="13.29%" enable="false"/>
                  <Static id="stc_ContractType00" taborder="1" text="비율" top="5" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="28.01%" width="5.75%" TL_SEQ="22654"/>
                  <MaskEdit id="msk_RoyaltyRate" taborder="7" left="34.65%" top="6" height="20" enable="false" onchanged="tab_Progress_tpg_Royalty_msk_RoyaltyRate_onchanged" width="5.03%"/>
                  <Static id="stc_ContractType00_01" taborder="8" text="%" top="5" height="22" cssclass="sta_WF_DetailTit" left="39.86%" textAlign="center" width="2.51%"/>
                  <Static id="stc_ContractType00_00" taborder="2" text="반영일자" top="5" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="43.27%" TL_SEQ="22655" right="262"/>
                  <Calendar id="cal_RoyaltyDt" taborder="11" top="5" height="22" dateformat="yyyy-MM-dd" enable="false" autoselect="true" width="16.52%" onchanged="tab_Progress_tpg_Royalty_cal_RoyaltyDt_onchanged" left="stc_ContractType00_00:5.55%"/>
                  <Button id="btn_RoyaltyConfirm" taborder="12" text="로열티 적용" height="22" enable="false" top="5" width="80" right="0" onclick="tab_Progress_tpg_Royalty_btn_RoyaltyConfirm_onclick" TL_SEQ="22656"/>
                  <CheckBox id="chb_ConfirmFlag" taborder="5" text="확정여부" width="13.29%" height="22" cssclass="sta_WF_DetailTit" truevalue="1" falsevalue="0" top="5" enable="false" readonly="true" right="btn_RoyaltyConfirm:9" TL_SEQ="22557"/>
                  <Static id="stc_Royalty" taborder="3" text="로열티 " top="34" width="60" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="8" TL_SEQ="22569"/>
                  <MaskEdit id="medt_RoyaltyPrice" taborder="9" left="stc_Royalty:8" top="34" width="14.36%" height="22" format="#,##0" textAlign="right" enable="false" onchanged="tab_Progress_tpg_Royalty_medt_RoyaltyPrice_onchanged"/>
                  <Static id="stc_NetSalesPrice" taborder="4" text="순매출금액" top="34" width="16.16%" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="29.26%" TL_SEQ="22657"/>
                  <MaskEdit id="medt_NetSalesPrice" taborder="10" left="stc_NetSalesPrice:8.91%" top="34" height="22" format="#,##0" textAlign="right" enable="false" width="14.18%"/>
                  <Combo id="cmb_ExchageStatus" taborder="14" text="" top="34" width="16.16%" height="22" innerdataset="ds_cmm_ExchageStatus" codecolumn="CODE" datacolumn="CAPTION" displayrowcount="15" enable="false" right="0"/>
                  <Static id="stc_ContractType00_00_00_00_00" taborder="15" text="환율상태" top="34" height="22" cssclass="sta_WF_DetailTit" textAlign="right" TL_SEQ="22658" width="105" right="cmb_ExchageStatus:13"/>
                  <Static id="stc_Remarks" taborder="16" text="비고 " width="60" cssclass="sta_WF_DetailTit" textAlign="right" left="8" bottom="1" top="65" TL_SEQ="45"/>
                  <MaskEdit id="medt_Exchange" taborder="18" left="345" height="1" format="#,##0.0000" textAlign="right" enable="false" onchanged="tab_Progress_tpg_Royalty_medt_RoyaltyPrice_onchanged" width="30" bottom="2"/>
                  <TextArea id="ta_RoyaltyRemarks" taborder="13" left="76" right="0" top="62" scrolltype="none" height="29" readonly="true"/>
                  <TextArea id="ta_Remarks" taborder="17" left="76" right="0" scrolltype="none" bottom="0.7639999999999958" top="96"/>
                </Layout>
              </Layouts>
            </Tabpage>
          </Tabpages>
        </Tab>
        <Button id="btn_ProgressMinus" taborder="4" width="16" height="16" onclick="CommDelRow_onclick" top="grd_ContractList:12" right="div_ContractInfo:12" enable="false" cssclass="btn_POP_Del"/>
        <Button id="btn_ProgressPlus" taborder="3" width="16" height="16" top="grd_ContractList:12" right="btn_ProgressMinus:4" onclick="CommAddRow_onclick" enable="false" cssclass="btn_POP_Add"/>
        <Grid id="grd_ContractDetail" taborder="5" left="0" right="0" binddataset="ds_ContractProdDet" autofittype="col" formatid="PROD" onexpandup="grd_ContractDetail_onexpandup" autoenter="select" oncellclick="grd_ContractDetail_oncellclick" onheadclick="grd_ContractDetail_onheadclick" top="tab_Progress:4" bottom="0">
          <Formats>
            <Format id="PROD">
              <Columns>
                <Column size="270"/>
                <Column size="100"/>
                <Column size="55"/>
                <Column size="80"/>
                <Column size="80"/>
                <Column size="100"/>
                <Column size="80"/>
                <Column size="60"/>
                <Column size="150"/>
                <Column size="247"/>
              </Columns>
              <Rows>
                <Row size="25" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="제품명" TL_SEQ="187"/>
                <Cell col="1" text="용도" TL_SEQ="224"/>
                <Cell col="2" text="개발용" TL_SEQ="291"/>
                <Cell col="3" text="제품단가" TL_SEQ="292"/>
                <Cell col="4" text="서버등급" TL_SEQ="225"/>
                <Cell col="5" text="유형" TL_SEQ="293"/>
                <Cell col="6" text="단위" TL_SEQ="104"/>
                <Cell col="7" text="수량" TL_SEQ="103"/>
                <Cell col="8" text="계약금액" TL_SEQ="40"/>
                <Cell col="9" text="비고      " TL_SEQ="45"/>
              </Band>
              <Band id="body">
                <Cell text="bind:PRODUCT_LIST_NAME" textAlign="left" expandimage="URL(&quot;theme://images/btn_WF_Sch.png&quot;)" expandshow="show" expandsize="20"/>
                <Cell col="1" text="bind:PURPOSE" displaytype="combotext" edittype="combo" combodataset="ds_cmm_Purpose" combocodecol="CODE" combodatacol="CAPTION"/>
                <Cell col="2" text="bind:ISDEV_FLAG" displaytype="checkboxcontrol" edittype="checkbox"/>
                <Cell col="3" text="bind:UNIT_COST" edittype="mask" displaytype="mask" textAlign="right" maskeditformat="#,#0"/>
                <Cell col="4" text="bind:SERVER_GRADE" combodataset="ds_cmm_ServerGrade" combocodecol="CODE" combodatacol="CAPTION" displaytype="combotext" edittype="combo"/>
                <Cell col="5" text="bind:PRODUCT_TYPE" combodataset="ds_cmm_ContProdType" combocodecol="CODE" combodatacol="CAPTION" displaytype="combotext" edittype="combo"/>
                <Cell col="6" text="bind:PRODUCT_UNIT" combodataset="ds_cmm_ProductUnit" combocodecol="CODE" combodatacol="CAPTION" displaytype="combotext" edittype="combo"/>
                <Cell col="7" text="bind:QUANTITY" edittype="mask" displaytype="mask" maskeditformat="#,#0"/>
                <Cell col="8" text="bind:CONTRACT_PRICE" textAlign="right" displaytype="mask" edittype="mask" maskeditformat="expr:comp.parent.gfn_getPriceMaskformat(CONTRACT_PRICE)" maskedittype="expr:comp.parent.gfn_getPriceMaskEdtType()"/>
                <Cell col="9" text="bind:REMARKS" textAlign="left" edittype="normal" displaytype="normal"/>
              </Band>
            </Format>
            <Format id="SI">
              <Columns>
                <Column size="100"/>
                <Column size="80"/>
                <Column size="120"/>
                <Column size="100"/>
                <Column size="100"/>
                <Column size="57"/>
                <Column size="120"/>
                <Column size="150"/>
                <Column size="57"/>
                <Column size="150"/>
                <Column size="230"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="역할" TL_SEQ="75"/>
                <Cell col="1" text="등급" TL_SEQ="92"/>
                <Cell col="2" text="등급단가" TL_SEQ="1098"/>
                <Cell col="3" text="개시일자" TL_SEQ="94"/>
                <Cell col="4" text="종료일자" TL_SEQ="95"/>
                <Cell col="5" text="인원" TL_SEQ="1099"/>
                <Cell col="6" text="계약단가" TL_SEQ="1100"/>
                <Cell col="7" text="계약금액" TL_SEQ="40"/>
                <Cell col="8" text="MM"/>
                <Cell col="9" text="근무지역" TL_SEQ="98"/>
                <Cell col="10" text="비고" TL_SEQ="45"/>
              </Band>
              <Band id="body">
                <Cell text="bind:ROLE_CODE" displaytype="combotext" edittype="combo" combodataset="ds_cmm_Role" combocodecol="CODE" combodatacol="CAPTION"/>
                <Cell col="1" text="bind:LEVEL_CODE" displaytype="combotext" edittype="combo" combodataset="ds_cmm_Level" combocodecol="CODE" combodatacol="CAPTION"/>
                <Cell col="2" text="bind:LEVEL_UNIT_COST" displaytype="mask" textAlign="right" maskeditformat="#,#0"/>
                <Cell col="3" text="bind:START_DATE" displaytype="expr:START_DATE.length==0?&quot;none&quot;:&quot;date&quot;" calendardateformat="yyyy-MM-dd" edittype="date" calendarautoselect="true"/>
                <Cell col="4" text="bind:END_DATE" displaytype="expr:END_DATE.length==0?&quot;none&quot;:&quot;date&quot;" calendardateformat="yyyy-MM-dd" edittype="date" calendarautoselect="true"/>
                <Cell col="5" text="bind:PERSON_NUMBER" displaytype="mask" edittype="mask" maskeditformat="#,#0"/>
                <Cell col="6" text="bind:UNIT_COST" displaytype="mask" edittype="mask" textAlign="right" maskeditformat="expr:comp.parent.gfn_getPriceMaskformat(UNIT_COST)" maskedittype="expr:comp.parent.gfn_getPriceMaskEdtType()"/>
                <Cell col="7" text="bind:CONTRACT_PRICE" displaytype="mask" edittype="mask" textAlign="right" maskeditformat="expr:comp.parent.gfn_getPriceMaskformat(CONTRACT_PRICE)" maskedittype="expr:comp.parent.gfn_getPriceMaskEdtType()"/>
                <Cell col="8" text="bind:MEN_MONTH" edittype="mask" displaytype="mask" maskeditformat="#,#0.#0"/>
                <Cell col="9" text="bind:AREA_CODE" displaytype="combotext" edittype="combo" combodataset="ds_cmm_Area" combocodecol="CODE" combodatacol="CAPTION" textAlign="left"/>
                <Cell col="10" text="bind:REMARKS" edittype="normal" displaytype="normal" textAlign="left"/>
              </Band>
            </Format>
            <Format id="CS">
              <Columns>
                <Column size="100"/>
                <Column size="80"/>
                <Column size="100"/>
                <Column size="100"/>
                <Column size="100"/>
                <Column size="57"/>
                <Column size="120"/>
                <Column size="130"/>
                <Column size="57"/>
                <Column size="80"/>
                <Column size="120"/>
                <Column size="230"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="역할" TL_SEQ="75"/>
                <Cell col="1" text="등급" TL_SEQ="92"/>
                <Cell col="2" text="수행방식" TL_SEQ="101"/>
                <Cell col="3" text="개시일자" TL_SEQ="1106"/>
                <Cell col="4" text="종료일자" TL_SEQ="95"/>
                <Cell col="5" text="인원" TL_SEQ="1099"/>
                <Cell col="6" text="계약단가" TL_SEQ="1100"/>
                <Cell col="7" text="계약금액" TL_SEQ="40"/>
                <Cell col="8" text="수량" TL_SEQ="103"/>
                <Cell col="9" text="단위" TL_SEQ="104"/>
                <Cell col="10" text="근무지역" TL_SEQ="98"/>
                <Cell col="11" text="비고" TL_SEQ="45"/>
              </Band>
              <Band id="body">
                <Cell text="bind:ROLE_CODE" displaytype="combotext" edittype="combo" combodataset="ds_cmm_Role" combocodecol="CODE" combodatacol="CAPTION"/>
                <Cell col="1" text="bind:LEVEL_CODE" displaytype="combotext" edittype="combo" combodataset="ds_cmm_Level" combocodecol="CODE" combodatacol="CAPTION"/>
                <Cell col="2" maskeditformat="#,#0" displaytype="combotext" edittype="combo" combodataset="ds_cmm_ExecutionType" combocodecol="CODE" combodatacol="CAPTION" text="bind:EXECUTION_TYPE"/>
                <Cell col="3" text="bind:START_DATE" displaytype="expr:START_DATE.length==0?&quot;none&quot;:&quot;date&quot;" calendardateformat="yyyy-MM-dd" edittype="date" calendarautoselect="true"/>
                <Cell col="4" text="bind:END_DATE" displaytype="expr:END_DATE.length==0?&quot;none&quot;:&quot;date&quot;" calendardateformat="yyyy-MM-dd" edittype="date" calendarautoselect="true"/>
                <Cell col="5" text="bind:PERSON_NUMBER" displaytype="mask" edittype="mask" maskeditformat="#,#0"/>
                <Cell col="6" text="bind:UNIT_COST" displaytype="mask" edittype="mask" textAlign="right" maskeditformat="expr:comp.parent.gfn_getPriceMaskformat(UNIT_COST)" maskedittype="expr:comp.parent.gfn_getPriceMaskEdtType()"/>
                <Cell col="7" text="bind:CONTRACT_PRICE" displaytype="mask" edittype="mask" textAlign="right" maskeditformat="expr:comp.parent.gfn_getPriceMaskformat(CONTRACT_PRICE)" maskedittype="expr:comp.parent.gfn_getPriceMaskEdtType()"/>
                <Cell col="8" edittype="mask" displaytype="mask" maskeditformat="#,#0.#0" text="bind:MEN_MONTH"/>
                <Cell col="9" displaytype="combotext" edittype="combo" combodataset="ds_cmm_TechSupportUnit" combocodecol="CODE" combodatacol="CAPTION" text="bind:TECH_SUPPORT_UNIT"/>
                <Cell col="10" text="bind:AREA_CODE" displaytype="combotext" edittype="combo" combodataset="ds_cmm_Area" combocodecol="CODE" combodatacol="CAPTION" textAlign="left"/>
                <Cell col="11" text="bind:REMARKS" edittype="normal" displaytype="normal" textAlign="left"/>
              </Band>
            </Format>
            <Format id="MA">
              <Columns>
                <Column size="150"/>
                <Column size="180"/>
                <Column size="120"/>
                <Column size="120"/>
                <Column size="70"/>
                <Column size="100"/>
                <Column size="120"/>
                <Column size="60"/>
                <Column size="300"/>
              </Columns>
              <Rows>
                <Row size="24" band="head"/>
                <Row size="24"/>
              </Rows>
              <Band id="head">
                <Cell text="유지보수타입" TL_SEQ="1105"/>
                <Cell col="1" text="유지보수 제품" TL_SEQ="471"/>
                <Cell col="2" text="개시일자" TL_SEQ="1106"/>
                <Cell col="3" text="종료일자" TL_SEQ="95"/>
                <Cell col="4" text="요율" TL_SEQ="1107"/>
                <Cell col="5" text="기준" TL_SEQ="1108"/>
                <Cell col="6" text="계약금액" TL_SEQ="40"/>
                <Cell col="7" text="매입제외" TL_SEQ="1109"/>
                <Cell col="8" text="비고" TL_SEQ="45"/>
              </Band>
              <Band id="body">
                <Cell text="bind:MA_PRODUCT_NAME" textAlign="left" expandimage="URL(&quot;theme://images/btn_WF_Sch.png&quot;)" expandshow="show" expandsize="20"/>
                <Cell col="1" text="bind:PRODUCT_NAME" textAlign="left" expandimage="URL(&quot;theme://images/btn_WF_Sch.png&quot;)" expandshow="show" expandsize="20"/>
                <Cell col="2" text="bind:START_DATE" displaytype="date" edittype="date" calendardateformat="yyyy-MM-dd" calendarautoselect="true"/>
                <Cell col="3" text="bind:END_DATE" displaytype="date" edittype="date" calendardateformat="yyyy-MM-dd" calendarautoselect="true"/>
                <Cell col="4" text="bind:MA_RATE" displaytype="mask" edittype="mask" maskeditformat="#,#0.#0"/>
                <Cell col="5" combodataset="ds_cmm_MaStandard" combocodecol="CODE" combodatacol="CAPTION" displaytype="combotext" edittype="combo" text="bind:MA_STANDARD"/>
                <Cell col="6" text="bind:CONTRACT_PRICE" displaytype="mask" edittype="mask" textAlign="right" maskeditformat="expr:comp.parent.gfn_getPriceMaskformat(CONTRACT_PRICE)" maskedittype="expr:comp.parent.gfn_getPriceMaskEdtType()"/>
                <Cell col="7" displaytype="checkboxcontrol" text="bind:PURCHASE_EXCEPT_FLAG" edittype="checkbox"/>
                <Cell col="8" text="bind:REMARKS" textAlign="left" edittype="normal"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Button id="btn_ContractDetailPlus" taborder="8" left="4" top="tab_Progress:8" height="16" onclick="CommAddRow_onclick" enable="false" width="16" cssclass="btn_POP_Add"/>
        <Button id="btn_Up" taborder="7" cssclass="btn_WF_schdUp" top="div_ContractInfo:8" width="18" height="18" onclick="btn_Up_onclick" right="4"/>
        <Button id="btn_Down" taborder="6" cssclass="btn_WF_schdDown" top="div_ContractInfo:8" height="18" onclick="btn_Down_onclick" width="18" right="btn_Up:4"/>
        <Button id="btn_ContractDetailMinus" taborder="9" left="btn_ContractDetailPlus:4" top="tab_Progress:8" width="16" height="16" enable="false" onclick="CommDelRow_onclick" cssclass="btn_POP_Del"/>
        <Div id="div_Account" top="305" width="296" height="78" visible="false" background="white" border="1px solid #c8c8c8" onkillfocus="div_Account_onkillfocus" right="396">
          <Layouts>
            <Layout>
              <CheckBox id="chb_ProgressExceptFlag" taborder="0" text="진행제외" width="73" height="22" cssclass="sta_WF_DetailTit" truevalue="1" falsevalue="0" top="16" left="31" TL_SEQ="645"/>
              <CheckBox id="chb_Progress100Flag" taborder="1" text="진행 100%" width="81" height="22" cssclass="sta_WF_DetailTit" truevalue="1" falsevalue="0" top="16" left="109" TL_SEQ="646"/>
              <CheckBox id="chb_ProgressAddFlag" taborder="2" text="진행포함" width="73" height="22" cssclass="sta_WF_DetailTit" truevalue="1" falsevalue="0" top="16" left="193" TL_SEQ="647"/>
              <CheckBox id="chb_BadDebtFlag" taborder="3" text="채권대손" width="73" height="22" cssclass="sta_WF_DetailTit" truevalue="1" falsevalue="0" top="43" left="31" onchanged="div_Account_chb_BadDebtFlag_onchanged" TL_SEQ="648"/>
              <Calendar id="cal_BadDebtDate" taborder="4" left="109" top="45" width="102" height="20" dateformat="yyyy-MM-dd"/>
            </Layout>
          </Layouts>
        </Div>
      </Layout>
    </Layouts>
    <Script type="xscript5.1"><![CDATA[/************************************************************************************************
 * 01. 업무구분 : 프로젝트관리
 * 02. 화면명   : 매출계약 탭페이지(SP_Contract)
 * 03. 화면설명 : 매출계약 탭페이지
 * 04. 작성일   : 2018.09.24
 * 05. 작성자   : 채종한
 * 06. 수정이력 :
 ***********************************************************************************************
 *     수정일          이  름    사유
 ***********************************************************************************************
 *
 *
 *
 ***********************************************************************************************/


/************************************************************************************************
 * 공통 라이브러리 INCLUDE 영역
 ************************************************************************************************/
include "Script::CommTrans.xjs"
include "Script::CommGrid.xjs"
include "Script::CommUtil.xjs"
include "Script::CommSystem.xjs"
include "Script::ext_CommEco.xjs"

/************************************************************************************************
 * 전역 변수 영역
 ************************************************************************************************/
this.FV_PARENT_FORM = this.parent.parent.parent;

this.FV_AUTH_ALL_FLAG = false;		// 전체권한(추가,삭제,저장)
this.FV_AUTH_PERSON_FLAG = false;	// 담당영업 권한
this.FV_AUTH_PROMISE_FLAG = false;	// 약속수정 권한
this.FV_AUTH_SALES_PROGRESS_FLAG = false	// 진행사항 권한

this.FV_SAVE_CURROW = 0;	// 저장처리 시점의 Row Index
this.FV_SAVE_KEY = "";		// 신규건 저장하는 경우 위치가 변경 될수 있음(Key 값을 통해 위치 찾음)

this.FV_SMS_SEND_MA = false; // 유지보수 계약이 신규이고 정기방문이 "방문" 여부 체크
this.FV_DEL_FLAG = false;	// 삭제 TRANS 발생 여부

this.FV_CO_CD = "A01";		// 로그인 회사 코드
this.contract_div = this.div_ContractInfo.form.div_ContractMain_K;		// 계약 정보 법인별 Div object 변수
this.FV_AUTH_PRICE_MASK = false;
 
 /************************************************************************************************
 * FORM 영역
 ************************************************************************************************/
this.SP_Contract_onload = function(obj:nexacro.Form, e:nexacro.LoadEventInfo)
{
//	 this.FV_CO_CD = nexacro.getApplication().gdsUserInfo.getColumn(0, "CO_CD");	//로그인 회사코드
	 
/*		this.div_ContractInfo.form.div_ContractMain_J.set_visible(false);*/
		this.contract_div = this.div_ContractInfo.form.div_ContractMain_K;				// 계약 정보 법인별 Div object 변수 세팅
		
		this.tab_Progress.tpg_Royalty.form.stc_NetSalesPrice.set_visible(false);		// 순매출 금액
		this.tab_Progress.tpg_Royalty.form.medt_NetSalesPrice.set_visible(false);		// 순매출 금액
		this.tab_Progress.tpg_Royalty.form.btn_RoyaltyConfirm.set_visible(false);		// 로열티 적용 버튼
		
		this.tab_Progress.tpg_Royalty.form.ta_RoyaltyRemarks.set_visible(false);		// (국내) 로열티 비고 미사용
		this.tab_Progress.tpg_Royalty.form.ta_Remarks.set_top(62);						// (국내) 비고는 로열티비고 + 비고 보여줌

// 	} else {
// 		this.div_ContractInfo.form.div_ContractMain_K.set_visible(false);
// 		this.contract_div = this.div_ContractInfo.form.div_ContractMain_J;				// 계약 정보 법인별 Div object 변수 세팅
// 		this.div_ContractInfo.form.div_ContractSub.set_top(160);
// 		
// 		// 일본 법인 라이선스 관련 버튼 사용 안함
// 		this.div_ContractInfo.form.btn_Online.set_visible(false);
// 		this.div_ContractInfo.form.btn_RequestLicense.set_visible(false);
// 	 }
	 
	 
	 this.gfnCompInit(obj);  	// Grid 공통함수 호출
	 this.fnSetComCmbConfig();	// 거래처 공통 검색 Div 세팅
	 
	 
	//if (this.commUtil.getFormAuthority(242,25))	this.FV_AUTH_PRICE_MASK = true;	// 계약금액 마스킹 처리 권한

// 	this.fn_setPriceMasking(this.div_ContractInfo.form.div_ContractMain_J.form.medt_ContractPrice);
// 	this.fn_setPriceMasking(this.div_ContractInfo.form.div_ContractMain_J.form.medt_Royalty);	
	 this.fnGetCode();
};



// 권한 처리 
this.fnAuthConfig = function()
{
	var bDisableFlag;
	var sLoginEmpNo = nexacro.getApplication().gdsUserInfo.getColumn(0, "EMP_NO");
	var sContractType = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_TYPE");
	if (this.gfnIsEmpty(sContractType)) sContractType = "P";
	
	if (this.commUtil.getFormAuthority(242,8)) {	/*	전체 권한	*/
		 this.FV_AUTH_ALL_FLAG = true;
		 bDisableFlag = false;
	} else {										/* 조회 전용 (하단 입력항목 일부허용 처리)	*/
		bDisableFlag = true;
	}
	
		
	// 예외대상 목록
	var arrCompInfo = new Array();
	arrCompInfo.push(this.div_ContractInfo.form.div_Attachment);		// 파일 버튼
	arrCompInfo.push(this.contract_div.form.cmb_ContractType);			// 계약구분
	arrCompInfo.push(this.contract_div.form.edt_ContractEnroll);		// 계약등록자
	arrCompInfo.push(this.contract_div.form.medt_ContractPrice);		// 계약금액
	
	arrCompInfo.push(this.div_ContractInfo.form.btn_RequestLicense);	// 라이선스 요청버튼
	arrCompInfo.push(this.div_ContractInfo.form.btn_Online);			// 온라인LIC 요청버튼
	arrCompInfo.push(this.div_ContractInfo.form.div_ContractMain_K.form.btn_Account);			// 회계용 버튼
	arrCompInfo.push(this.div_Account);									// 회계용 진행율 div
	
	if (this.FV_CO_CD != "J02") {
		arrCompInfo.push(this.contract_div.form.btn_MaintenceEmail);	// 점검이력메일 버튼
	} else {
		arrCompInfo.push(this.contract_div.form.medt_Royalty);			// 로열티 금액
	}
	
	if (sContractType == "P" || sContractType == "G") {
		arrCompInfo.push(this.div_ContractInfo.form.div_ContractSub.form.cal_StartDt);		// [제품계약] 시작일
		arrCompInfo.push(this.div_ContractInfo.form.div_ContractSub.form.cal_EndDt);		// [제품계약] 종료일
		arrCompInfo.push(this.div_ContractInfo.form.div_ContractSub.form.cal_ResultDt);		// [제품계약] 실적반영일
		arrCompInfo.push(this.div_ContractInfo.form.div_ContractSub.form.cal_LICDate);		// [제품계약] LIC 발급일
	}
	else if (sContractType == "S" || sContractType == "T") {
		arrCompInfo.push(this.div_ContractInfo.form.div_ContractSub.form.edt_WithDrawUser);	// [용역계약]철수(일자) 등록자
		arrCompInfo.push(this.div_ContractInfo.form.div_ContractSub.form.medt_Menmonth);	// [용역계약]MM
	}
	
	// Form 전체 처리
	this.gfnCompDisable(this, bDisableFlag, arrCompInfo);
	
	
	// 세부Tab 처리
	this.gfnCompDisable(this.tab_Progress.tpg_Remark.form, bDisableFlag, arrCompInfo);			// 비고
	this.gfnCompDisable(this.tab_Progress.tpg_Maintenance.form, bDisableFlag, arrCompInfo);		// 통합유지보수
	this.gfnCompDisable(this.tab_Progress.tpg_Promise.form, bDisableFlag, arrCompInfo);			// 약속
	this.gfnCompDisable(this.tab_Progress.tpg_Royalty.form, bDisableFlag, arrCompInfo);			// royalty
	
	
	// 진행사항
	if ((this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "SALES_EMP_NO") == sLoginEmpNo)
		|| (this.FV_AUTH_ALL_FLAG)) {
		this.gfnCompDisable(this.tab_Progress.tpg_SalesProgess.form, false);
		this.FV_AUTH_SALES_PROGRESS_FLAG = true;
	} else {
		this.gfnCompDisable(this.tab_Progress.tpg_SalesProgess.form, bDisableFlag);
		this.FV_AUTH_SALES_PROGRESS_FLAG = false;
	}
	
	
	
	
	// 진행율 관련 권한 (진행제외, 진행100%, 진행포함)
	if (this.commUtil.getFormAuthority(242,3)) {
		this.contract_div.form.btn_Account.set_visible(true);
	} else {
		this.contract_div.form.btn_Account.set_visible(false);
	}
	
	
	// 담당영업, 인센티브담당자 수정 권한
	var bReadOnly;
	if (this.commUtil.getFormAuthority(242,5)) {
		bReadOnly = false;
	} else {
		bReadOnly = true;
	}
	this.contract_div.form.cmb_Incentive.set_readonly(bReadOnly);
	this.contract_div.form.cmb_SalesEmpNo.set_readonly(bReadOnly);
	
	// 담당자 수정권한
	if (this.commUtil.getFormAuthority(242,7)) {
		this.contract_div.form.cmb_SalesEmpNo.set_readonly(false);
		this.FV_AUTH_PERSON_FLAG = true;
	}
	
	// 약속 수정 권한
	if (this.commUtil.getFormAuthority(242,4)) {
		this.gfnCompDisable(this.tab_Progress.tpg_Promise.form, false);			// 약속
		this.FV_AUTH_PROMISE_FLAG = true;
	} else {
		this.gfnCompDisable(this.tab_Progress.tpg_Promise.form, true);			// 약속
		this.FV_AUTH_PROMISE_FLAG = false;
	}
	
	// 납품일자 수정 권한
	if (sContractType == "P" || sContractType == "G") {
		if (this.commUtil.getFormAuthority(242,2)) {
			this.div_ContractInfo.form.div_ContractSub.form.cal_FreeMaEndDate.set_readonly(false);
		}
	}
		
	// 용역 철수일 수정 권한
	if (sContractType == "S") {
		if (this.div_ContractInfo.form.div_ContractSub.form.name == "SP_ContractSI") {
			if (this.commUtil.getFormAuthority(242,6)) {
				this.div_ContractInfo.form.div_ContractSub.form.cal_WithDrawDate.set_readonly(false);
			}
		}
	}
	
	//사후원가표 저장 권한
	if (this.commUtil.getFormAuthority(242,12)) {
		this.div_ContractInfo.form.btn_CostSheet.set_enable(true);
	}	
	
	var sContractNo = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_NO");
	if ( this.gfnIsEmpty(sContractNo)) {
		this.div_ContractInfo.form.div_Attachment.set_enable(false);
	} else {
		this.div_ContractInfo.form.div_Attachment.set_enable(true);
	}
	
	// 계약변경이력 메일발신 권한 -> TBJ 사용 안함
	if (this.commUtil.getFormAuthority(242,17) && this.FV_CO_CD != "J02") {
		this.div_ContractInfo.form.btn_HistoryMail.set_enable(true);
		// 점검이력메일 권한( 계약변경이력 메일발신 권한 동일하게 사용)
		this.contract_div.form.btn_MaintenceEmail.set_visible(true);
	}
	
	//상품순매출 체크 권한
	if(this.commUtil.getFormAuthority(243,1))	
	{
		this.contract_div.form.chb_NetSales.set_enable(true);
	}
	
	//Annual 수정권한
	if (this.commUtil.getFormAuthority(242,19) && this.gfnIsXComponent(this.div_ContractInfo.form.div_ContractSub.form.chb_Annual)) {
		this.div_ContractInfo.form.div_ContractSub.form.chb_Annual.set_readonly(false);
	}	
}

 /************************************************************************************************
 * TRANSACTION 및 추가 FUNCTION 영역
 ************************************************************************************************/
  // 공통코드 조회
 this.fnGetCode = function()
 {
 	this.gfnAddCodeDataset("ds_cmm_ContractType",	"CONTRACT_TYPE"); 		// 계약구분
	this.gfnAddCodeDataset("ds_cmm_PayMethod",		"PAY_METHOD"); 			// 결제조건
	this.gfnAddCodeDataset("ds_cmm_SalesStatus",	"SALES_STATUS"); 		// 영업상태
	this.gfnAddCodeDataset("ds_cmm_BusinessType",	"BUSINESS_TYPE");		// 사업구분
	
	this.gfnAddCodeDataset("ds_cmm_Purpose",		"PURPOSE"); 			// 용도
	this.gfnAddCodeDataset("ds_cmm_ServerGrade",	"SERVER_GRADE"); 		// 서버등급
	this.gfnAddCodeDataset("ds_cmm_ContProdType",	"CONTRACT_PROD_TYPE"); 	// 유형
	this.gfnAddCodeDataset("ds_cmm_ProductUnit",	"PRODUCT_UNIT"); 		// 단위
	
	this.gfnAddCodeDataset("ds_cmm_Area",			"AREA_CODE"); 			// 근무지역
	this.gfnAddCodeDataset("ds_cmm_Role",			"ROLE_CODE"); 			// 역할코드
	this.gfnAddCodeDataset("ds_cmm_Level",			"LEVEL_CODE"); 			// 등급
	
	this.gfnAddCodeDataset("ds_cmm_Type",			"TYPE_CODE");			// 일정 구분
	this.gfnAddCodeDataset("ds_cmm_Importance",		"IMPORTANCE");			// 일정 중요도 코드
	this.gfnAddCodeDataset("ds_cmm_PromiseKind",	"PROMISE_KIND"); 		// 약속종류
	this.gfnAddCodeDataset("ds_cmm_MaCriteria",		"MA_CRITERIA"); 		// 유지보수 기준
	
	this.gfnAddCodeDataset("ds_cmm_CaGrade",		"CA_GRADE_CODE");		// 담당자 직급
	this.gfnAddCodeDataset("ds_cmm_CaRole",			"CA_ROLE_CODE");		// 담당자 역할
	this.gfnAddCodeDataset("ds_cmm_HoldOffice",		"CM0009");				// 재직여부
	
	this.gfnAddCodeDataset("ds_cmm_ExecutionType",	"EXECUTION_TYPE");		// 수행방법
	this.gfnAddCodeDataset("ds_cmm_TechSupportUnit","TECH_SUPPORT_UNIT");	// 단위(기술서비스)
	
	this.gfnAddCodeDataset("ds_cmm_MaStandard",		"MA_STANDARD");			// 유지보수 기준
	this.gfnAddCodeDataset("ds_CD_SUPPORT_STATUS"	,"SUPPORT_STATUS");		// 유지보수기술지원중단상태
	
	this.gfnAddCodeDataset("ds_cmm_ConsumptionTax"	,"CONSUMPTION_TAX");	// 소비세액
	
	
	this.gfnAddCodeDataset("ds_cmm_RoyaltyType"	,"ROYALTY_TYPE");	// 로열티 구분
	this.gfnAddCodeDataset("ds_cmm_ExchageStatus"	,"EXCHAGE_STATUS");	// 로열티 확정 여부
	
	this.gfnAddCodeDataset("ds_cmm_Product",			"AREA_CODE"); 			// 근무지역
	this.gfnAddCodeDataset("ds_cmm_Publisher_SI",		"PUBLISHER"); 			// 계산서발행처
	
	this.gfnCodeTransaction();

	// 공통코드 조회	
	// 조건값(Rarameter) 셋팅
	this.gfnAddSendParameter("BUSINESS_TYPE",		"");
		
	// 조회용 Output dataset 세팅
	this.gfnAddOutputDataset("ds_cmm_SalesEmp"	, "ds_output");
	this.gfnCommonTransaction("CO_SalesEmp_S01", "CO_SalesEmp_S01");
 };
 

 // 조회
 this.fn_QueryData = function()
 {
	if (!this.fn_getValidation("S"))	return;
	
	// 조건값 셋팅
	this.gfnAddSendParameter("PROJECT_CODE",	this.FV_PARENT_FORM.div_search.form.edt_ProjectCode.value);
		
	// 조회용 Output dataset 세팅
	this.gfnAddOutputDataset("ds_MainContract", "ds_output");
	this.gfnCommonTransaction("Select_M", "SP_Contract_S01", this.grd_ContractList);
 };
 
 
 this.fn_DupUnionContractNo = function (sContractNo)
 {
	this.gfnAddSendParameter("PROJECT_CODE",		this.FV_PARENT_FORM.div_search.form.edt_ProjectCode.value);
	this.gfnAddSendParameter("UNION_CONTRACT_NO",	sContractNo);
	
	// 조회용 Output dataset 세팅
	this.gfnAddOutputDataset("ds_DupUionContr", "ds_output");
	this.gfnCommonTransaction("DupUnionContractNo", "SP_Contract_S03", null, false);
 }
 
   // 세부 조회
 this.fn_ContractDetailQueryData = function(nRow)
 {
	// 조건값 셋팅
	this.gfnAddSendParameter("PROJECT_CODE",	this.ds_MainContract.getColumn(nRow, "PROJECT_CODE"));
	this.gfnAddSendParameter("CONTRACT_NO",		this.ds_MainContract.getColumn(nRow, "CONTRACT_NO"));
	this.gfnAddSendParameter("CONTRACT_TYPE",	this.ds_MainContract.getColumn(nRow, "CONTRACT_TYPE"));
	
	// 조회용 Output dataset 세팅
	this.gfnAddOutputDataset("ds_ContractProdDet",	"ds_prod_det");
	this.gfnAddOutputDataset("ds_ContractSiDet",	"ds_si_det");
	this.gfnAddOutputDataset("ds_ContractMaDet",	"ds_ma_det");
	
	this.gfnAddOutputDataset("ds_ScheduleList",		"ds_output1");
	this.gfnAddOutputDataset("ds_AddressbookList",	"ds_output2");
	this.gfnAddOutputDataset("ds_MaUnion", 			"ds_output3");
	this.gfnAddOutputDataset("ds_Promise", 			"ds_output4");
	this.gfnAddOutputDataset("ds_ContractBill",		"ds_output5");
	this.gfnAddOutputDataset("ds_Royalty",			"ds_output6");
	
	this.gfnCommonTransaction("Select_S", "SP_Contract_S02", this.grd_ContractDetail);
 }
 
 // (계약대표)제품 조회
  this.fn_ProductQueryData = function(sContractType)
{
	if (this.gfnIsEmpty(sContractType)) {
		this.ds_cmm_Product.clearData();
		return;
	}
	
	if (sContractType == "S" || sContractType == "T")	sContractType = "P";
	if (sContractType == "M")	sContractType = "P";
	
	this.gfnAddSendParameter("CONTRACT_TYPE",		sContractType);
	this.gfnAddSendParameter("MAIN_PRODUCT_FLAG",	"1");
	this.gfnAddSendParameter("E03",		"E03");
	this.gfnAddOutputDataset("ds_cmm_Product", 	"dsOutput");
	this.gfnCommonTransaction("AP_SalesProductMM_S01", "AP_SalesProductMM_S01");
	
}
 
 // 등급단가 조회
 this.fn_LevelUnitCostQueryData = function(sYear, sLevelCd)
 {
	this.gfnAddSendParameter("YEAR", sYear);
	this.gfnAddSendParameter("LEVEL_CODE", sLevelCd);
	this.gfnAddOutputDataset("ds_comm_LevelUnitCost", "ds_output");
	this.gfnCommonTransaction("CO_LevelUnitCost_S01", "CO_LevelUnitCost_S01");
 }
 
  
   // 환율 정보 조회
 this.fn_ExchageQueryData = function()
 {
	// 조건값 셋팅
	this.gfnAddSendParameter("ROYALTY_DATE",		this.ds_Royalty.getColumn(0, "ROYALTY_DATE"));
	
	if (this.ds_Royalty.getColumn(0, "ROYALTY_TYPE") == "NW") {
		this.gfnAddSendParameter("COUNTER_CURRENCY",	"003");
	} else {
		this.gfnAddSendParameter("COUNTER_CURRENCY",	"002");
	}
	
		
	// 조회용 Output dataset 세팅
	this.gfnAddOutputDataset("ds_ExchageInfo", "ds_output");
	this.gfnCommonTransaction("ExchangeSelect", "SP_Contract_S07");
 };
 
 
 this.fn_GetSaveCurrow = function()
 {
	var nRetVal = 0;
	for (var i=0; i<this.ds_MainContract.rowcount; i++) 
	{
		var sCompKey = this.ds_MainContract.getColumn(i, "CONTRACT_DATE") + "/" + this.ds_MainContract.getColumn(i, "CONTRACT_NAME");
		if (this.FV_SAVE_KEY == sCompKey) {
			nRetVal = i;
			break;
		}
	}
	
	//this.FV_SAVE_KEY = "";
	return nRetVal
 }
 
 
 
  
 // 저장 처리
 this.fn_SaveData = function ()
 {
	if (!this.fn_getValidation("T")) return;	
	
	
	this.FV_SAVE_KEY = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_DATE") + "/" + this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_NAME");
	//this.FV_SAVE_CURROW = this.ds_MainContract.rowposition;
	
	// 신규 유지보수이고 정기방문이 "방문" 체크
	if (this.FV_CO_CD != "J02")	{
		this.FV_SMS_SEND_MA = this.fnCheckSendSMSMA();
	}	

	//저장용 Input Dataset 세팅
	this.gfnAddInputDataset("ds_MainContract",		"ds_contract", "U");
	this.gfnAddInputDataset("ds_ContractProdDet",	"ds_contract_p_det", "U");
	this.gfnAddInputDataset("ds_ContractSiDet",		"ds_contract_s_det", "U");
	this.gfnAddInputDataset("ds_ContractMaDet",		"ds_contract_m_det", "U");
	this.gfnAddInputDataset("ds_ScheduleList",		"ds_schedul", "U");
	this.gfnAddInputDataset("ds_AddressbookList",	"ds_addressbook", "U");
	this.gfnAddInputDataset("ds_MaUnion",			"ds_ma_union", "U");
	this.gfnAddInputDataset("ds_Promise",			"ds_promise", "U");
	this.gfnAddInputDataset("ds_Royalty",			"ds_royalty", "U");
	
	this.gfnCommonTransaction("Save", "SP_Contract_R01");
 }
 
 // 계약확정 취소
 this.fn_ContractCancelData = function ()
 {
	// this.FV_SAVE_CURROW = 0;
	this.FV_SAVE_KEY = "";
	
	var sContractNo = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_NO");
	var sContractName = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_NAME");
	var sContractType = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_TYPE");
	var sProjectCode = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "PROJECT_CODE");
	
	
	if( this.confirm(sContractName + this.gfnGetTransTxt(1888, "계약의 계약확정을 취소 하시겠습니까?")) )
	{
		if(this.FV_CO_CD == "J02") {
			this.ds_checkProduct.clearData();
			
			if(sContractType == "P" || sContractType == "G") {
				this.gfnAddSendParameter("PROJECT_CODE",  sProjectCode);
				this.gfnAddSendParameter("CONTRACT_NO",  sContractNo);
				this.gfnAddSendParameter("CONTRACT_STATUS",  "3");
				this.gfnAddSendParameter("TARGET_CONTRACT_STATUS",  "2");
				this.gfnAddOutputDataset("ds_checkProduct",	"ds_output");
				this.gfnCommonTransaction("SS_Contract_S02", "SS_Contract_S02", null, false);
			}
						
			if(this.ds_checkProduct.rowcount > 0) {
				if(this.confirm(this.gfnGetTransTxt(32857,"영업관리에 해당 프로젝트 가계약에 동일한 제품 또는 상품이 있습니다. 그래도 계약취소 처리를 하시겠습니까? 확인 : 계약취소"))) {
					this.gfnAddSendParameter("CONTRACT_NO",	sContractNo);	
					this.gfnCommonTransaction("ContractCancel", "SP_Contract_R03");
				}
			} else {
				this.gfnAddSendParameter("CONTRACT_NO",	sContractNo);	
				this.gfnCommonTransaction("ContractCancel", "SP_Contract_R03");
			}
		} else {
			this.gfnAddSendParameter("CONTRACT_NO",	sContractNo);	
			this.gfnCommonTransaction("ContractCancel", "SP_Contract_R03");
		}
	}
 }
// 화면 콜백
 this.fnCallBack = function (strSvcID, nErrorCode, strErrorMag)
 {
	if (nErrorCode<0) {
		this.alert("["+strSvcID+":"+nErrorCode+"] "+strErrorMag);
		return;
	} else {
		switch (strSvcID) 
		{
			case "gfnGetCode" :			
				this.ds_cmm_ContractType.filter("VAL1=='1'");
				this.ds_cmm_ServerGrade.insertRow(0);
				this.ds_cmm_ServerGrade.setColumn(0, "CAPTION", " ");
				
				break;
			case "CO_SalesEmp_S01" :
				// trace("CO_SalesEmp_S01 !!");
				break;
			case "Select_M" :				
				this.FV_PARENT_FORM.fnAuthConfig();
				if (this.ds_MainContract.rowcount == 0 && this.commUtil.getFormAuthority(242,8))
				{
					/*신규프로젝트 추가시 조회되는 계약이 없음, 
					추가, 삭제 권한이 있을경우 계약 자동으로 1개 추가(초기화 문제때문에)*/
					this.fn_AddRecord();
				}				
				
				var nSaveCurrow = this.fn_GetSaveCurrow();
				if (nSaveCurrow > 0) {
					// 저장 처리시 이전 Row로 rowposition 위치 이동(rowposition:0 무시)
					var nRow = nSaveCurrow;
					this.FV_SAVE_KEY = "";
					//this.FV_SAVE_CURROW = 0;
					
					this.div_ContractInfo.form.div_Attachment.set_enableevent(false);
					this.ds_MainContract.set_enableevent(false);
					this.ds_MainContract.set_rowposition(nRow);
					
					// 첨부파일 버튼 초기화
					//this.div_ContractInfo.form.div_Attachment.form.fnSearch();
					this.fnSetFileInit();
					this.ds_MainContract.set_enableevent(true);
					this.div_ContractInfo.form.div_Attachment.set_enableevent(true);
					
					// 세부 조회
					this.fn_ContractDetailQueryData (nRow);
				}
				
				
				this.fn_setPriceMasking(this.contract_div.form.medt_ContractPrice);
				this.fn_setPriceMasking(this.contract_div.form.medt_Royalty);
				break;
			case "Select_S" :
				
				this.fn_setRoyaltyCompCtl();		// 로열티 컴포넌트 활성화 컨트롤
				
				this.fnCheckDetGridScroll();
				this.fn_setInitContractStartEndDt(this.ds_MainContract.rowposition);
				this.fnSetSiMMStaticChange();
				
				
				break;
			case "AP_SalesProductMM_S01" :
				break;
			case "CO_LevelUnitCost_S01" :
				var sUnitCost = this.ds_comm_LevelUnitCost.getColumn(0, "UNIT_COST");
				this.ds_ContractSiDet.set_enableevent(false);
				this.ds_ContractSiDet.setColumn(this.ds_ContractSiDet.rowposition, "LEVEL_UNIT_COST", sUnitCost);
				// this.ds_ContractSiDet.setColumn(this.ds_ContractSiDet.rowposition, "UNIT_COST", sUnitCost);
				this.ds_ContractSiDet.set_enableevent(true);
				break;
			case "ExchangeSelect":
				var sExchangeStatus = "DEF";
				if (this.ds_ExchageInfo.getColumn(0, "CONFIRM_FLAG") == "1")	sExchangeStatus = "CONF";
				
				this.ds_Royalty.setColumn(0, "EXCHAGE_STATUS", sExchangeStatus);
				this.ds_Royalty.setColumn(0, "EXCHAGE_RATE", this.ds_ExchageInfo.getColumn(0, "EXCHAGE_RATE"));
				
				this.fn_setRoyaltyPriceChange();		// 로열티 재설정 처리
				
				break;
			case "Save" :
				if(this.FV_SMS_SEND_MA) {
					this.fnSendSMS();
				} else {
					this.fn_QueryData();
				}
				break;
			case "MaCopyAdd" :
			case "ContractCancel" :
				this.fn_QueryData();
				break;
			case "getMM":
				if (this.ds_MM.rowcount>0) {
					var nMM = this.ds_MM.getColumn(0, "MM");
					var nROW = this.ds_MM.getColumn(0, "ROW");
					this.ds_ContractSiDet.setColumn(nROW, "MEN_MONTH", nMM);
				}
				break;
			case "SendSMS" : 
				this.alert(this.gfnGetTransTxt(22586, "유지보수 담당자 SMS 메시지 발송 완료 했습니다."));
				this.fn_QueryData();
				break;
			case "InsertMaEstimateDet" :
	var duplicationFlag = false;
	if(this.ds_EstimateUnionContract.rowcount > 0) {
		for(var i = 0; i < this.ds_EstimateUnionContract.rowcount; i++) {
			this.fn_DupUnionContractNo(this.ds_EstimateUnionContract.getColumn(i, "UNION_CONTRACT_NO"));
			if (this.ds_DupUionContr.rowcount > 0) {
				var sMsg = "";
				for (var i=0; i<this.ds_DupUionContr.rowcount; i++) {
					var sClientNm = this.ds_DupUionContr.getColumn(i, "CLIENT_NAME");
					var sContractNm = this.ds_DupUionContr.getColumn(i, "CONTRACT_NAME");
					sMsg += "["+sClientNm+"]-"+sContractNm+"\n";
				}
				sMsg += "해당 유지보수 계약에서 이미 사용하고 있습니다. 확인 하세요"
				this.alert(sMsg + this.gfnGetTransTxt(1281, "해당 유지보수 계약에서 이미 사용하고 있습니다. 확인 하세요"));
				duplicationFlag = true;
			}
			if(duplicationFlag) break;
		}
	}
	
	if(!duplicationFlag) {
		var sContractNo = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_NO");
		if(this.ds_EstimateContractMa.rowcount > 0) {
			var ds = this.ds_EstimateContractMa;
			var sStartDate =  ds.getColumn(0, "START_DATE");
			var sEndDate =  ds.getColumn(0, "END_DATE");
			var sConsumptionTax =  ds.getColumn(0, "CONSUMPTION_TAX");
			var sPayMethod =  ds.getColumn(0, "PAY_METHOD");
			var sContractMain =  ds.getColumn(0, "CONTRACT_MAIN");
			var sContractMainName =  ds.getColumn(0, "CONTRACT_MAIN_NAME");
			var sSalesStatus =  ds.getColumn(0, "SALES_STATUS");
			var sContractName =  ds.getColumn(0, "CONTRACT_NAME");
			
			var curRow = this.ds_MainContract.rowposition;
			
			this.ds_MainContract.setColumn(curRow, "PAY_METHOD", sPayMethod);
			this.ds_MainContract.setColumn(curRow, "START_DATE", sStartDate);
			this.ds_MainContract.setColumn(curRow, "END_DATE", sEndDate);
			this.ds_MainContract.setColumn(curRow, "CONSUMPTION_TAX", sConsumptionTax);
			this.ds_MainContract.setColumn(curRow, "CONTRACT_MAIN", sContractMain);
			this.ds_MainContract.setColumn(curRow, "CONTRACT_MAIN_NAME", sContractMainName);
			this.ds_MainContract.setColumn(curRow, "SALES_STATUS", sSalesStatus);
			this.ds_MainContract.setColumn(curRow, "CONTRACT_NAME", sContractName);
		}
		
		if(this.ds_EstimateContractMaDet.rowcount > 0) {
			var ds = this.ds_EstimateContractMaDet;
			var targetDs = this.ds_ContractMaDet;
			for(var i = 0; i < this.ds_EstimateContractMaDet.rowcount; i++) {
				var sMaMainProductCode = ds.getColumn(i, "MA_MAIN_PRODUCT_CODE");
				var sMaMainProductName = ds.getColumn(i, "MA_MAIN_PRODUCT_NAME");
				var sStartDate = ds.getColumn(i, "START_DATE");
				var sEndDate = ds.getColumn(i, "END_DATE");
				var sMaRate = ds.getColumn(i, "MA_RATE");
				var sMaStandard = ds.getColumn(i, "MA_STANDARD");
				var sContractPrice = ds.getColumn(i, "CONTRACT_PRICE");
				var sMaProductCode = ds.getColumn(i, "MA_PRODUCT_CODE");
				var sMaProductName = ds.getColumn(i, "MA_PRODUCT_NAME");
				
				var nRow = targetDs.addRow();
				
				targetDs.setColumn(nRow, "CONTRACT_NO", sContractNo);
				targetDs.setColumn(nRow, "PRODUCT_CODE", sMaMainProductCode);
				targetDs.setColumn(nRow, "PRODUCT_NAME", sMaMainProductName);
				targetDs.setColumn(nRow, "START_DATE", sStartDate);
				targetDs.setColumn(nRow, "END_DATE", sEndDate);
				targetDs.setColumn(nRow, "MA_RATE", sMaRate);
				targetDs.setColumn(nRow, "MA_STANDARD", sMaStandard);
				targetDs.setColumn(nRow, "CONTRACT_PRICE", sContractPrice);
				targetDs.setColumn(nRow, "MA_PRODUCT_CODE", sMaProductCode);
				targetDs.setColumn(nRow, "MA_PRODUCT_NAME", sMaProductName);
			}
		}
		
		if(this.ds_EstimateUnionContract.rowcount > 0) {
			this.ds_MaUnion.deleteAll();
			var targetUnionDs = this.ds_EstimateUnionContract;
			this.ds_MaUnion.set_enableevent(false);
			for(var i = 0; i < targetUnionDs.rowcount; i++) {
				var nRow = this.ds_MaUnion.addRow();
				this.ds_MaUnion.setColumn(nRow, "CONTRACT_NO", sContractNo);
				this.ds_MaUnion.setColumn(nRow, "UNION_PROJECT_CODE",	targetUnionDs.getColumn(i, "PROJECT_CODE"));
				this.ds_MaUnion.setColumn(nRow, "UNION_PROJECT_NAME",	targetUnionDs.getColumn(i, "PROJECT_NAME"));
				this.ds_MaUnion.setColumn(nRow, "UNION_CONTRACT_NO",	targetUnionDs.getColumn(i, "UNION_CONTRACT_NO"));
				this.ds_MaUnion.setColumn(nRow, "UNION_CONTRACT_NAME",	targetUnionDs.getColumn(i, "UNION_CONTRACT_NAME"));
				this.ds_MaUnion.setColumn(nRow, "CLIENT_CODE",			targetUnionDs.getColumn(i, "CLIENT_CODE"));
				this.ds_MaUnion.setColumn(nRow, "CLIENT_NAME",			targetUnionDs.getColumn(i, "CLIENT_NAME"));
				this.ds_MaUnion.setColumn(nRow, "PRODUCT_NAME",			targetUnionDs.getColumn(i, "PRODUCT_NAME"));
			}
			this.ds_MaUnion.set_enableevent(true);
		}
	}
	
	break;
		}
	}
 };
 
 // 로열티탭 적용 상태(신규, 1회이상, 확정등)에 따른 컴포넌트 컨트롤 처리
 this.fn_setRoyaltyCompCtl = function()
 {
	var bCompEnableFlag = false;
	
	if (this.ds_Royalty.rowcount <= 0) {
		// 로열티 미적용
		bCompEnableFlag = false;
	} else {
		
		if (this.gfnIsEmpty(this.ds_Royalty.getColumn(0, "ROYALTY_CONTRACT_NO"))) {
			// 신규
			this.tab_Progress.tpg_Royalty.form.cal_RoyaltyDt.set_enable(true);			// 로열티 반영일
			
			this.fn_setRoyaltyPriceChange();		// 로열티 재설정 처리
			bCompEnableFlag = true;	
		} else {
			// 로열티 1회 이상 반영			
			if (this.ds_Royalty.getColumn(0, "CONFIRM_FLAG") == "1") {
				// 로열티 확정 반영 (모든 항목을 수정 할수 없음)
				//this.tab_Progress.tpg_Royalty.form.chb_ConfirmFlag.set_enable(false);	// 로열티 확정 (비활성화)
				bCompEnableFlag = false;
			} else {
				// 로열티 미확정 반영 (로열티 적용을 한번이라도 진행한 경우 반영일자는 변경 불가)
				//this.tab_Progress.tpg_Royalty.form.chb_ConfirmFlag.set_enable(true);	// 로열티 확정 (활성화)
				this.fn_setRoyaltyPriceChange();		// 로열티 재설정 처리
				bCompEnableFlag = true;
			}
			
			this.tab_Progress.tpg_Royalty.form.cal_RoyaltyDt.set_enable(bCompEnableFlag);	// 로열티 반영일(로열티 확정전 이면 변경 가능)
		}
	}
	
	this.tab_Progress.tpg_Royalty.form.chb_ConfirmFlag.set_enable(bCompEnableFlag);		// 로열티 확정 (활성화)
	//this.tab_Progress.tpg_Royalty.form.ta_Remarks.set_enable(bCompEnableFlag);			// 로열티 비고
	//this.tab_Progress.tpg_Royalty.form.btn_RoyaltyConfirm.set_enable(bCompEnableFlag);	// 로열티 적용 버튼
	
	if (this.FV_CO_CD != "J02")
	{
		// 국내인 경우 로열티 적용 버튼, 확정 버튼 비활성화
		if (this.gfnIsEmpty(this.ds_Royalty.getColumn(0, "REMARKS_KOR"))) {
			this.ds_Royalty.setColumn(0, "REMARKS", this.ds_Royalty.getColumn(0, "ROYALTY_REMARKS_KOR"));
		} else {
			this.ds_Royalty.setColumn(0, "REMARKS", this.ds_Royalty.getColumn(0, "ROYALTY_REMARKS_KOR") +"\n"+ this.ds_Royalty.getColumn(0, "REMARKS_KOR"));
		}
		
		this.tab_Progress.tpg_Royalty.form.btn_RoyaltyConfirm.set_visible(false);		// 로열티 적용 버튼
		this.tab_Progress.tpg_Royalty.form.chb_ConfirmFlag.set_visible(false);			// 로열티 확정 (활성화)
		
		this.tab_Progress.tpg_Royalty.form.ta_Remarks.set_readonly(true);				// 로열티 비고
	} else {
		// 일본법인(TBJ)인 경우만 로열티 적용 버튼, 확정 활성화
		if (this.ds_Royalty.getColumn(0, "ROYALTY_TYPE") == "NA") {
			this.tab_Progress.tpg_Royalty.form.btn_RoyaltyConfirm.set_visible(false);		// 로열티 적용 버튼
			this.tab_Progress.tpg_Royalty.form.chb_ConfirmFlag.set_visible(false);			// 로열티 확정 (활성화)
		} else {
			this.tab_Progress.tpg_Royalty.form.btn_RoyaltyConfirm.set_visible(true);		// 로열티 적용 버튼
			this.tab_Progress.tpg_Royalty.form.chb_ConfirmFlag.set_visible(true);			// 로열티 확정 (활성화)	
		}
	}
 }
  
 
 this.fn_setInitContractStartEndDt = function(nRow)
 {
	var ds;
	if (this.ds_MainContract.getColumn(nRow, "CONTRACT_TYPE") == "S" || this.ds_MainContract.getColumn(nRow, "CONTRACT_TYPE") == "T") {
		ds = this.ds_ContractSiDet;
	} else if (this.ds_MainContract.getColumn(nRow, "CONTRACT_TYPE") == "M") {
		ds = this.ds_ContractMaDet;
	}
	
	if (!this.gfnIsEmpty(ds)) {
		if (ds.rowcount > 0) {
			var sStartDt = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "START_DATE");
			var sEndDt = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "END_DATE");
			
			if (this.gfnIsEmpty(sStartDt)) {
				this.ds_MainContract.setColumn(this.ds_MainContract.rowposition, "START_DATE", ds.getMin("START_DATE"));
			}
			if (this.gfnIsEmpty(sEndDt)) {
				this.ds_MainContract.setColumn(this.ds_MainContract.rowposition, "END_DATE", ds.getMax("END_DATE"));
			}
		}
	}	
 }
  
 // 팝업 콜백
 this.fnPopupCallBack = function(sPopupId, Variant)
{
	Variant = this.commUtil.popupReturn();
	if(this.gfnIsEmpty(Variant))
	{
		return;
	}
	else
	{	
		this.recentVariant = Variant;
		switch(sPopupId)
		{
			case "popupProductSearch" : // 제품
				var ds = new nexacro.Dataset();
				ds.loadXML(Variant);
				this.recentVariant = ds;
			
				var sFormatId = this.grd_ContractDetail.formatid;
				if (sFormatId == "PROD") {
					var sProductCd = ds.getColumn(0, "PRODUCT_CODE");
					var sProductList = ds.getColumn(0, "PRODUCT_LIST");
					var sProductListNm = "";
					
					// PRODUCT_LIST_NAME
					if (!this.gfnIsEmpty(sProductList)) {
						var arrProductList = sProductList.split(",",3);
						for (var i=0; i<arrProductList.length; i++) {
							if (arrProductList[i] == "0") {
								sProductListNm += "S"
							} else if (arrProductList[i] == "1") {
								sProductListNm += "T"
							} else if (arrProductList[i] == "2") {
								sProductListNm += "C"
							}
						}
						if (sProductListNm.length>0) {
							sProductListNm = "[" + sProductListNm + "] ";
						}
					}
					
					this.ds_ContractProdDet.setColumn(this.ds_ContractProdDet.rowposition, "PRODUCT_CODE", sProductCd);
					this.ds_ContractProdDet.setColumn(this.ds_ContractProdDet.rowposition, "PRODUCT_NAME", ds.getColumn(0, "PRODUCT_NAME"));
					this.ds_ContractProdDet.setColumn(this.ds_ContractProdDet.rowposition, "PRODUCT_LIST_NAME", sProductListNm + ds.getColumn(0, "PRODUCT_NAME"));
					
					// PRODUCT_LIST
					this.ds_ContractProdDet.setColumn(this.ds_ContractProdDet.rowposition, "PRODUCT_LIST", ds.getColumn(0, "PRODUCT_LIST"));
					// PLATFORM_LIST
					this.ds_ContractProdDet.setColumn(this.ds_ContractProdDet.rowposition, "PLATFORM_LIST", ds.getColumn(0, "PLATFORM_LIST"));
					// FUNCTION_LIST	
					this.ds_ContractProdDet.setColumn(this.ds_ContractProdDet.rowposition, "FUNCTION_LIST", ds.getColumn(0, "FUNCTION_LIST"));
					
					// 제품선택시 Tools 및 Developer 선택시 단위Dev 세팅
					if (sProductCd == "P010104" 
					|| sProductCd == "P010204"
					|| sProductCd == "P010304"
					|| sProductList == "1") {
						this.ds_ContractProdDet.setColumn(this.ds_ContractProdDet.rowposition, "PRODUCT_UNIT", "010");
 						var sQty = this.ds_ContractProdDet.getColumn(this.ds_ContractProdDet.rowposition, "QUANTITY");
						
						if (this.gfnIsEmpty(sQty) || sQty == "0") {
							this.ds_ContractProdDet.setColumn(this.ds_ContractProdDet.rowposition, "QUANTITY", "1");
						}
					}
				} else if (sFormatId == "MA") {
					this.ds_ContractMaDet.setColumn(this.ds_ContractMaDet.rowposition, "PRODUCT_CODE", ds.getColumn(0, "RELATED_PRODUCT_CODE"));
					this.ds_ContractMaDet.setColumn(this.ds_ContractMaDet.rowposition, "PRODUCT_NAME", ds.getColumn(0, "RELATED_PRODUCT_NAME"));
					this.ds_ContractMaDet.setColumn(this.ds_ContractMaDet.rowposition, "MA_PRODUCT_CODE", ds.getColumn(0, "PRODUCT_CODE"));
					this.ds_ContractMaDet.setColumn(this.ds_ContractMaDet.rowposition, "MA_PRODUCT_NAME", ds.getColumn(0, "PRODUCT_NAME"));
				}
			break;
			case "popupContractSearch" :
				var ds = new nexacro.Dataset();
				ds.loadXML(Variant);
				this.recentVariant = ds;

				var sUnionContractNo = ds.getColumn(0, "CONTRACT_NO");
				var nFindRow = this.ds_MaUnion.findRow("UNION_CONTRACT_NO", sUnionContractNo);
				if (nFindRow>=0) {
					this.alert(this.gfnGetTransTxt(1306, "해당 계약을 중복 등록 할수 없습니다."));
					return;
				}
				
				var sContractType = ds.getColumn(0, "CONTRACT_TYPE");
				if (sContractType != "P" && sContractType != "G") {
					this.alert(this.gfnGetTransTxt(1307, "제품(상품)계약만 연결가능합니다."));
					return;
				} else {
					
					this.fn_DupUnionContractNo(ds.getColumn(0, "CONTRACT_NO"));
					if (this.ds_DupUionContr.rowcount > 0) {
						var sMsg = "";
						for (var i=0; i<this.ds_DupUionContr.rowcount; i++) {
							var sClientNm = this.ds_DupUionContr.getColumn(i, "CLIENT_NAME");
							var sContractNm = this.ds_DupUionContr.getColumn(i, "CONTRACT_NAME");
							sMsg += "["+sClientNm+"]-"+sContractNm+"\n";
						}
						sMsg += "해당 유지보수 계약에서 이미 사용하고 있습니다. 확인 하세요"
						this.alert(sMsg + this.gfnGetTransTxt(1281, "해당 유지보수 계약에서 이미 사용하고 있습니다. 확인 하세요"));
					}
					
					var sContractNo = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_NO");
					this.ds_MaUnion.set_enableevent(false);
					var nRow = this.ds_MaUnion.addRow();
					this.ds_MaUnion.setColumn(nRow, "CONTRACT_NO", sContractNo);
					this.ds_MaUnion.setColumn(nRow, "UNION_PROJECT_CODE",	ds.getColumn(0, "PROJECT_CODE"));
					this.ds_MaUnion.setColumn(nRow, "UNION_PROJECT_NAME",	ds.getColumn(0, "PROJECT_NAME"));
					this.ds_MaUnion.setColumn(nRow, "UNION_CONTRACT_NO",	ds.getColumn(0, "CONTRACT_NO"));
					this.ds_MaUnion.setColumn(nRow, "UNION_CONTRACT_NAME",	ds.getColumn(0, "CONTRACT_NAME"));
					this.ds_MaUnion.setColumn(nRow, "CLIENT_CODE",			ds.getColumn(0, "CLIENT_CODE"));
					this.ds_MaUnion.setColumn(nRow, "CLIENT_NAME",			ds.getColumn(0, "CLIENT_NAME"));
					this.ds_MaUnion.setColumn(nRow, "PRODUCT_NAME",			ds.getColumn(0, "PRODUCT_NAME"));
					this.ds_MaUnion.set_enableevent(true);
				}
			break;
			case "CompanyTypeSelect":
				var ds = new nexacro.Dataset();
				ds.loadXML(Variant);
				this.recentVariant = ds;
				
				// return 정보가 없으면 종료
				if (ds.rowcount<=0) return;
				
				for (var i=0; i<ds.rowcount; i++) {
					var nfindRow = this.ds_AddressbookList.findRow("CA_SEQ", ds.getColumn(i, "CA_SEQ"));
					if(nfindRow>=0)
					{
						this.alert(ds.getColumn(i, "EMP_NAME") + this.gfnGetTransTxt(1631, "의 중복 데이터가 존재 합니다."));
						//continue;
						return;
					}
					nfindRow = this.ds_AddressbookList.findRow("EMP_NAME", ds.getColumn(i, "EMP_NAME"));
					if(nfindRow>=0)
					{
							if( !this.confirm(ds.getColumn(i, "EMP_NAME") + this.gfnGetTransTxt(1675, " 동명이인이 존재 합니다. 계속진행하시겠습니까?")) )
							//continue;
							return;
					}
					// 담당자 정보 세팅
					this.ds_AddressbookList.set_enableevent(false);
					var nRow = this.ds_AddressbookList.addRow();					
					this.ds_AddressbookList.setColumn(nRow, "CA_SEQ",		ds.getColumn(i, "CA_SEQ"));
					this.ds_AddressbookList.setColumn(nRow, "SOURCE_CD",	"CL");
					this.ds_AddressbookList.setColumn(nRow, "SOURCE_DATA",	this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_NO"));
					this.ds_AddressbookList.setColumn(nRow, "COMPANY_NAME",	ds.getColumn(i, "COMPANY_NAME"));
					this.ds_AddressbookList.setColumn(nRow, "CA_SEQ",		ds.getColumn(i, "CA_SEQ"));
					this.ds_AddressbookList.setColumn(nRow, "DEPT_NAME",	ds.getColumn(i, "DEPT_NAME"));
					this.ds_AddressbookList.setColumn(nRow, "EMP_NAME",		ds.getColumn(i, "EMP_NAME"));
					this.ds_AddressbookList.setColumn(nRow, "GRADE_CODE",	ds.getColumn(i, "GRADE_CODE"));
					this.ds_AddressbookList.setColumn(nRow, "ROLE_CODE",	ds.getColumn(i, "ROLE_CODE"));
					this.ds_AddressbookList.setColumn(nRow, "H_PHONE_NO",	ds.getColumn(i, "H_PHONE_NO"));
					this.ds_AddressbookList.setColumn(nRow, "HOLD_OFFICE",	ds.getColumn(i, "HOLD_OFFICE"));
					this.ds_AddressbookList.setColumn(nRow, "O_PHONE_NO",	ds.getColumn(i, "O_PHONE_NO"));
					this.ds_AddressbookList.setColumn(nRow, "EMAIL",		ds.getColumn(i, "EMAIL"));
					this.ds_AddressbookList.setColumn(nRow, "REMARKS",		ds.getColumn(i, "REMARKS"));
					this.ds_AddressbookList.setColumn(nRow, "ETAX_FLAG",	ds.getColumn(i, "ETAX_FLAG"));
					this.ds_AddressbookList.setColumn(nRow, "ORDER_FLAG",	ds.getColumn(i, "ORDER_FLAG"));
					this.ds_AddressbookList.set_enableevent(true);
				}				
				
			break;
			case "popupRequestLicense":
				// 
			break;
			
			case "popupMAContractCopy":
				this.fn_QueryData();
			break;
			case "popupContractRoyaltyConfirmPop":
				//
			break;
		}
	}
}

this.fnCheckDetGridScroll= function()
{
	//매출계약 상세 그리드에 스크롤이 생길경우 추가삭제 버튼을 이동시킴
	if(this.grd_ContractDetail.vscrollbar.trackbar.getOffsetHeight()>0) {
		this.btn_Down.set_right(55);
		this.btn_Up.set_right(31);
	} else {
		this.btn_Down.set_right(35);
		this.btn_Up.set_right(11);
	}
	
	
	if (this.width > 1520) {
		this.tab_Progress.tpg_Maintenance.form.grd_ContractNumberList.set_autofittype("col");
	} else {
		this.tab_Progress.tpg_Maintenance.form.grd_ContractNumberList.set_autofittype("none");
	}
}

// 시작 종료일에 대한 MEN_MONTH 조회
this.fnGetMM = function(sStartDt, sEndDt, nRow) {
	if (this.gfnIsEmpty(sStartDt) || this.gfnIsEmpty(sEndDt)) {
		return;	
	}
	if (sStartDt>sEndDt)
	{
		return;
	}
	
	this.gfnAddSendParameter("START_DATE",	sStartDt);
	this.gfnAddSendParameter("END_DATE",	sEndDt);
	this.gfnAddSendParameter("ROW",			nRow);
	this.gfnAddOutputDataset("ds_MM", "ds_output");
	this.gfnCommonTransaction("getMM", "CO_GetMM_S01");
}

// 유지보수 계약 SMS 발송 여부 체크
this.fnCheckSendSMSMA = function() {
	/*
		만족하는 조건 : 	1. 현재 유지보수 계약 외 다른 유지보수 계약이 없는 경우
							AND
							2. 정기방문(REGULAR_VISIT)이 "없음"(001) 아닌 경우
							3. 점검주기(VIST_CYCLE)가 "없음"(001) 아닌 경우
	*/
	var bRtn = false;
	var sMaRow = this.ds_MainContract.findRow("CONTRACT_TYPE", "M");
	
	var sMACnt = this.ds_MainContract.getCaseCount("CONTRACT_TYPE=='M'");
	var sOrgReguilarVisit = this.ds_MainContract.getOrgColumn(sMaRow, "REGULAR_VISIT");  // 이전 정기방문 옵션
	var sReguilarVisit = this.ds_MainContract.getColumn(sMaRow, "REGULAR_VISIT"); // 정기방문 옵션
	var sOrgMaCycle = this.ds_MainContract.getOrgColumn(sMaRow, "VIST_CYCLE");  // 이전 점검주기
	var sMaCycle = this.ds_MainContract.getColumn(sMaRow, "VIST_CYCLE"); // 점검주기
	var sloginCd = this.FV_CO_CD;													//로그인회사코드
	
	//var sloginCd = nexacro.getApplication().gdsUserInfo.getColumn(0, "CO_CD");	//로그인회사코드
	
	var sRowType = this.ds_MainContract.getRowType(sMaRow);	// RowType
	
	// 삭제 TRANS가 아닌 경우만 SMS
	if(!this.FV_DEL_FLAG) {
		// 현재 등록한 유지보수 외 다른 유지보수 계약이 있는 경우 "갱신"으로 간주
		if(sMACnt == 1) {
			if(sRowType == 2) {
				if(sReguilarVisit != "001" && sMaCycle != "001" && sloginCd == "A01") bRtn = true;
				else bRtn = false;
			} else {
				// 정기방문 옵션이 변경 되거나 점검주기가 변경 시 두 항목 모두 "없음"이 아닌 경우 발송 
				if(sOrgReguilarVisit != sReguilarVisit || sOrgMaCycle != sMaCycle) {
					if(sReguilarVisit != "001" && sMaCycle != "001" && sloginCd == "A01") bRtn = true;
					else bRtn = false;
				} else {
					bRtn = false;
				}
			}
		} else {
			bRtn = false;
		}
	}
		
	return bRtn;
};

// sms 발송
this.fnSendSMS = function()
{
	var sMaRow = this.ds_MainContract.findRow("CONTRACT_TYPE", "M");
	
	var sSendType = "SELF";
	var sTelNoKind = "T";
	
	// Massage 처리
	var sClientNm = this.FV_PARENT_FORM.div_search.form.div_ClientName.getData();				// 고객사
	var sVisitCycle = this.div_ContractInfo.form.div_ContractSub.form.cmb_VisitCycle.text		// 점검주기
	var sReguilarVisit = this.div_ContractInfo.form.div_ContractSub.form.cmb_RegularVisit.text;	// 방문옵션
	var	sProductNm = this.contract_div.form.cmb_SalesProduct.text;		// 계약제품
	var sContractNm = this.ds_MainContract.getColumn(sMaRow, "CONTRACT_NAME");					// 계약명
	var sStartDt = this.ds_MainContract.getColumn(sMaRow, "START_DATE");						// 시작일
	var sEndDt = this.ds_MainContract.getColumn(sMaRow, "END_DATE");							// 종료일
	var sSalesEmpNm = this.ds_MainContract.getColumn(sMaRow, "SALES_EMP_NAME");					// 영업대표 명
	
	sStartDt = sStartDt.substring(0, 4) + "-" + sStartDt.substring(4, 6) + "-" + sStartDt.substring(6, 8);
	sEndDt = sEndDt.substring(0, 4) + "-" + sEndDt.substring(4, 6) + "-" + sEndDt.substring(6, 8);
	
	var sMsg = "<신규MA계약>\n" 
	sMsg	+= "["+ sClientNm +"] 점검주기 : " + sVisitCycle + " 방문옵션 : " + sReguilarVisit + " ( " + sProductNm + " )\n";
	sMsg	+= "계약명 : " + sContractNm + "\n";
	sMsg	+= "계약기간 : " + sStartDt + " ~ " + sEndDt +"\n";
	sMsg	+= "담당영업 : " + sSalesEmpNm;
	
	var arrSmsInfo = new Array();
	// [화면별 권한] 방문 유지보수 체결 SMS
	arrSmsInfo[0] = {};
	arrSmsInfo[0].pvUserKind = "FORM_AUTH";
	arrSmsInfo[0].pvUserCode = "242,11";		
	
	//this.gfnAddSmsList(arrSmsInfo);		// 수신자 처리 
	this.gfnAddAlimTalkList(arrSmsInfo);	// 알림톡 수신자 처리 
	
	//this.gfnSendSms ("SendSMS", sSendType, sTelNoKind, "", sMsg, "");	// SMS 발송
	this.gfnSendAlimTalk ("SendSMS", sSendType, sTelNoKind, "", sMsg, "", "NEW_MA_CONTRACT");	// 알림톡 발송
};
 /************************************************************************************************
 * FORM 공통 FUNCTION 영역
 ************************************************************************************************/
 // 공통 검색 Popup 설정 처리
this.fnSetComCmbConfig = function ()
{
	this.contract_div.form.div_ContractMain.form.param = "pvMode:2";
}

 // Validation check
 this.fn_getValidation = function(sMode)
 {
	if (sMode == "T") 			//// 등록 Validation 체크
	{
		// 매출 계약 입력값 체크
		var bResult = this.gfnIsUpdateDs(this.ds_MainContract);		
		if (bResult) 
		{
			for (var i=0; i<this.ds_MainContract.rowcount; i++) {
			
				if(this.ds_MainContract.getRowType(i) == 2 || this.ds_MainContract.getRowType(i) == 4) {
					if (this.gfnIsEmpty(this.ds_MainContract.getColumn(i, "CONTRACT_TYPE"))) { this.alert(this.gfnGetTransTxt(1308, "계약구분은 필수 입력 항목 입니다.")); return false;}
					else if (this.gfnIsEmpty(this.ds_MainContract.getColumn(i, "CONTRACT_NAME"))) { this.alert(this.gfnGetTransTxt(1309, "계약명은 필수 입력 항목 입니다")); return false;}
					else if (this.gfnIsEmpty(this.ds_MainContract.getColumn(i, "PRODUCT_CODE"))) { this.alert(this.gfnGetTransTxt(1310, "계약제품은 필수 입력 항목 입니다.")); return false;}
					else if (this.gfnIsEmpty(this.ds_MainContract.getColumn(i, "CONTRACT_DATE"))) { this.alert(this.gfnGetTransTxt(1311, "계약일자는 필수 입력 항목 입니다.")); return false;}
					else if (this.gfnIsEmpty(this.ds_MainContract.getColumn(i, "SALES_EMP_NO"))) { this.alert(this.gfnGetTransTxt(1312, "영업담당은 필수 입력 항목 입니다.")); return false;}
					else if (this.gfnIsEmpty(this.ds_MainContract.getColumn(i, "INCENTIVE_EMP_NO"))) { this.alert(this.gfnGetTransTxt(1313, "인센티브 담당은 필수 입력 항목 입니다.")); return false;}
					else if (this.gfnIsEmpty(this.ds_MainContract.getColumn(i, "CONTRACT_MAIN"))) { this.alert(this.gfnGetTransTxt(1314, "계약처는 필수 입력 항목 입니다.")); return false;}
					else if (this.gfnIsEmpty(this.ds_MainContract.getColumn(i, "BUSINESS_TYPE"))) { this.alert(this.gfnGetTransTxt(1315, "사업구분은 필수 입력 항목 입니다.")); return false;}
					else if (this.gfnIsEmpty(this.ds_MainContract.getColumn(i, "SALES_STATUS"))) { this.alert(this.gfnGetTransTxt(1316, "영업상태는 필수 입력 항목 입니다.")); return false;}
					
					var sContractType = this.ds_MainContract.getColumn(i, "CONTRACT_TYPE");
					if(sContractType == "M") {
						if(this.gfnIsEmpty(this.ds_MainContract.getColumn(i, "START_DATE"))) { 
							this.alert(this.gfnGetTransTxt(1303, "시작일은 필수 입력 항목 입니다.")); 
							return false;
						} else  if(this.gfnIsEmpty(this.ds_MainContract.getColumn(i, "END_DATE"))) { 
							this.alert(this.gfnGetTransTxt(2307, "종료일은 필수 입력 항목 입니다.")); 
							return false;
						}
					}
				}
			}
		}
		
		// 용역 세부 입력값 체크
		bResult = this.gfnIsUpdateDs(this.ds_ContractSiDet);
		if (bResult)
		{
			for (var i=0; i<this.ds_ContractSiDet.rowcount; i++) {
				
				var sRoleCd = this.ds_ContractSiDet.getColumn(i, "ROLE_CODE");
				var sLevelCd = this.ds_ContractSiDet.getColumn(i, "LEVEL_CODE");
				var sStratDt = this.ds_ContractSiDet.getColumn(i, "START_DATE");
				var sEndDt = this.ds_ContractSiDet.getColumn(i, "END_DATE");
				
				if (this.gfnIsEmpty(sRoleCd)) { this.alert(this.gfnGetTransTxt(1317, "[용역계약 세부] 역할은 필수 입력 항목 입니다.")); return false;}
				else if (this.gfnIsEmpty(sLevelCd)) { this.alert(this.gfnGetTransTxt(1318, "[용역계약 세부] 등급은 필수 입력 항목 입니다.")); return false;}
				else if (this.gfnIsEmpty(sStratDt)) { this.alert(this.gfnGetTransTxt(1319, "[용역계약 세부] 개시일자는 필수 입력 항목 입니다.")); return false;}
				else if (this.gfnIsEmpty(sStratDt)) { this.alert(this.gfnGetTransTxt(1320, "[용역계약 세부] 종료일자는 필수 입력 항목 입니다.")); return false;}
				
				if (sStratDt > sEndDt) { this.alert(this.gfnGetTransTxt(1321, "개시일자 또는 종료일자를 확인하세요\n개시일자 보다 종료일자가 빠릅니다"));	return false;}
			}
		}	
		
		// SI 인력 ORD 셋팅
		this.ds_ContractSiDet.set_enableevent(false);
		if(this.ds_ContractSiDet.rowcount > 0)
		{
			for (var i=0; i<this.ds_ContractSiDet.rowcount; i++) {
				var sOrd = this.ds_ContractSiDet.getColumn(i, "ORD");
				this.ds_ContractSiDet.setColumn(i, "ORD", i+1);
			}
		}
		this.ds_ContractSiDet.set_enableevent(true);
		
		
		// 유지보수 세부 입력값 체크 
		bResult = this.gfnIsUpdateDs(this.ds_ContractMaDet);
		if (bResult)
		{
			for (var i=0; i<this.ds_ContractMaDet.rowcount; i++) {
				var sProductCd = this.ds_ContractMaDet.getColumn(i, "PRODUCT_CODE");
				var sMaProductCd = this.ds_ContractMaDet.getColumn(i, "MA_PRODUCT_CODE");
				
				var sStratDt = this.ds_ContractMaDet.getColumn(i, "START_DATE");
				var sEndDt = this.ds_ContractMaDet.getColumn(i, "END_DATE");
				
				
				if (this.gfnIsEmpty(sProductCd)) { this.alert(this.gfnGetTransTxt(1322, "[유지보수계약 세부] 유지보수 타입은 필수 입력 항목 입니다.")); return false;}
				if (this.gfnIsEmpty(sMaProductCd)) { this.alert(this.gfnGetTransTxt(1323, "[유지보수계약 세부] 유지보수 제품은 필수 입력 항목 입니다.")); return false;}
				else if (this.gfnIsEmpty(sStratDt)) { this.alert(this.gfnGetTransTxt(1891, "[유지보수계약 세부] 개시일자는 필수 입력 항목 입니다.")); return false;}
				else if (this.gfnIsEmpty(sStratDt)) { this.alert(this.gfnGetTransTxt(1324, "[유지보수계약 세부] 종료일자는 필수 입력 항목 입니다.")); return false;}
				
				if (sStratDt > sEndDt) { this.alert(this.gfnGetTransTxt(1321, "개시일자 또는 종료일자를 확인하세요\n개시일자 보다 종료일자가 빠릅니다"));	return false;}
			}
		}
		
		// 약속탭 입력값 체크 
		bResult = this.gfnIsUpdateDs(this.ds_Promise);
		if (bResult)
		{
			for (var i=0; i<this.ds_Promise.rowcount; i++) {
			
				var sSubject = this.ds_Promise.getColumn(this.ds_Promise.rowposition, "SUBJECT");
				if (this.gfnIsEmpty(sSubject)) { this.alert(this.gfnGetTransTxt(1325, "[약속] 약속제목은 필수 입력 항목 입니다.")); return false;}
			}
		}
		
		// 통합유지보수탭 입력값 체크 
		bResult = this.gfnIsUpdateDs(this.ds_MaUnion);
		if (bResult)
		{
			/*수정할경우 SM_MaintenanceStopMM.xfdl 도 같이 수정 해야함*/
			for (var i=0; i<this.ds_MaUnion.rowcount; i++) 
			{			
				var strOrgStatus = this.ds_MaUnion.getOrgColumn(i, "SUPPORT_STATUS");
				var strStatus = this.ds_MaUnion.getColumn(i, "SUPPORT_STATUS");
				if(strOrgStatus != strStatus)
				{				
					var nFindRow = this.ds_CD_SUPPORT_STATUS.findRow("CODE", strStatus);
					var strStopValue = this.ds_CD_SUPPORT_STATUS.getColumn(nFindRow, "VAL1");
			
					var nFindRowOrg = this.ds_CD_SUPPORT_STATUS.findRow("CODE", strOrgStatus);
					var strStopValueOrg = this.ds_CD_SUPPORT_STATUS.getColumn(nFindRowOrg, "VAL1");
					
					var bRemark = this.gfnIsEmpty(this.ds_MaUnion.getColumn(i, "SUPPORT_REMARKS"));
					var bEnd = this.gfnIsEmpty(this.ds_MaUnion.getColumn(i, "SUPPORT_STOP_END_DATE"));
					var bStart = this.gfnIsEmpty(this.ds_MaUnion.getColumn(i, "SUPPORT_STOP_START_DATE"));
					
					/*N/A, 지원, 무상, 유상 : 중단종료일, 비고 필수 입력*/
					if(strStopValue=="Y" && bEnd && (strStopValue != strStopValueOrg))
					{
						this.alert(this.gfnGetTransTxt(1298, "중단종료일을 입력하여야 저장 가능 합니다."));
						return false;
					}
					/*중단, 미대상, 해지, 미갱신_중단 : 중단종료일, 비고 필수 입력*/
					else if(strStopValue=="N" && bStart && (strStopValue != strStopValueOrg))
					{
						this.alert(this.gfnGetTransTxt(1299, "중단시작일을 입력하여야 저장 가능 합니다."));
						return false;
					}
					/*미갱신에서 중단상태일때는 시작일이 필수*/
					else if((strOrgStatus=="008" && strStopValue=="N") && bStart)
					{
						this.alert(this.gfnGetTransTxt(1299, "중단시작일을 입력하여야 저장 가능 합니다."));
						return false;
					}
					/*상태변경시 비고는 필수*/
					if(bRemark)
					{
						this.alert(this.gfnGetTransTxt(1300, "비고란에 사유를 입력하여야 저장 가능 합니다."));
						return false;
					}
				}
			}
		}
		
		// 일본법인 예외 처리
		if(this.FV_CO_CD == "J02")
		{
			var nRow			= this.ds_MainContract.rowposition;
			var sContractNo		= this.ds_MainContract.getColumn(nRow, "CONTRACT_NO");
			var sOrgConsumptionTax	= this.ds_MainContract.getOrgColumn(nRow, "CONSUMPTION_TAX");
			var sConsumptionTax	= this.ds_MainContract.getColumn(nRow, "CONSUMPTION_TAX");
			
			if(sOrgConsumptionTax > sConsumptionTax || sOrgConsumptionTax < sConsumptionTax) {
				this.gfnAddSendParameter("CONTRACT_NO",		sContractNo);
			
				// 조회용 Output dataset 세팅
				this.gfnAddOutputDataset("dsCheckBill", "dsOutput");
				this.gfnAddOutputDataset("dsBillList", 	"dsOutput2");
				this.gfnCommonTransaction("CheckBill", "SP_Contract_S04", null, false);
				
				if(this.dsCheckBill.rowcount > 0 && this.dsBillList.rowcount > 0) {
					alert(this.gfnGetTransTxt(22562, "수금 또는 청구된 건이 있습니다. 해당 부가세율은 별도 수정 바랍니다."));
				} else if(this.dsBillList.rowcount > 0) {
					this.gfnAddSendParameter("CONTRACT_NO",		sContractNo);
					this.gfnAddSendParameter("CONSUMPTION_TAX",		sConsumptionTax);
					//저장용 Input Dataset 세팅
					this.gfnAddInputDataset("dsBillList",			"dsBillList", "A");
					this.gfnCommonTransaction("Update_Bill", "SP_Contract_R04", null, false);
				}
			}
		}
		
		return true;
	} else					 	//// 조회 Validation 체크
	{
		// 조회시 프로젝트 코드 존재 여부 체크
		var sProjectCd = this.FV_PARENT_FORM.div_search.form.edt_ProjectCode.value;
		if (this.gfnIsEmpty(sProjectCd))
		{
			this.alert(this.gfnGetTransTxt(1241, "프로젝트를 선택해 주세요"));
			return false;
		}
	}
	return true;
 }
 

// 계약 구분(제품(상품), 용역, 유지보수) 변경시 해당 Display 변경 처리
 this.fn_ContractTypeChanged = function (nRow)
 {
	var sDivUrl; 
	var sGrdFormatId;
	var sBindDsId;
	
	var sAnnualFg = this.ds_MainContract.getColumn(nRow, "ANNUAL_FLAG");
	var sContractType = this.ds_MainContract.getColumn(nRow, "CONTRACT_TYPE");
	if (sContractType == "S" || sContractType == "T")		
	{
		// 용역, 기술서비스 계약
		sDivUrl = "Sales::SP_ContractSI.xfdl";
		sBindDsId = "ds_ContractSiDet";
		if (sContractType == "S" )	sGrdFormatId = "SI";
		else						sGrdFormatId = "CS";

		this.contract_div.form.chb_StrategySales.set_visible(true);
		this.contract_div.form.chb_UnionFlag.set_visible(false);
		this.contract_div.form.chb_AutoExtension.set_visible(false);
		this.contract_div.form.btn_CopyAdd.set_visible(false);
		this.contract_div.form.cmb_SubSalesEmpNo.set_enable(false);
		this.contract_div.form.medt_SubContractPrice.set_enable(false);
		this.contract_div.form.chb_NetSales.set_visible(false);
				
		// this.ds_cmm_Role.filter();
		if (sContractType == "T") {
			this.ds_cmm_Role.filter("VAL2 == 'T'");
		} else {
			this.ds_cmm_Role.filter("VAL2 == 'S'");
		}		
		
		if (this.div_ContractInfo.form.div_ContractSub.url == sDivUrl) {
			this.div_ContractInfo.form.div_ContractSub.form.fn_SetInitDisp(sContractType);
		}
		
	} else if (sContractType == "M") {
	// 유지보수 계약
		sDivUrl = "Sales::SP_ContractMaintenance.xfdl";
		sGrdFormatId = "MA";
		sBindDsId = "ds_ContractMaDet";
		this.contract_div.form.chb_StrategySales.set_visible(false);
		this.contract_div.form.chb_UnionFlag.set_visible(true);
		this.contract_div.form.chb_AutoExtension.set_visible(true);
		this.contract_div.form.btn_CopyAdd.set_visible(true);
		this.contract_div.form.cmb_SubSalesEmpNo.set_enable(false);
		this.contract_div.form.medt_SubContractPrice.set_enable(false);		
		this.contract_div.form.chb_NetSales.set_visible(false);
		
	} else {
	// 제품, 상품, 기타 계약
		sDivUrl = "Sales::SP_ContractProduct.xfdl";
		sGrdFormatId = "PROD";
		sBindDsId = "ds_ContractProdDet";
		this.contract_div.form.chb_StrategySales.set_visible(true);
		this.contract_div.form.chb_UnionFlag.set_visible(false);
		this.contract_div.form.chb_AutoExtension.set_visible(false);
		this.contract_div.form.btn_CopyAdd.set_visible(false);
		this.contract_div.form.cmb_SubSalesEmpNo.set_enable(true);
		this.contract_div.form.medt_SubContractPrice.set_enable(true);	
		this.contract_div.form.chb_NetSales.set_visible(false);
			
		if (this.div_ContractInfo.form.div_ContractSub.url == sDivUrl) {
			this.div_ContractInfo.form.div_ContractSub.form.fn_AnnualDisp(sAnnualFg);
		}
	}
	
	this.div_ContractInfo.form.div_ContractSub.set_enableevent(false);
	this.div_ContractInfo.form.div_ContractSub.set_url(sDivUrl);
	this.div_ContractInfo.form.div_ContractSub.set_enableevent(true);
	
	this.grd_ContractDetail.set_enableevent(false);
	this.grd_ContractDetail.set_formatid(sGrdFormatId);
	this.grd_ContractDetail.set_binddataset(sBindDsId);
	this.grd_ContractDetail.set_enableevent(true);
 }
 
 // 초기화 처리
 this.fn_setInit = function (sGb)
 {
	if (sGb == "A") {
		this.ds_MainContract.set_enableevent(false);
		this.ds_MainContract.clearData();
		this.ds_MainContract.set_enableevent(true);
	}
	
	this.ds_cmm_Product.clearData();
	this.ds_ContractProdDet.clearData();
	this.ds_ContractSiDet.clearData();
	this.ds_ContractMaDet.clearData();
	this.ds_ScheduleList.clearData();
	this.ds_AddressbookList.clearData();
	this.ds_MaUnion.clearData();
	this.ds_Promise.clearData();

	
	this.div_ContractInfo.form.div_ContractSub.set_enableevent(false);
	this.div_ContractInfo.form.div_ContractSub.set_url("Sales::SP_ContractProduct.xfdl");
	this.div_ContractInfo.form.div_ContractSub.set_enableevent(true);
	
	this.grd_ContractDetail.set_enableevent(false);
	this.grd_ContractDetail.set_formatid("PROD");
	this.grd_ContractDetail.set_binddataset("ds_ContractProdDet");
	this.grd_ContractDetail.set_enableevent(true);
		
	this.btn_ContractDetailPlus.set_enable(false);
	this.btn_ContractDetailMinus.set_enable(false);	
	
	if (this.FV_CO_CD != "J02") {
		// 신규 추가 시 점검이력메일 버튼 비활성화
		this.contract_div.form.btn_MaintenceEmail.set_enable(false);
	}
	
	this.contract_div.form.cmb_ContractType.set_readonly(false);
 }
 
 
 // Dataset RowType 얻기
  this.fn_getRowType = function(objDs, nRow)
 {
	var nRowType = objDs.getRowType(nRow);
	return nRowType;
 }
 
 
 this.fnGetChangeDs = function()
{
	var objDsList = {
		ContProd: this.ds_ContractProdDet,
		ContSi:   this.ds_ContractSiDet,
		ContMa:   this.ds_ContractMaDet,
		Schedule: this.ds_ScheduleList,
		AddrBook: this.ds_AddressbookList,
		MaUnion:  this.ds_MaUnion,
		Promise:  this.ds_Promise
	}
	
	return this.gfnIsUpdateDsList(objDsList);
}



this.fnSetSiMMStaticChange = function()
{
	var sContractType = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_TYPE");
	if (sContractType == "S" || sContractType == "T") {
		if (this.ds_ContractSiDet.rowcount>0)
		{
			var sTechSupportName = "MM";
			if (sContractType == "T")
			{
				var sTechSupportUnit = this.ds_ContractSiDet.getColumn(0, "TECH_SUPPORT_UNIT");
				var sTechSupportName = this.ds_cmm_TechSupportUnit.lookup("CODE", sTechSupportUnit, "CAPTION");
			}
			
			this.div_ContractInfo.form.div_ContractSub.form.stc_Menmonth.set_text(sTechSupportName);
			
		}
	}
}


 /************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역
 ************************************************************************************************/
// 계약M Dataset Row 변경 처리
this.ds_MainContract_onrowposchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSRowPosChangeEventInfo)
{	
	var nSaveCurrow = this.fn_GetSaveCurrow();
	if (nSaveCurrow > 0) {
		// 저장 처리시 이전 Row로 rowposition 위치 이동(rowposition:0 무시)
		//var nRow = this.FV_SAVE_CURROW;
		//this.FV_SAVE_CURROW = 0;
		/*
		this.ds_MainContract.set_enableevent(false);
		this.ds_MainContract.set_rowposition(nRow);
		
		// 첨부파일 버튼 초기화
		this.fnSetFileInit();
		this.ds_MainContract.set_enableevent(true);
		return;
		*/
		
		// 초기화 유지보수 SMS 발송 여부 및 삭제 TRAN 플레그 초기화
		this.FV_SMS_SEND_MA = false;
		this.FV_DEL_FLAG = false;
		
		
		// 계약 금액 마스킹 처리
// 		this.fn_setPriceMasking(this.div_ContractInfo.form.div_ContractMain_J.form.medt_ContractPrice);
// 		this.fn_setPriceMasking(this.div_ContractInfo.form.div_ContractMain_J.form.medt_Royalty);

	} else {
		
		// 변경여부 확인
		if (this.gfnIsUpdateDs(this.ds_MainContract)) {
			if ( this.confirm(this.gfnGetTransTxt(1684, "변경된 데이터가 존재 합니다 계속 진행 하시겠습니까?")) )	{
				this.ds_MainContract.reset();
			} else {
				obj.set_enableevent(false);
				obj.set_rowposition(e.oldrow);
				obj.set_enableevent(true);
				return;
			}
		} 
		
		if (this.fnGetChangeDs()) {
			if ( this.confirm(this.gfnGetTransTxt(1684, "변경된 데이터가 존재 합니다 계속 진행 하시겠습니까?")) )	{
				obj.set_enableevent(false);
				obj.set_rowposition(e.oldrow);
				obj.set_enableevent(true);
				return;
			}
		}
		
		// 초기화 유지보수 SMS 발송 여부 및 삭제 TRAN 플레그 초기화
		this.FV_SMS_SEND_MA = false;
		this.FV_DEL_FLAG = false;
		
		
		var sContractType = obj.getColumn(e.newrow, "CONTRACT_TYPE") ;
		var bContractTypeReadonly = true;
		// 신규 건만 계약구분 변경 가능 (그외 계약 구분 변경 불가)
		if (this.fn_getRowType(this.ds_MainContract, e.newrow) == Dataset.ROWTYPE_INSERT) {
			this.ds_cmm_ContractType.filter("VAL1=='1'");
			//this.contract_div.form.cmb_ContractType.set_readonly(false);
			bContractTypeReadonly = false;
		} else if ((sContractType=="S" || sContractType=="T") && this.commUtil.getFormAuthority(242,8)) {	/*용역과 기술서비스는 서로 변경이 가능하다 (계약코드는 그대로 유지)*/
			this.ds_cmm_ContractType.filter("VAL1=='1' && CODE=='S'||CODE=='T'");
			//this.contract_div.form.cmb_ContractType.set_readonly(false);			
			bContractTypeReadonly = false;
		} else {
			this.ds_cmm_ContractType.filter("VAL1=='1'");
			//this.contract_div.form.cmb_ContractType.set_readonly(true);
			bContractTypeReadonly = true;
		}
		
		// 계약구분에 대한 대표제품 조회
		this.fn_ProductQueryData(sContractType);
		this.contract_div.form.cmb_ContractType.set_readonly(bContractTypeReadonly);
		
		
		// 제품계약인 경우만 라이선스 요청 버튼 활성화
		if (sContractType == "P")	{
			this.div_ContractInfo.form.btn_RequestLicense.set_enable(true);
			this.div_ContractInfo.form.btn_Online.set_enable(true);
		}
		else if (sContractType == "G" || obj.getColumn(e.newrow, "PRODUCT_CODE") == "G0101") {
			this.div_ContractInfo.form.btn_RequestLicense.set_enable(true);
			this.div_ContractInfo.form.btn_Online.set_enable(true);
		}
		else{
			this.div_ContractInfo.form.btn_RequestLicense.set_enable(false);	
			this.div_ContractInfo.form.btn_Online.set_enable(false);
		}
		
		// 점검이력메일 버튼 "유지보수" 이고 TBJ가 아닌 경우에만 활성화
		if(sContractType == "M" && this.FV_CO_CD != "J02") {
			this.contract_div.form.btn_MaintenceEmail.set_enable(true);
		} 
		
		// 계약 구분에 대한 Display 처리
		this.ds_MainContract.set_enableevent(false);
		this.fn_ContractTypeChanged(e.newrow);
		this.ds_MainContract.set_enableevent(true);
		
		// 계약 세부 조회
		this.fn_ContractDetailQueryData(e.newrow);	
		
		// 매출계약 기타 정보 탭위치 지정
		this.tab_Progress.set_enableevent(false);
		this.tab_Progress.set_tabindex(2);
		this.tab_Progress.set_enableevent(true);
		
		
		this.btn_ContractDetailPlus.set_enable(true);
		this.btn_ContractDetailMinus.set_enable(true);
		
		this.fnAuthConfig();	// 권한 처리
		
		if(obj.getColumn(e.newrow, "CONTRACT_TYPE") == "P")
		{
			var sProductCd = obj.getColumn(e.newrow, "PRODUCT_CODE");
			if (this.gfnIsEmpty(sProductCd))	sProductCd = "";
			
			if (sProductCd.substr(0,3) == "P17" &&
				obj.getColumn(e.newrow, "CONTRACT_MAIN") != "Z03766")
			{
				/*제품계약, X-UP, 이젠고가 아닐경우 순매출체크박스를 보여줌*/
				this.contract_div.form.chb_NetSales.set_visible(true);
			} 
			else if (sProductCd.substr(0,3)  == "P95" &&
					 obj.getColumn(e.newrow, "CONTRACT_MAIN") != "WIN")
			{
				/*제품계약, TOBEMALL, 투비소프트씨엔에스가 아닐경우 순매출체크박스를 보여줌*/
				this.contract_div.form.chb_NetSales.set_visible(true);
			}
			else
			{
				this.contract_div.form.chb_NetSales.set_visible(false);	
			}
		}
		else
		{
			this.contract_div.form.chb_NetSales.set_visible(false);	
		}
	}
};



// 담당 영업이 변경 처리
this.fn_cmb_SalesEmpNoItemChanged = function (postindex, postvalue)
{
	var nCurrow = this.ds_MainContract.rowposition;
	if (this.fn_getRowType(this.ds_MainContract, this.ds_MainContract.rowposition) == Dataset.ROWTYPE_INSERT) {

		// 신규 등록시 영업담당부서(명) 자동처리
		var sDeptCd =	this.ds_cmm_SalesEmp.getColumn(postindex, "DEPT_CD");
		var sDeptNm =	this.ds_cmm_SalesEmp.getColumn(postindex, "DEPT_NAME");
		var sCocd =		this.ds_cmm_SalesEmp.getColumn(postindex, "CO_CD");
		
		// 담당 영업 변경시
		this.ds_MainContract.setColumn(nCurrow, "SALES_CO_CD",		sCocd);
		this.ds_MainContract.setColumn(nCurrow, "SALES_DEPT_CD",	sDeptCd);
		this.ds_MainContract.setColumn(nCurrow, "SALES_DEPT_NAME",	sDeptNm);
		
		// 인센티브 적용 영업
		var sIncentiveEmpNo = this.ds_MainContract.getColumn(nCurrow, "INCENTIVE_EMP_NO");
		if ( this.gfnIsEmpty(sIncentiveEmpNo)) {
				this.ds_MainContract.setColumn(nCurrow, "INCENTIVE_EMP_NO", postvalue);
		}
	}
	
	var sBusinessType = this.ds_cmm_SalesEmp.getColumn(postindex, "BUSINESS_TYPE");
	this.ds_MainContract.setColumn(nCurrow, "BUSINESS_TYPE", sBusinessType);
}


// 계약 구분 변경 (제품, 용역, 유지보수 Display 변경처리)
this.fn_cmb_ContractTypeItemchanged = function (sValue)
{
	var nCurrow = this.ds_MainContract.rowposition;
	
	// 계약구분에 대한 대표제품 조회
	this.fn_ProductQueryData(sValue);
	
	
	// 계약구분 변경에 대한 Display 처리
	this.ds_MainContract.set_enableevent(false);
	this.fn_ContractTypeChanged(nCurrow);
	this.ds_MainContract.set_enableevent(true);
}


// 유지보수 계약 복사 추가 버튼 클릭
this.fn_MAContractCopy = function()
{
	this.dsCopyContract.clearData();
	
	// this.FV_SAVE_CURROW = this.ds_MainContract.rowcount;
	var sCurrow = this.ds_MainContract.rowposition;
	
	var strToday = this.gfnToday();
	this.FV_SAVE_KEY = strToday + "/" + this.ds_MainContract.getColumn(sCurrow, "CONTRACT_NAME");
	
	
	// 선택한 계약의 계약번호, 계약일자, 종료일자
	var sContractNo = this.ds_MainContract.getColumn(sCurrow, "CONTRACT_NO");
	var sStartDt = this.ds_MainContract.getColumn(sCurrow, "START_DATE");
	var sEndDt = this.ds_MainContract.getColumn(sCurrow, "END_DATE");
	
	var _dsInContractList = this.objects["_dsInContractList"];
	if (this.gfnIsEmpty(_dsInContractList)) {
		_dsInContractList = new nexacro.Dataset();
		this.addChild("_dsInContractList", _dsInContractList); 
	}
	
	_dsInContractList.clearData();
	_dsInContractList.assign(this.ds_MainContract)
	_dsInContractList.filter("CONTRACT_TYPE == 'M'");
	
	// 계약일자와 종료일자가 동일한 갯수 확인
	var sCopyContractCnt = _dsInContractList.getCaseCount("START_DATE == '"+ sStartDt + "' && END_DATE == '"+ sEndDt +"'");
	
	if(sCopyContractCnt > 1) {
		// 다수건인 경우
		args = {dsMainContract:_dsInContractList, sStartDt:sStartDt, sEndDt:sEndDt};
		this.commUtil.popup(this, "popupMAContractCopy", "Sales::SP_MAContractCopy.xfdl", -1, -1, 800, 500, true, true, false, args, "fnPopupCallBack");
	} else {
		if(this.confirm(this.gfnGetTransTxt(1729, "복사추가 하시겠습니까?"))) {
			// 단건인 경우
			var sCA_CopyFlag = "0";
			if( this.confirm(this.gfnGetTransTxt(1687, "담당자 정보도 복사하여 반영 하시겠습니까?")) ){
				sCA_CopyFlag = "1"
			}
			
			var nRow = this.dsCopyContract.addRow();
			this.dsCopyContract.setColumn(nRow, "CONTRACT_NO", sContractNo);
			this.dsCopyContract.setColumn(nRow, "CA_COPY_FLAG", sCA_CopyFlag);
			
			this.gfnAddInputDataset("dsCopyContract", "dsInput");
			this.gfnCommonTransaction("MaCopyAdd", 	"SP_Contract_R02");
		}
	}
};


// 회계용 팝업 버튼
this.fn_AccountOptionPopup = function()
{
	this.div_Account.set_visible(true);
	this.div_Account.form.chb_ProgressExceptFlag.setFocus();
	this.div_Account.form.cal_BadDebtDate.set_enable(this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "BAD_DEBT_FLAG"));
};

// 점검 이력 메일 발송
this.fn_MaintenceHistEmail = function()
{
	var nRow			= this.ds_MainContract.rowposition;
	var sContractNo		= this.ds_MainContract.getColumn(nRow, "CONTRACT_NO");	
	
	if(this.gfnIsEmpty(sContractNo)) this.alert(this.gfnGetTransTxt(1283, "저장 후 사용하세요."));
	else {
		var sArgument = {pvContractNo:sContractNo ,pvKind:"MaintenceVisit"};
		this.commUtil.popup(this, "CompanyAddMM", "Sales::SP_ContractHistoryMail.xfdl", -1, -1, null, null, true, true, false, sArgument, "fnPopupCallBack");
	}
};


// 제품 검색 팝업 버튼 클릭 처리
this.grd_ContractDetail_onexpandup = function(obj:nexacro.Grid,e:nexacro.GridMouseEventInfo)
{
	var Argument={};
	var sProductNm;
	
	var sFormatId = this.grd_ContractDetail.formatid;
	var sContractType = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_TYPE");
	
	if (sFormatId == "PROD") {
		if (e.cell != 0) return;
		
		var sProductCd = this.ds_ContractProdDet.getColumn(e.row, "PRODUCT_CODE");
		
		Argument.uselicenseinfo = true;
		Argument.userelatedproduct = false;
		
		if (this.gfnIsEmpty(sProductCd)) {
			// 최초추가 및 제품선택하지 않은 경우 대표계약제품으로 위치 변경
			Argument.sProductCd = this.contract_div.form.cmb_SalesProduct.value;
		} else {
			Argument.sProductCd = sProductCd;
			Argument.productlist = this.ds_ContractProdDet.getColumn(e.row, "PRODUCT_LIST");
			Argument.platformlist = this.ds_ContractProdDet.getColumn(e.row, "PLATFORM_LIST");
			Argument.functionlist = this.ds_ContractProdDet.getColumn(e.row, "FUNCTION_LIST");
		}
		
		if (sContractType == "P") {
			Argument.sFilterExpr = "CODE=='P'||CODE=='G'";
		} else {
			Argument.sFilterExpr = "";
		}
		
		sContractType = "ALL";
		
	} else if (sFormatId == "MA") {
		if (e.cell != 0 && e.cell != 1) return;
		
		Argument.sProductCd = this.ds_ContractMaDet.getColumn(e.row, "MA_PRODUCT_CODE");
		Argument.sProductCd2 = this.ds_ContractMaDet.getColumn(e.row, "PRODUCT_CODE");
		
		
		sProductNm = this.ds_ContractMaDet.getColumn(this.ds_ContractMaDet.rowposition, "PRODUCT_NAME");
		Argument.userelatedproduct = true;
		Argument.usemaproduct = true;
	} else {
		return;
	}
	
	// Argument.sSubject = sProductNm;
	Argument.sComboContractType = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_TYPE");
	Argument.sContractType = sContractType;
	this.commUtil.popupProductSearch(this, "popupProductSearch", "fnPopupCallBack", Argument);
};

// 계약 추가
this.fn_AddRecord = function()
{
	var sProjectCd = this.FV_PARENT_FORM.div_search.form.edt_ProjectCode.value;
	this.ds_MainContract.set_enableevent(false);
	this.ds_cmm_ContractType.filter("VAL1=='1'");
	var nRow = this.ds_MainContract.addRow();
	
	// 초기값 세팅
	this.ds_MainContract.setColumn(nRow, "PROJECT_CODE", sProjectCd);
	this.ds_MainContract.setColumn(nRow, "CONTRACT_DATE", this.gfnToday());
	this.ds_MainContract.setColumn(nRow, "CONTRACT_PRICE", 0);
	this.ds_MainContract.setColumn(nRow, "REQUEST_PRICE", 0);
	this.ds_MainContract.setColumn(nRow, "EXPORT_FLAG", "0");
	this.ds_MainContract.setColumn(nRow, "STRATEGY_SALES_FLAG", "0");	// 전략영업여부
	this.ds_MainContract.setColumn(nRow, "PROGRESS_EXCEPT_FLAG", "0");
	this.ds_MainContract.setColumn(nRow, "PROGRESS_100_FLAG", "0");
	this.ds_MainContract.setColumn(nRow, "PROGRESS_ADD_FLAG", "0");
	this.ds_MainContract.setColumn(nRow, "BAD_DEBT_FLAG", "0");
	this.ds_MainContract.setColumn(nRow, "NET_SALES_FLAG", "0");
	this.ds_MainContract.setColumn(nRow, "DIVISION_FLAG", "0");
	this.ds_MainContract.setColumn(nRow, "COLLECTION_BOND_FLAG", "0");
	this.ds_MainContract.setColumn(nRow, "COLLECTION_BOND_FLAG", "0");
	this.ds_MainContract.setColumn(nRow, "ANNUAL_FLAG", "0");
	this.ds_MainContract.setColumn(nRow, "SITECHK_FLAG", "0");
	this.ds_MainContract.setColumn(nRow, "SALES_STATUS", "008");
	
	// 유지보수 계약
	this.ds_MainContract.setColumn(nRow, "UNION_FLAG", "0");
	this.ds_MainContract.setColumn(nRow, "AUTO_EXTENSION_FLAG", "0");
	this.ds_MainContract.setColumn(nRow, "AUTO_ISSUE_FLAG", "0");
	
	if (nRow > 0) {
		var nBefRow = (nRow -1);
		this.ds_MainContract.setColumn(nRow, "SALES_EMP_NO",		this.ds_MainContract.getColumn(nBefRow, "SALES_EMP_NO"));
		this.ds_MainContract.setColumn(nRow, "SALES_EMP_NAME",		this.ds_MainContract.getColumn(nBefRow, "SALES_EMP_NAME"));
		this.ds_MainContract.setColumn(nRow, "SALES_DEPT_CD",		this.ds_MainContract.getColumn(nBefRow, "SALES_DEPT_CD"));
		this.ds_MainContract.setColumn(nRow, "SALES_DEPT_NAME",		this.ds_MainContract.getColumn(nBefRow, "SALES_DEPT_NAME"));
		this.ds_MainContract.setColumn(nRow, "SALES_CO_CD",			this.ds_MainContract.getColumn(nBefRow, "SALES_CO_CD"));

		this.ds_MainContract.setColumn(nRow, "INCENTIVE_EMP_NO",	this.ds_MainContract.getColumn(nBefRow, "INCENTIVE_EMP_NO"));
		this.ds_MainContract.setColumn(nRow, "BUSINESS_TYPE",		this.ds_MainContract.getColumn(nBefRow, "BUSINESS_TYPE"));
	}
	this.ds_MainContract.set_enableevent(true);
	
	this.fn_setInit("S");
	this.btn_ContractDetailPlus.set_enable(true);
	this.btn_ContractDetailMinus.set_enable(true);
}

 this.fnRequestStaffSearch = function(sProjectCd, sContractNo)
 {
	// 조건값(Rarameter) 셋팅
	this.gfnAddSendParameter("PROJECT_CODE", sProjectCd);
	this.gfnAddSendParameter("CONTRACT_NO",  sContractNo);
	
	// 조회용 Output dataset 세팅
	this.gfnAddOutputDataset("ds_RequestStaff",	"ds_output");
	this.gfnCommonTransaction("SS_Presales_S03", "SS_Presales_S03", null, false);
 };


// 계약 삭제
this.fn_DelRecord = function()
{
	var nRow = this.ds_MainContract.rowposition;
	
	if (this.confirm(this.gfnGetTransTxt(1668, "해당 계약을 삭제할 경우 세부 정보도 함께 삭제 됩니다. \n정말 삭제 하시겠습니까?")) ) {
		
		this.FV_DEL_FLAG = true;
		
		var sContractNo = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_NO");
			
		if (!this.gfnIsEmpty(sContractNo)) {
			this.fnRequestStaffSearch(null, sContractNo);
			
			if (this.ds_RequestStaff.rowcount > 0)
			{
				this.alert(this.gfnGetTransTxt(1326, "해당 매출계약의 지원인력 요청 건이 있어 삭제 할수 없습니다.\n지원요청 삭제후 처리하세요"));
				return;
			}
		}		
		//ds_MainContract_onrowposchanged 이벤트 때문에 초기화 되어서 이벤트 막음
		this.ds_MainContract.set_enableevent(false);
		this.ds_MainContract.deleteRow(nRow);
		this.ds_MainContract.set_enableevent(true);
		
		this.ds_ContractProdDet.set_enableevent(false);
		this.ds_ContractProdDet.deleteAll();
		this.ds_ContractProdDet.set_enableevent(true);
	
		this.ds_ContractSiDet.set_enableevent(false);
		this.ds_ContractSiDet.deleteAll();
		this.ds_ContractSiDet.set_enableevent(true);
	
		this.ds_ContractMaDet.set_enableevent(false);
		this.ds_ContractMaDet.deleteAll();
		this.ds_ContractMaDet.set_enableevent(true);
				
		this.ds_MaUnion.set_enableevent(false);
		this.ds_MaUnion.deleteAll();
		this.ds_MaUnion.set_enableevent(true);
		
		this.fn_SaveData();
	}
}

// 행추가 공통 이벤트
this.CommAddRow_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var objDs;
	var arrDefSetCol = new Array();
	var arrDefSetVal = new Array();
	
	var sProjectCd = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "PROJECT_CODE");
	var sContractNo = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_NO");
	
	var bAddRowFlag = true;
	if (obj.name == "btn_ProgressPlus") {
		var nTabIdx = this.tab_Progress.tabindex;
		if (nTabIdx == 0) {				// 진행사항
			
			objDs = this.objects["ds_ScheduleList"];
			arrDefSetCol.push("PROJECT_CODE");	arrDefSetCol.push("CONTRACT_NO");	arrDefSetCol.push("ISSUE_DATE");  	arrDefSetCol.push("TYPE_CODE");	arrDefSetCol.push("IMPORTANCE");	arrDefSetCol.push("REPORT_FLAG");		arrDefSetCol.push("OPEN_FLAG");
			arrDefSetVal.push(sProjectCd);		arrDefSetVal.push(sContractNo);		arrDefSetVal.push(this.gfnToday());	arrDefSetVal.push("001");		arrDefSetVal.push("2");				arrDefSetVal.push("0");					arrDefSetVal.push("1");
			
		} else if (nTabIdx == 1) {		// 담당자
			bAddRowFlag = false;
			var sClientCd = this.FV_PARENT_FORM.div_search.form.div_ClientName.getCode();
			var sCompanyCd = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_MAIN");
			
			var sArgument = {CLIENT_CODE:sClientCd, COMPANY_CODE:sCompanyCd};
			this.commUtil.popup(this, "CompanyTypeSelect", "Sales::SC_CompanyTypeSelect.xfdl", -1, -1, null, null, true, true, false, sArgument, "fnPopupCallBack");			
		
		} else if (nTabIdx == 3) {		// 통합유지보수
			bAddRowFlag = false;
			var sArgument = {};
			sArgument.pvMode = "C";	// 고객사
			sArgument.contracttype = "P,G";	// 고객사
			sArgument.sSubject = this.FV_PARENT_FORM.div_search.form.div_ClientName.getData(); // 고객사명
			this.commUtil.popupProjectSearch(this, "popupContractSearch", "fnPopupCallBack", sArgument);
			
		} else if (nTabIdx == 4) {		// 약속
			
			objDs = this.objects["ds_Promise"];
			// 필수 입력값 체크
			if (objDs.rowposition>=0) {
				var sSubject = objDs.getColumn(objDs.rowposition, "SUBJECT");
				if (this.gfnIsEmpty(sSubject)) { this.alert(this.gfnGetTransTxt(1327, "약속제목을 입력 후 추가 해주세요")); return;}
			}
			
			arrDefSetCol.push("CONTRACT_NO");	arrDefSetCol.push("PROMISE_DATE");	arrDefSetCol.push("PROMISE_KIND");
			arrDefSetVal.push(sContractNo);		arrDefSetVal.push(this.gfnToday());	arrDefSetVal.push("001");
		
		}
		
	} else {
		var sFormatid = this.grd_ContractDetail.formatid;
		if (sFormatid == "PROD") {			// 제품, 상품, 기타
			objDs = this.objects["ds_ContractProdDet"];
			arrDefSetCol.push("CONTRACT_NO");	arrDefSetCol.push("ISDEV_FLAG");	arrDefSetCol.push("CONTRACT_PRICE");
			arrDefSetVal.push(sContractNo);		arrDefSetVal.push("0");				arrDefSetVal.push(0);
			
		} else if (sFormatid == "SI" || sFormatid == "CS") {		// 용역
			objDs = this.objects["ds_ContractSiDet"];
			// 필수 입력값 체크
			if (objDs.rowposition>=0) {
				var sRoleCd = objDs.getColumn(objDs.rowposition, "ROLE_CODE");
				var sLevelCd = objDs.getColumn(objDs.rowposition, "LEVEL_CODE");
				var sStratDt = objDs.getColumn(objDs.rowposition, "START_DATE");
				var sEndDt = objDs.getColumn(objDs.rowposition, "END_DATE");
				
				if (this.gfnIsEmpty(sRoleCd)) { this.alert(this.gfnGetTransTxt(1328, "역할을 입력 후 추가 해주세요")); return; }
				else if (this.gfnIsEmpty(sLevelCd)) { this.alert(this.gfnGetTransTxt(1329, "등급을 입력 후 추가 해주세요")); return; }
				else if (this.gfnIsEmpty(sStratDt)) { this.alert(this.gfnGetTransTxt(1330, "개시일자를 입력 후 추가 해주세요")); return; }
				else if (this.gfnIsEmpty(sEndDt)) {	this.alert(this.gfnGetTransTxt(1331, "종료일자를 입력 후 추가 해주세요")); return;	}
				
				
				if (sFormatid == "CS") {
					var sExecutionType = objDs.getColumn(objDs.rowposition, "EXECUTION_TYPE");
					if (this.gfnIsEmpty(sExecutionType)) { this.alert(this.gfnGetTransTxt(1332, "수행방식을 입력 후 추가 해주세요")); return; }
				}
				
			}
			
			arrDefSetCol.push("CONTRACT_NO");	arrDefSetCol.push("CONTRACT_PRICE");
			arrDefSetVal.push(sContractNo);		arrDefSetVal.push(0);
		} else if (sFormatid == "MA") {		// 유지보수
			objDs = this.objects["ds_ContractMaDet"];
			var sStartDt = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "START_DATE");
			var sEndDt = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "END_DATE");
			arrDefSetCol.push("CONTRACT_NO");	arrDefSetCol.push("CONTRACT_PRICE");	arrDefSetCol.push("START_DATE");	arrDefSetCol.push("END_DATE");	arrDefSetCol.push("MA_STANDARD");
			arrDefSetVal.push(sContractNo);		arrDefSetVal.push(0);					arrDefSetVal.push(sStartDt);		arrDefSetVal.push(sEndDt);		arrDefSetVal.push("000");
		}
	}
	
	if (bAddRowFlag)
	{
		objDs.set_enableevent(false);
		var nRow = objDs.addRow();
		
		// 초기값 세팅
		for(var i=0; i<arrDefSetCol.length; i++)
		{
			var sCol = arrDefSetCol[i];
			var sVal = arrDefSetVal[i];
			objDs.setColumn(nRow, sCol, sVal);
		}
		objDs.set_enableevent(true);
	}

	this.fnCheckDetGridScroll();
};

// 행삭제 공통 이벤트
this.CommDelRow_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var objDs;
	var sMsg;
	var sTL_SEQ;
	if (obj.name == "btn_ProgressMinus") {
		var nTabIdx = this.tab_Progress.tabindex;
		if (nTabIdx == 0) {				// 진행사항
			objDs = this.objects["ds_ScheduleList"];
			sMsg = "진행 사항을 삭제 하시겠습니까?";
			sTL_SEQ = "1894";
		} else if (nTabIdx == 1) {		// 담당자
			objDs = this.objects["ds_AddressbookList"];
			sMsg = "담당자를 삭제 하시겠습니까?";	
			sTL_SEQ = "1893";
		} else if (nTabIdx == 3) {		// 통합유지보수
			objDs = this.objects["ds_MaUnion"];
			sMsg = "유지보수건을 삭제 하시겠습니까?";
			sTL_SEQ = "1716";
		} else if (nTabIdx == 4) {		// 약속
			objDs = this.objects["ds_Promise"];
			sMsg = "약속을 삭제 하시겠습니까?";
			sTL_SEQ = "1892";
		} 
	} else {
		var sFormatid = this.grd_ContractDetail.formatid;
		if (sFormatid == "PROD") {			// 제품, 상품, 기타
			objDs = this.objects["ds_ContractProdDet"];
			sMsg = "제품을 삭제 하시겠습니까?";
			sTL_SEQ = "1895";
		} else if (sFormatid == "SI" || sFormatid == "CS") {		// 용역
			objDs = this.objects["ds_ContractSiDet"];
			sMsg = "용역상세를 삭제 하시겠습니까?";
			sTL_SEQ = "1896";
		} else if (sFormatid == "MA") {		// 유지보수
			objDs = this.objects["ds_ContractMaDet"];
			sMsg = "유지보수상세를 삭제 하시겠습니까?";
			sTL_SEQ = "1897";
		}
	}
	
	var nRow = objDs.rowposition;
	if ( this.confirm(this.gfnGetTransTxt(sTL_SEQ, sMsg)) ) {
		objDs.deleteRow(nRow);
	}
	
	this.fnCheckDetGridScroll();
};

// 기타 Tab 변경시
this.tab_Progress_onchanged = function(obj:nexacro.Tab,e:nexacro.TabIndexChangeEventInfo)
{
	if (this.ds_MainContract.rowcount<=0) return;
	
	var bBtnEnableFlag = false;
	if (e.postindex == 0) {				/*	진행사항	*/
		if (this.FV_AUTH_ALL_FLAG) { bBtnEnableFlag = true; }
		else if (this.FV_AUTH_SALES_PROGRESS_FLAG) { bBtnEnableFlag = true; }
	} else if (e.postindex == 1) {		/*	담당자	*/
		if (this.FV_AUTH_ALL_FLAG || this.FV_AUTH_PERSON_FLAG) { bBtnEnableFlag = true;	}		
	} else if (e.postindex == 2) {		/*	비고	*/
		bBtnEnableFlag = false;
	} else if (e.postindex == 3) {		/*	통합유지보수	*/
		
		var sContractType = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_TYPE");
		// 유지보수인 경우만 추가, 삭제 가능
		if (sContractType == "M") {
			if (this.FV_AUTH_ALL_FLAG) { bBtnEnableFlag = true; }
		}
	} else if (e.postindex == 4) {		/*	약속	*/
		if (this.FV_AUTH_PROMISE_FLAG) { bBtnEnableFlag = true; } 		
	} else {							/*	로열티	*/
		this.fn_setPriceMasking(this.tab_Progress.tpg_Royalty.form.medt_RoyaltyPrice);
	}

	this.btn_ProgressPlus.set_enable(bBtnEnableFlag);
	this.btn_ProgressMinus.set_enable(bBtnEnableFlag);
};


// 매출원가표 POPUP
this.btn_CostSheet_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var sProjectCd = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "PROJECT_CODE");
	var Argument = {pv_project_cd:sProjectCd, pv_costsheet_type:"2"};
	this.commUtil.popup(this, "popupCostSheet", "Sales::SP_CostSheet.xfdl", -1, -1, 1200, 665, true, true, false, Argument, "fnPopupCallBack");
};

// 납품확인서 POPUP
this.btn_DeliveryConfirm_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	
	var sProjectCd = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "PROJECT_CODE");
	var sSalesEmpNo = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "SALES_EMP_NO");
	
	var Argument = {pv_project_cd:sProjectCd, pv_sales_empno:sSalesEmpNo};
	this.commUtil.popup(this, "popupDeliveryConfirm", "Sales::SP_DeliveryConfirm.xfdl", -1, -1, 800, 720, true, false, false, Argument, "fnPopupCallBack");
};


// 라이선스 요청
this.fn_RequestLicense = function (bOnlineFlag)
{
	if (this.gfnIsUpdateDs(this.ds_ContractProdDet)) {
		this.alert(this.gfnGetTransTxt(1333, "저장후 라이센스 요청하시기 바랍니다"));
		return;
	}
	
	var bAppend = true;
	var nCurrow = this.ds_ContractProdDet.rowposition;
	var sProductCd = this.ds_ContractProdDet.getColumn( nCurrow,"PRODUCT_CODE");
	var sProdShortName = this.ds_ContractProdDet.getColumn( nCurrow,"PRODUCT_NAME_SHORT");
	var sLicenseKind =  "";
	
	if (sProductCd.substr(0, 5) == "G0101")		sLicenseKind = "Chart";
	else if (sProdShortName.indexOf("MP")>=0)	sLicenseKind = "MP";
	else if (sProdShortName.indexOf("XP ")>=0)	sLicenseKind = "XP";
	else if (sProdShortName.indexOf("NP")>=0)	sLicenseKind = "NP";
	else 										sLicenseKind = sProdShortName;
	
	// Chart 예외처리
	if (this.gfnIsEmpty(sProdShortName)) {
		if (sProductCd.substr(0, 5) == "G0101")	sLicenseKind = "Chart";
	}
	
	var nRow			= this.ds_MainContract.rowposition;
	var sContractNo		= this.ds_MainContract.getColumn(nRow, "CONTRACT_NO");
	var sContractName	= this.ds_MainContract.getColumn(nRow, "CONTRACT_NAME");
	var sProjectCode	= this.ds_MainContract.getColumn(nRow, "PROJECT_CODE");
	var sProjectName	= this.ds_MainContract.getColumn(nRow, "PROJECT_NAME");
	var sDeliveryDate	= this.ds_MainContract.getColumn(nRow, "DELIVERY_DATE");
	var sContractMain	= this.ds_MainContract.getColumn(nRow, "CONTRACT_MAIN");
	var sContractMainName	= this.ds_MainContract.getColumn(nRow, "CONTRACT_MAIN_NAME");
	
	var sClientCode	= this.FV_PARENT_FORM.div_search.form.div_ClientName.getCode();
	var sClientName	= this.FV_PARENT_FORM.div_search.form.div_ClientName.getData();
	
	if (this.gfnIsEmpty(sContractNo)) {
		this.alert(this.gfnGetTransTxt(1334, "먼저 계약내용을 저장하십시요."));
		return;
	}
	
	// Dataset 컬럼 복사(format 맞추기) 및 초기화
	// this.ds_ParamLic.assign(this.ds_ContractProdDet);
	this.ds_ParamLic.clearData();
	this.ds_ParamLic.addRow();
	
	// 선택된 제품계약 세부 정보 복사
	var nCurrow = this.ds_ContractProdDet.rowposition;
	this.ds_ParamLic.setColumn(0, "PRODUCT_CODE",	this.ds_ContractProdDet.getColumn(nCurrow, "PRODUCT_CODE"));
	this.ds_ParamLic.setColumn(0, "PRODUCT_NAME",	this.ds_ContractProdDet.getColumn(nCurrow, "PRODUCT_NAME"));
	this.ds_ParamLic.setColumn(0, "PRODUCT_VERSION",this.ds_ContractProdDet.getColumn(nCurrow, "PRODUCT_VERSION"));
	this.ds_ParamLic.setColumn(0, "PRODUCT_LIST",	this.ds_ContractProdDet.getColumn(nCurrow, "PRODUCT_LIST"));
	this.ds_ParamLic.setColumn(0, "PLATFORM_LIST",	this.ds_ContractProdDet.getColumn(nCurrow, "PLATFORM_LIST"));
	this.ds_ParamLic.setColumn(0, "FUNCTION_LIST",	this.ds_ContractProdDet.getColumn(nCurrow, "FUNCTION_LIST"));
	this.ds_ParamLic.setColumn(0, "ISDEV_FLAG",		this.ds_ContractProdDet.getColumn(nCurrow, "ISDEV_FLAG"));
	// bSucc = this.ds_ParamLic.copyRow(0, this.ds_ContractProdDet, this.ds_ContractProdDet.rowposition);
	
	var Argument = {pvLicenseKind:sLicenseKind, pvProjectCode:sProjectCode, pvProjectName:sProjectName, pvContractNo:sContractNo, pvContractName:sContractName, pvClientCode:sClientCode, pvClientName:sClientName, pvContractMain:sContractMain, pvParamDsj:this.ds_ParamLic, pvOnlineFlag:bOnlineFlag};
	this.commUtil.popup(this, "popupRequestLicense", "Sales::SP_RequestLicense_pop.xfdl", -1, -1, 1200, 600, true, false, false, Argument, "fnPopupCallBack");
}

// 라이선스요청 POPUP
this.btn_RequestLicense_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.fn_RequestLicense("0");
};

// 공통검색 component callback 처리
this.Com_Search_onChanged = function (obj, e)
{	
	if (!this.gfnIsEmpty(e.newCode)) {
		if (obj.name == "div_ContractMain") {
			// 고객사 변경시 처리
			var ds = new nexacro.Dataset();
			ds = this.contract_div.form.div_ContractMain.form.recentVariant;
			
			// 여신한도 0원 이상 또는 대분류가 해외가 아닌 경우
			var nRestAmt = ds.getColumn(0, "REST");
			if (nexacro.toNumber(nRestAmt) < 0) {
				if (ds.getColumn(0, "CL_EXCEPTION_CODE") != "008") {
					this.alert(this.gfnGetTransTxt(1335, "여신한도 금액 초과 업체 입니다.\n지급 보증각서 또는 내부품의 진행 바랍니다."));
				}
			}			
		}
	}
};

this.grd_ContractDetail_oncellclick = function(obj:nexacro.Grid,e:nexacro.GridClickEventInfo)
{
	// 역할에 맞는 등급만 나오고 필터
	var sCellProp = obj.getCellProperty("body", e.cell, "text");
	var sColNm = sCellProp.split(":")[1];
	var ds = obj.getBindDataset();
	if(sColNm == "LEVEL_CODE")
	{
		var strRoleCode = ds.getColumn(e.row, "ROLE_CODE");
		var nRow = this.ds_cmm_Role.findRow("CODE", strRoleCode);
		var strKind = this.ds_cmm_Role.getColumn(nRow, "VAL1");	
		
		var sFormatId = this.grd_ContractDetail.formatid;
		if (sFormatId == "CS") {
			this.ds_cmm_Level.filter("VAL1=='DEV' || VAL1=='ALL' ");
		} else {
			
			if (strKind == "ALL") {
				this.ds_cmm_Level.filter("");
			} else {
				this.ds_cmm_Level.filter("VAL1=='"+strKind+"' || VAL1=='ALL' ");
			}
		}
	}
};

// 상세 계약금액 합계금액을 CONTRACT_LIST 영역에 세팅
this.fn_setContractPriceSum = function (objDs)
{
	var nSumContractPrice = 0;
	for (var i=0; i<objDs.rowcount; i++) {
		var sContractPrice = objDs.getColumn(i, "CONTRACT_PRICE");
		if (this.gfnIsEmpty(sContractPrice)) sContractPrice = "0";
		
		nSumContractPrice += nexacro.toNumber(sContractPrice);
	}	
	
	this.ds_MainContract.setColumn(this.ds_MainContract.rowposition, "CONTRACT_PRICE", nSumContractPrice);
}

 // 제품, 상품 상세 컬럼 변경 처리
this.ds_ContractProdDet_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	if (e.columnid == "CONTRACT_PRICE") {	// 계약 금액 Sum 처리
		this.fn_setContractPriceSum(obj);
	}
};

 // 용역 상세 컬럼 변경 처리
 this.ds_ContractSiDet_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
 {
	if (e.columnid == "CONTRACT_PRICE") {		// 계약 금액 Sum 처리
		this.fn_setContractPriceSum(obj);
	} else if (e.columnid == "LEVEL_CODE") {	// 등급 변경시 단가 처리
		var sContractDt = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_DATE");
		if (this.gfnIsEmpty(sContractDt)) sContractDt = this.gfnToday();
		
		var sYear = sContractDt.substr(0, 4);
		this.fn_LevelUnitCostQueryData(sYear, e.newvalue);
	} else if (e.columnid == "START_DATE" || e.columnid == "END_DATE") {
		
		var strStartDt = obj.getColumn(e.row, "START_DATE");
		var strEndDt = obj.getColumn(e.row, "END_DATE");

		if(obj.getColumn(e.row, "LEVEL_CODE")=="009")	//출장비 선택시 공수 계산 안함
		{
			obj.setColumn(e.row, "MEN_MONTH", 0);
		}
		else
		{
			// 시작일, 종료일 변경시 M/M계산 조회
			this.fnGetMM(strStartDt, strEndDt, e.row);
			this.fn_setInitContractStartEndDt(this.ds_MainContract.rowposition);
		}
	} else if (e.columnid == "UNIT_COST" || e.columnid == "MEN_MONTH") {
		var nUnitCost = obj.getColumn(e.row, "UNIT_COST");
		var nMenMonth = obj.getColumn(e.row, "MEN_MONTH");
		var nContractPrice = nUnitCost*nMenMonth;
		obj.setColumn(e.row, "CONTRACT_PRICE", nContractPrice)
	} else if (e.columnid == "EXECUTION_TYPE") {
		var sTechSupprotUnit = obj.getColumn(e.row, "TECH_SUPPORT_UNIT");
		if (this.gfnIsEmpty(sTechSupprotUnit)) {
			obj.set_enableevent(false);
			if (e.newvalue == "001") {
				obj.setColumn(e.row, "TECH_SUPPORT_UNIT", "1");
			} else if (e.newvalue == "002") {
				obj.setColumn(e.row, "TECH_SUPPORT_UNIT", "3");
			} else if (e.newvalue == "003") {
				obj.setColumn(e.row, "TECH_SUPPORT_UNIT", "4");
			} 
			obj.set_enableevent(true);
		}
	}
 };

// 통합 유지보수 column 변경
this.ds_MaUnion_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	if(e.columnid=="SUPPORT_STATUS" || e.columnid=="SUPPORT_REMARKS")
	{
		obj.setColumn(e.row, "ORG_SUPPORT_STATUS", obj.getOrgColumn(e.row, "SUPPORT_STATUS"));
		if(obj.getOrgColumn(e.row, "SUPPORT_STATUS") != e.newvalue)
		{
			if(obj.getOrgColumn(e.row, "SUPPORT_REMARKS") == obj.getColumn(e.row, "SUPPORT_REMARKS"))
				obj.setColumn(e.row, "SUPPORT_REMARKS");	//상태를 바꾸면 비고를 자동으로 지워줌
		}
	}
};

 // 유지보수 세부 column 변경
this.ds_ContractMaDet_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	if (e.columnid == "CONTRACT_PRICE") {			// 계약 금액 Sum 처리
		this.fn_setContractPriceSum(obj);
	} else if (e.columnid == "START_DATE" || e.columnid == "END_DATE") {
		var strStartDt = obj.getColumn(e.row, "START_DATE");
		var strEndDt = obj.getColumn(e.row, "END_DATE");
		if (strEndDt < strStartDt) {
			this.alert(this.gfnGetTransTxt(1321, "개시일자 또는 종료일자를 확인하세요\n개시일자 보다 종료일자가 빠릅니다"));
			obj.set_enableevent(false);
			obj.setColumn(e.row, e.columnid, e.oldvalue);
			this.grd_ContractDetail.setCellPos(e.col, e.row);
			obj.set_enableevent(true);
			return;
		}
		
		// 계약 시작일, 종료일 초기화
		this.fn_setInitContractStartEndDt(this.ds_MainContract.rowposition);
	}
};

// 계약 세부 Order down
this.btn_Down_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var sDsId = this.grd_ContractDetail.binddataset;
	var objDs = this.objects[sDsId];
	
	var nRow = objDs.rowposition;
	if (nRow < (objDs.rowcount-1))
	{
		objDs.moveRow(nRow, nRow+1);
		objDs.set_rowposition(nRow+1);		
		
		objDs.set_enableevent(false);
		for(var i=0; i<objDs.rowcount; i++)
		{
			objDs.setColumn(i, "ORD", i+1);
		}
		objDs.set_enableevent(true);
	}
};

// 계약 세부 Order Up
this.btn_Up_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var sDsId = this.grd_ContractDetail.binddataset;
	var objDs = this.objects[sDsId];
	
	var nRow = objDs.rowposition;
	if (nRow > 0)
	{
		objDs.moveRow(nRow, nRow-1);
		objDs.set_rowposition(nRow-1);
				
		objDs.set_enableevent(false);
		for(var i=0; i<objDs.rowcount; i++)
		{
			objDs.setColumn(i, "ORD", i+1);
		}
		objDs.set_enableevent(true);
	}
};

// Form 사이즈 변경
this.SP_Contract_onsize = function(obj:nexacro.Form,e:nexacro.SizeEventInfo)
{
	this.fnCheckDetGridScroll();
};

// 공통 코드 등록 팝업
this.btn_CommCode_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var sArgument = {CD_CODE : "", SCR_ID:this.name};
	this.commUtil.popup(this, "CompanyAddMM", "Sales::SC_CompanyAddMM.xfdl", -1, -1, null, null, true, true, false, sArgument, "fnPopupCallBack");
};




// 헤더 클릭시 소트 미처리 위함
this.grd_ContractDetail_onheadclick = function(obj:nexacro.Grid,e:nexacro.GridClickEventInfo)
{
	
};



this.fnSetFileInit = function()
{	
	this.div_ContractInfo.form.div_Attachment.form.opts["PROJECT_CODE"] = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "PROJECT_CODE");
	this.div_ContractInfo.form.div_Attachment.form.opts["SOURCE_SEQ"] = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_NO");
	this.div_ContractInfo.form.div_Attachment.form.fnSearch();
}

this.tab_Progress_tpg_Maintenance_grd_ContractNumberList_onexpandup = function(obj:nexacro.Grid,e:nexacro.GridMouseEventInfo)
{
	var sCellProp = obj.getCellProperty("body", e.cell, "text");
	if(!this.gfnIsEmpty(sCellProp))
	{	
		var sColNm = sCellProp.split(":")[1];
		var ds = obj.getBindDataset();
				
		if(sColNm == "SUPPORT_REMARKS")
		{
			args = {CONTRACT_NO:ds.getColumn(ds.rowposition,"UNION_CONTRACT_NO")};
			this.commUtil.popup(this, "SP_PurchaseReg", "Sales::SM_MaintenanceStopHistory.xfdl", -1, -1, 800, 500, true, true, false, args, "fnPopupCallBack");
		}
	}
};

this.btn_Online_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.fn_RequestLicense("1");
};

this.tab_Progress_tpg_Maintenance_grd_ContractNumberList_oncelldblclick = function(obj:nexacro.Grid,e:nexacro.GridClickEventInfo)
{
	var sProjectCd =	this.ds_MaUnion.getColumn(e.row, "UNION_PROJECT_CODE");
	var sProjectNm =	this.ds_MaUnion.getColumn(e.row, "UNION_PROJECT_NAME");	
	
	this.commUtil.popupProjectMM(this, "popProjectMM", "fn_popCallBack", sProjectCd, sProjectNm, "R");
};

this.ds_MainContract_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	if(e.columnid=="SUB_CONTRACT_PRICE")
	{
		if(e.newvalue == 0)
			this.ds_MainContract.setColumn(e.row, "SUB_SALES_EMP_NO");
		else if (e.newvalue >= this.ds_MainContract.getColumn(e.row, "CONTRACT_PRICE")){
			this.alert(this.gfnGetTransTxt(1336, "계약금액보다 크게 설정할수 없습니다."));
			this.ds_MainContract.setColumn(e.row, "SUB_CONTRACT_PRICE", e.oldvalue);
		}
	}
	else if(e.columnid=="CONTRACT_TYPE" || e.columnid=="PRODUCT_CODE" || e.columnid=="CONTRACT_MAIN")
	{
		
		if(this.ds_MainContract.getColumn(e.row, "CONTRACT_TYPE") == "P")
		{
			var sProductCd = this.ds_MainContract.getColumn(e.row, "PRODUCT_CODE");
			if (this.gfnIsEmpty(sProductCd))	sProductCd = "";
			
			if (sProductCd.substr(0,3) == "P17" &&
				this.ds_MainContract.getColumn(e.row, "CONTRACT_MAIN") != "Z03766")
			{
				/*제품계약, X-UP, 이젠고가 아닐경우 순매출체크박스를 보여줌*/
				this.ds_MainContract.setColumn(e.row, "NET_SALES_FLAG", "1");
				this.contract_div.form.chb_NetSales.set_visible(true);
			} 
			else if (sProductCd.substr(0,3) == "P95" &&
					 this.ds_MainContract.getColumn(e.row, "CONTRACT_MAIN") != "WIN")
			{
				/*제품계약, TOBEMALL, 이젠고가 아닐경우 순매출체크박스를 보여줌*/
				this.ds_MainContract.setColumn(e.row, "NET_SALES_FLAG", "1");
				this.contract_div.form.chb_NetSales.set_visible(true);
			}
			else
			{
				this.ds_MainContract.setColumn(e.row, "NET_SALES_FLAG", "0");
				this.contract_div.form.chb_NetSales.set_visible(false);
			}
		}
		else
		{
			this.ds_MainContract.setColumn(e.row, "NET_SALES_FLAG", "0");
			this.contract_div.form.chb_NetSales.set_visible(false);
		}	
	} else if(e.columnid=="EM_SEQ")
	{
		if(this.FV_CO_CD=="J02" && this.ds_MainContract.getColumn(e.row, "CONTRACT_TYPE") == "M") {
			var sContractNo = this.ds_MainContract.getColumn(e.row, "CONTRACT_NO");
			
			this.gfnAddSendParameter("CONTRACT_NO",	sContractNo);
			
			// 조회용 Output dataset 세팅
			this.gfnAddOutputDataset("ds_RelatedPurchaseProduct", "ds_output");
			this.gfnCommonTransaction("CheckRelatedPurchaseProduct", "SP_Contract_S05", null, false);
			
			if(this.ds_RelatedPurchaseProduct.rowcount > 0) {
				if(this.confirm(this.gfnGetTransTxt(22659, "매입상세에 매칭 된 건이 있습니다. 확인 클릭 시 견적서 상세 내용을 새로 입력 합니다. 취소 클릭 시 수기로 입력 요청 드립니다."))) {
					this.ds_ContractMaDet.deleteAll();
					this.fnInsertMaEstimateDet(e.newvalue);
				} 
			} else {
				this.ds_ContractMaDet.deleteAll();
				this.fnInsertMaEstimateDet(e.newvalue);
			}
		}
	}
};

this.fnInsertMaEstimateDet = function(sEmSeq)
{
	this.gfnAddSendParameter("EM_SEQ",	sEmSeq);
			
	// 조회용 Output dataset 세팅
	this.gfnAddOutputDataset("ds_EstimateContractMa", "ds_output");
	this.gfnAddOutputDataset("ds_EstimateContractMaDet", "ds_output2");
	this.gfnAddOutputDataset("ds_EstimateUnionContract", "ds_output3");
	this.gfnCommonTransaction("InsertMaEstimateDet", "SP_Contract_S06");
};

this.div_ContractInfo_btn_HistoryMail_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var nRow			= this.ds_MainContract.rowposition;
	var sContractNo		= this.ds_MainContract.getColumn(nRow, "CONTRACT_NO");	
	var sArgument = {pvContractNo:sContractNo, pvKind:"Contract"};
	this.commUtil.popup(this, "CompanyAddMM", "Sales::SP_ContractHistoryMail.xfdl", -1, -1, null, null, true, true, false, sArgument, "fnPopupCallBack");	
};

this.tab_Progress_tpg_PersonInCharge_grd_PersonInCharge_oncelldblclick = function(obj:nexacro.Grid,e:nexacro.GridClickEventInfo)
{
	var sArgument = {COMPANY_CODE : this.ds_AddressbookList.getColumn(e.row, "COMPANY_CODE"), TAB_INDEX:3, MODE:"E"};
	this.commUtil.popup(this, "CompanyTypeSelect", "Sales::SC_CompanyReg.xfdl", -1, -1, null, null, true, true, false, sArgument, "fnPopupCallBack");
};

this.ds_AddressbookList_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	/*담담자 등록기준 변경*/
	if(e.columnid=="SOURCE_CD")
	{
		var sSourceData;
		if(e.newvalue=="CL")
			sSourceData = this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "CONTRACT_NO");
		else if(e.newvalue=="PL")
			sSourceData = this.FV_PARENT_FORM.div_search.form.edt_ProjectCode.value;
		
		this.ds_AddressbookList.setColumn(e.row, "SOURCE_DATA",	sSourceData);
	}
};


this.div_Account_chb_BadDebtFlag_onchanged = function(obj:nexacro.CheckBox,e:nexacro.CheckBoxChangedEventInfo)
{
	this.div_Account.form.cal_BadDebtDate.set_enable(e.postvalue);
	if(e.postvalue)
		this.div_Account.form.cal_BadDebtDate.set_value();
};

this.div_Account_onkillfocus = function(obj:nexacro.Div,e:nexacro.KillFocusEventInfo)
{
	if(this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "BAD_DEBT_FLAG")=="1" && this.gfnIsEmpty(this.ds_MainContract.getColumn(this.ds_MainContract.rowposition, "BAD_DEBT_DATE")))
	{
		this.alert(this.gfnGetTransTxt(1337, "채권대손일을 입력하세요."));
		this.div_Account.form.cal_BadDebtDate.setFocus();
	}
	else
		this.div_Account.set_visible(false);
};






this.fn_setRoyaltyPriceChange = function ()
{
	var nRoyaltyRate = nexacro.toNumber(this.ds_Royalty.getColumn(0, "ROYALTY_RATE"));
	var nContractPrice = nexacro.toNumber(this.ds_Royalty.getColumn(0, "CONTRACT_PRICE"));
	var nExchageRate = nexacro.toNumber(this.ds_Royalty.getColumn(0, "EXCHAGE_RATE"));
	
	
	if (this.gfnIsEmpty(nRoyaltyRate) || nRoyaltyRate<0)		nRoyaltyRate = 0;			// 로열티 비율
	if (this.gfnIsEmpty(nContractPrice) || nContractPrice<0)	nContractPrice = 0;			// 계약 금액
	
	
	this.ds_Royalty.set_enableevent(false);
	if (nRoyaltyRate > 0 && nContractPrice > 0) {
		var nRoyaltyPrice = nexacro.ceil(nContractPrice * (nRoyaltyRate * 0.01));
		this.ds_Royalty.setColumn(0, "ROYALTY_PRICE", nRoyaltyPrice);
		this.ds_Royalty.setColumn(0, "NET_SALES_PRICE", nContractPrice - nRoyaltyPrice);
		this.ds_Royalty.setColumn(0, "EXCHAGE_RATE", nExchageRate);
		this.ds_Royalty.setColumn(0, "ROYALTY_PRICE_KOR", nRoyaltyPrice * nExchageRate);
		
		this.fn_setRoyaltyRemark(nContractPrice, nRoyaltyRate, nRoyaltyPrice, nExchageRate);
		
	} else {
		this.ds_Royalty.setColumn(0, "ROYALTY_PRICE", 0);
		this.ds_Royalty.setColumn(0, "NET_SALES_PRICE", 0);
	}
	this.ds_Royalty.set_enableevent(true);
	this.fn_setPriceMasking(this.tab_Progress.tpg_Royalty.form.medt_NetSalesPrice);
}


this.fn_setRoyaltyRemark = function (nContractPrice, nRoyaltyRate, nRoyaltyPrice, nExchageRate)
{
	/********************************************************************************
	// 일문 비고
	//	"総契約金額 (円) 00  * ロイヤリティ (%) 00  = ロイヤリティ反映金額(엔) 00,000"
	
	// 국문 비고
	//	"총 계약금액(엔) 00  * 로열티(%) 00  = 로열티 반영금액(엔) 00,000"
	//	"로열티 금액(엔) 00  * 환율(원) 00 = 총금액(원)  00,000"
	********************************************************************************/
	
	var sRoyaltyType = this.ds_Royalty.getColumn(0, "ROYALTY_TYPE");
	var sCurrencyUnit = "";
	if (sRoyaltyType == "NW")	sCurrencyUnit = "USD";
	else						sCurrencyUnit = "KRW";
	
	this.ds_Royalty.set_enableevent(false);
	this.ds_Royalty.setColumn(0, "ROYALTY_REMARKS", "総契約金額 (円) " + this.gfnSetComma(nContractPrice) + " * ロイヤリティ (%) "+this.gfnSetComma(nRoyaltyRate)+" = ロイヤリティ反映金額 (円) "+this.gfnSetComma(nRoyaltyPrice));
	this.ds_Royalty.setColumn(0, "ROYALTY_REMARKS_KOR",	 "총 계약금액(엔) " + this.gfnSetComma(nContractPrice) +" * 로열티(%) " + this.gfnSetComma(nRoyaltyRate) + " = 로열티 반영 금액(엔) "+this.gfnSetComma(nRoyaltyPrice)+"\n"
														+"로열티 금액(엔) " + this.gfnSetComma(nRoyaltyPrice) + " * 환율("+sCurrencyUnit+") " + this.tab_Progress.tpg_Royalty.form.medt_Exchange.text + " = 총 금액("+sCurrencyUnit+") " + this.gfnNumFormat(nexacro.ceil(nRoyaltyPrice*nExchageRate)));
	this.ds_Royalty.set_enableevent(true);	
}


// 로열티 적용 버튼 클릭
this.tab_Progress_tpg_Royalty_btn_RoyaltyConfirm_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	// 고객사, 계약명
	if (this.ds_Royalty.rowcount>0) {
		args = {CONTRACT_NO:this.ds_Royalty.getColumn(0, "CONTRACT_NO"), objDS:this.ds_Royalty};
		this.commUtil.popup(this, "popupContractRoyaltyConfirmPop", "Sales::SP_ContractRoyaltyConfirmPop.xfdl", -1, -1, 640, 545, true, true, false, args, "fnPopupCallBack");
	}
};


// 반영일자 변경시 환율 재조회
this.tab_Progress_tpg_Royalty_cal_RoyaltyDt_onchanged = function(obj:nexacro.Calendar,e:nexacro.ChangeEventInfo)
{
	this.fn_ExchageQueryData();
};



// 계약 구분 변경 (제품, 용역, 유지보수 Display 변경처리)
this.cmb_ContractType_onitemchanged = function(obj:nexacro.Combo,e:nexacro.ItemChangeEventInfo)
{
	this.fn_cmb_ContractTypeItemchanged(e.postvalue);
};

// 담당 영업이 변경 처리
this.cmb_SalesEmpNo_onitemchanged = function(obj:nexacro.Combo,e:nexacro.ItemChangeEventInfo)
{
	this.fn_cmb_SalesEmpNoItemChanged(e.postindex, e.postvalue);
};

// 유지보수 계약 복사 추가 버튼 클릭
this.btn_CopyAdd_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.fn_MAContractCopy();
};

// 점검 이력 메일 발송 버튼
this.btn_MaintenceEmail_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.fn_MaintenceHistEmail();
};

// // 회계용 팝업 버튼
this.btn_Account_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.fn_AccountOptionPopup();
};


this.fn_setPriceMasking = function (obj)
{
	if (!obj.visible) return;
	var sContractAmt = obj.value;
	if (this.gfnIsEmpty(sContractAmt))	sContractAmt = 0;
	
	obj.set_type( this.gfn_getPriceMaskEdtType() );
	obj.set_format( this.gfn_getPriceMaskformat(sContractAmt) );
}]]></Script>
    <Objects>
      <Dataset id="ds_cmm_SalesStatus">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_ContractType">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_SalesEmp">
        <ColumnInfo>
          <Column id="EMP_NO" type="string" size="100"/>
          <Column id="EMP_NAME" type="string" size="255"/>
          <Column id="CO_CD" type="string" size="60"/>
          <Column id="DEPT_CD" type="string" size="30"/>
          <Column id="DEPT_NAME" type="string" size="100"/>
          <Column id="BUSINESS_TYPE" type="string" size="30"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_PayMethod">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_Purpose">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_ServerGrade">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_ContProdType">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_PromiseKind">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_ProductUnit">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_Area">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_Role">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_Level">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_Type">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_Importance">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_comm_LevelUnitCost">
        <ColumnInfo>
          <Column id="LEVEL_CODE" type="STRING" size="256"/>
          <Column id="LEVEL_NAME" type="STRING" size="256"/>
          <Column id="UNIT_COST" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_Product">
        <ColumnInfo>
          <Column id="PRODUCT_CODE" type="string" size="20"/>
          <Column id="PRODUCT_CODE_LEVEL" type="int" size="11"/>
          <Column id="P_PRODUCT_CODE" type="string" size="255"/>
          <Column id="PRODUCT_NAME" type="string" size="100"/>
          <Column id="PRODUCT_NAME_SHORT" type="string" size="100"/>
          <Column id="MAIN_PRODUCT_FLAG" type="string" size="1"/>
          <Column id="UNIT_COST" type="float" size="22"/>
          <Column id="REMARKS" type="string" size="1073741823"/>
          <Column id="DELETE_FLAG" type="string" size="1"/>
          <Column id="ORD" type="string" size="10"/>
          <Column id="RELATED_COMPANY_CODE" type="string" size="20"/>
          <Column id="RELATED_COMPANY_NAME" type="string" size="100"/>
          <Column id="INSERT_DATE" type="string" size="8"/>
          <Column id="INSERT_EMP_NO" type="string" size="60"/>
          <Column id="INSERT_EMP_NM" type="string" size="255"/>
          <Column id="INSERT_DEPT_CD" type="string" size="60"/>
          <Column id="INSERT_DEPT_NM" type="string" size="100"/>
          <Column id="INSERT_MODEL" type="string" size="100"/>
          <Column id="UPDATE_DATE" type="datetime" size="23"/>
          <Column id="UPDATE_EMP_NO" type="string" size="60"/>
          <Column id="UPDATE_DEPT_CD" type="string" size="60"/>
          <Column id="UPDATE_DEPT_NM" type="string" size="100"/>
          <Column id="UPDATE_MODEL" type="string" size="100"/>
          <Column id="PTYPE" type="string" size="1"/>
          <Column id="SELECT_FLAG" type="string" size="1"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_BusinessType">
        <ColumnInfo>
          <Column id="LEVEL_CODE" type="STRING" size="256"/>
          <Column id="LEVEL_NAME" type="STRING" size="256"/>
          <Column id="UNIT_COST" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_MaCriteria">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_CaGrade">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_CaRole">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_HoldOffice">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="30"/>
          <Column id="CAPTION" type="STRING" size="255"/>
          <Column id="VAL1" type="STRING" size="100"/>
          <Column id="VAL2" type="STRING" size="100"/>
          <Column id="VAL3" type="STRING" size="100"/>
          <Column id="VAL4" type="STRING" size="100"/>
          <Column id="REMARK" type="STRING" size="1073741823"/>
          <Column id="ORD" type="STRING" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_ExecutionType">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="30"/>
          <Column id="CAPTION" type="STRING" size="255"/>
          <Column id="VAL1" type="STRING" size="100"/>
          <Column id="VAL2" type="STRING" size="100"/>
          <Column id="VAL3" type="STRING" size="100"/>
          <Column id="VAL4" type="STRING" size="100"/>
          <Column id="REMARK" type="STRING" size="1073741823"/>
          <Column id="ORD" type="STRING" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_TechSupportUnit">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="30"/>
          <Column id="CAPTION" type="STRING" size="255"/>
          <Column id="VAL1" type="STRING" size="100"/>
          <Column id="VAL2" type="STRING" size="100"/>
          <Column id="VAL3" type="STRING" size="100"/>
          <Column id="VAL4" type="STRING" size="100"/>
          <Column id="REMARK" type="STRING" size="1073741823"/>
          <Column id="ORD" type="STRING" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_MainContract" onrowposchanged="ds_MainContract_onrowposchanged" oncolumnchanged="ds_MainContract_oncolumnchanged">
        <ColumnInfo>
          <Column id="CONTRACT_TYPE" type="string" size="20"/>
          <Column id="PROJECT_CODE" type="string" size="15"/>
          <Column id="PROJECT_NAME" type="string" size="100"/>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="CO_CD" type="string" size="255"/>
          <Column id="BUSINESS_TYPE" type="string" size="20"/>
          <Column id="CONTRACT_NAME" type="string" size="100"/>
          <Column id="CONTRACT_MAIN" type="string" size="20"/>
          <Column id="CONTRACT_MAIN_NAME" type="string" size="100"/>
          <Column id="PRODUCT_CODE" type="string" size="20"/>
          <Column id="PRODUCT_NAME" type="string" size="100"/>
          <Column id="PAY_METHOD" type="string" size="20"/>
          <Column id="INCENTIVE_EMP_NO" type="string" size="60"/>
          <Column id="SALES_EMP_NO" type="string" size="60"/>
          <Column id="SALES_EMP_NAME" type="string" size="255"/>
          <Column id="CREATE_EMP_NO" type="string" size="60"/>
          <Column id="CREATE_EMP_NAME" type="string" size="255"/>
          <Column id="CONTRACT_PRICE" type="bigdecimal" size="40"/>
          <Column id="PREPAYMENT_EXECUTION_RATE" type="bigdecimal" size="8"/>
          <Column id="CONTRACT_EXECUTION_RATE" type="bigdecimal" size="8"/>
          <Column id="DEFECT_EXECUTION_RATE" type="bigdecimal" size="8"/>
          <Column id="CONTRACT_DATE" type="string" size="8"/>
          <Column id="PROGRESS_EXCEPT_FLAG" type="string" size="1"/>
          <Column id="PROGRESS_100_FLAG" type="string" size="1"/>
          <Column id="PROGRESS_ADD_FLAG" type="string" size="1"/>
          <Column id="EXPORT_FLAG" type="string" size="1"/>
          <Column id="OPEN_DATE" type="string" size="8"/>
          <Column id="ISSUE_DATE" type="string" size="8"/>
          <Column id="DELIVERY_DATE" type="string" size="8"/>
          <Column id="STRATEGY_SALES_FLAG" type="string" size="1"/>
          <Column id="ANNUAL_FLAG" type="string" size="1"/>
          <Column id="START_DATE" type="string" size="8"/>
          <Column id="END_DATE" type="string" size="8"/>
          <Column id="START_DATE2" type="string" size="8"/>
          <Column id="END_DATE2" type="string" size="8"/>
          <Column id="RESULT_DATE" type="string" size="8"/>
          <Column id="PUBLISHER" type="string" size="20"/>
          <Column id="AREA_CODE" type="string" size="20"/>
          <Column id="WITHDRAW_DATE" type="string" size="8"/>
          <Column id="WITHDRAW_EMP_NO" type="string" size="60"/>
          <Column id="WITHDRAW_EMP_NAME" type="string" size="255"/>
          <Column id="UNION_FLAG" type="string" size="1"/>
          <Column id="AUTO_EXTENSION_FLAG" type="string" size="1"/>
          <Column id="REGULAR_VISIT" type="string" size="20"/>
          <Column id="ATTACH" type="string" size="20"/>
          <Column id="REQUEST_PRICE" type="bigdecimal" size="20"/>
          <Column id="VIST_CYCLE" type="string" size="20"/>
          <Column id="REQUEST_CYCLE" type="string" size="20"/>
          <Column id="REQUEST_MONTH" type="string" size="20"/>
          <Column id="REQUEST_DAY" type="string" size="20"/>
          <Column id="AUTO_ISSUE_FLAG" type="string" size="1"/>
          <Column id="SITECHK_FLAG" type="string" size="1"/>
          <Column id="REMARKS" type="string" size="1073741823"/>
          <Column id="SALES_DEPT_CD" type="string" size="60"/>
          <Column id="SALES_DEPT_NAME" type="string" size="100"/>
          <Column id="SALES_CO_CD" type="string" size="60"/>
          <Column id="CONTRACT_STATUS" type="string" size="20"/>
          <Column id="SALES_STATUS" type="string" size="20"/>
          <Column id="COLLECTION_BOND_FLAG" type="string" size="1"/>
          <Column id="CLIENT_PO_NO" type="string" size="50"/>
          <Column id="MEN_MONTH" type="bigdecimal" size="40"/>
          <Column id="DISCOUNT_RATE" type="bigdecimal" size="8"/>
          <Column id="PROFITS_RATE" type="bigdecimal" size="8"/>
          <Column id="ROYALTY_PRICE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ContractProdDet" oncolumnchanged="ds_ContractProdDet_oncolumnchanged">
        <ColumnInfo>
          <Column id="CRD_SEQ" type="bigdecimal" size="20"/>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="PRODUCT_CODE" type="string" size="20"/>
          <Column id="PRODUCT_NAME" type="string" size="109"/>
          <Column id="PRODUCT_VERSION" type="STRING" size="10"/>
          <Column id="PRODUCT_NAME_SHORT" type="string" size="200"/>
          <Column id="PRODUCT_LIST_NAME" type="string" size="255"/>
          <Column id="PRODUCT_LIST" type="string" size="10"/>
          <Column id="PLATFORM_LIST" type="string" size="100"/>
          <Column id="FUNCTION_LIST" type="string" size="100"/>
          <Column id="PURPOSE" type="string" size="20"/>
          <Column id="ISDEV_FLAG" type="string" size="1"/>
          <Column id="SERVER_GRADE" type="string" size="20"/>
          <Column id="PRODUCT_TYPE" type="string" size="20"/>
          <Column id="UNIT_COST" type="BIGDECIMAL" size="22"/>
          <Column id="PRODUCT_UNIT" type="string" size="20"/>
          <Column id="QUANTITY" type="int" size="11"/>
          <Column id="CONTRACT_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="REMARKS" type="string" size="1073741823"/>
          <Column id="DELETE_FLAG" type="string" size="1"/>
          <Column id="ORD" type="STRING" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ContractSiDet" oncolumnchanged="ds_ContractSiDet_oncolumnchanged">
        <ColumnInfo>
          <Column id="CSD_SEQ" type="bigdecimal" size="20"/>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="ROLE_CODE" type="string" size="20"/>
          <Column id="LEVEL_CODE" type="string" size="20"/>
          <Column id="LEVEL_UNIT_COST" type="BIGDECIMAL" size="22"/>
          <Column id="START_DATE" type="string" size="8"/>
          <Column id="END_DATE" type="string" size="8"/>
          <Column id="PERSON_NUMBER" type="int" size="11"/>
          <Column id="UNIT_COST" type="BIGDECIMAL" size="22"/>
          <Column id="CONTRACT_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="MEN_MONTH" type="float" size="22"/>
          <Column id="AREA_CODE" type="string" size="20"/>
          <Column id="REMARKS" type="string" size="1073741823"/>
          <Column id="DELETE_FLAG" type="string" size="1"/>
          <Column id="ORD" type="STRING" size="10"/>
          <Column id="EXECUTION_TYPE" type="STRING" size="20"/>
          <Column id="TECH_SUPPORT_UNIT" type="STRING" size="20"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ContractMaDet" oncolumnchanged="ds_ContractMaDet_oncolumnchanged">
        <ColumnInfo>
          <Column id="CMD_SEQ" type="bigdecimal" size="20"/>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="PRODUCT_CODE" type="string" size="20"/>
          <Column id="PRODUCT_NAME" type="string" size="100"/>
          <Column id="MA_PRODUCT_CODE" type="string" size="20"/>
          <Column id="MA_PRODUCT_NAME" type="string" size="100"/>
          <Column id="START_DATE" type="string" size="8"/>
          <Column id="END_DATE" type="string" size="8"/>
          <Column id="CONTRACT_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="MA_RATE" type="float" size="22"/>
          <Column id="MA_STANDARD" type="STRING" size="256"/>
          <Column id="REMARKS" type="string" size="1073741823"/>
          <Column id="DELETE_FLAG" type="string" size="1"/>
          <Column id="ORD" type="STRING" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ScheduleList">
        <ColumnInfo>
          <Column id="PROJECT_CODE" type="string" size="15"/>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="TYPE_CODE" type="string" size="20"/>
          <Column id="ISSUE_DATE" type="string" size="8"/>
          <Column id="REPORT_FLAG" type="string" size="1"/>
          <Column id="IMPORTANCE" type="int" size="11"/>
          <Column id="OPEN_FLAG" type="string" size="1"/>
          <Column id="CONTENTS" type="string" size="1073741823"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_AddressbookList" oncolumnchanged="ds_AddressbookList_oncolumnchanged">
        <ColumnInfo>
          <Column id="PROJECT_CODE" type="string" size="15"/>
          <Column id="CA_SEQ" type="bigdecimal" size="20"/>
          <Column id="COMPANY_CODE" type="string" size="20"/>
          <Column id="EMP_NAME" type="string" size="100"/>
          <Column id="DEPT_NAME" type="string" size="100"/>
          <Column id="GRADE_NAME" type="string" size="100"/>
          <Column id="ROLE_NAME" type="string" size="100"/>
          <Column id="H_PHONE_NO" type="string" size="30"/>
          <Column id="O_PHONE_NO" type="string" size="30"/>
          <Column id="HOLD_OFFICE" type="string" size="20"/>
          <Column id="EMAIL" type="string" size="200"/>
          <Column id="ETAX_FLAG" type="string" size="1"/>
          <Column id="ORDER_FLAG" type="string" size="1"/>
          <Column id="REMARKS" type="string" size="1073741823"/>
          <Column id="COMPANY_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_MaUnion" oncolumnchanged="ds_MaUnion_oncolumnchanged">
        <ColumnInfo>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="UNION_CONTRACT_NO" type="string" size="10"/>
          <Column id="UNION_PROJECT_CODE" type="string" size="15"/>
          <Column id="UNION_PROJECT_NAME" type="string" size="100"/>
          <Column id="UNION_CONTRACT_NAME" type="string" size="100"/>
          <Column id="PRODUCT_NAME" type="string" size="100"/>
          <Column id="CLIENT_CODE" type="string" size="20"/>
          <Column id="CLIENT_NAME" type="string" size="100"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Promise">
        <ColumnInfo>
          <Column id="CP_SEQ" type="bigdecimal" size="20"/>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="SUBJECT" type="string" size="200"/>
          <Column id="PROMISE_DATE" type="string" size="8"/>
          <Column id="LIMIT_DATE" type="string" size="8"/>
          <Column id="PROMISE_KIND" type="string" size="20"/>
          <Column id="CONTENTS" type="string" size="1073741823"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ParamLic">
        <ColumnInfo>
          <Column id="PRODUCT_CODE" type="STRING" size="256"/>
          <Column id="PRODUCT_NAME" type="STRING" size="256"/>
          <Column id="PRODUCT_VERSION" type="STRING" size="256"/>
          <Column id="PRODUCT_LIST" type="STRING" size="256"/>
          <Column id="PLATFORM_LIST" type="STRING" size="256"/>
          <Column id="FUNCTION_LIST" type="STRING" size="256"/>
          <Column id="ISDEV_FLAG" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ContractBill">
        <ColumnInfo>
          <Column id="ORD_NUM" type="long" size="20"/>
          <Column id="CB_SEQ" type="bigdecimal" size="20"/>
          <Column id="PROJECT_CODE" type="string" size="15"/>
          <Column id="CONTRACT_TYPE" type="string" size="20"/>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="BILL_STATUS" type="string" size="1"/>
          <Column id="PAY_METHOD" type="string" size="20"/>
          <Column id="TAX_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="TAX_PLAN_DATE" type="string" size="8"/>
          <Column id="TAX_DATE" type="string" size="8"/>
          <Column id="VAT_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="BILL_PLAN_DATE" type="string" size="8"/>
          <Column id="BILL_DATE" type="string" size="8"/>
          <Column id="BILL_PROC_DATE" type="string" size="8"/>
          <Column id="BILL_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="REMARKS" type="string" size="1073741823"/>
          <Column id="REMARKS_UNBILL" type="string" size="1073741823"/>
          <Column id="BILL_EXCEPT_FLAG" type="string" size="1"/>
          <Column id="SITECHK_STATUS" type="string" size="20"/>
          <Column id="SITECHK_REMARKS" type="string" size="1073741823"/>
          <Column id="CHK" type="string" size="1"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_MM"/>
      <Dataset id="ds_DupUionContr">
        <ColumnInfo>
          <Column id="PROJECT_CODE" type="string" size="15"/>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="CONTRACT_NAME" type="string" size="100"/>
          <Column id="CLIENT_CODE" type="string" size="20"/>
          <Column id="CLIENT_NAME" type="string" size="100"/>
          <Column id="UNION_CONTRACT_NO" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsInput">
        <ColumnInfo>
          <Column id="EMP_NAME" type="STRING" size="256"/>
          <Column id="PHONE_NO" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="EMP_NAME">111</Col>
            <Col id="PHONE_NO">010-1111-1111</Col>
          </Row>
          <Row>
            <Col id="EMP_NAME">222</Col>
            <Col id="PHONE_NO">010-2222-2222</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_RequestStaff"/>
      <Dataset id="ds_cmm_MaStandard">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_CD_SUPPORT_STATUS"/>
      <Dataset id="ds_CAType">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CODE">PL</Col>
            <Col id="CAPTION">P</Col>
          </Row>
          <Row>
            <Col id="CODE">CL</Col>
            <Col id="CAPTION">C</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="dsCopyContract">
        <ColumnInfo>
          <Column id="CONTRACT_NO" type="STRING" size="256"/>
          <Column id="CA_COPY_FLAG" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_ConsumptionTax">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="30"/>
          <Column id="CAPTION" type="STRING" size="255"/>
          <Column id="VAL1" type="STRING" size="100"/>
          <Column id="VAL2" type="STRING" size="100"/>
          <Column id="VAL3" type="STRING" size="100"/>
          <Column id="VAL4" type="STRING" size="100"/>
          <Column id="REMARK" type="STRING" size="1073741823"/>
          <Column id="ORD" type="STRING" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_RoyaltyType">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_ExchageStatus">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Royalty">
        <ColumnInfo>
          <Column id="PROJECT_CODE" type="string" size="15"/>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="CONTRACT_TYPE" type="STRING" size="20"/>
          <Column id="ROYALTY_SEQ" type="int" size="11"/>
          <Column id="ROYALTY_CONTRACT_NO" type="string" size="10"/>
          <Column id="CONTRACT_NO_PURCHASE" type="STRING" size="256"/>
          <Column id="ROYALTY_TYPE" type="string" size="20"/>
          <Column id="ROYALTY_RATE" type="bigdecimal" size="8"/>
          <Column id="ROYALTY_DATE" type="string" size="8"/>
          <Column id="CONTRACT_PRICE" type="BIGDECIMAL" size="20"/>
          <Column id="ROYALTY_PRICE" type="bigdecimal" size="20"/>
          <Column id="ROYALTY_PRICE_KOR" type="bigdecimal" size="20"/>
          <Column id="NET_SALES_PRICE" type="bigdecimal" size="20"/>
          <Column id="CONFIRM_FLAG" type="string" size="1"/>
          <Column id="EXCHAGE_STATUS" type="string" size="20"/>
          <Column id="EXCHAGE_RATE" type="STRING" size="256"/>
          <Column id="ROYALTY_REMARKS" type="string" size="1073741823"/>
          <Column id="REMARKS" type="string" size="1073741823"/>
          <Column id="ROYALTY_REMARKS_KOR" type="string" size="1073741823"/>
          <Column id="REMARKS_KOR" type="string" size="1073741823"/>
          <Column id="CONTRACT_NO_KOR" type="STRING" size="256"/>
          <Column id="CONTRACT_NAME_KOR" type="STRING" size="256"/>
          <Column id="BILL_REMARKS" type="string" size="1073741823"/>
          <Column id="TAX_PLAN_DATE" type="STRING" size="8"/>
          <Column id="TAX_DATE" type="STRING" size="8"/>
          <Column id="BILL_PLAN_DATE" type="STRING" size="8"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsCheckBill">
        <ColumnInfo>
          <Column id="CB_SEQ" type="INT" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsBillList">
        <ColumnInfo>
          <Column id="CB_SEQ" type="INT" size="256"/>
          <Column id="CONTRACT_NO" type="STRING" size="256"/>
          <Column id="BILL_STATUS" type="STRING" size="256"/>
          <Column id="PAY_METHOD" type="STRING" size="256"/>
          <Column id="TAX_PRICE" type="INT" size="256"/>
          <Column id="VAT_PRICE" type="INT" size="256"/>
          <Column id="TAX_PLAN_DATE" type="STRING" size="256"/>
          <Column id="TAX_DATE" type="STRING" size="256"/>
          <Column id="BILL_PRICE" type="INT" size="256"/>
          <Column id="BILL_PLAN_DATE" type="STRING" size="256"/>
          <Column id="BILL_DATE" type="STRING" size="256"/>
          <Column id="BILL_PROC_DATE" type="STRING" size="256"/>
          <Column id="BILL_EXCEPT_FLAG" type="STRING" size="256"/>
          <Column id="SITECHK_STATUS" type="STRING" size="256"/>
          <Column id="REMARKS" type="STRING" size="256"/>
          <Column id="REMARKS_UNBILL" type="STRING" size="256"/>
          <Column id="SITECHK_REMARKS" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_RelatedPurchaseProduct">
        <ColumnInfo>
          <Column id="CMD_SEQ" type="INT" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_EstimateContractMa">
        <ColumnInfo>
          <Column id="EM_SEQ" type="STRING" size="256"/>
          <Column id="CONTRACT_NAME" type="STRING" size="256"/>
          <Column id="CONTRACT_MAIN" type="STRING" size="256"/>
          <Column id="CONTRACT_MAIN_NAME" type="STRING" size="256"/>
          <Column id="SALES_STATUS" type="STRING" size="256"/>
          <Column id="START_DATE" type="STRING" size="256"/>
          <Column id="END_DATE" type="STRING" size="256"/>
          <Column id="CONSUMPTION_TAX" type="STRING" size="256"/>
          <Column id="PAY_METHOD" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_EstimateContractMaDet">
        <ColumnInfo>
          <Column id="EMD_SEQ" type="STRING" size="256"/>
          <Column id="EM_SEQ" type="STRING" size="256"/>
          <Column id="PRODUCT_CODE" type="STRING" size="256"/>
          <Column id="MA_MAIN_PRODUCT_CODE" type="STRING" size="256"/>
          <Column id="START_DATE" type="STRING" size="256"/>
          <Column id="END_DATE" type="STRING" size="256"/>
          <Column id="MA_RATE" type="STRING" size="256"/>
          <Column id="MA_STANDARD" type="STRING" size="256"/>
          <Column id="CONTRACT_PRICE" type="STRING" size="256"/>
          <Column id="MA_PRODUCT_CODE" type="STRING" size="256"/>
          <Column id="MA_PRODUCT_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_ExchageInfo">
        <ColumnInfo>
          <Column id="ER_SEQ" type="STRING" size="256"/>
          <Column id="YYYYMM" type="STRING" size="256"/>
          <Column id="BASE_CURRENCY" type="STRING" size="256"/>
          <Column id="COUNTER_CURRENCY" type="STRING" size="256"/>
          <Column id="EXCHAGE_RATE" type="STRING" size="256"/>
          <Column id="CONFIRM_FLAG" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_EstimateUnionContract">
        <ColumnInfo>
          <Column id="UNION_CONTRACT_NO" type="STRING" size="256"/>
          <Column id="UNION_CONTRACT_NAME" type="STRING" size="256"/>
          <Column id="PROJECT_CODE" type="STRING" size="256"/>
          <Column id="PROJECT_NAME" type="STRING" size="256"/>
          <Column id="CLIENT_CODE" type="STRING" size="256"/>
          <Column id="CLIENT_NAME" type="STRING" size="256"/>
          <Column id="PRODUCT_CODE" type="STRING" size="256"/>
          <Column id="PRODUCT_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_Publisher_SI">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="30"/>
          <Column id="CAPTION" type="STRING" size="255"/>
          <Column id="VAL1" type="STRING" size="100"/>
          <Column id="VAL2" type="STRING" size="100"/>
          <Column id="VAL3" type="STRING" size="100"/>
          <Column id="VAL4" type="STRING" size="100"/>
          <Column id="REMARK" type="STRING" size="1073741823"/>
          <Column id="ORD" type="STRING" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_checkProduct">
        <ColumnInfo>
          <Column id="PRODUCT_CODE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item0" compid="tab_Progress.tpg_SalesProgess.form.cmb_ProgressTypeCode" propid="value" datasetid="ds_ScheduleList" columnid="TYPE_CODE"/>
      <BindItem id="item1" compid="tab_Progress.tpg_SalesProgess.form.cal_ProgessIssueDate" propid="value" datasetid="ds_ScheduleList" columnid="ISSUE_DATE"/>
      <BindItem id="item2" compid="tab_Progress.tpg_SalesProgess.form.chb_ProgressReport" propid="value" datasetid="ds_ScheduleList" columnid="REPORT_FLAG"/>
      <BindItem id="item3" compid="tab_Progress.tpg_SalesProgess.form.cmb_Importance" propid="value" datasetid="ds_ScheduleList" columnid="IMPORTANCE"/>
      <BindItem id="item4" compid="tab_Progress.tpg_Remark.form.ta_Remark" propid="value" datasetid="ds_MainContract" columnid="REMARKS"/>
      <BindItem id="item14" compid="div_ContractInfo.form.cal_FreeMaEndDate" propid="value" datasetid="ds_MainContract" columnid="DELIVERY_DATE"/>
      <BindItem id="item15" compid="div_ContractInfo.form.cal_OpenDate" propid="value" datasetid="ds_MainContract" columnid="OPEN_DATE"/>
      <BindItem id="item16" compid="div_ContractInfo.form.cal_LICDate" propid="value" datasetid="ds_MainContract" columnid="ISSUE_DATE"/>
      <BindItem id="item17" compid="div_ContractInfo.form.chb_Annual" propid="value" datasetid="ds_MainContract" columnid="ANNUAL_FLAG"/>
      <BindItem id="item18" compid="div_ContractInfo.form.cal_StartDt" propid="value" datasetid="ds_MainContract" columnid="START_DATE2"/>
      <BindItem id="item19" compid="div_ContractInfo.form.cal_EndDt" propid="value" datasetid="ds_MainContract" columnid="END_DATE2"/>
      <BindItem id="item20" compid="div_ContractInfo.form.cal_ResultDt" propid="value" datasetid="ds_MainContract" columnid="RESULT_DATE"/>
      <BindItem id="item27" compid="medt_ContractExecutionRate00" propid="value" datasetid="ds_MainContract" columnid="CONTRACT_EXECUTION_RATE"/>
      <BindItem id="item11" compid="tab_Progress.tpg_Promise.form.edt_PromiseTitle" propid="value" datasetid="ds_Promise" columnid="SUBJECT"/>
      <BindItem id="item12" compid="tab_Progress.tpg_Promise.form.cmb_PromiseType" propid="value" datasetid="ds_Promise" columnid="PROMISE_KIND"/>
      <BindItem id="item13" compid="tab_Progress.tpg_Promise.form.cal_PromiseDate" propid="value" datasetid="ds_Promise" columnid="PROMISE_DATE"/>
      <BindItem id="item25" compid="tab_Progress.tpg_Promise.form.cal_PromiseDueDate" propid="value" datasetid="ds_Promise" columnid="LIMIT_DATE"/>
      <BindItem id="item30" compid="tab_Progress.tpg_Promise.form.txt_ContractPromise" propid="value" datasetid="ds_Promise" columnid="CONTENTS"/>
      <BindItem id="item31" compid="tab_Progress.tpg_SalesProgess.form.txt_ProgessContents" propid="value" datasetid="ds_ScheduleList" columnid="CONTENTS"/>
      <BindItem id="item45" compid="div_Account.form.chb_ProgressExceptFlag" propid="value" datasetid="ds_MainContract" columnid="PROGRESS_EXCEPT_FLAG"/>
      <BindItem id="item46" compid="div_Account.form.chb_Progress100Flag" propid="value" datasetid="ds_MainContract" columnid="PROGRESS_100_FLAG"/>
      <BindItem id="item47" compid="div_Account.form.chb_ProgressAddFlag" propid="value" datasetid="ds_MainContract" columnid="PROGRESS_ADD_FLAG"/>
      <BindItem id="item21" compid="div_Account.form.chb_BadDebtFlag" propid="value" datasetid="ds_MainContract" columnid="BAD_DEBT_FLAG"/>
      <BindItem id="item22" compid="div_Account.form.cal_BadDebtDate" propid="value" datasetid="ds_MainContract" columnid="BAD_DEBT_DATE"/>
      <BindItem id="item48" compid="tab_Progress.tpg_Royalty.form.msk_RoyaltyRate" propid="value" datasetid="ds_Royalty" columnid="ROYALTY_RATE"/>
      <BindItem id="item49" compid="tab_Progress.tpg_Royalty.form.cal_RoyaltyDt" propid="value" datasetid="ds_Royalty" columnid="ROYALTY_DATE"/>
      <BindItem id="item50" compid="tab_Progress.tpg_Royalty.form.medt_RoyaltyPrice" propid="value" datasetid="ds_Royalty" columnid="ROYALTY_PRICE"/>
      <BindItem id="item51" compid="tab_Progress.tpg_Royalty.form.medt_NetSalesPrice" propid="value" datasetid="ds_Royalty" columnid="NET_SALES_PRICE"/>
      <BindItem id="item52" compid="tab_Progress.tpg_Royalty.form.chb_ConfirmFlag" propid="value" datasetid="ds_Royalty" columnid="CONFIRM_FLAG"/>
      <BindItem id="item53" compid="tab_Progress.tpg_Royalty.form.cmb_ExchageStatus" propid="value" datasetid="ds_Royalty" columnid="EXCHAGE_STATUS"/>
      <BindItem id="item54" compid="tab_Progress.tpg_Royalty.form.ta_RoyaltyRemarks" propid="value" datasetid="ds_Royalty" columnid="ROYALTY_REMARKS"/>
      <BindItem id="item55" compid="tab_Progress.tpg_Royalty.form.cmb_RoyaltyType" propid="value" datasetid="ds_Royalty" columnid="ROYALTY_TYPE"/>
      <BindItem id="item56" compid="tab_Progress.tpg_Royalty.form.ta_Remarks" propid="value" datasetid="ds_Royalty" columnid="REMARKS"/>
      <BindItem id="item5" compid="tab_Progress.tpg_Royalty.form.medt_Exchange" propid="value" datasetid="ds_Royalty" columnid="EXCHAGE_RATE"/>
      <BindItem id="item6" compid="div_ContractInfo.form.div_ContractMain_K.form.cmb_ContractType" propid="value" datasetid="ds_MainContract" columnid="CONTRACT_TYPE"/>
      <BindItem id="item7" compid="div_ContractInfo.form.div_ContractMain_K.form.edt_ContractName" propid="value" datasetid="ds_MainContract" columnid="CONTRACT_NAME"/>
      <BindItem id="item8" compid="div_ContractInfo.form.div_ContractMain_K.form.cmb_SalesProduct" propid="value" datasetid="ds_MainContract" columnid="PRODUCT_CODE"/>
      <BindItem id="item9" compid="div_ContractInfo.form.div_ContractMain_K.form.chb_Export" propid="value" datasetid="ds_MainContract" columnid="EXPORT_FLAG"/>
      <BindItem id="item10" compid="div_ContractInfo.form.div_ContractMain_K.form.chb_StrategySales" propid="value" datasetid="ds_MainContract" columnid="STRATEGY_SALES_FLAG"/>
      <BindItem id="item23" compid="div_ContractInfo.form.div_ContractMain_K.form.cmb_SalesStatus" propid="value" datasetid="ds_MainContract" columnid="SALES_STATUS"/>
      <BindItem id="item24" compid="div_ContractInfo.form.div_ContractMain_K.form.cmb_PayMethod" propid="value" datasetid="ds_MainContract" columnid="PAY_METHOD"/>
      <BindItem id="item26" compid="div_ContractInfo.form.div_ContractMain_K.form.medt_ContractPrice" propid="value" datasetid="ds_MainContract" columnid="CONTRACT_PRICE"/>
      <BindItem id="item28" compid="div_ContractInfo.form.div_ContractMain_K.form.cmb_SalesEmpNo" propid="value" datasetid="ds_MainContract" columnid="SALES_EMP_NO"/>
      <BindItem id="item29" compid="div_ContractInfo.form.div_ContractMain_K.form.cmb_Incentive" propid="value" datasetid="ds_MainContract" columnid="INCENTIVE_EMP_NO"/>
      <BindItem id="item32" compid="div_ContractInfo.form.div_ContractMain_K.form.edt_ContractEnroll" propid="value" datasetid="ds_MainContract" columnid="CREATE_EMP_NAME"/>
      <BindItem id="item33" compid="div_ContractInfo.form.div_ContractMain_K.form.medt_ContractExecutionRate" propid="value" datasetid="ds_MainContract" columnid="CONTRACT_EXECUTION_RATE"/>
      <BindItem id="item34" compid="div_ContractInfo.form.div_ContractMain_K.form.medt_ContractDefectExecutionRate" propid="value" datasetid="ds_MainContract" columnid="DEFECT_EXECUTION_RATE"/>
      <BindItem id="item35" compid="div_ContractInfo.form.div_ContractMain_K.form.medt_PrepaymentExecutionRate" propid="value" datasetid="ds_MainContract" columnid="PREPAYMENT_EXECUTION_RATE"/>
      <BindItem id="item36" compid="div_ContractInfo.form.div_ContractMain_K.form.cmb_BusinessType" propid="value" datasetid="ds_MainContract" columnid="BUSINESS_TYPE"/>
      <BindItem id="item37" compid="div_ContractInfo.form.div_ContractMain_K.form.edt_ClientPoNo" propid="value" datasetid="ds_MainContract" columnid="CLIENT_PO_NO"/>
      <BindItem id="item38" compid="div_ContractInfo.form.div_ContractMain_K.form.chb_UnionFlag" propid="value" datasetid="ds_MainContract" columnid="UNION_FLAG"/>
      <BindItem id="item39" compid="div_ContractInfo.form.div_ContractMain_K.form.chb_AutoExtension" propid="value" datasetid="ds_MainContract" columnid="AUTO_EXTENSION_FLAG"/>
      <BindItem id="item40" compid="div_ContractInfo.form.div_ContractMain_K.form.chk_SitecheckFlag" propid="value" datasetid="ds_MainContract" columnid="SITECHK_FLAG"/>
      <BindItem id="item41" compid="div_ContractInfo.form.div_ContractMain_K.form.cmb_SubSalesEmpNo" propid="value" datasetid="ds_MainContract" columnid="SUB_SALES_EMP_NO"/>
      <BindItem id="item42" compid="div_ContractInfo.form.div_ContractMain_K.form.medt_SubContractPrice" propid="value" datasetid="ds_MainContract" columnid="SUB_CONTRACT_PRICE"/>
      <BindItem id="item43" compid="div_ContractInfo.form.div_ContractMain_K.form.chb_NetSales" propid="value" datasetid="ds_MainContract" columnid="NET_SALES_FLAG"/>
      <BindItem id="item44" compid="div_ContractInfo.form.div_ContractMain_K.form.chb_DivisionFlag" propid="value" datasetid="ds_MainContract" columnid="DIVISION_FLAG"/>
      <BindItem id="item57" compid="div_ContractInfo.form.div_ContractMain_K.form.cmb_ConsumptionTax" propid="value" datasetid="ds_MainContract" columnid="CONSUMPTION_TAX"/>
    </Bind>
  </Form>
</FDL>
