<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="SP_PurchaseReg" width="1510" height="650" titletext="매입계약 정보등록" cssclass="frm_popBg" onload="SP_PurchaseReg_onload">
    <Layouts>
      <Layout height="650" mobileorientation="landscape" width="1510">
        <Div id="div_List" taborder="15" text="Div00" left="10" top="38" bottom="43" right="1320">
          <Layouts>
            <Layout>
              <Static id="stc_GbSales00" taborder="2" cssclass="sta_POP_GroupBg" left="0" top="0" text="" height="30" right="0"/>
              <Grid id="grd_List" taborder="0" left="0" top="30" binddataset="dsList" autofittype="col" formatid="default" bottom="0" right="0">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="30"/>
                      <Column size="80"/>
                      <Column size="60"/>
                    </Columns>
                    <Rows>
                      <Row size="24" band="head"/>
                      <Row size="24" band="head"/>
                      <Row size="24"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="No"/>
                      <Cell col="1" text="최종수정일" TL_SEQ="761"/>
                      <Cell col="2" text="수정자" TL_SEQ="337"/>
                      <Cell row="1" colspan="3" text="매입계약명" TL_SEQ="161"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:NO" cssclass="expr:DELETE_FLAG=='0'?'Expr_Case_Font_blue':''" tooltiptext="bind:CONTRACT_NAME"/>
                      <Cell col="1" text="bind:UPDATE_DATE" calendardateformat="yyyy-MM-dd" cssclass="expr:DELETE_FLAG=='0'?'Expr_Case_Font_blue':''" tooltiptext="bind:CONTRACT_NAME" displaytype="date"/>
                      <Cell col="2" text="bind:UPDATE_EMP_NAME" cssclass="expr:DELETE_FLAG=='0'?'Expr_Case_Font_blue':''" tooltiptext="bind:CONTRACT_NAME"/>
                      <Cell row="1" colspan="3" text="bind:CONTRACT_NAME" cssclass="expr:DELETE_FLAG=='0'?'Expr_Case_Font_blue':''" tooltiptext="bind:CONTRACT_NAME"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Button id="btn_PurchaseCopy" taborder="1" width="16" height="16" top="7" right="8" cssclass="btn_POP_Add" onclick="btn_CommAddRemove_onclick" text=""/>
              <Static id="stc_GbSalesText00" taborder="3" text="계약이력" left="8.00" top="-3" width="95" height="19" visible="true" cssclass="sta_POP_GroupTit" TL_SEQ="762"/>
            </Layout>
          </Layouts>
        </Div>
        <Div id="div_Sales_List" taborder="14" cssclass="div_WF_detailBg" top="38" text="" left="div_List:10" right="10" height="181">
          <Layouts>
            <Layout>
              <Div id="div_Remarks" taborder="0" left="533" top="93" height="82" right="4">
                <Layouts>
                  <Layout>
                    <Static id="stc_Remark" taborder="0" text="비고" top="0" width="52" cssclass="sta_WF_DetailTit" textAlign="right" left="-5" bottom="0" TL_SEQ="45"/>
                    <TextArea id="txt_Remark" taborder="1" left="55" top="0" bottom="0" width="43.61%"/>
                    <Static id="stc_Remark00" taborder="2" text="매입&#13;&#10;상세&#13;&#10;비고" top="0" width="28" cssclass="sta_WF_DetailTit" textAlign="right" bottom="0" left="txt_Remark:6" TL_SEQ="1921"/>
                    <TextArea id="txt_RemarkDet" taborder="3" top="0" bottom="0" left="stc_Remark00:8" right="0"/>
                  </Layout>
                </Layouts>
              </Div>
              <Static id="stc_ProductType" taborder="1" text="매입구분" top="63" width="52" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="528" TL_SEQ="747"/>
              <Combo id="cmb_ProductType" taborder="2" text="" left="588" top="63" width="82" height="22" innerdataset="ds_CD_PURCHASE_TYPE" codecolumn="CODE" datacolumn="CAPTION"/>
              <Edit id="edt_ResponsibilitySales" taborder="3" left="451" top="63" width="70" height="22" readonly="true"/>
              <Static id="stc_ResponsibilitySales" taborder="4" text="담당영업" top="63" width="76" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="367" TL_SEQ="37"/>
              <Static id="stc_ClientName" taborder="5" text="고객사" top="63" width="68" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="4" TL_SEQ="32"/>
              <Static id="stc_ProjectName" taborder="6" text="프로젝트" top="33" width="68" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="4" TL_SEQ="119"/>
              <CheckBox id="chb_NetSales" taborder="7" text="순매출" left="886" top="33" width="68" height="22" falsevalue="0" truevalue="1" enable="false" TL_SEQ="279"/>
              <Static id="stc_ContractName" taborder="8" text="매출계약" top="93" width="68" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="4" TL_SEQ="650"/>
              <Static id="stc_CompanyCode" taborder="9" text="매입계약처코드" top="123" width="84" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="359" TL_SEQ="739"/>
              <Edit id="edt_CompanyCode" taborder="10" left="451" top="123" width="70" height="22" readonly="true"/>
              <Combo id="cmb_ProvideType" taborder="11" text="" left="588" top="33" width="82" height="22" innerdataset="ds_CD_PAY_TERM" codecolumn="CODE" datacolumn="CAPTION"/>
              <Static id="stc_ProvideType" taborder="12" text="지급구분" top="33" width="52" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="528" TL_SEQ="740"/>
              <Static id="stc_CompanyName" taborder="13" text="매입계약처" top="123" width="68" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="4" TL_SEQ="163"/>
              <Div id="div_PurchaseCompany" taborder="14" top="123" height="22" url="sales::comm/COM_Search.xfdl" binddataset="dsPurchase" kind="COMPANY" async="false" codecolumn="CONTRACT_MAIN" datacolumn="CONTRACT_MAIN_NAME" mode="" left="80" width="271" user_onchanged="dsPurchase_user_onchanged" param="2"/>
              <Div id="div_Contract" taborder="15" left="80" top="93" width="441" height="22" url="sales::comm/COM_Search.xfdl" binddataset="dsPurchase" kind="CONTRACT_PROJECT" async="false" codecolumn="CL_CONTRACT_NO" datacolumn="CL_CONTRACT_NAME" param="searchtype:N" user_onchanged="dsPurchase_user_onchanged" projectcodecolumn="PROJECT_CODE"/>
              <Edit id="edt_PurchaseContractName" taborder="16" left="80" top="153" width="441" height="22"/>
              <Static id="st_PurchaseContractName" taborder="17" text="매입계약명" top="153" width="68" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="4" TL_SEQ="161"/>
              <Static id="stc_ContractDueDate" taborder="18" text="계약일" top="33" width="60" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="676" TL_SEQ="490"/>
              <Calendar id="cal_ContractDate" taborder="19" left="742" top="33" width="136" height="22" dateformat="yyyy-MM-dd"/>
              <Static id="stc_ContractNo" taborder="20" text="계약서번호" top="63" width="60" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="676" TL_SEQ="743"/>
              <Edit id="edt_ContractDocNo" taborder="21" left="742" top="63" width="136" height="22" textAlign="center" maxlength="50"/>
              <CheckBox id="chb_LumpPay" taborder="22" text="일괄지급" left="958" top="33" width="76" height="22" falsevalue="0" truevalue="1" TL_SEQ="741"/>
              <Div id="div_Project" taborder="23" left="80" top="33" width="441" height="22" url="sales::comm/COM_Search.xfdl" binddataset="dsPurchase" kind="PROJECT" async="false" codecolumn="PROJECT_CODE" datacolumn="PROJECT_NAME" param="searchtype:P,searchcode:CLIENT_CODE" user_onchanged="dsPurchase_user_onchanged"/>
              <Div id="div_Client" taborder="24" left="80" top="63" width="271" height="22" url="sales::comm/COM_Search.xfdl" binddataset="dsPurchase" kind="PROJECT" async="false" codecolumn="CLIENT_CODE" datacolumn="CLIENT_NAME" param="searchtype:C" user_onchanged="dsPurchase_user_onchanged"/>
              <Div id="div_ContractPeriod" taborder="25" left="528" top="93" width="581" height="22" visible="false">
                <Layouts>
                  <Layout>
                    <Calendar id="cal_ContractPeriodEndDate" taborder="0" left="202" top="0" width="124" height="22" dateformat="yyyy-MM-dd"/>
                    <Static id="stc_ContractPeriod00" taborder="1" text="~" top="0" width="12" height="22" cssclass="sta_WF_DetailTit" textAlign="center" left="187"/>
                    <Calendar id="cal_ContractPeriodStartDate" taborder="2" left="60" top="0" width="124" height="22" dateformat="yyyy-MM-dd"/>
                    <Static id="stc_ContractPeriod" taborder="3" text="계약기간" top="0" width="52" height="22" textAlign="right" left="0" cssclass="sta_WF_DetailTit" TL_SEQ="120"/>
                    <CheckBox id="chb_Period" taborder="4" text="기간계약" left="354" top="1" width="78" height="20" falsevalue="0" truevalue="1" TL_SEQ="748"/>
                    <Combo id="cmb_PayMethod" taborder="5" left="502" top="0" width="70" height="22" innerdataset="ds_CD_PAY_METHOD" codecolumn="CODE" datacolumn="CAPTION" value=","/>
                    <Static id="stc_ContractAddType" taborder="6" text="결재조건" top="0" width="68" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="427" TL_SEQ="749"/>
                  </Layout>
                </Layouts>
              </Div>
              <Static id="stc_ContractDocNoPre" taborder="26" text="이전계약서번호" top="63" width="84" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="886" visible="false" TL_SEQ="744"/>
              <Edit id="edt_ContractDocNoPre" taborder="27" left="972" top="63" width="142" height="22" textAlign="center" maxlength="50" visible="false" readonly="true"/>
              <Static id="stc_ContractAddType" taborder="28" text="계약추가" top="33" width="68" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="1132" visible="false" TL_SEQ="742"/>
              <Static id="stc_PayPlanDay" taborder="29" text="지급예정일" top="63" width="68" height="22" cssclass="sta_WF_DetailTit" textAlign="right" left="1132" visible="false" TL_SEQ="736"/>
              <Combo id="cmb_PayPlanDay" taborder="30" text="" left="1207" top="63" width="69" height="22" innerdataset="innerdataset" codecolumn="codecolumn" datacolumn="datacolumn" visible="false">
                <Dataset id="innerdataset">
                  <ColumnInfo>
                    <Column id="codecolumn" size="256"/>
                    <Column id="datacolumn" size="256"/>
                  </ColumnInfo>
                  <Rows>
                    <Row>
                      <Col id="codecolumn">10</Col>
                      <Col id="datacolumn">10일</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">15</Col>
                      <Col id="datacolumn">15일</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">20</Col>
                      <Col id="datacolumn">20일</Col>
                    </Row>
                    <Row>
                      <Col id="codecolumn">25</Col>
                      <Col id="datacolumn">25일</Col>
                    </Row>
                  </Rows>
                </Dataset>
              </Combo>
              <Combo id="cmb_ContractAddType" taborder="31" left="1206" top="33" height="22" innerdataset="ds_CD_CONTRACT_ADD_TYPE" codecolumn="CODE" datacolumn="CAPTION" value="," visible="false" width="70"/>
              <CheckBox id="chb_IsIncludeRemark" taborder="32" text="비고반영" left="1042" top="33" width="76" height="22" falsevalue="0" truevalue="1" TL_SEQ="750"/>
              <Button id="btn_Popup" taborder="33" top="63" width="22" height="22" cssclass="btn_WF_Sch" onclick="btn_Popup_onclick" visible="false" left="1113"/>
              <CheckBox id="chb_MainContractReport" taborder="34" text="계약서 원청인력 표시" left="385" top="153" width="136" height="22" falsevalue="0" truevalue="1" visible="false" value="0" TL_SEQ="751"/>
              <Static id="stc_GbSales00" taborder="35" cssclass="sta_POP_GroupBg" left="0" top="-1" text="" height="30" right="0"/>
              <Static id="stc_GbSalesText00" taborder="36" text="기본정보" left="8.00" top="5" width="199" height="21" visible="true" cssclass="sta_POP_GroupTit" TL_SEQ="752"/>
            </Layout>
          </Layouts>
        </Div>
        <Static id="Static00" taborder="1" left="0" height="38" right="1" bottom="1" cssclass="sta_POP_BtnBg"/>
        <Button id="btn_Cancel" taborder="4" text="닫기" width="60" height="28" cssclass="btn_WF_cancel" right="10" bottom="8" onclick="btn_Cancel_onclick" TL_SEQ="59"/>
        <Button id="btn_SaveClose" taborder="6" text="저장 후 닫기" width="100" height="28" cssclass="btn_WF_Crud" right="btn_Cancel:4" bottom="8" onclick="btn_SaveClose_onclick" enable="false" TL_SEQ="753"/>
        <Button id="btn_Save" taborder="0" text="저장" width="60" height="28" cssclass="btn_WF_Crud" right="btn_SaveClose:4" bottom="8" onclick="btn_Save_onclick" enable="false" TL_SEQ="115"/>
        <Div id="div_Attachment" taborder="5" left="8" width="80" async="false" SOURCE_CD="PL" SOURCE_SEQ="CONTRACT_NO_PURCHASE_SEQ" USE_NEXT_FILE_TYPE="true" USE_LINK_TYPE="false" USE_MULTI_FILE="true" USE_OPEN_ADD_DIALOG="false" USE_DELETE_ALL="false" USE_BUTTON_ONLY="true" BINDDATASET="dsPurchase" url="sales::comm/COM_Attachment.xfdl" bottom="8" height="24"/>
        <Button id="btn_ProductPurchaseOrder" taborder="2" text="상품발주서" width="108" height="28" left="div_Attachment:4" bottom="8" onclick="btn_ProductPurchaseOrder_onclick" background="" TL_SEQ="754"/>
        <CheckBox id="chb_SalesDeliveryDateChangeFlag" taborder="3" text="매출 납품일자 덮어쓰기" width="156" height="22" right="btn_Save:4" bottom="11" falsevalue="0" truevalue="1" TL_SEQ="755"/>
        <Button id="btn_Delete" taborder="7" text="삭제" width="60" height="28" cssclass="btn_WF_Crud" right="chb_SalesDeliveryDateChangeFlag:4" bottom="8" onclick="btn_Delete_onclick" enable="false" TL_SEQ="117"/>
        <Button id="btn_Search" taborder="8" text="새로고침" top="6" width="76" height="28" cssclass="btn_WF_SchText" right="10" onclick="btn_Search_onclick" TL_SEQ="36"/>
        <Div id="div_ProdContract" taborder="10" left="div_List:10" top="404" right="4" bottom="43">
          <Layouts>
            <Layout>
              <Grid id="grd_GbProductContractDetail" taborder="0" binddataset="dsProdContract" scrollbars="alwaysvert" useinputpanel="false" cellsizingtype="col" top="30" visible="true" left="0" right="0" bottom="0" oncelldblclick="grd_GbProductContractDetail_oncelldblclick" formatid="CONTRACT_TYPE_P" autofittype="col" autoenter="select" oncellclick="div_ProdContract_grd_GbProductContractDetail_oncellclick">
                <Formats>
                  <Format id="CONTRACT_TYPE_P">
                    <Columns>
                      <Column size="48"/>
                      <Column size="100"/>
                      <Column size="200"/>
                      <Column size="100"/>
                      <Column size="40"/>
                      <Column size="100"/>
                      <Column size="75"/>
                      <Column size="40"/>
                      <Column size="75"/>
                      <Column size="100"/>
                      <Column size="200"/>
                    </Columns>
                    <Rows>
                      <Row size="25" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="Seq"/>
                      <Cell col="1" text="계약번호" TL_SEQ="316"/>
                      <Cell col="2" text="제품명" displaytype="text" edittype="text" TL_SEQ="187"/>
                      <Cell col="3" displaytype="text" edittype="text" text="종류" TL_SEQ="728"/>
                      <Cell col="4" text="개발용" TL_SEQ="291"/>
                      <Cell col="5" text="제품단가" TL_SEQ="292"/>
                      <Cell col="6" text="서버등급" TL_SEQ="225"/>
                      <Cell col="7" text="수량" TL_SEQ="103"/>
                      <Cell col="8" text="단위" TL_SEQ="104"/>
                      <Cell col="9" text="계약금액" TL_SEQ="40"/>
                      <Cell col="10" text="비고" TL_SEQ="45"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:CRD_SEQ"/>
                      <Cell col="1" text="bind:CONTRACT_NO"/>
                      <Cell col="2" text="bind:PRODUCT_NAME" textAlign="left"/>
                      <Cell col="3" text="bind:PURPOSE_NAME"/>
                      <Cell col="4" text="bind:ISDEV_FLAG" displaytype="checkboxcontrol"/>
                      <Cell col="5" text="bind:UNIT_COST" displaytype="number" textAlign="right"/>
                      <Cell col="6" text="bind:SERVER_GRADE_NAME"/>
                      <Cell col="7" text="bind:QUANTITY" displaytype="number" textAlign="right"/>
                      <Cell col="8" text="bind:PRODUCT_UNIT_NAME" textAlign="left"/>
                      <Cell col="9" text="bind:CONTRACT_PRICE" displaytype="number" textAlign="right"/>
                      <Cell col="10" text="bind:REMARKS" textAlign="left"/>
                    </Band>
                  </Format>
                  <Format id="CONTRACT_TYPE_M">
                    <Columns>
                      <Column size="48"/>
                      <Column size="100"/>
                      <Column size="200"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="100"/>
                      <Column size="107"/>
                    </Columns>
                    <Rows>
                      <Row size="25" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="Seq"/>
                      <Cell col="1" text="계약번호" TL_SEQ="316"/>
                      <Cell col="2" text="항목" displaytype="text" edittype="text" TL_SEQ="105"/>
                      <Cell col="3" text="개시일자" TL_SEQ="1106"/>
                      <Cell col="4" text="종료일자" TL_SEQ="95"/>
                      <Cell col="5" text="계약금액" TL_SEQ="40"/>
                      <Cell col="6" text="비고" TL_SEQ="45"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:CMD_SEQ"/>
                      <Cell col="1" text="bind:CONTRACT_NO"/>
                      <Cell col="2" text="bind:PRODUCT_NAME" textAlign="left"/>
                      <Cell col="3" displaytype="date" calendardateformat="yyyy-MM-dd" text="bind:START_DATE"/>
                      <Cell col="4" text="bind:END_DATE" displaytype="date" calendardateformat="yyyy-MM-dd"/>
                      <Cell col="5" text="bind:CONTRACT_PRICE" displaytype="number" textAlign="right"/>
                      <Cell col="6" text="bind:REMARKS" textAlign="left"/>
                    </Band>
                  </Format>
                  <Format id="CONTRACT_TYPE_S">
                    <Columns>
                      <Column size="48"/>
                      <Column size="100"/>
                      <Column size="60"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="48"/>
                      <Column size="100"/>
                      <Column size="48"/>
                      <Column size="100"/>
                      <Column size="107"/>
                    </Columns>
                    <Rows>
                      <Row size="25" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="Seq"/>
                      <Cell col="1" text="계약번호" TL_SEQ="316"/>
                      <Cell col="2" text="등급" displaytype="text" edittype="text" TL_SEQ="92"/>
                      <Cell col="3" text="개시일자" TL_SEQ="1106"/>
                      <Cell col="4" text="종료일자" TL_SEQ="95"/>
                      <Cell col="5" text="인원" TL_SEQ="1099"/>
                      <Cell col="6" text="단가" TL_SEQ="102"/>
                      <Cell col="7" text="MM"/>
                      <Cell col="8" text="계약금액" TL_SEQ="40"/>
                      <Cell col="9" text="비고" TL_SEQ="45"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:CSD_SEQ"/>
                      <Cell col="1" text="bind:CONTRACT_NO"/>
                      <Cell col="2" text="bind:LEVEL_CODE_NAME"/>
                      <Cell col="3" displaytype="date" calendardateformat="yyyy-MM-dd" text="bind:START_DATE"/>
                      <Cell col="4" text="bind:END_DATE" displaytype="date" calendardateformat="yyyy-MM-dd"/>
                      <Cell col="5" text="bind:PERSON_NUMBER" displaytype="number"/>
                      <Cell col="6" text="bind:UNIT_COST" displaytype="number" textAlign="right"/>
                      <Cell col="7" text="bind:MEN_MONTH" displaytype="number"/>
                      <Cell col="8" text="bind:CONTRACT_PRICE" displaytype="number" textAlign="right"/>
                      <Cell col="9" text="bind:REMARKS" textAlign="left" edittype="normal"/>
                    </Band>
                  </Format>
                  <Format id="CONTRACT_TYPE_S_TOTAL">
                    <Columns>
                      <Column size="48"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="60"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="48"/>
                      <Column size="100"/>
                      <Column size="48"/>
                      <Column size="100"/>
                      <Column size="200"/>
                      <Column size="40"/>
                    </Columns>
                    <Rows>
                      <Row size="25" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="Seq"/>
                      <Cell col="1" text="성명" TL_SEQ="27"/>
                      <Cell col="2" text="계약번호" TL_SEQ="316"/>
                      <Cell col="3" text="등급" displaytype="text" edittype="text" TL_SEQ="92"/>
                      <Cell col="4" text="개시일자" TL_SEQ="1106"/>
                      <Cell col="5" text="종료일자" TL_SEQ="95"/>
                      <Cell col="6" text="인원" TL_SEQ="1099"/>
                      <Cell col="7" text="단가" TL_SEQ="102"/>
                      <Cell col="8" text="MM" TL_SEQ=""/>
                      <Cell col="9" text="계약금액" TL_SEQ="40"/>
                      <Cell col="10" colspan="2" text="비고" TL_SEQ="45"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:CSD_SEQ"/>
                      <Cell col="1" text="bind:EMP_NAME"/>
                      <Cell col="2" text="bind:CONTRACT_NO"/>
                      <Cell col="3" text="bind:LEVEL_CODE_NAME"/>
                      <Cell col="4" displaytype="date" calendardateformat="yyyy-MM-dd" text="bind:START_DATE" edittype="date"/>
                      <Cell col="5" text="bind:END_DATE" displaytype="date" calendardateformat="yyyy-MM-dd" edittype="date"/>
                      <Cell col="6" text="bind:PERSON_NUMBER" displaytype="number"/>
                      <Cell col="7" text="bind:UNIT_COST" displaytype="number" textAlign="right" edittype="normal"/>
                      <Cell col="8" text="bind:MEN_MONTH" displaytype="number" edittype="normal"/>
                      <Cell col="9" text="bind:CONTRACT_PRICE" displaytype="number" textAlign="right" edittype="normal"/>
                      <Cell col="10" text="bind:REMARKS" textAlign="left"/>
                      <Cell col="11" displaytype="buttoncontrol" text="expr:comp.parent.fnGetButtonTxt(currow)"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Static id="stc_GbProductContractDetail" taborder="2" cssclass="sta_POP_GroupBg" left="0" top="0" height="30" right="0"/>
              <Static id="stc_GbProductContractDetailText" taborder="1" text="매출계약 상세" left="8" top="7" width="154" height="16" visible="true" cssclass="sta_POP_GroupTit"/>
              <Tab id="tab_ContractDet" taborder="3" tabindex="0" left="0" top="0" height="30" right="0" onchanged="div_ProdContract_tab_ContractDet_onchanged">
                <Tabpages>
                  <Tabpage id="Tabpage1" text="매출계약상세" TL_SEQ="757"/>
                  <Tabpage id="Tabpage2" text="총괄표매출계약" TL_SEQ="758"/>
                </Tabpages>
              </Tab>
              <Button id="btn_TotalRemove" taborder="4" height="16" width="16" top="7" onclick="btn_CommAddRemove_onclick" right="9" cssclass="btn_POP_Del" visible="false"/>
            </Layout>
          </Layouts>
        </Div>
        <Div id="div_ProdContractM" taborder="9" top="404" width="596" visible="false" right="10" bottom="43">
          <Layouts>
            <Layout>
              <Grid id="grd_GbProductContractM" binddataset="dsProdContractM" scrollbars="alwaysvert" useinputpanel="false" cellsizingtype="col" top="30" left="0" right="0" autofittype="col" bottom="0">
                <Formats>
                  <Format id="default">
                    <Columns>
                      <Column size="100"/>
                      <Column size="150"/>
                      <Column size="100"/>
                    </Columns>
                    <Rows>
                      <Row size="25" band="head"/>
                      <Row size="24"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="고객사" TL_SEQ="32"/>
                      <Cell col="1" text="계약" TL_SEQ="33"/>
                      <Cell col="2" text="제품" TL_SEQ="62"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:CLIENT_NAME" textAlign="left"/>
                      <Cell col="1" text="bind:CONTRACT_NAME" textAlign="left"/>
                      <Cell col="2" text="bind:PRODUCT_NAME" textAlign="left"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Static id="stc_GbProductContractM" taborder="2" cssclass="sta_POP_GroupBg" left="0" top="0" text="" height="30" right="0"/>
              <Static id="stc_GbProductContractMText" taborder="1" text="유지보수 대상 계약" left="0" top="2" width="199" height="23" visible="true" cssclass="sta_POP_GroupTit" TL_SEQ="729"/>
              <Button id="btn_MAAdd" taborder="3" width="16" height="16" top="7" onclick="btn_CommAddRemove_onclick" right="33" cssclass="btn_POP_Add" enable="false"/>
              <Button id="btn_MARemove" taborder="4" height="16" width="16" top="7" onclick="btn_CommAddRemove_onclick" right="9" cssclass="btn_POP_Del" enable="false"/>
            </Layout>
          </Layouts>
        </Div>
        <Div id="div_PurchasePay" taborder="12" top="223" height="178" width="596" right="10">
          <Layouts>
            <Layout>
              <Static id="stc_GbProvideList" taborder="0" cssclass="sta_POP_GroupBg" left="0" top="0" text="" height="30" right="0"/>
              <Grid id="grd_GbProvideList" taborder="1" binddataset="dsPurchasePay" scrollbars="alwaysvert" autoenter="select" useinputpanel="false" cellsizingtype="col" top="30" visible="true" left="0" formatid="CONTRACT_TYPE_P" right="0" bottom="1" autofittype="col">
                <Formats>
                  <Format id="CONTRACT_TYPE_P">
                    <Columns>
                      <Column size="40"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="40"/>
                    </Columns>
                    <Rows>
                      <Row size="25" band="head"/>
                      <Row size="24"/>
                      <Row size="24" band="summ"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="No." displaytype="text" edittype="text"/>
                      <Cell col="1" displaytype="text" edittype="text" text="지급예정일" TL_SEQ="736"/>
                      <Cell col="2" text="공급가" TL_SEQ="733"/>
                      <Cell col="3" text="부가세" TL_SEQ="734"/>
                      <Cell col="4" text="합계" TL_SEQ="437"/>
                      <Cell col="5" text="지급" TL_SEQ="738"/>
                    </Band>
                    <Band id="body">
                      <Cell editautoselect="true" text="expr:currow+1" textAlign="right"/>
                      <Cell col="1" edittype="date" editautoselect="true" editdisplay="edit" text="bind:PAY_PLAN_DATE" displaytype="date" calendardateformat="yyyy-MM-dd"/>
                      <Cell col="2" text="bind:TAX_PRICE" textAlign="right" displaytype="number" edittype="normal" editinputtype="number"/>
                      <Cell col="3" text="bind:VAT_PRICE" textAlign="right" displaytype="number" edittype="normal" editinputtype="number"/>
                      <Cell col="4" displaytype="number" text="expr:TAX_PRICE+VAT_PRICE" textAlign="right"/>
                      <Cell col="5" text="expr:PAY_FLAG == &quot;1&quot; ? &quot;Y&quot; : &quot;N&quot;"/>
                    </Band>
                    <Band id="summary">
                      <Cell colspan="2" text="합계" TL_SEQ="437"/>
                      <Cell col="2" text="expr:dataset.getSum(&quot;TAX_PRICE&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="3" text="expr:dataset.getSum(&quot;VAT_PRICE&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="4" text="expr:dataset.getSum(&quot;TAX_PRICE&quot;) + dataset.getSum(&quot;VAT_PRICE&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="5"/>
                    </Band>
                  </Format>
                  <Format id="CONTRACT_TYPE_M">
                    <Columns>
                      <Column size="40"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="40"/>
                    </Columns>
                    <Rows>
                      <Row size="25" band="head"/>
                      <Row size="24"/>
                      <Row size="24" band="summ"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="No." displaytype="text" edittype="text"/>
                      <Cell col="1" text="지급회차" TL_SEQ="1119"/>
                      <Cell col="2" text="시작일" TL_SEQ="38"/>
                      <Cell col="3" text="종료일" TL_SEQ="39"/>
                      <Cell col="4" displaytype="text" edittype="text" text="지급예정일" TL_SEQ="736"/>
                      <Cell col="5" text="공급가" TL_SEQ="733"/>
                      <Cell col="6" text="부가세" TL_SEQ="734"/>
                      <Cell col="7" text="합계" TL_SEQ="437"/>
                      <Cell col="8" text="지급" TL_SEQ="738"/>
                    </Band>
                    <Band id="body">
                      <Cell editautoselect="true" text="expr:currow+1" textAlign="right"/>
                      <Cell col="1" text="bind:REMARKS" textAlign="left" edittype="normal"/>
                      <Cell col="2" text="bind:START_DATE" displaytype="date" edittype="date" calendardateformat="yyyy-MM-dd"/>
                      <Cell col="3" text="bind:END_DATE" displaytype="date" edittype="date" calendardateformat="yyyy-MM-dd"/>
                      <Cell col="4" edittype="date" editautoselect="true" editdisplay="edit" text="bind:PAY_PLAN_DATE" displaytype="date" calendardateformat="yyyy-MM-dd"/>
                      <Cell col="5" text="bind:TAX_PRICE" textAlign="right" displaytype="number" edittype="normal" editinputtype="number"/>
                      <Cell col="6" text="bind:VAT_PRICE" textAlign="right" displaytype="number" edittype="normal" editinputtype="number"/>
                      <Cell col="7" displaytype="number" text="expr:TAX_PRICE+VAT_PRICE" textAlign="right"/>
                      <Cell col="8" text="expr:PAY_FLAG == &quot;1&quot; ? &quot;Y&quot; : &quot;N&quot;"/>
                    </Band>
                    <Band id="summary">
                      <Cell colspan="5" text="합계" TL_SEQ="437"/>
                      <Cell col="5" text="expr:dataset.getSum(&quot;TAX_PRICE&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="6" text="expr:dataset.getSum(&quot;VAT_PRICE&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="7" text="expr:dataset.getSum(&quot;TAX_PRICE&quot;) + dataset.getSum(&quot;VAT_PRICE&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="8"/>
                    </Band>
                  </Format>
                  <Format id="CONTRACT_TYPE_S">
                    <Columns>
                      <Column size="40"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="40"/>
                    </Columns>
                    <Rows>
                      <Row size="25" band="head"/>
                      <Row size="24"/>
                      <Row size="24" band="summ"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="No." displaytype="text" edittype="text"/>
                      <Cell col="1" colspan="2" text="역무기간" TL_SEQ="1120"/>
                      <Cell col="3" displaytype="text" edittype="text" text="지급예정일" TL_SEQ="736"/>
                      <Cell col="4" text="공급가" TL_SEQ="733"/>
                      <Cell col="5" text="부가세" TL_SEQ="734"/>
                      <Cell col="6" text="합계" TL_SEQ="437"/>
                      <Cell col="7" text="지급" TL_SEQ="738"/>
                    </Band>
                    <Band id="body">
                      <Cell editautoselect="true" text="expr:currow+1" textAlign="right"/>
                      <Cell col="1" text="bind:START_DATE" displaytype="date" edittype="date" calendardateformat="yyyy-MM-dd"/>
                      <Cell col="2" text="bind:END_DATE" displaytype="date" edittype="date" calendardateformat="yyyy-MM-dd"/>
                      <Cell col="3" edittype="date" editautoselect="true" editdisplay="edit" text="bind:PAY_PLAN_DATE" displaytype="date" calendardateformat="yyyy-MM-dd"/>
                      <Cell col="4" text="bind:TAX_PRICE" textAlign="right" displaytype="number" edittype="normal" editinputtype="number"/>
                      <Cell col="5" text="bind:VAT_PRICE" textAlign="right" displaytype="number" edittype="normal" editinputtype="number"/>
                      <Cell col="6" displaytype="number" text="expr:TAX_PRICE+VAT_PRICE" textAlign="right"/>
                      <Cell col="7" text="expr:PAY_FLAG == &quot;1&quot; ? &quot;Y&quot; : &quot;N&quot;"/>
                    </Band>
                    <Band id="summary">
                      <Cell colspan="4" text="합계" TL_SEQ="437"/>
                      <Cell col="4" text="expr:dataset.getSum(&quot;TAX_PRICE&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="5" text="expr:dataset.getSum(&quot;VAT_PRICE&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="6" text="expr:dataset.getSum(&quot;TAX_PRICE&quot;) + dataset.getSum(&quot;VAT_PRICE&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="7"/>
                    </Band>
                  </Format>
                  <Format id="CONTRACT_TYPE_ST">
                    <Columns>
                      <Column size="40"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="40"/>
                    </Columns>
                    <Rows>
                      <Row size="25" band="head"/>
                      <Row size="24"/>
                      <Row size="24" band="summ"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="No." displaytype="text" edittype="text"/>
                      <Cell col="1" text="지급회차" TL_SEQ="1119"/>
                      <Cell col="2" displaytype="text" edittype="text" text="지급예정일" TL_SEQ="736"/>
                      <Cell col="3" text="공급가" TL_SEQ="733"/>
                      <Cell col="4" text="부가세" TL_SEQ="734"/>
                      <Cell col="5" text="합계" TL_SEQ="437"/>
                      <Cell col="6" text="지급" TL_SEQ="738"/>
                    </Band>
                    <Band id="body">
                      <Cell editautoselect="true" text="expr:currow+1" textAlign="right"/>
                      <Cell col="1" text="bind:REMARKS" textAlign="left" edittype="normal"/>
                      <Cell col="2" edittype="date" editautoselect="true" editdisplay="edit" text="bind:PAY_PLAN_DATE" displaytype="date" calendardateformat="yyyy-MM-dd"/>
                      <Cell col="3" text="bind:TAX_PRICE" textAlign="right" displaytype="number" edittype="normal" editinputtype="number"/>
                      <Cell col="4" text="bind:VAT_PRICE" textAlign="right" displaytype="number" edittype="normal" editinputtype="number"/>
                      <Cell col="5" displaytype="number" text="expr:TAX_PRICE+VAT_PRICE" textAlign="right"/>
                      <Cell col="6" text="expr:PAY_FLAG == &quot;1&quot; ? &quot;Y&quot; : &quot;N&quot;"/>
                    </Band>
                    <Band id="summary">
                      <Cell colspan="3" text="합계" TL_SEQ="437"/>
                      <Cell col="3" text="expr:dataset.getSum(&quot;TAX_PRICE&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="4" text="expr:dataset.getSum(&quot;VAT_PRICE&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="5" text="expr:dataset.getSum(&quot;TAX_PRICE&quot;) + dataset.getSum(&quot;VAT_PRICE&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="6"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Static id="stc_GbProvideListText" taborder="2" text="지급내역" left="0" top="-3" width="199" height="23" visible="true" cssclass="sta_POP_GroupTit" TL_SEQ="731"/>
              <Button id="btn_PayAdd" taborder="3" width="16" height="16" top="7" onclick="btn_CommAddRemove_onclick" right="33" cssclass="btn_POP_Add" enable="false"/>
              <Button id="btn_PayRemove" taborder="4" height="16" width="16" top="7" onclick="btn_CommAddRemove_onclick" right="9" cssclass="btn_POP_Del" enable="false"/>
              <Radio id="rdo_BaseMM" taborder="5" top="6" width="95" height="16" innerdataset="ds_CD_BaseMM" index="0" text="월말" value="1" columncount="2" right="57" onitemchanged="div_PurchasePay_rdo_BaseMM_onitemchanged" visible="false" TL_FLAG="1" codecolumn="CODE" datacolumn="CAPTION">
                <Dataset id="innerdataset">
                  <ColumnInfo>
                    <Column id="codecolumn" size="256"/>
                    <Column id="datacolumn" size="256"/>
                  </ColumnInfo>
                  <Rows>
                    <Row>
                      <Col id="datacolumn">월말</Col>
                      <Col id="codecolumn">1</Col>
                    </Row>
                    <Row>
                      <Col id="datacolumn">한달</Col>
                      <Col id="codecolumn">2</Col>
                    </Row>
                  </Rows>
                </Dataset>
              </Radio>
            </Layout>
          </Layouts>
        </Div>
        <Div id="div_PurchaseDet" taborder="11" left="div_List:10" top="223" height="177" right="div_PurchasePay:4">
          <Layouts>
            <Layout>
              <Static id="stc_GbSales" taborder="0" cssclass="sta_POP_GroupBg" left="0" top="0" text="" height="30" right="0"/>
              <Static id="stc_GbSalesText" taborder="1" text="상품" left="0" top="1" width="199" height="23" visible="true" cssclass="sta_POP_GroupTit" TL_SEQ="405"/>
              <Grid id="grd_GbSales" taborder="2" binddataset="dsPurchaseDet" scrollbars="alwaysvert" autoenter="select" useinputpanel="false" cellsizingtype="col" top="30" visible="true" left="0" onexpandup="grd_GbSales_onexpandup" oncelldblclick="grd_GbSales_oncelldblclick" formatid="CONTRACT_TYPE_ALL" bottom="0" right="0" autofittype="col">
                <Formats>
                  <Format id="CONTRACT_TYPE_ALL">
                    <Columns>
                      <Column size="40"/>
                      <Column size="150"/>
                      <Column size="150"/>
                      <Column size="80"/>
                      <Column size="50"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="55"/>
                      <Column size="60"/>
                      <Column size="80"/>
                    </Columns>
                    <Rows>
                      <Row size="25" band="head"/>
                      <Row size="24"/>
                      <Row size="24" band="summ"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="Seq"/>
                      <Cell col="1" text="상품명" displaytype="text" edittype="text" TL_SEQ="732"/>
                      <Cell col="2" displaytype="text" edittype="text" text="연관제품" TL_SEQ="106"/>
                      <Cell col="3" text="단가" TL_SEQ="102"/>
                      <Cell col="4" text="수량" TL_SEQ="103"/>
                      <Cell col="5" text="단위" TL_SEQ="104"/>
                      <Cell col="6" text="공급가" TL_SEQ="733"/>
                      <Cell col="7" text="부가세" TL_SEQ="734"/>
                      <Cell col="8" text="로열티" TL_SEQ="22569"/>
                      <Cell col="9" text="요율(%)" TL_SEQ="109"/>
                      <Cell col="10" text="합계" TL_SEQ="437"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:CRD_SEQ"/>
                      <Cell col="1" text="bind:PRODUCT_NAME" expandshow="show" expandimage="URL(&quot;theme://images/tab_MDI_MdiTabCls.png&quot;)" textAlign="left" tooltiptext="더블 클릭 - 제품선택"/>
                      <Cell col="2" editdisplay="edit" text="bind:RELATED_PRODUCT_NAME" expandshow="show" expandimage="URL(&quot;theme://images/tab_MDI_MdiTabCls.png&quot;)" textAlign="left" tooltiptext="더블 클릭 - 제품선택"/>
                      <Cell col="3" text="bind:UNIT_COST" displaytype="number" edittype="normal" editinputtype="number" textAlign="right"/>
                      <Cell col="4" text="bind:QUANTITY" displaytype="number" edittype="normal" textAlign="right" editinputtype="number"/>
                      <Cell col="5" text="bind:PRODUCT_UNIT" edittype="combo" displaytype="combotext" combodataset="ds_CD_PRODUCT_UNIT" combocodecol="CODE" combodatacol="CAPTION" editinputtype="number" textAlign="left"/>
                      <Cell col="6" text="bind:CONTRACT_PRICE" displaytype="number" edittype="normal" textAlign="right" editinputtype="number"/>
                      <Cell col="7" text="bind:VAT_PRICE" displaytype="number" edittype="normal" textAlign="right" editinputtype="number"/>
                      <Cell col="8" text="bind:ROYALTY_TYPE" edittype="combo" combodataset="ds_CD_ROYALTY_TYPE" combodatacol="CAPTION" combocodecol="CODE" displaytype="combotext"/>
                      <Cell col="9" text="bind:COMMISSION_RATE" displaytype="number" editinputtype="number" edittype="normal" textAlign="right"/>
                      <Cell col="10" text="expr:CONTRACT_PRICE + VAT_PRICE" displaytype="number" textAlign="right"/>
                    </Band>
                    <Band id="summary">
                      <Cell/>
                      <Cell col="1" colspan="5" text="합계" TL_SEQ="437"/>
                      <Cell col="6" text="expr:dataset.getSum(&quot;CONTRACT_PRICE&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="7" text="expr:dataset.getSum(&quot;VAT_PRICE&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="8"/>
                      <Cell col="9"/>
                      <Cell col="10" text="expr:dataset.getSum(&quot;CONTRACT_PRICE&quot;) + dataset.getSum(&quot;VAT_PRICE&quot;)" displaytype="number" textAlign="right"/>
                    </Band>
                  </Format>
                  <Format id="CONTRACT_TYPE_C">
                    <Columns>
                      <Column size="40"/>
                      <Column size="200"/>
                      <Column size="70"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="55"/>
                      <Column size="60"/>
                      <Column size="100"/>
                      <Column size="100"/>
                    </Columns>
                    <Rows>
                      <Row size="25" band="head"/>
                      <Row size="24"/>
                      <Row size="24" band="summ"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="Seq"/>
                      <Cell col="1" displaytype="text" edittype="text" text="연관제품" TL_SEQ="106"/>
                      <Cell col="2" text="수량" TL_SEQ="103"/>
                      <Cell col="3" text="단위" TL_SEQ="104"/>
                      <Cell col="4" text="단위(수기입력)" TL_SEQ="1110"/>
                      <Cell col="5" text="로열티" TL_SEQ="22569"/>
                      <Cell col="6" text="요율(%)" TL_SEQ="109"/>
                      <Cell col="7" text="매출계약금액" TL_SEQ="1111"/>
                      <Cell col="8" text="판매수수료금액" TL_SEQ="1112"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:CRD_SEQ"/>
                      <Cell col="1" editdisplay="edit" text="bind:RELATED_PRODUCT_NAME" expandshow="show" expandimage="URL(&quot;theme://images/tab_MDI_MdiTabCls.png&quot;)" textAlign="left" tooltiptext="더블 클릭 - 제품선택"/>
                      <Cell col="2" text="bind:QUANTITY" displaytype="number" edittype="normal" textAlign="right" editinputtype="number"/>
                      <Cell col="3" text="bind:PRODUCT_UNIT" edittype="combo" displaytype="combotext" combodataset="ds_CD_PRODUCT_UNIT" combocodecol="CODE" combodatacol="CAPTION" editinputtype="number" textAlign="left"/>
                      <Cell col="4" text="bind:REMARKS" expandshow="show" expandimage="URL(&quot;theme://images/btn_TP_refresh_O.png&quot;)" expandsize="18" textAlign="left" edittype="expr:PRODUCT_UNIT == &quot;900&quot; ? &quot;normal&quot; : &quot;none&quot;" expr="PRODUCT_UNIT == &quot;900&quot; ? REMARKS : &quot;&quot;"/>
                      <Cell col="5" text="bind:ROYALTY_TYPE" combodataset="ds_CD_ROYALTY_TYPE" combodatacol="CAPTION" combocodecol="CODE" edittype="combo" displaytype="combotext"/>
                      <Cell col="6" text="bind:COMMISSION_RATE" displaytype="number" editinputtype="number" edittype="normal" textAlign="right"/>
                      <Cell col="7" text="bind:UNIT_COST" displaytype="number" edittype="normal" editinputtype="number" textAlign="right"/>
                      <Cell col="8" text="bind:CONTRACT_PRICE" displaytype="number" edittype="normal" textAlign="right" editinputtype="number"/>
                    </Band>
                    <Band id="summary">
                      <Cell/>
                      <Cell col="1" colspan="6" text="합계" TL_SEQ="437"/>
                      <Cell col="7" text="expr:dataset.getSum(&quot;UNIT_COST&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="8" text="expr:dataset.getSum(&quot;CONTRACT_PRICE&quot;)" displaytype="number" textAlign="right"/>
                    </Band>
                  </Format>
                  <Format id="CONTRACT_TYPE_M">
                    <Columns>
                      <Column size="40"/>
                      <Column size="120"/>
                      <Column size="120"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="55"/>
                      <Column size="50"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="70"/>
                    </Columns>
                    <Rows>
                      <Row size="25" band="head"/>
                      <Row size="24"/>
                      <Row size="24" band="summ"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="Seq"/>
                      <Cell col="1" text="상품명" displaytype="text" edittype="text" TL_SEQ="732"/>
                      <Cell col="2" displaytype="text" edittype="text" text="연관제품" TL_SEQ="106"/>
                      <Cell col="3" text="시작일" TL_SEQ="38"/>
                      <Cell col="4" text="종료일" TL_SEQ="39"/>
                      <Cell col="5" text="로열티" edittype="combo" TL_SEQ="22569"/>
                      <Cell col="6" text="요율(%)" TL_SEQ="109"/>
                      <Cell col="7" text="매출계약금액" TL_SEQ="1111"/>
                      <Cell col="8" text="유지보수금액" TL_SEQ="1114"/>
                      <Cell col="9" text="비고" TL_SEQ="45"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:CMD_SEQ"/>
                      <Cell col="1" text="bind:PRODUCT_NAME" expandshow="show" expandimage="URL(&quot;theme://images/tab_MDI_MdiTabCls.png&quot;)" textAlign="left" tooltiptext="더블 클릭 - 제품선택"/>
                      <Cell col="2" editdisplay="edit" text="bind:RELATED_PRODUCT_NAME" expandshow="show" expandimage="URL(&quot;theme://images/tab_MDI_MdiTabCls.png&quot;)" textAlign="left" tooltiptext="더블 클릭 - 제품선택"/>
                      <Cell col="3" text="bind:START_DATE" displaytype="date" edittype="date" calendardateformat="yyyy-MM-dd"/>
                      <Cell col="4" text="bind:END_DATE" displaytype="date" edittype="date" calendardateformat="yyyy-MM-dd"/>
                      <Cell col="5" text="bind:ROYALTY_TYPE" edittype="combo" combodataset="ds_CD_ROYALTY_TYPE" combodatacol="CAPTION" combocodecol="CODE" displaytype="combotext"/>
                      <Cell col="6" text="bind:COMMISSION_RATE" displaytype="number" editinputtype="number" edittype="normal" textAlign="right"/>
                      <Cell col="7" text="bind:UNIT_COST" displaytype="number" edittype="normal" editinputtype="number" textAlign="right"/>
                      <Cell col="8" text="bind:CONTRACT_PRICE" displaytype="number" edittype="normal" textAlign="right" editinputtype="number"/>
                      <Cell col="9" text="bind:REMARKS" textAlign="left" edittype="normal"/>
                    </Band>
                    <Band id="summary">
                      <Cell/>
                      <Cell col="1" text="합계" TL_SEQ="437"/>
                      <Cell col="2" colspan="5" text="합계" TL_SEQ="437"/>
                      <Cell col="7" text="expr:dataset.getSum(&quot;UNIT_COST&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="8" text="expr:dataset.getSum(&quot;CONTRACT_PRICE&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="9"/>
                    </Band>
                  </Format>
                  <Format id="CONTRACT_TYPE_S">
                    <Columns>
                      <Column size="48"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="40"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="80"/>
                      <Column size="48"/>
                      <Column size="48"/>
                    </Columns>
                    <Rows>
                      <Row size="25" band="head"/>
                      <Row size="24"/>
                      <Row size="24" band="summ"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="Seq"/>
                      <Cell col="1" text="성명" TL_SEQ="27"/>
                      <Cell col="2" text="계약내용" TL_SEQ="1913"/>
                      <Cell col="3" text="등급" TL_SEQ="92"/>
                      <Cell col="4" text="투입시작일" TL_SEQ="1115"/>
                      <Cell col="5" text="투입종료일" TL_SEQ="1116"/>
                      <Cell col="6" text="MM"/>
                      <Cell col="7" text="매출 단가" TL_SEQ="334"/>
                      <Cell col="8" text="매입 단가" TL_SEQ="339"/>
                      <Cell col="9" text="경비" TL_SEQ="341"/>
                      <Cell col="10" text="계약금액" TL_SEQ="40"/>
                      <Cell col="11" text="마진율" TL_SEQ="974"/>
                      <Cell col="12" text="비상주" TL_SEQ="340"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:CSD_SEQ"/>
                      <Cell col="1" text="bind:EMP_NAME" expandshow="show" expandimage="URL(&quot;theme://images/tab_MDI_MdiTabCls.png&quot;)" textAlign="center" tooltiptext="더블 클릭 - 인력 선택" tooltiptype="hover"/>
                      <Cell col="2" text="bind:TURNKEY_NAME" edittype="normal"/>
                      <Cell col="3" text="bind:LEVEL_CODE" edittype="combo" displaytype="combotext" combodataset="ds_CD_LEVEL_CODE" combocodecol="CODE" combodatacol="CAPTION" editinputtype="number"/>
                      <Cell col="4" text="bind:START_DATE" displaytype="date" edittype="date" calendardateformat="yyyy-MM-dd"/>
                      <Cell col="5" text="bind:END_DATE" displaytype="date" edittype="date" calendardateformat="yyyy-MM-dd"/>
                      <Cell col="6" text="bind:MEN_MONTH" displaytype="number" edittype="normal" textAlign="right" editinputtype="number"/>
                      <Cell col="7" text="bind:CSD_UNIT_COST" displaytype="number" edittype="normal" editinputtype="number" textAlign="right"/>
                      <Cell col="8" text="bind:UNIT_COST" displaytype="number" edittype="normal" editinputtype="number" textAlign="right"/>
                      <Cell col="9" text="bind:EXPENSE" displaytype="number" edittype="normal" editinputtype="number" textAlign="right"/>
                      <Cell col="10" text="bind:CONTRACT_PRICE" displaytype="number" edittype="normal" textAlign="right" editinputtype="number"/>
                      <Cell col="11" text="bind:PROFITS_RATE" displaytype="number" edittype="normal"/>
                      <Cell col="12" text="bind:NONRESIDENT_FLAG" displaytype="checkboxcontrol" edittype="checkbox"/>
                    </Band>
                    <Band id="summary">
                      <Cell/>
                      <Cell col="1" colspan="9" text="합계" TL_SEQ="437"/>
                      <Cell col="10" text="expr:dataset.getSum(&quot;CONTRACT_PRICE&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="11"/>
                      <Cell col="12"/>
                    </Band>
                  </Format>
                  <Format id="CONTRACT_TYPE_D">
                    <Columns>
                      <Column size="40"/>
                      <Column size="200"/>
                      <Column size="70"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="55"/>
                      <Column size="60"/>
                      <Column size="100"/>
                      <Column size="100"/>
                    </Columns>
                    <Rows>
                      <Row size="25" band="head"/>
                      <Row size="24"/>
                      <Row size="24" band="summ"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="Seq"/>
                      <Cell col="1" displaytype="text" edittype="text" text="연관제품" TL_SEQ="106"/>
                      <Cell col="2" text="수량" TL_SEQ="103"/>
                      <Cell col="3" text="단위" TL_SEQ="104"/>
                      <Cell col="4" text="단위(수기입력)" TL_SEQ="22675"/>
                      <Cell col="5" text="로열티" TL_SEQ="22569"/>
                      <Cell col="6" text="요율(%)" TL_SEQ="109"/>
                      <Cell col="7" text="매출계약금액" TL_SEQ="1111"/>
                      <Cell col="8" text="총판수수료금액" TL_SEQ="1118"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:CRD_SEQ"/>
                      <Cell col="1" editdisplay="edit" text="bind:RELATED_PRODUCT_NAME" expandshow="show" expandimage="URL(&quot;theme://images/tab_MDI_MdiTabCls.png&quot;)" textAlign="left" tooltiptext="더블 클릭 - 제품선택"/>
                      <Cell col="2" text="bind:QUANTITY" displaytype="number" edittype="normal" textAlign="right" editinputtype="number"/>
                      <Cell col="3" text="bind:PRODUCT_UNIT" edittype="combo" displaytype="combotext" combodataset="ds_CD_PRODUCT_UNIT" combocodecol="CODE" combodatacol="CAPTION" editinputtype="number" textAlign="left"/>
                      <Cell col="4" text="bind:REMARKS" expandshow="show" expandimage="URL(&quot;theme://images/btn_TP_refresh_O.png&quot;)" expandsize="18" textAlign="left" edittype="expr:PRODUCT_UNIT == &quot;900&quot; ? &quot;normal&quot; : &quot;none&quot;" expr="PRODUCT_UNIT == &quot;900&quot; ? REMARKS : &quot;&quot;"/>
                      <Cell col="5" text="bind:ROYALTY_TYPE" edittype="combo" combodataset="ds_CD_ROYALTY_TYPE" combodatacol="CAPTION" combocodecol="CODE" displaytype="combotext"/>
                      <Cell col="6" text="bind:COMMISSION_RATE" displaytype="number" editinputtype="number" edittype="normal" textAlign="right"/>
                      <Cell col="7" text="bind:UNIT_COST" displaytype="number" edittype="normal" editinputtype="number" textAlign="right"/>
                      <Cell col="8" text="bind:CONTRACT_PRICE" displaytype="number" edittype="normal" textAlign="right" editinputtype="number"/>
                    </Band>
                    <Band id="summary">
                      <Cell/>
                      <Cell col="1" colspan="6" text="합계" TL_SEQ="437"/>
                      <Cell col="7" text="expr:dataset.getSum(&quot;UNIT_COST&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="8" text="expr:dataset.getSum(&quot;CONTRACT_PRICE&quot;)" displaytype="number" textAlign="right"/>
                    </Band>
                  </Format>
                  <Format id="CONTRACT_TYPE_P">
                    <Columns>
                      <Column size="40"/>
                      <Column size="200"/>
                      <Column size="70"/>
                      <Column size="100"/>
                      <Column size="100"/>
                      <Column size="55"/>
                      <Column size="60"/>
                      <Column size="100"/>
                      <Column size="100"/>
                    </Columns>
                    <Rows>
                      <Row size="25" band="head"/>
                      <Row size="24"/>
                      <Row size="24" band="summ"/>
                    </Rows>
                    <Band id="head">
                      <Cell text="Seq"/>
                      <Cell col="1" displaytype="text" edittype="text" text="제품명" TL_SEQ="187"/>
                      <Cell col="2" text="수량" TL_SEQ="103"/>
                      <Cell col="3" text="단위" TL_SEQ="104"/>
                      <Cell col="4" text="단위(수기입력)" TL_SEQ="22675"/>
                      <Cell col="5" text="로열티" TL_SEQ="22569"/>
                      <Cell col="6" text="요율(%)" TL_SEQ="109"/>
                      <Cell col="7" text="매출계약금액" TL_SEQ="1111"/>
                      <Cell col="8" text="매입금액" TL_SEQ="278"/>
                    </Band>
                    <Band id="body">
                      <Cell text="bind:CRD_SEQ"/>
                      <Cell col="1" editdisplay="edit" text="bind:PRODUCT_NAME" expandshow="show" expandimage="URL(&quot;theme://images/tab_MDI_MdiTabCls.png&quot;)" textAlign="left" tooltiptext="더블 클릭 - 제품선택"/>
                      <Cell col="2" text="bind:QUANTITY" displaytype="number" edittype="normal" textAlign="right" editinputtype="number"/>
                      <Cell col="3" text="bind:PRODUCT_UNIT" edittype="combo" displaytype="combotext" combodataset="ds_CD_PRODUCT_UNIT" combocodecol="CODE" combodatacol="CAPTION" editinputtype="number" textAlign="center"/>
                      <Cell col="4" text="bind:REMARKS" expandshow="show" expandimage="URL(&quot;theme://images/btn_TP_refresh_O.png&quot;)" expandsize="18" textAlign="left" edittype="expr:PRODUCT_UNIT == &quot;900&quot; ? &quot;normal&quot; : &quot;none&quot;" expr="PRODUCT_UNIT == &quot;900&quot; ? REMARKS : &quot;&quot;"/>
                      <Cell col="5" text="bind:ROYALTY_TYPE" combodataset="ds_CD_ROYALTY_TYPE" combocodecol="CODE" combodatacol="CAPTION" edittype="combo" displaytype="combotext"/>
                      <Cell col="6" text="bind:COMMISSION_RATE" displaytype="number" editinputtype="number" edittype="normal" textAlign="right"/>
                      <Cell col="7" text="bind:UNIT_COST" displaytype="number" edittype="normal" editinputtype="number" textAlign="right"/>
                      <Cell col="8" text="bind:CONTRACT_PRICE" displaytype="number" edittype="normal" textAlign="right" editinputtype="number"/>
                    </Band>
                    <Band id="summary">
                      <Cell/>
                      <Cell col="1" colspan="6" text="합계" TL_SEQ="437"/>
                      <Cell col="7" text="expr:dataset.getSum(&quot;UNIT_COST&quot;)" displaytype="number" textAlign="right"/>
                      <Cell col="8" text="expr:dataset.getSum(&quot;CONTRACT_PRICE&quot;)" displaytype="number" textAlign="right"/>
                    </Band>
                  </Format>
                </Formats>
              </Grid>
              <Button id="btn_ProductAdd" taborder="3" width="16" height="16" top="7" onclick="btn_CommAddRemove_onclick" right="33" cssclass="btn_POP_Add" enable="false"/>
              <Button id="btn_ProductRemove" taborder="4" height="16" width="16" top="7" onclick="btn_CommAddRemove_onclick" right="9" cssclass="btn_POP_Del" enable="false"/>
            </Layout>
          </Layouts>
        </Div>
        <Button id="btn_PurchaseEarlyTermination" taborder="13" text="조기종료확인서" width="100" height="28" left="btn_ProductPurchaseOrder:4" bottom="8" onclick="btn_ProductPurchaseOrder_onclick" background="" visible="false" TL_SEQ="759"/>
        <Button id="btn_CopyCancel" taborder="16" text="복사취소" top="570" height="22" enable="false" cssclass="btn_WF_tran" visible="false" onclick="btn_CopyCancel_onclick" TL_SEQ="763" left="904" right="btn_Delete:6"/>
        <Button id="btn_PurchaseBill" taborder="17" text="매입청구서" left="btn_PurchaseEarlyTermination:8.00" height="28" onclick="btn_PurchaseBill_onclick" visible="false" TL_SEQ="22574" right="1065" bottom="8"/>
      </Layout>
    </Layouts>
    <Script type="xscript5.1"><![CDATA[/************************************************************************************************
* 01. 업무구분	 	: xxx
* 02. 화면명		: xxx
* 03. 화면설명 	: 1. PURCHASE_PRODUCT, PURCHASE_PRODUCT_DET 테이블 기준 데이터 입/출력 기능 구현
						- 처리내용 : P,E,G,O,C,M (제품, 기타, 상품, OEM, 판매수수료, 유지보수)
					  2. PURCHASE_SI, PURCHASE_SI_DET 			테이블 기준 데이터 입/출력 기능 구현
						- 처리내용 : S (용역)
						
* 04. 작성일   	: 2018.xx.xx
* 05. 작성자   	: xxx
* 06. 수정이력 	:
***********************************************************************************************
*     수정일          이  름    사유
***********************************************************************************************
*     
************************************************************************************************/

/************************************************************************************************
* 공통 라이브러리 INCLUDE 영역
************************************************************************************************/
include "Script::CommUtil.xjs";
include "Script::CommSystem.xjs";
include "Script::CommTrans.xjs";
 include "Script::CommGrid.xjs";
include "Script::ext_Report.xjs"

/************************************************************************************************
* 전역 변수 영역
************************************************************************************************/
this.sContractType 			= "GD";
this.sContractNoPurchase 	= "";
this.sPRtype				= "P";			/*연관제품 입력 시 계약별 선택 계약구분*/
this.sPtype					= "P";			/*상품	    입력 시 계약별 선택 계약구분*/
this.sPurchaseDetKeyName 	= "PPD_SEQ";	/*계약구분에 따른 상세 테이블 분기*/
this.sContractNo 			= "";
this.sProjectCode			= "";
this.sEmpNo					= "";
this.sUnitCost 				= "";

this.bSave;
this.bSaveClose;
this.bDelete;
this.bCopyCancel;
this.FV_CO_CD;
/************************************************************************************************
* FORM 영역 EVENT 영역
************************************************************************************************/
this.SP_PurchaseReg_onload = function(obj:nexacro.Form,e:nexacro.LoadEventInfo)
{
	this.gfnCompInit(obj); //Grid 공통함수 호출
	//this.FV_CO_CD = nexacro.getApplication().gdsUserInfo.getColumn(0, "CO_CD");
	
	
	if(this.commUtil.getFormAuthority(243,1))	//상품순매출 체크 권한
	{
		this.div_Sales_List.form.chb_NetSales.set_enable(true);
	}
	if(this.commUtil.getFormAuthority(243,2))	//추가,삭제 권한
	{
		this.div_PurchaseDet.form.btn_ProductAdd.set_enable(true);
		this.div_PurchaseDet.form.btn_ProductRemove.set_enable(true);
		this.div_PurchasePay.form.btn_PayAdd.set_enable(true);
		this.div_PurchasePay.form.btn_PayRemove.set_enable(true);
		this.div_ProdContractM.form.btn_MAAdd.set_enable(true);
		this.div_ProdContractM.form.btn_MARemove.set_enable(true);
		this.btn_Delete.set_enable(true);
		this.btn_CopyCancel.set_enable(true);
	}
	if(this.commUtil.getFormAuthority(243,3))	//저장 권한
	{
		this.btn_Save.set_enable(true);
		this.btn_SaveClose.set_enable(true);
	}
	
	this.fnInitForm();
};

/************************************************************************************************
* 각 COMPONENT 별 EVENT 영역
************************************************************************************************/
this.grd_GbSales_oncelldblclick = function(obj:nexacro.Grid,e:nexacro.GridClickEventInfo)
{
	var sCellProp = obj.getCellProperty("body", e.cell, "text");
	if(!this.gfnIsEmpty(sCellProp) && e.clickitem != "expandbutton")
	{
		/*상품 or 제품 선택 팝업*/
		if(["bind:PRODUCT_NAME", "bind:RELATED_PRODUCT_NAME"].indexOf(sCellProp) != -1)
		{
			var sColNm = sCellProp.split(":")[1];
			var sArgument = {};
			/*
			1. 계약구분에 따른 연관제품
			  - 기본값 	: P
			  - 판매수수료	: P = 타사가 자사제품을 팔았을 경우 받는 수수료
			  - 유지보수	: G = 자사가 타사제품을 팔았을 경우 받는 수수료
			 */
			sArgument.sContractType = (sColNm == "RELATED_PRODUCT_NAME" ? this.sPRtype : this.sPtype);
			//제품검색창 연관제품나오게 처리
			if(this.sContractType == "M")
			{
				sArgument.sContractType = this.sContractType;
				sArgument.sProductCd = obj.getBindDataset().getColumn(e.row, "PRODUCT_CODE");
				sArgument.sProductCd2 = obj.getBindDataset().getColumn(e.row, "RELATED_PRODUCT_CODE");	
				sArgument.userelatedproduct = true;
			}
			else if(this.sContractType == "G")
			{
				if(sColNm== "PRODUCT_NAME")
				{
					sArgument.sContractType = this.sContractType;
					sArgument.userelatedproduct = true;
					sArgument.sProductCd = obj.getBindDataset().getColumn(e.row, "PRODUCT_CODE");
					sArgument.sProductCd2 = obj.getBindDataset().getColumn(e.row, "RELATED_PRODUCT_CODE");		
					sArgument.sFilterExpr = "CODE=='"+this.sContractType+"'";
				}
				else if(sColNm== "RELATED_PRODUCT_NAME")
				{
					sArgument.sContractType = this.sPRtype;
					sArgument.sProductCd = obj.getBindDataset().getColumn(e.row, "RELATED_PRODUCT_CODE");
				}
			}
			this.commUtil.popupProductSearch(this, "popupProductSearch_"+sColNm, "fnPopupCallBack", sArgument);
		}
		/*투입인력 선택 팝업*/
		else if( obj.getBindCellIndex("body", "EMP_NAME") == e.cell )
		{
			var sArgument = {};
			var sContractMain = this.dsPurchase.getColumn(0, "CONTRACT_MAIN");
			if(!this.gfnIsEmpty(sContractMain))
			{
				sArgument.sCompanyCode = sContractMain;
			}
			this.commUtil.popupFindSiEmp(this, "popupFindSiEmp", "fnPopupCallBack", sArgument);
		}
	}
};

this.grd_GbSales_onexpandup = function(obj:nexacro.Grid,e:nexacro.GridMouseEventInfo)
{
	var sCellProp = obj.getCellProperty("body", e.cell, "text");	//제거 버튼
	if(!this.gfnIsEmpty(sCellProp))
	{	
		var sColNm = sCellProp.split(":")[1];
		var ds = obj.getBindDataset();
		if(sColNm == "PRODUCT_NAME")
		{
			/*상품 제거*/
			ds.setColumn(obj.getDatasetRow(e.row), "PRODUCT_NAME");
			ds.setColumn(obj.getDatasetRow(e.row), "PRODUCT_CODE");
		}
		else if(sColNm == "RELATED_PRODUCT_NAME")
		{
			/*제품 제거*/
			ds.setColumn(obj.getDatasetRow(e.row), "RELATED_PRODUCT_NAME");
			ds.setColumn(obj.getDatasetRow(e.row), "RELATED_PRODUCT_CODE");
		}
		else if(sColNm == "EMP_NAME")
		{
			/*투입인력 제거*/
			ds.setColumn(obj.getDatasetRow(e.row), "EMP_NO");
			ds.setColumn(obj.getDatasetRow(e.row), "EMP_NAME");
		}
		else if(sColNm == "REMARKS" && ds.getColumn(obj.getDatasetRow(e.row), "PRODUCT_UNIT") == "900")
		{
		
			this.gfnAlert('confirm.general',"단위(수기입력)를 갱신하시겠습니까?\n - 제품계약 상세 기준\n - 계약금액 0원 제외\n - 예시) 개발서버용 4 CORE / 운영서버용 1 Project",null
				,function(srvId,rtn) {
					if(this.gfnIsNull(rtn) || rtn == false || rtn == "false") return;
					var arrUnitTxt = [];
					var price, purpose, unit, qty;
					for(var i = 0, iL = this.dsProdContract.getRowCount(); i < iL; i++)
					{
						price = this.dsProdContract.getColumn(i, "CONTRACT_PRICE");
						if(price > 0)
						{
							//ex) 운영 8 vCORE / DR 8 vCORE / 개발 4 vCORE / 테스트 8 vCORE
							purpose = this.dsProdContract.getColumn(i, "PURPOSE_NAME");
							unit = this.dsProdContract.getColumn(i, "PRODUCT_UNIT_NAME");
							qty = this.dsProdContract.getColumn(i, "QUANTITY");
							arrUnitTxt.push( [purpose,qty,unit].join(" ") );
						}
					}			
					ds.setColumn(obj.getDatasetRow(e.row), "REMARKS", arrUnitTxt.join(" / "));
				});			
			/*단위 업데이트*/
// 			if( this.confirm(this.gfnGetTransTxt(1707, "단위(수기입력)를 갱신하시겠습니까?\n - 제품계약 상세 기준\n - 계약금액 0원 제외\n - 예시) 개발서버용 4 CORE / 운영서버용 1 Project")) )
// 			{
// 				var arrUnitTxt = [];
// 				var price, purpose, unit, qty;
// 				for(var i = 0, iL = this.dsProdContract.getRowCount(); i < iL; i++)
// 				{
// 					price = this.dsProdContract.getColumn(i, "CONTRACT_PRICE");
// 					if(price > 0)
// 					{
// 						//ex) 운영 8 vCORE / DR 8 vCORE / 개발 4 vCORE / 테스트 8 vCORE
// 						purpose = this.dsProdContract.getColumn(i, "PURPOSE_NAME");
// 						unit = this.dsProdContract.getColumn(i, "PRODUCT_UNIT_NAME");
// 						qty = this.dsProdContract.getColumn(i, "QUANTITY");
// 						arrUnitTxt.push( [purpose,qty,unit].join(" ") );
// 					}
// 				}			
// 				ds.setColumn(obj.getDatasetRow(e.row), "REMARKS", arrUnitTxt.join(" / "));
// 			}
		}
	}
};

this.grd_GbProductContractDetail_oncelldblclick = function(obj:nexacro.Grid,e:nexacro.GridClickEventInfo)
{
	//매출계약 정보로 매입계약 덮어쓰기
	var sCellProp = obj.getCellProperty("body", e.cell, "text");
	if(!this.gfnIsEmpty(sCellProp))
	{	
		var sColNm = sCellProp.split(":")[1];
		var ds = obj.getBindDataset();
		var row = obj.getDatasetRow(e.row);
		var dsT = this.dsPurchaseDet;
		var tRow = dsT.rowposition;
		
		var setColumn = function(sColDes, sColSrc)
		{
			dsT.setColumn(tRow, sColDes, ds.getColumn(row, sColSrc));
		}
		if(tRow >= 0)
		{
			switch(this.sContractType)
			{
				case "S" :
					if(this.gfnIsEmpty(sColNm))
						return;
						
					this.gfnAlert('confirm.general',"투입인력 '"+dsT.getColumn(tRow, "EMP_NAME")+"'에게 매출상세 Seq : "+this.gfnGetNumMaskFormatString(ds.getColumn(row, "CSD_SEQ"),"9,999")+"을 연결하시겠습니까?",null
						,function(srvId,rtn) {
							if(this.gfnIsNull(rtn) || rtn == false || rtn == "false") return;
							if(ds.id=="dsProdContractTotal")
							{
								var arrProdMsg = new Array();
								arrProdMsg[0] = this.gfnGetNumMaskFormatString(ds.getColumn(row, "UNIT_COST"),"9,999");
								arrProdMsg[1] = this.gfnGetDateMaskFormatString(this.gfnStrToDate(ds.getColumn(row, "START_DATE")),"yyyy-MM-dd");
								arrProdMsg[2] = this.gfnGetDateMaskFormatString(this.gfnStrToDate(ds.getColumn(row, "END_DATE")),"yyyy-MM-dd");
								
								if( this.confirm(this.gfnGetTransTxt(1999, "상세내역을 변경하시겠습니까?\n\n 확인을 누르시면 매출단가 : "+arrProdMsg[0]+"원,\n 시작일 "+arrProdMsg[1]+",\n 종료일 "+arrProdMsg[2]+"을 변경합니다.", arrProdMsg)) )
								{							
									setColumn("START_DATE"		, "START_DATE");
									setColumn("END_DATE"		, "END_DATE");
									setColumn("CSD_UNIT_COST"	, "UNIT_COST");
								}
							}
							else {
								this.gfnAlert('confirm.general',"상세내역을 변경하시겠습니까?\n\n 확인을 누르시면 매출단가 "+this.gfnGetNumMaskFormatString(ds.getColumn(row, "UNIT_COST"),"9,999")+"원을 변경합니다.",null
									,function(srvId,rtn) {
										if(this.gfnIsNull(rtn) || rtn == false || rtn == "false") return;
										setColumn("CSD_UNIT_COST", "UNIT_COST");
										var sPsdSeq = dsT.getColumn(tRow, "PSD_SEQ");
										var nRow = this.dsProdContractTotal.addRow();
										this.dsProdContractTotal.copyRow(nRow, this.dsProdContract, e.row);
										
										if(!this.gfnIsEmpty(sPsdSeq)) {
											this.dsProdContractTotal.setColumn(nRow, "PSD_SEQ", sPsdSeq);
										}
										this.dsProdContractTotal.setColumn(nRow, "EMP_NO", dsT.getColumn(tRow, "EMP_NO"));
										this.dsProdContractTotal.setColumn(nRow, "EMP_NAME", dsT.getColumn(tRow, "EMP_NAME"));		
									});								
							}
// 							else if( this.confirm(this.gfnGetTransTxt(2000, "상세내역을 변경하시겠습니까?\n\n 확인을 누르시면 매출단가 "+this.gfnGetNumMaskFormatString(ds.getColumn(row, "UNIT_COST"),"9,999")+"원을 변경합니다.", [this.gfnGetNumMaskFormatString(ds.getColumn(row, "UNIT_COST"),"9,999")])) )
// 							{
// 								setColumn("CSD_UNIT_COST", "UNIT_COST");
// 								var sPsdSeq = dsT.getColumn(tRow, "PSD_SEQ");
// 								var nRow = this.dsProdContractTotal.addRow();
// 								this.dsProdContractTotal.copyRow(nRow, this.dsProdContract, e.row);
// 								
// 								if(!this.gfnIsEmpty(sPsdSeq)) {
// 									this.dsProdContractTotal.setColumn(nRow, "PSD_SEQ", sPsdSeq);
// 								}
// 								this.dsProdContractTotal.setColumn(nRow, "EMP_NO", dsT.getColumn(tRow, "EMP_NO"));
// 								this.dsProdContractTotal.setColumn(nRow, "EMP_NAME", dsT.getColumn(tRow, "EMP_NAME"));
// 							}
							setColumn("CSD_SEQ", "CSD_SEQ");	
						});							

// 					if( this.confirm(this.gfnGetTransTxt(1998, "투입인력 '"+dsT.getColumn(tRow, "EMP_NAME")+"'에게 매출상세 Seq : "+this.gfnGetNumMaskFormatString(ds.getColumn(row, "CSD_SEQ"),"9,999")+"을 연결하시겠습니까?"
// 														  , [dsT.getColumn(tRow, "EMP_NAME"), this.gfnGetNumMaskFormatString(ds.getColumn(row, "CSD_SEQ"),"9,999")] )) )
// 					{						
// 
// 					}
					break;
	
				case "M" :
				case "P" :
					if (this.FV_CO_CD == "J02") {
						if (this.sContractType == "P") {
							this.gfnAlert('confirm.general',"상세내역을 변경하시겠습니까?\n\n 확인을 누르시면 매출계약금액을 변경합니다.",null
								,function(srvId,rtn) {
									if(this.gfnIsNull(rtn) || rtn == false || rtn == "false") return;
									var nContractPrice = ds.getSum("CONTRACT_PRICE");
									if(this.gfnIsEmpty(nContractPrice)) nContractPrice = 0;
									
									for (var i=0; i<dsT.rowcount; i++) {
										dsT.setColumn(i, "UNIT_COST", nContractPrice);
									}
									setColumn("PRODUCT_CODE",	"PRODUCT_CODE");
									setColumn("PRODUCT_NAME",	"PRODUCT_NAME");
									setColumn("QUANTITY", 		"QUANTITY");
									setColumn("PRODUCT_UNIT",	"PRODUCT_UNIT");
									setColumn("ROYALTY_TYPE",	"ROYALTY_TYPE");

								});							
							// 제품 매입
// 							if( this.confirm(this.gfnGetTransTxt(22694, "상세내역을 변경하시겠습니까?\n\n 확인을 누르시면 매출계약금액을 변경합니다.")) )
// 							{
// 								var nContractPrice = ds.getSum("CONTRACT_PRICE");
// 								if(this.gfnIsEmpty(nContractPrice)) nContractPrice = 0;
// 								
// 								for (var i=0; i<dsT.rowcount; i++) {
// 									dsT.setColumn(i, "UNIT_COST", nContractPrice);
// 								}
// 								setColumn("PRODUCT_CODE",	"PRODUCT_CODE");
// 								setColumn("PRODUCT_NAME",	"PRODUCT_NAME");
// 								setColumn("QUANTITY", 		"QUANTITY");
// 								setColumn("PRODUCT_UNIT",	"PRODUCT_UNIT");
// 								setColumn("ROYALTY_TYPE",	"ROYALTY_TYPE");
// 								
// 							}
							setColumn("CRD_SEQ", "CRD_SEQ");
							
						} else {
							// 유지보수 매입
							if( this.confirm(this.gfnGetTransTxt(22694, "상세내역을 변경하시겠습니까?\n\n 확인을 누르시면 매출계약금액을 변경합니다.")) ) 
							{
								var nContractPrice = ds.getSum("CONTRACT_PRICE");
								if(this.gfnIsEmpty(nContractPrice)) nContractPrice = 0;
								
								for (var i=0; i<dsT.rowcount; i++) {
									dsT.setColumn(i, "UNIT_COST", nContractPrice);
								}
								
								setColumn("START_DATE"			, "START_DATE");
								setColumn("END_DATE"			, "END_DATE");
								setColumn("RELATED_PRODUCT_CODE", "PRODUCT_CODE");
								setColumn("RELATED_PRODUCT_NAME", "PRODUCT_NAME");
								setColumn("ROYALTY_TYPE",	"ROYALTY_TYPE");
							}
							setColumn("CMD_SEQ", "CMD_SEQ");
						}
						
					} else {
						var arrMaintenanceMsg = new Array();
						arrMaintenanceMsg[0] = dsT.getColumn(tRow, "RELATED_PRODUCT_NAME");
						arrMaintenanceMsg[1] = this.gfnGetNumMaskFormatString(dsT.getColumn(tRow, "UNIT_COST"),"9,999");
						arrMaintenanceMsg[2] = ds.getColumn(row, "PRODUCT_NAME")+"("+this.gfnGetNumMaskFormatString(ds.getColumn(row, "CONTRACT_PRICE"),"9,999");
						if( this.confirm(this.gfnGetTransTxt(2001, "매입유지보수 "+arrMaintenanceMsg[0]+"("+arrMaintenanceMsg[1]+"원) 항목에 \n 매출계약 "+arrMaintenanceMsg[2]+"원) 항목을 연결 하시겠습니까?", arrMaintenanceMsg)) )
						{
							if( this.confirm(this.gfnGetTransTxt(2002, "상세내역을 변경하시겠습니까?\n\n 확인을 누르시면 기간,연관제품,매출계약금액을 변경합니다.")) )
							{
								setColumn("START_DATE"			, "START_DATE");
								setColumn("END_DATE"			, "END_DATE");
								setColumn("RELATED_PRODUCT_CODE", "PRODUCT_CODE");
								setColumn("RELATED_PRODUCT_NAME", "PRODUCT_NAME");
								setColumn("UNIT_COST"			, "CONTRACT_PRICE");	/*매출계약금 연결*/
							}
							setColumn("CMD_SEQ", "CMD_SEQ");
						}
					}
					break;					
				case "G" :
					if (this.FV_CO_CD == "J02") {
						// 상품 매입
						if( this.confirm(this.gfnGetTransTxt(22694, "상세내역을 변경하시겠습니까?\n\n 확인을 누르시면 매출계약금액을 변경합니다.")) ) 
						{							
							setColumn("PRODUCT_CODE"		, "PRODUCT_CODE");
							setColumn("PRODUCT_NAME"		, "PRODUCT_NAME");
							setColumn("QUANTITY"			,"QUANTITY");
							setColumn("PRODUCT_UNIT"		,"PRODUCT_UNIT");						
							setColumn("ROYALTY_TYPE"		,"ROYALTY_TYPE");
							
							var nContractPrice = ds.getSum("CONTRACT_PRICE");
							if(this.gfnIsEmpty(nContractPrice)) nContractPrice = 0;
							
							for (var i=0; i<dsT.rowcount; i++) {
								dsT.setColumn(i, "UNIT_COST", nContractPrice);
							}
						}
					} else {
						if(sColNm == "PRODUCT_NAME")
						{
							setColumn("RELATED_PRODUCT_CODE", "PRODUCT_CODE");
							setColumn("RELATED_PRODUCT_NAME", "PRODUCT_NAME");
						}
						else if(sColNm == "PRODUCT_UNIT_NAME")
						{
							setColumn("PRODUCT_UNIT", "PRODUCT_UNIT");
						}
						else if(sColNm == "QUANTITY")
						{
							setColumn("QUANTITY", "QUANTITY");
						}
						else if(sColNm == "CONTRACT_PRICE")
						{
							setColumn("UNIT_COST", "CONTRACT_PRICE");
						}
					}
					
					setColumn("CRD_SEQ", "CRD_SEQ");
					break;
					
				default :
					setColumn("CRD_SEQ", "CRD_SEQ");
					break;
			}
		}
	}
};

this.btn_Cancel_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	if(this.isUpdated())
	{
		if( this.confirm(this.gfnGetTransTxt(1711, "변경내역이 존재합니다.\n계속하시겠습니까?")) )
		{
			this.commUtil.popupClose();
		}
	}else{
		this.commUtil.popupClose();
	}	
};

this.btn_Close_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	if(this.isUpdated())
	{
		if( this.confirm(this.gfnGetTransTxt(1711, "변경내역이 존재합니다.\n계속하시겠습니까?")) )
		{
			this.commUtil.popupClose();
		}
	}else{
		this.commUtil.popupClose();
	}	
};

this.btn_Search_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	if(this.sContractType == "M")
		this.fnSearchList();
	else
		this.fnSearch();
};

this.btn_Save_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var dsPurchaseDetSum = parseInt(this.dsPurchaseDet.getSumNF("CONTRACT_PRICE"));
	var dsPurchaerPaySum = parseInt(this.dsPurchasePay.getSumNF("TAX_PRICE"));
	var nSeqKeyVAL = this.dsPurchaseDet.getColumn(this.dsPurchaseDet.rowposition, this.sPurchaseDetKeyName);
	
	if(dsPurchaseDetSum === dsPurchaerPaySum || this.gfnIsEmpty(nSeqKeyVAL))
	{
		if(this.fnCheckTurnkey())
		{
			this.fnSave();	
		}
		else
		{
			this.gfnAlert('msg.general',this.gfnGetTransTxt(1385, "원청턴키 대상 회사가 아닙니다. \n원청턴키로 매입계약을 진행할려면 회사정보를 수정 후 진행 해주세요."));
		}
	}
	else
	{
		var arrMsg = new Array();
		var sContractPriceNM = this.gfnGetTransTxt(826, "공급가액");
		switch(this.sContractType)
		{
			case "S":
				sContractPriceNM = this.gfnGetTransTxt(40, "계약금액");
				break;
			case "M":
				sContractPriceNM = this.gfnGetTransTxt(1114, "유지보수금액");
				break;
			case "C":
				sContractPriceNM = this.gfnGetTransTxt(1923, "판매수수료");
				break;
			case "D":
				sContractPriceNM = this.gfnGetTransTxt(1932, "총판수수료");
				break;
			default:
				sContractPriceNM = this.gfnGetTransTxt(826, "공급가액");
				break;
		}
		arrMsg[0] = sContractPriceNM;
		this.gfnAlert('msg.general', this.gfnGetTransTxt(1630, "매입내역의 "+sContractPriceNM+"과 지급내역의 공급가액이 상이합니다. \n확인하시기 바랍니다.", arrMsg) );
	}
};

this.btn_Delete_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var nPayCompleteCnt = this.dsPurchasePay.getCaseCountNF("PAY_FLAG=='1'");	//필터된 로우 포함하여 보여준다.
	var nDatasetRowType = this.dsPurchase.getRowType(0); // 추가:2
	//지급내역 완료 건 존재 시 삭제 할 수 없음.
	//신규 추가 건은 삭제할 필요 없음. (닫으면 된다.)
	if(nPayCompleteCnt > 0)
	{
		return this.gfnAlert('msg.general',this.gfnGetTransTxt(1386, "지급완료 건이 존재 시 삭제할 수 없습니다."));
	}
	if(nDatasetRowType == 2)
	{
		if(this.confirm(this.gfnGetTransTxt(1713, "등록중인 계약을 취소하시겠습니까?")))
		{
			this.commUtil.popupClose();
		}
	}
	
	if(this.confirm(this.gfnGetTransTxt(1714, "본 매입계약을 삭제하시겠습니까?")))
	{
		this.dsPurchasePay.deleteAll();
		this.dsPurchaseDet.deleteAll();
		this.dsPurchase.deleteAll();
		this.fnSave("Delete");
	}
	
};

// 복사취소
this.btn_CopyCancel_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var sContractNoPurchase = this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CONTRACT_NO_PURCHASE_PRE");
	if(this.confirm(this.gfnGetTransTxt(1715, "본 복사한 매입계약을 취소하시겠습니까?")))
	{
		if(!this.gfnIsEmpty(sContractNoPurchase)) this.fnPurchaseCopyCancel();
		else this.gfnAlert('msg.general',this.gfnGetTransTxt(1387, "이전 유지보수 매입 계약이 없습니다."));
	}
};

this.btn_SaveClose_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	if(this.fnCheckTurnkey()) this.fnSave("Close");
	else this.gfnAlert('msg.general',this.gfnGetTransTxt(1388, "원천턴키 대상 회사가 아닙니다. \n원천턴키로 매입계약을 진행할려면 회사정보를 수정 후 진행 해주세요."));
};

this.btn_CommAddRemove_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	switch(obj.name) 
	{
		case "btn_ProductAdd" :	
			var sContractNoPurchase = this.dsPurchase.getColumn(0, "CONTRACT_NO_PURCHASE");
			if(this.gfnIsEmpty(sContractNoPurchase) && this.dsPurchaseDet.getRowCount() >= 1 )
			{
				return this.gfnAlert('msg.general',this.gfnGetTransTxt(1389, "계약 신규등록 시 상품을 1개 이상 등록할 수 없습니다.\n - 저장 후 진행하십시오."));
			}
			if(this.sContractType == "C" && this.dsPurchaseDet.getRowCount() >= 1)
			{
				// gfnAlert('msg.general',"판매수수료는 1건 이상 등록할 수 없습니다.");
				return;
			}
			//조기종료확인서(프리랜서(A104))로 출력 시 프리랜서 1명이상 등록하지 못하게 막음. (2018.12.05) - 안주환
			if(this.sContractType == "S" && this.dsPurchase.getColumn(0, "CONTRACT_MAIN")=="A104" && this.dsPurchaseDet.rowcount >= 1)
			{
				this.gfnAlert('msg.general',this.gfnGetTransTxt(1390, "프리랜서는 1명이상 등록할 수 없습니다."));
				return;
			}
			//지급내역 매핑문제때문에 저장안된 상세 내역이 있으면 추가 못하게 막음
			if(this.dsPurchaseDet.getRowType(this.dsPurchaseDet.rowcount-1)==2)
			{
				this.gfnAlert('msg.general',this.gfnGetTransTxt(1391, "먼저 추가한 매입상세를 저장 후 진행하십시오."));
				return;
			}
			if(this.sContractType == "D" && this.dsPurchaseDet.getRowCount() >= 1)
			{
				// gfnAlert('msg.general',"총판수수료는 1건 이상 등록할 수 없습니다.");
				return;
			}
			var newrow = this.dsPurchaseDet.addRow();
			/*row 추가에 따른 이벤트처리후에 이벤트를 막는다.(지급내역 신규생성 방지용)*/
			this.dsPurchaseDet.set_enableevent(false);		
			this.dsPurchaseDet.setColumn(newrow, "CONTRACT_NO_PURCHASE"	, sContractNoPurchase);
			this.dsPurchaseDet.setColumn(newrow, "PRODUCT_UNIT"			, "001");
			this.dsPurchaseDet.setColumn(newrow, "UNIT_COST"			, "0");
			this.dsPurchaseDet.setColumn(newrow, "QUANTITY"				, "1");
			this.dsPurchaseDet.setColumn(newrow, "CONTRACT_PRICE"		, "0");
			this.dsPurchaseDet.setColumn(newrow, "VAT_PRICE"			, "0");
			
			// float NULL 제약조건 때문에 추가
			this.dsPurchaseDet.setColumn(newrow, "COMMISSION_RATE"		, "0");
			this.dsPurchaseDet.setColumn(newrow, "CSD_UNIT_COST"		, "0");
			
			if(this.sContractType == "C")
			{
				this.dsPurchaseDet.setColumn(newrow, "PRODUCT_CODE"		, "C01");
				this.dsPurchaseDet.setColumn(newrow, "PRODUCT_NAME"		, this.gfnGetTransTxt(1923, "판매수수료"));
				this.dsPurchaseDet.setColumn(newrow, "PRODUCT_UNIT"		, "900");
			}
			else if(this.sContractType == "M")
			{
				this.dsPurchaseDet.setColumn(newrow, "PRODUCT_CODE"		, "M01");
				this.dsPurchaseDet.setColumn(newrow, "PRODUCT_NAME"		, this.gfnGetTransTxt(46, "유지보수"));
				this.dsPurchaseDet.setColumn(newrow, "PRODUCT_UNIT"		, "900");
			}
			else if(this.sContractType == "D")
			{
				this.dsPurchaseDet.setColumn(newrow, "PRODUCT_CODE"		, "D01");
				this.dsPurchaseDet.setColumn(newrow, "PRODUCT_NAME"		, this.gfnGetTransTxt(1932, "총판수수료"));
				this.dsPurchaseDet.setColumn(newrow, "PRODUCT_UNIT"		, "900");
			}
			
			if(this.sContractType == "S")
			{
				this.dsPurchaseDet.setColumn(newrow, "NONRESIDENT_FLAG"	, "0");
				this.dsPurchaseDet.setColumn(newrow, "EXPENSE"			, "0");
				this.setTurnkeyFormat(this.dsPurchase.getColumn(0, "PURCHASE_TYPE"), newrow);
			}
			
			if(this.sContractType == "M" || this.sContractType == "S")
			{
				/*매입정보 기간을 매입상세 기간에 자동기입*/
				var strStratDate = this.dsPurchase.getColumn(0, "START_DATE");
				var strEndDate = this.dsPurchase.getColumn(0, "END_DATE");
				var strToday = this.gfnGetDateMaskFormatString(new Date(), "yyyyMMdd");
				strStratDate = this.gfnIsEmpty(strStratDate)?strToday:strStratDate;
				strEndDate = this.gfnIsEmpty(strEndDate)?strToday:strEndDate;
				this.dsPurchaseDet.setColumn(newrow, "START_DATE"	, strStratDate);
				this.dsPurchaseDet.setColumn(newrow, "END_DATE"		, strEndDate);
			}
			this.dsPurchaseDet.set_enableevent(true);
			break;
		case "btn_ProductRemove" :	
			//매입상세 삭제시 지급내역 같이 삭제
			for(var i=this.dsPurchasePay.rowcount-1; i>=0; i--)
			{
				this.dsPurchasePay.deleteRow(i);
			}
			this.dsPurchaseDet.deleteRow(this.dsPurchaseDet.rowposition);
			break;
		case "btn_PayAdd" :	
			var sContractNoPurchase = this.dsPurchase.getColumn(0, "CONTRACT_NO_PURCHASE");
			var sLumpPayFlag 		= this.dsPurchase.getColumn(0, "LUMP_PAY_FLAG");
			
			var nSeqKeyVAL;
			if(this.dsPurchaseDet.rowposition >= 0)
			{
				nSeqKeyVAL = this.dsPurchaseDet.getColumn(this.dsPurchaseDet.rowposition, this.sPurchaseDetKeyName);
			}
			
			/*매입지급 신규등록 가능 조건
			1. 계약 == 신규
			2. 계약 != 신규 && 일괄지급 == false && 상품키 == true
			*/
			
			if( this.gfnIsEmpty(sContractNoPurchase) || (!this.gfnIsEmpty(sContractNoPurchase) /*&& sLumpPayFlag != "1"*/ && !this.gfnIsEmpty(nSeqKeyVAL)) )
			{
				var newrow = this.dsPurchasePay.addRow();
				if(sLumpPayFlag != "1")
				{
					this.dsPurchasePay.setColumn(newrow, this.sPurchaseDetKeyName, nSeqKeyVAL);
				}
				
				var today = new Date();
				var s_yyyyMMdd,e_yyyyMMdd,p_yyyyMMdd;
				switch(this.sContractType)
				{
					case "S":
						/*s_yyyyMMdd, e_yyyyMMdd 	= 역무기간 초기설정 = 금일~한달뒤 : ex) 20181120 ~ 20181219 )*/
						/*p_yyyyMMdd 				= 역무종료일 + 다음달 + 지급예정일 ex) 20190125(일반) or 20190110(프리랜서)*/
						s_yyyyMMdd = this.gfnGetDateMaskFormatString(today, "yyyyMMdd");
						today.addMonth(1);
						today.addDate(-1);
						e_yyyyMMdd = this.gfnGetDateMaskFormatString(today, "yyyyMMdd");
						today.addMonth(1);
						today.setDate(this.div_Sales_List.form.cmb_PayPlanDay.value);
						p_yyyyMMdd = this.gfnGetDateMaskFormatString(today, "yyyyMMdd");
						this.dsPurchasePay.setColumn(newrow, "START_DATE"			, s_yyyyMMdd);
						this.dsPurchasePay.setColumn(newrow, "END_DATE"				, e_yyyyMMdd);
						this.dsPurchasePay.setColumn(newrow, "PAY_PLAN_DATE"		, p_yyyyMMdd);
						break;
						
					case "M":
						/*s_yyyyMMdd, e_yyyyMMdd 	= 계약기간*/
						/*p_yyyyMMdd 				= 계약종료일 다음달 25일*/
						s_yyyyMMdd = this.dsPurchase.getColumn(0, "START_DATE");
						e_yyyyMMdd = this.dsPurchase.getColumn(0, "END_DATE");
						this.dsPurchasePay.setColumn(newrow, "START_DATE", s_yyyyMMdd);
						this.dsPurchasePay.setColumn(newrow, "END_DATE", e_yyyyMMdd);
						
						e_yyyyMMdd = this.gfnStrToDate(e_yyyyMMdd);
						e_yyyyMMdd.addMonth(1);
						e_yyyyMMdd.setDate(25);
						p_yyyyMMdd = this.gfnGetDateMaskFormatString(e_yyyyMMdd, "yyyyMMdd");
						this.dsPurchasePay.setColumn(newrow, "PAY_PLAN_DATE", p_yyyyMMdd);
						break;
						
					default:
						this.dsPurchasePay.setColumn(newrow, "PAY_PLAN_DATE", this.gfnGetDateMaskFormatString(new Date(), "yyyyMMdd"));
						
				}
				
				this.dsPurchasePay.setColumn(newrow, "CONTRACT_NO_PURCHASE", sContractNoPurchase);
			}else{
				this.gfnAlert('msg.general',this.gfnGetTransTxt(1392, "저장 후 진행하십시오."));
			}
			
			break;
		case "btn_PayRemove" :
			var sPayFlag = this.dsPurchasePay.getColumn(this.dsPurchasePay.rowposition, "PAY_FLAG");
			if(sPayFlag == "1")	//지급완료이면 삭제불가
			{
				this.gfnAlert('msg.general',this.gfnGetTransTxt(1393, "지급완료 건은 삭제할 수 없습니다."));
			}else{
				this.dsPurchasePay.deleteRow(this.dsPurchasePay.rowposition);
			}
			
			break;
		case "btn_MAAdd" :
			var sArgument = {pvMode : "C"	// 고객사
							,sSubject : this.div_Sales_List.form.div_Client.getData()	// 고객사명
							,sRelatedCompany : this.dsPurchase.getColumn(0, "CONTRACT_MAIN")
							};
			this.commUtil.popupProjectSearch(this, "popupContractSearch", "fnPopupCallBack", sArgument);
			break;
		case "btn_MARemove" :		
			var nRow = this.dsProdContractM.rowposition;
			if ( this.confirm(this.gfnGetTransTxt(1716, "유지보수건을 삭제 하시겠습니까?")) ){
				this.dsProdContractM.deleteRow(nRow);
			}
			break;
		case "btn_PurchaseCopy" :
			if(this.confirm(this.gfnGetTransTxt(1717, "계약 복사를 진행 하시겠습니까?")))
			{
				this.fnPurchaseCopy();
			}
			break;	
		case "btn_TotalRemove" :
			this.dsProdContractTotal.deleteRow(this.dsProdContractTotal.rowposition);
			break;	
		default:
	}
};

this.btn_ProductPurchaseOrder_onclick = function(obj:nexacro.Button, e:nexacro.ClickEventInfo)
{	
	var ds = this.dsPurchase;
	var row = ds.rowposition;
	var rowType = ds.getRowType(row);
	
	if(!this.fnCanSave())	//저장된 상태일 경우만 출력가능
	{
		return false;
	}
	if( rowType == 1 )	// Normal 상태일 경우만 출력가능
	{
		var sContractType  = ds.getColumn(row,"CONTRACT_TYPE");
		var sPurchaseType  = ds.getColumn(row,"PURCHASE_TYPE");
		var sContractDocNo = ds.getColumn(row,"CONTRACT_DOC_NO");
		
		//계약서번호가 비어있을 경우 생성 한다.
		if(this.gfnIsEmpty(sContractDocNo))
		{
			this.fnSearchNewDocNo();
			sContractDocNo = this.dsNewDocNo.getColumn(0, "CONTRACT_DOC_NO_NEW"); //계약서번호 신규생성 로직!
			if(this.gfnIsEmpty(sContractDocNo))
			{
				this.gfnAlert('msg.general',this.gfnGetTransTxt(1394, "계약서번호 생성에 실패하였습니다. \n - 매입계약처코드를 확인하세요."));
				return false;
			}
			ds.setColumn(row, "CONTRACT_DOC_NO", sContractDocNo);
		}
		
		if(this.sContractType == "S")
		{	
			//addcolumn
			this.dsPurchaseDet.addColumn("PAY_PLAN_DATE", "STRING", "255");
			this.dsPurchaseDet.addColumn("CONTRACT_CHARGE", "STRING", "255");
			this.dsPurchaseDet.addColumn("VAT_CHARGE", "STRING", "255");
			this.dsPurchaseDet.addColumn("LEVEL_NAME", "STRING", "255");
			
			//setcolumn
			for(var i=0, iL=this.dsPurchase.rowcount; i<iL; i++)
			{
				this.dsPurchaseDet.setColumn(i, "PAY_PLAN_DATE", this.isUndefineCheck(this.dsPurchasePay.getColumn(i, "PAY_PLAN_DATE")));
				this.dsPurchaseDet.setColumn(i, "CONTRACT_CHARGE", this.isUndefineCheck(this.dsPurchasePay.getColumn(i, "TAX_PRICE")));
				this.dsPurchaseDet.setColumn(i, "VAT_CHARGE", this.isUndefineCheck(this.dsPurchasePay.getColumn(i, "VAT_PRICE")));
			}
			
			//setcolumn
			for(var i=0, iL=this.dsPurchaseDet.rowcount; i<iL; i++)
			{
				var nfindRow = this.ds_CD_LEVEL_CODE.findRow("CODE",this.dsPurchaseDet.getColumn(i, "LEVEL_CODE"));
				this.dsPurchaseDet.setColumn(i, "LEVEL_NAME",  this.ds_CD_LEVEL_CODE.getColumn(nfindRow, "CAPTION"));
			}
			
			var Tmp_dsPurchaseDet = new nexacro.Dataset();
			Tmp_dsPurchaseDet.copyData(this.dsPurchaseDet)
			Tmp_dsPurchaseDet.addColumn("ORG_EMP_NAME", "STRING", 255);
			
			if(this.div_Sales_List.form.chb_MainContractReport.value == "1")
			{
				for(var i=0, iL=Tmp_dsPurchaseDet.rowcount; i<iL; i++)
				{
					Tmp_dsPurchaseDet.setColumn(i, "ORG_EMP_NAME",  Tmp_dsPurchaseDet.getColumn(i, "EMP_NAME"));
					Tmp_dsPurchaseDet.setColumn(i, "EMP_NAME",  this.gfnGetTransTxt(22846, "원청인력"));
				}
			}
			if(obj.name == "btn_ProductPurchaseOrder")
			{
				//매입계약서확인서 버튼 클릭 했을 때 SP_PurchaseRegSiReport 팝업화면 출력.
				var sArgument = {
									sContractType: sContractType
									,dsPurchase:this.dsPurchase
									,dsPurchaseDet:Tmp_dsPurchaseDet//this.dsPurchaseDet
									,dsPurchasePay:this.dsPurchasePay
									,ds_CD_LEVEL_CODE:this.ds_CD_LEVEL_CODE
									,"chb_IsIncludeRemark" : this.div_Sales_List.form.chb_IsIncludeRemark
									,bIsEarlyTermination:(obj.name == "btn_PurchaseEarlyTermination" ? true:false)	//매입계약서 버튼 클릭 했을 경우
								};				
				this.commUtil.popup(this, "popupProductReportPopUp", "Sales::SP_PurchaseRegSiReport.xfdl", -1, -1, 648, 720, true, true, true, sArgument, "fnPopupCallBack");
			}
			else if(obj.name == "btn_PurchaseEarlyTermination")
			{
				//조기종료확인서 버튼 클릭 했을 때 SP_PurchaseRegPopup 팝업화면 출력.
				var sArgument = {
									sContractType: sContractType
									,dsPurchase:this.dsPurchase
									,dsPurchaseDet:Tmp_dsPurchaseDet//this.dsPurchaseDet
									,dsPurchasePay:this.dsPurchasePay
									,ds_CD_LEVEL_CODE:this.ds_CD_LEVEL_CODE
									,bIsEarlyTermination:(obj.name == "btn_PurchaseEarlyTermination" ? true:false)	//조기종료확인서 버튼 클릭 했을 경우
								};
				this.commUtil.popup(this, "popupPurchaseRegPopup", "Sales::SP_PurchaseRegPopup.xfdl", -1, -1, 900, 450, true, true, false, sArgument, "fnPopupCallBack");
			}
		}else if(this.sContractType == "M")
		{
			var strAddType = this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CONTRACT_ADD_TYPE");
			var sArgument = {
								sContractType: sContractType
								,dsPurchase:this.dsPurchase
								,dsPurchaseDet:this.dsPurchaseDet
								,dsPurchasePay:this.dsPurchasePay
								,dsProdContractM:this.dsProdContractM
								,ds_CD_PURCHASE_TYPE:this.ds_CD_PURCHASE_TYPE
								,ds_CD_PRODUCT_UNIT:this.ds_CD_PRODUCT_UNIT
								,bIsEarlyTermination:(obj.name == "btn_PurchaseEarlyTermination" ? true:false)	//조기종료확인서 버튼 클릭 했을 경우
								,sAddType:strAddType	//0:신규 2:연장 3:변경
								,IsIncludeRemark : this.div_Sales_List.form.chb_IsIncludeRemark.value
							};		
			if(obj.name == "btn_ProductPurchaseOrder")
			{
				if(strAddType=="0")	// 신규는 기존 레포트 그대로
					this.commUtil.popup(this, "popupProductReport", "Sales::SP_PurchaseRegReport.xfdl", -1, -1, 1120, 720, true, true, true, sArgument, "fnPopupCallBack");
				else	// 연장, 변경은 추가되는 레포트로 출력
					this.commUtil.popup(this, "popupProductReportPopUp", "Sales::SP_PurchaseRegMAReport.xfdl", -1, -1, 900, 450, true, true, false, sArgument, "fnPopupCallBack");
			}
			else if(obj.name == "btn_PurchaseEarlyTermination")
			{
 				//조기종료확인서 버튼 클릭 했을 때
 				this.commUtil.popup(this, "popupProductReportPopUp", "Sales::SP_PurchaseRegMAReport.xfdl", -1, -1, 900, 450, true, true, false, sArgument, "fnPopupCallBack");
			}
		}else if(this.sContractType == "D"){
			// 리포트용 회사 조회
			this.fnSearchCoInfo();
		}else{
			//상품발주서 버튼 클릭 했을 때 SP_PurchaseRegReport 팝업화면 출력.
			var sArgument = {
								sContractType: sContractType
								,dsPurchase:this.dsPurchase
								,dsPurchaseDet:this.dsPurchaseDet
								,dsPurchasePay:this.dsPurchasePay
								,dsProdContractM:this.dsProdContractM
								,ds_CD_PURCHASE_TYPE:this.ds_CD_PURCHASE_TYPE
								,ds_CD_PRODUCT_UNIT:this.ds_CD_PRODUCT_UNIT
							};
			this.commUtil.popup(this, "popupProductReport", "Sales::SP_PurchaseRegReport.xfdl", -1, -1, 1120, 720, true, true, true, sArgument, "fnPopupCallBack");
		}		
				
	} else {
		this.gfnAlert('msg.general',this.gfnGetTransTxt(1392, "저장 후 진행하십시오."));
	}	
};

this.dsPurchase_cancolumnchange = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	var nSeqKeyVAL;
	var nSeqKeyCnt;
	if(e.columnid == "PAY_TERM")
	{
		if(e.newvalue != e.oldvalue && this.confirm(this.gfnGetTransTxt(1718, "변경된 지급구분을 기준으로 지급내역을 재생성 하시겠습니까?")))
		{
			this.setPurchasePay(e.newvalue);
		}
	}
	if(e.columnid == "LUMP_PAY_FLAG")// && obj.getRowType(e.row) != 2)	//2:추가된 상태
	{
		var nPayCompleteCnt = this.dsPurchasePay.getCaseCountNF("PAY_FLAG=='1'");	//필터된 로우를 포함하여 리턴한다.
		if(nPayCompleteCnt > 0)
		{
			this.gfnAlert('msg.general',this.gfnGetTransTxt(1386, "지급완료 건이 존재 시 삭제할 수 없습니다."));
			return false;
		}
		
		var sConfirmMsg = ( e.newvalue == "1" ? this.gfnGetTransTxt(1916, "일괄지급 설정 시 지급내역이 병합됩니다.") : this.gfnGetTransTxt(1917, "일괄지급 해제 시 지급내역이 첫번째 상품으로 병합됩니다.\n등록된 상품이 없는 경우 삭제됩니다.") );
			sConfirmMsg += this.gfnGetTransTxt(1915, "계속하시겠습니까?");
		if(confirm(sConfirmMsg))
		{
			var sContractnoPurchase = obj.getColumn(e.row, "CONTRACT_NO_PURCHASE");			
			if(e.newvalue == "1")
			{
				//일괄지급일 경우 계약으로 이동
				for(var i = 0, iL = this.dsPurchasePay.rowcount; i < iL; i++)
				{
					this.dsPurchasePay.setColumn(i, "CONTRACT_NO_PURCHASE", sContractnoPurchase);
					this.dsPurchasePay.setColumn(i, this.sPurchaseDetKeyName, null);				
				}
			}
			else
			{
				//일괄지급이 아닐 경우 상품으로 이동 (단, 등록된 상품이 없을 경우 삭제)
				nSeqKeyVAL = this.dsPurchaseDet.getColumn(0, this.sPurchaseDetKeyName);
				nSeqKeyCnt = this.dsPurchaseDet.getRowCount();				
				if( nSeqKeyCnt > 0 && !this.gfnIsEmpty(nSeqKeyVAL) )
				{
					for(var i = 0, iL = this.dsPurchasePay.rowcount; i < iL; i++)
					{
						//this.dsPurchasePay.setColumn(i, "CONTRACT_NO_PURCHASE", null);	//CONTRACT_NO_PURCHASE는 키값이므로 삭제 하면 안됨
						this.dsPurchasePay.setColumn(i, this.sPurchaseDetKeyName, nSeqKeyVAL);
					}
				}else{
					this.dsPurchasePay.clearData();
				}
			}	
		}else{
			return false;
		}
	}
};

this.dsPurchase_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	if(e.columnid == "LUMP_PAY_FLAG" )
	{
		this.fnFilterPurchasePay();
	}
	else if(e.columnid == "PURCHASE_TYPE")
	{
		this.setTurnkeyFormat(e.newvalue);
	}
	else if(e.columnid == "CONTRACT_MAIN")
	{
		this.setTurnkeyFormat(obj.getColumn(0, "PURCHASE_TYPE"));
		if(this.FV_CO_CD == "J02") this.fnPurchaseBillSetBtn(e.newvalue);
	}
};

this.dsPurchase_onrowposchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSRowPosChangeEventInfo)
{
	this.setTurnkeyFormat(obj.getColumn(e.newrow,"PURCHASE_TYPE"));	
	if(this.sContractType=="M" && this.commUtil.getFormAuthority(243,2))	//추가,삭제 권한
	{
		var bBtnMaenable = true;
		if(this.dsPurchase.getRowType(0)==2)
		{
			bBtnMaenable = false;
		}
		this.div_ProdContractM.form.btn_MAAdd.set_enable(bBtnMaenable);
		this.div_ProdContractM.form.btn_MARemove.set_enable(bBtnMaenable);
	}	
};

this.dsPurchaseDet_cancolumnchange = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{

};





this.fn_setPurchaseDetPrice = function (nRow, nPriceVal)
{
	var pRoyaltyType = this.dsPurchaseDet.getColumn(nRow, "ROYALTY_TYPE");
	this.dsPurchaseDet.setColumn(nRow, "CONTRACT_PRICE"	, nexacro.ceil(nPriceVal) );
	
	if (nexacro.getApplication().gdsUserInfo.getColumn(0, "CO_CD") == "J02" && pRoyaltyType != "NA")
	{
		this.dsPurchaseDet.setColumn(nRow, "VAT_PRICE"		, 0	);
	} else {
		this.dsPurchaseDet.setColumn(nRow, "VAT_PRICE"		, nexacro.ceil(nPriceVal * 0.1)	);
	}
	this.setPurchasePay(this.div_Sales_List.form.cmb_ProvideType.value);
}



this.dsPurchaseDet_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	var price = 0;
	var pThis = this;
	var pRoyaltyType = obj.getColumn(e.row, "ROYALTY_TYPE");
	if (this.gfnIsEmpty(pRoyaltyType))	pRoyaltyType = "NA";
	
	
	/*
	var setPrice = function(v)
	{
		obj.setColumn(e.row, "CONTRACT_PRICE"	, nexacro.ceil(v)		);
		
		if (nexacro.getApplication().gdsUserInfo.getColumn(0, "CO_CD") == "J02" && pRoyaltyType != "NA")
		{
			obj.setColumn(e.row, "VAT_PRICE"		, 0	);
		} else {
			obj.setColumn(e.row, "VAT_PRICE"		, nexacro.ceil(v * 0.1)	);
		}
		pThis.setPurchasePay(pThis.div_Sales_List.form.cmb_ProvideType.value);
	}*/
	
	switch(this.sContractType)
	{
		case "C":
		case "D":
		case "P":
		case "M":
			if(["COMMISSION_RATE", "UNIT_COST", "ROYALTY_TYPE"].indexOf(e.columnid) != -1 )
			{
				var rate = nexacro.toNumber(obj.getColumn(e.row, "COMMISSION_RATE"));
				var cost = nexacro.toNumber(obj.getColumn(e.row, "UNIT_COST"));
				
				if (this.FV_CO_CD == "J02") {
					var royalty_rate=0;
					if (e.columnid == "ROYALTY_TYPE") {
						royalty_rate = nexacro.toNumber(this.ds_CD_ROYALTY_TYPE.lookup("CODE", pRoyaltyType, "VAL1"));
					} else {
						royalty_rate = obj.getColumn(e.row, "COMMISSION_RATE");
					}
					
					if (pRoyaltyType == "NA") {
						rate = this.sContractType == "M"?(100-rate):rate;	/*유지보수 요율= 1-요율*/
					} else {
						rate = royalty_rate;
						
						obj.set_enableevent(false);
						obj.setColumn(e.row, "COMMISSION_RATE", rate);
						obj.set_enableevent(true);
					}
				} else {
					rate = this.sContractType == "M"?(100-rate):rate;	/*유지보수 요율= 1-요율*/
				}
				
				price = (rate*0.01) * cost;
				// setPrice(price);
				this.fn_setPurchaseDetPrice(e.row, price);
			}
			/*계약금액 금액 변경시 지급내역 자동 계산*/
			else if(["CONTRACT_PRICE"].indexOf(e.columnid) != -1 )
			{
				var price = nexacro.toNumber(obj.getColumn(e.row, "CONTRACT_PRICE"));
				//setPrice(price);
				this.fn_setPurchaseDetPrice(e.row, price);
			}
			break;
		case "G":
			
			if (this.FV_CO_CD == "J02") {
				if(["COMMISSION_RATE", "UNIT_COST", "ROYALTY_TYPE"].indexOf(e.columnid) != -1 )
				{
					var rate = nexacro.toNumber(obj.getColumn(e.row, "COMMISSION_RATE"));
					var cost = this.dsProdContract.getSum("CONTRACT_PRICE");
					var sRoyaltyTy = obj.getColumn(e.row, "ROYALTY_TYPE");
					var vat = 0;
					var royalty_rate=0;
					
					
					// 로열티 계산
					if (e.columnid == "ROYALTY_TYPE") {
						royalty_rate = nexacro.toNumber(this.ds_CD_ROYALTY_TYPE.lookup("CODE", pRoyaltyType, "VAL1"));
					} else {
						royalty_rate = obj.getColumn(e.row, "COMMISSION_RATE");
					}
					obj.set_enableevent(false);
					obj.setColumn(e.row, "COMMISSION_RATE", royalty_rate);
					obj.set_enableevent(true);
					
					rate = sRoyaltyTy == "NA"?(100-royalty_rate):royalty_rate;
					vat = sRoyaltyTy == "NA"?price*0.01:0;						// 로열티 경우 매출금액에 대한 비율 = 단가
					price = (rate*0.01) * cost;									// 로열티 아닌 경우 매출금액 - 비율금액 = 단가
							
					obj.setColumn(e.row, "UNIT_COST",		price);
					obj.setColumn(e.row, "VAT_PRICE", 		vat);
					//setPrice(price);
					this.fn_setPurchaseDetPrice(e.row, price);
				}
			} else {
				if(["QUANTITY", "UNIT_COST"].indexOf(e.columnid) != -1 )
				{
					var qty = nexacro.toNumber(obj.getColumn(e.row, "QUANTITY"));
					var cost = nexacro.toNumber(obj.getColumn(e.row, "UNIT_COST"));
					price = qty * cost;
					//setPrice(price);
					this.fn_setPurchaseDetPrice(e.row, price);
				}
			}
			
			
			break;
		case "S":
			if(["MEN_MONTH", "UNIT_COST", "EXPENSE"].indexOf(e.columnid) != -1 )
			{
				//trace("MEN_MONTH(MM) / UNIT_COST(매입단가) / EXPENSE(경비) 컬럼값 변경시 !!! ["+e.columnid+"]");
				
				var mm = nexacro.toNumber(obj.getColumn(e.row, "MEN_MONTH"));
				var cost = nexacro.toNumber(obj.getColumn(e.row, "UNIT_COST"));
				var exp = nexacro.toNumber(obj.getColumn(e.row, "EXPENSE"));
				price = mm * (cost+exp);

				//trace("MEN_MONTH(MM):["+mm+"]  *  ( UNIT_COST(매입단가):["+cost+"]  +  EXPENSE(경비):["+exp+"])  =  ["+price+"]");
				//setPrice(price);
				this.fn_setPurchaseDetPrice(e.row, price);
			}
			else if(["START_DATE", "END_DATE"].indexOf(e.columnid) != -1 )
			{
				//신규용계약일경우 용역매입상세 첫번째 시작일을 자동으로 계약일자로 셋팅한다.
				if(this.gfnIsEmpty(this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CONTRACT_NO_PURCHASE"))
					&& this.sContractType == "S"
					&& e.row == 0
				) 
				{
					this.dsPurchase.setColumn(0, "CONTRACT_DATE", obj.getColumn(e.row, "START_DATE"));
				}
				
				//trace("START_DATE(투입시작일) / END_DATE(투입종료일) 컬럼값 변경시 !!! ["+e.columnid+"]");
				
				var s_yyyyMMdd = obj.getColumn(e.row, "START_DATE");
 				var e_yyyyMMdd = obj.getColumn(e.row, "END_DATE");
				
				var mm = nexacro.ceil(this.gfnGetMenMonth(s_yyyyMMdd, e_yyyyMMdd), 2);
				var cost = nexacro.ceil(obj.getColumn(e.row, "UNIT_COST"), 2);
				var exp = nexacro.ceil(obj.getColumn(e.row, "EXPENSE"), 2);
				price = mm * (cost+exp);
				
				
				//trace(" (반올림) MEN_MONTH(MM):["+nexacro.ceil(mm, 2)+"]");
				//trace(" (원본-계산용) MEN_MONTH(MM):["+mm+"]");
				
				//trace(" MEN_MONTH(MM):["+mm+"]  *  ( UNIT_COST(매입단가):["+cost+"]  +  EXPENSE(경비):["+exp+"])  =  ["+price+"]");
				
				obj.setColumn(e.row, "MEN_MONTH", nexacro.ceil(mm, 2));
				//setPrice(price);				
				this.fn_setPurchaseDetPrice(e.row, nexacro.ceil(price));
			}else if(["EMP_NAME"].indexOf(e.columnid) != -1 ){
				this.setPayPlanDay();
				
// 				var mm = nexacro.toNumber(obj.getColumn(e.row, "MEN_MONTH"));
// 				var cost = nexacro.toNumber(obj.getColumn(e.row, "UNIT_COST"));
// 				var exp = nexacro.toNumber(obj.getColumn(e.row, "EXPENSE"));
// 				price = mm * (cost+exp);
// 
// 				//trace("MEN_MONTH(MM):["+mm+"]  *  ( UNIT_COST(매입단가):["+cost+"]  +  EXPENSE(경비):["+exp+"])  =  ["+price+"]");
// 				//setPrice(price);
// 				this.fn_setPurchaseDetPrice(e.row, price);
			}
			break;
		default:
			if(["QUANTITY", "UNIT_COST"].indexOf(e.columnid) != -1 )
			{
				var qty = nexacro.toNumber(obj.getColumn(e.row, "QUANTITY"));
				var cost = nexacro.toNumber(obj.getColumn(e.row, "UNIT_COST"));
				price = qty * cost;
				//setPrice(price);
				this.fn_setPurchaseDetPrice(e.row, price);
			}
	}
	
	if(e.columnid == "CONTRACT_PRICE")
	{
		 //setPrice(nexacro.ceil(nexacro.toNumber(e.newvalue) * 0.1));
		 this.fn_setPurchaseDetPrice(e.row, price);
		
		// obj.setColumn(e.row, "VAT_PRICE", nexacro.ceil(nexacro.toNumber(e.newvalue) * 0.1)	);
	}
};

this.dsPurchaseDet_onrowposchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSRowPosChangeEventInfo)
{
	this.fnFilterPurchasePay();
};

this.dsPurchasePay_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	if(e.columnid == "TAX_PRICE")
	{
		var vat = nexacro.ceil(nexacro.toNumber(e.newvalue) * 0.1);
		if(this.dsPurchase.getColumn(0, "CONTRACT_MAIN")=="A104" && this.sContractType=="S") {	//프리랜서일경우 vat 0원
			vat = 0;
		}
		else if (this.FV_CO_CD == "J02" &&  this.dsPurchaseDet.getColumn(this.dsPurchaseDet.rowposition, "ROYALTY_TYPE") != "NA") {
			vat = 0;
		}
		
		
		obj.setColumn(e.row, "VAT_PRICE", vat);
		
		//용역 지급내역합계가 매입계약금액에 자동 셋팅(지급내역 자동생성시에는 셋팅안한다. 필터가 풀려서 오류가 생김, 신규 생성시에는 자동셋팅해줌)
		if((!this.gfnIsEmpty(this.dsPurchasePay.filterstr) || this.gfnIsEmpty(this.dsPurchaseDet.getColumn(this.dsPurchaseDet.rowposition, this.sPurchaseDetKeyName)) )&& this.sContractType=="S")
		//if(this.sContractType=="S")
		{	
			//trace("TAX_PRICE sum ("+e.row+") : "+this.dsPurchasePay.getSum("TAX_PRICE") + " : "+this.dsPurchasePay.filterstr);
			this.dsPurchaseDet.set_enableevent(false);
			this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "CONTRACT_PRICE", this.dsPurchasePay.getSum("TAX_PRICE"));
			this.dsPurchaseDet.set_enableevent(true);
		}
	}
	else if(e.columnid == "PAY_PLAN_DATE")
	{
		var ds = this.dsPurchase;
		var row = ds.rowposition;
		var sLumpPayFlag  = ds.getColumn(row,"LUMP_PAY_FLAG");
		
		if(this.dsPurchaseDet.rowcount > 1 && sLumpPayFlag != "1") {
			var sMaxPayPlanDate = obj.getColumn(e.row, "MAX_PAY_PLAN_DATE");
			var sGroupFlag = obj.getColumn(e.row, "PPY_GROUP_FLAG");
		
			if(sGroupFlag == "Y" && !this.gfnIsEmpty(sMaxPayPlanDate) && e.newvalue.substring(0, 6) != sMaxPayPlanDate) {
				gfnAlert('msg.general',this.gfnGetTransTxt(32852, "해당 건은 이미 매입청구서에 발급된 건이 있습니다. 지급내역 '지급예정일'을 확인 부탁 드립니다."));
			}
		}
	}
};


this.dsPurchasePay_onrowsetchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSRowsetChangeEventInfo)
{
	if(e.reason == Dataset.REASON_APPEND)
	{
		obj.setColumn(e.row, "PAY_DATE"			, null);
		obj.setColumn(e.row, "PAY_FLAG"			, "0");
		obj.setColumn(e.row, "ISSUE_DATE"		, null);
		obj.setColumn(e.row, "CONTRACT_PRICE"	, "0");
		obj.setColumn(e.row, "VAT_PRICE"		, "0");
		obj.setColumn(e.row, "REMARKS"			, "");
	}
};

this.dsPurchase_user_onchanged = function(obj, e)
{
	var dsRtn = obj.getRecentVariant();
	var ds = this.dsPurchase;
	var row = ds.rowposition;
	
	if(e.columnId == "PROJECT_CODE")
	{
		if(!this.gfnIsEmpty(e.newCode))
		{
			ds.setColumn(row, "CL_CONTRACT_NO"		, dsRtn.getColumn(0,"CONTRACT_NO")		);
			ds.setColumn(row, "CL_CONTRACT_NAME"	, dsRtn.getColumn(0,"CONTRACT_NAME")	);
			ds.setColumn(row, "CL_SALES_EMP_NAME"	, dsRtn.getColumn(0,"BIZ_STAFF_NAME")	);
			ds.setColumn(row, "CLIENT_NAME"			, dsRtn.getColumn(0,"CLIENT_NAME")		);
			ds.setColumn(row, "CLIENT_CODE"			, dsRtn.getColumn(0,"CLIENT_CODE")		);
			ds.setColumn(row, "CONTRACT_NAME"		, dsRtn.getColumn(0,"CONTRACT_NAME")	);
		}else{
			ds.setColumn(row, "CL_CONTRACT_NO"		, ""	);
			ds.setColumn(row, "CL_CONTRACT_NAME"	, ""	);
			ds.setColumn(row, "CL_SALES_EMP_NAME"	, ""	);
			ds.setColumn(row, "CLIENT_NAME"			, ""	);
			ds.setColumn(row, "CLIENT_CODE"			, ""	);
		}
	}
	else if(e.columnId == "CL_CONTRACT_NO")
	{
		if(!this.gfnIsEmpty(e.newCode))
		{
			ds.setColumn(row, "PROJECT_CODE"		, dsRtn.getColumn(0,"PROJECT_CODE")		);
			ds.setColumn(row, "PROJECT_NAME"		, dsRtn.getColumn(0,"PROJECT_NAME")		);
			ds.setColumn(row, "CL_SALES_EMP_NAME"	, dsRtn.getColumn(0,"BIZ_STAFF_NAME")	);
			ds.setColumn(row, "CLIENT_NAME"			, dsRtn.getColumn(0,"CLIENT_NAME")		);
			ds.setColumn(row, "CLIENT_CODE"			, dsRtn.getColumn(0,"CLIENT_CODE")		);
			ds.setColumn(row, "CONTRACT_NAME"		, dsRtn.getColumn(0,"CONTRACT_NAME")	);
		}else{
			ds.setColumn(row, "CL_SALES_EMP_NAME"	, ""	);
		}
	}
	else if(e.columnId == "CLIENT_CODE")
	{
		if(!this.gfnIsEmpty(e.newCode))
		{
			ds.setColumn(row, "PROJECT_CODE"		, dsRtn.getColumn(0,"PROJECT_CODE")		);
			ds.setColumn(row, "PROJECT_NAME"		, dsRtn.getColumn(0,"PROJECT_NAME")		);
			ds.setColumn(row, "CL_SALES_EMP_NAME"	, dsRtn.getColumn(0,"BIZ_STAFF_NAME")	);
			ds.setColumn(row, "CL_CONTRACT_NO"		, dsRtn.getColumn(0,"CONTRACT_NO")		);
			ds.setColumn(row, "CL_CONTRACT_NAME"	, dsRtn.getColumn(0,"CONTRACT_NAME")	);
			ds.setColumn(row, "CLIENT_NAME"			, dsRtn.getColumn(0,"CLIENT_NAME")		);
			ds.setColumn(row, "CLIENT_CODE"			, dsRtn.getColumn(0,"CLIENT_CODE")		);
			ds.setColumn(row, "CONTRACT_NAME"		, dsRtn.getColumn(0,"CONTRACT_NAME")	);
		}else{
			ds.setColumn(row, "PROJECT_CODE"		, ""	);
			ds.setColumn(row, "PROJECT_NAME"		, ""	);
			ds.setColumn(row, "CL_SALES_EMP_NAME"	, ""	);
			ds.setColumn(row, "CL_CONTRACT_NO"		, ""	);
			ds.setColumn(row, "CL_CONTRACT_NAME"	, ""	);
		}
	}
	else if(e.columnId == "CONTRACT_MAIN")
	{
		var sContractMain = ds.getColumn(0, "CONTRACT_MAIN");
		var sTurnkeyFlag = dsRtn.getColumn(0,"TURNKEY_FLAG");
		ds.setColumn(row, "TURNKEY_FLAG", sTurnkeyFlag);
		
		if(this.gfnIsEmpty(sContractMain)) ds.setColumn(row, "PURCHASE_COMPANY_CODE", "");
		else ds.setColumn(row, "PURCHASE_COMPANY_CODE", dsRtn.getColumn(0,"PURCHASE_COMPANY_CODE"));
		
		if (dsRtn.getColumn(0,"COMPANY_CODE") == "WIN"){
			if(this.sContractType == "S")
			{
				this.div_Sales_List.form.chb_MainContractReport.set_value("1");
			}
		}
		
		this.setPayPlanDay();
		
// 		if(dsRtn.getColumn(0,"COMPANY_CODE") == "A104")
// 		{
// 			if(this.FV_CO_CD == 'W01')
// 				this.div_Sales_List.form.cmb_PayPlanDay.set_value(15);	//15일 : 프리랜서(투비윈은 15일 지급)
// 			else
// 				this.div_Sales_List.form.cmb_PayPlanDay.set_value(10);	//10일 : 프리랜서
// 		}else if (dsRtn.getColumn(0,"COMPANY_CODE") == "WIN"){
// 			this.div_Sales_List.form.cmb_PayPlanDay.set_value(10);  //10일 : 투비윈
// // 			if(this.sContractType == "S")
// // 			{
// // 				this.div_Sales_List.form.chb_MainContractReport.set_value("1");
// // 			}
// 		}else{
// 			this.div_Sales_List.form.cmb_PayPlanDay.set_value(25);  //25일 : 프리랜서 외
// 		}
	}
	this.fnSearchContractDet();
	this.fnSearchMContractDet();
}


/************************************************************************************************
* FORM 공통 FUNCTION 영역
************************************************************************************************/
this.fnInitForm = function()
{	
	/*1. 계약번호 파라미터 로컬 설정*/
	if(this.parent.hasOwnProperty("CONTRACT_NO_PURCHASE"))
	{
		this.sContractNoPurchase = this.parent.CONTRACT_NO_PURCHASE;
	}
	/*2. 계약구분 파라미터 로컬 설정*/
	if(this.parent.hasOwnProperty("CONTRACT_TYPE"))
	{
		this.sContractType = this.parent.CONTRACT_TYPE;
		
 		if(this.sContractType == "G")	/*상품일경우만 순매출 보임*/
 			this.div_Sales_List.form.chb_NetSales.set_visible(true);
 		else
 			this.div_Sales_List.form.chb_NetSales.set_visible(false);
	}
	
	/*계약정보가 있을경우 용역 매입기본정보 자동셋팅*/
	if(this.parent.hasOwnProperty("pvContractNo"))
	{
		this.sContractNo = this.parent.pvContractNo;
	}
	/*투입인력이 있을경우 용역매입내역 상세 자동셋팅*/
	if(this.parent.hasOwnProperty("pvProjectCode"))
	{
		this.sProjectCode = this.parent.pvProjectCode;
	}
	/*투입인력이 있을경우 용역매입내역 상세 자동셋팅*/
	if(this.parent.hasOwnProperty("pvEmpNo"))
	{
		this.sEmpNo = this.parent.pvEmpNo;
	}
	/*월단가가 있을경우 지급내역 자동셋팅*/
	if(this.parent.hasOwnProperty("pvUnitCost"))
	{
		this.sUnitCost = this.parent.pvUnitCost;
	}
	
	
	/*2. 계약구분에 따른 상세 테이블키 설정*/
	this.sPurchaseDetKeyName =  this.sContractType == "S" ? "PSD_SEQ" : "PPD_SEQ";
	
	/*3. 계약구분에 따른 선택가능 제품 설정
	  - 기본값 : 계약구분
	  - 판매수수료->제품	
	*/
	/*4. 계약구분에 따른 선택가능 제품 설정
	  - 기본값 : 계약구분
	  - 총판수수료->제품	
	*/
	//this.sPtype = this.sContractType == "C" ? "P" : this.sContractType;	
	if(this.sContractType == "C" || this.sContractType == "D") this.sPtype = "P";
	else this.sPtype = this.sContractType;
	
	/*5. 계약구분에 따른 선택가능 연관제품 설정
	  - 기본값 : 제품
	  - 유지보수->MA_FLAG == "1"
	*/
	//this.sPRtype = this.sContractType == "M" ? "G" : "P";
	this.sPRtype = "P";
	
	/*6. 계약구분에 따른 프로젝트, 고객사, 매출계약 필터값 설정*/	
	//var paramAdd = ",contracttype:" + this.sContractType;
	var paramAdd = ",contracttype:" + this.sPtype;
	//OEM일경우 계약구분을 전달하지 않는다. (매출검색이 안됨)
	if(this.sPtype=="O")
		paramAdd = "";
	this.div_Sales_List.form.div_Project.param	= this.div_Sales_List.form.div_Project.param + paramAdd;
	this.div_Sales_List.form.div_Client.param	= this.div_Sales_List.form.div_Client.param + paramAdd;
	this.div_Sales_List.form.div_Contract.param	= this.div_Sales_List.form.div_Contract.param + paramAdd;
	
	
	/*7. 계약구분에 따른 화면 레이아웃 조정*/
	if(this.sContractType != "C" && this.sContractType != "D" && this.sContractType != "P")
	{
		//제품단위 : 직접입력:900  -> 직접입력은 판매수수료에서만 사용
		this.ds_CD_PRODUCT_UNIT.filter("CODE != '900'");
	}
	
	if(this.sContractType!="M")
	{
		this.div_List.set_visible(false);
		this.div_Sales_List.set_left(4);
		this.div_PurchaseDet.set_left(4);
		this.div_ProdContract.set_left(4);
	}
	if(this.sContractType!="S")
		this.div_ProdContract.form.tab_ContractDet.removeTabpage(1);
		
	switch(this.sContractType)
	{
		case "C" : 			
			var pForm = this.div_PurchaseDet.form;
			this.st_Title.set_text( this.gfnGetTransTxt(1922, "판매수수료 매입계약 정보등록") );
			pForm.stc_GbSalesText.set_text( this.gfnGetTransTxt(1923, "판매수수료") );
			pForm.grd_GbSales.set_formatid("CONTRACT_TYPE_C");
			this.btn_ProductPurchaseOrder.set_text( this.gfnGetTransTxt(1924, "판매수수료계약서") );			
			this.chb_SalesDeliveryDateChangeFlag.set_visible(false);
			break;
			
		case "M" : 
			var pForm = this.div_PurchaseDet.form;
			this.st_Title.set_text( this.gfnGetTransTxt(1925, "유지보수 매입계약 정보등록") );
			pForm.stc_GbSalesText.set_text( this.gfnGetTransTxt(46, "유지보수") );
			pForm.grd_GbSales.set_formatid("CONTRACT_TYPE_M");			
			this.btn_ProductPurchaseOrder.set_text( this.gfnGetTransTxt(1926, "유지보수계약서") );			
			
			this.div_PurchaseDet.set_width(682);
			this.div_PurchasePay.form.grd_GbProvideList.set_formatid("CONTRACT_TYPE_M");
			
			this.div_ProdContract.set_width(682);
			this.div_ProdContractM.set_visible(true);
			
			this.div_Sales_List.form.div_ContractPeriod.set_visible(true);
			this.div_Sales_List.form.div_Remarks.set_top(123);
			this.div_Sales_List.form.div_Remarks.set_height(52);
			
			this.div_ProdContract.form.grd_GbProductContractDetail.set_formatid("CONTRACT_TYPE_M");
			this.chb_SalesDeliveryDateChangeFlag.set_visible(false);
			this.div_Sales_List.form.stc_ContractAddType.set_visible(true);		//계약추가
			this.div_Sales_List.form.cmb_ContractAddType.set_visible(true);
			this.btn_PurchaseEarlyTermination.set_visible(true);
			this.div_Sales_List.form.stc_ContractDocNoPre.set_visible(true);	//이전계약서번호
			this.div_Sales_List.form.edt_ContractDocNoPre.set_visible(true);
			this.div_Sales_List.form.btn_Popup.set_visible(true);
			
			this.btn_CopyCancel.set_visible(true); // 계약복사취소
			break;
			
		case "S" : 
			this.div_Sales_List.form.stc_ContractDocNoPre.set_visible(true);	//이전계약서번호
			this.div_Sales_List.form.edt_ContractDocNoPre.set_visible(true);
			this.div_Sales_List.form.btn_Popup.set_visible(true);
			this.div_Sales_List.form.stc_ContractAddType.set_visible(true);		//계약추가
			this.div_Sales_List.form.cmb_ContractAddType.set_visible(true);
			this.div_Sales_List.form.stc_PayPlanDay.set_visible(true);			//지급예정일
			this.div_Sales_List.form.cmb_PayPlanDay.set_visible(true);
			this.div_PurchasePay.form.rdo_BaseMM.set_visible(true);
			
			var pForm = this.div_PurchaseDet.form;
			this.st_Title.set_text( this.gfnGetTransTxt(1927, "용역 매입계약 정보등록") );
			pForm.stc_GbSalesText.set_text( this.gfnGetTransTxt(17, "용역") );
			pForm.grd_GbSales.set_formatid("CONTRACT_TYPE_S");
			this.btn_ProductPurchaseOrder.set_text( this.gfnGetTransTxt(1928, "매입계약서") );
			
			this.div_PurchaseDet.set_width(863);
			this.div_PurchasePay.form.grd_GbProvideList.set_formatid("CONTRACT_TYPE_S");
			
			this.div_ProdContract.form.grd_GbProductContractDetail.set_formatid("CONTRACT_TYPE_S");
			this.btn_PurchaseEarlyTermination.set_visible(true);
			this.chb_SalesDeliveryDateChangeFlag.set_visible(false);
			
			this.div_Sales_List.form.edt_PurchaseContractName.set_width(271);
			this.div_Sales_List.form.chb_MainContractReport.set_value("0");
			this.div_Sales_List.form.chb_MainContractReport.set_visible(true);
			break;
		case "E" : 
			var pForm = this.div_PurchaseDet.form;
			this.st_Title.set_text( this.gfnGetTransTxt(1929, "기타 매입계약 정보등록") );
			pForm.stc_GbSalesText.set_text(this.gfnGetTransTxt(406, "기타") );
			break;
			
		case "O" : 
			this.st_Title.set_text( this.gfnGetTransTxt(1930, "OEM 매입계약 정보등록") );
			this.div_Sales_List.form.div_ContractPeriod.set_visible(true);
			this.div_Sales_List.form.div_Remarks.set_top(123);
			this.div_Sales_List.form.div_Remarks.set_height(52);
			break;
		
		case "D" : 			
			var pForm = this.div_PurchaseDet.form;
			this.st_Title.set_text( this.gfnGetTransTxt(1931, "총판수수료 매입계약 정보등록") );
			pForm.stc_GbSalesText.set_text( this.gfnGetTransTxt(1932, "총판수수료") );
			pForm.grd_GbSales.set_formatid("CONTRACT_TYPE_D");
			this.btn_ProductPurchaseOrder.set_text( this.gfnGetTransTxt(1933, "총판수수료 계약서") );			
			this.chb_SalesDeliveryDateChangeFlag.set_visible(false);
			break;
		case "P" : 			
			var pForm = this.div_PurchaseDet.form;
			this.st_Title.set_text( this.gfnGetTransTxt(22582, "제품 매입계약 정보등록") );
			pForm.stc_GbSalesText.set_text( this.gfnGetTransTxt(62, "총판수수료") );
			pForm.grd_GbSales.set_formatid("CONTRACT_TYPE_P");
			this.btn_ProductPurchaseOrder.set_text( this.gfnGetTransTxt(22583, "제품 계약서") );			
			this.chb_SalesDeliveryDateChangeFlag.set_visible(false);
			break;
		default : 
		break;
	}
	
	
	if (this.FV_CO_CD != "J02") {
		var sFormatId = this.div_PurchaseDet.form.grd_GbSales.formatid;
		var nColidx	= -1;
		if (sFormatId == "CONTRACT_TYPE_ALL") {
			nColidx = 8;
		} else if (sFormatId == "CONTRACT_TYPE_C") {
			nColidx = 5;
		} else if (sFormatId == "CONTRACT_TYPE_M") {
			nColidx = 5;
		} else if (sFormatId == "CONTRACT_TYPE_D") {
			nColidx = 5;
		} else if (sFormatId == "CONTRACT_TYPE_P") {
			nColidx = 5;
		}
		
		if (nColidx>0) {
			this.div_PurchaseDet.form.grd_GbSales.deleteContentsCol("body", nColidx);
		}
	}
	
	
	this.bSave = this.btn_Save.enable;
	this.bSaveClose = this.btn_SaveClose.enable;
	this.bDelete = this.btn_Delete.enable;
	this.bCopyCancel = this.btn_CopyCancel.enable;
	
	this.fnGetCode();
}

this.fnPopupCallBack = function (popupId, popupArg)
{
	popupArg = this.commUtil.popupReturn();
	
	switch(popupId)
	{
		case "popupProductSearch_PRODUCT_NAME" :
			if(!this.gfnIsEmpty(popupArg))
			{
				var ds = new nexacro.Dataset();
					ds.loadXML(popupArg);
					
				this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "PRODUCT_CODE", ds.getColumn(0, "PRODUCT_CODE"));
				this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "PRODUCT_NAME", ds.getColumn(0, "PRODUCT_NAME"));
				if(this.FV_CO_CD == 'J02') {
					this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "ROYALTY_TYPE", ds.getColumn(0, "ROYALTY_TYPE"));
				}
				
				if(this.sContractType == "M")
				{
					this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "RELATED_PRODUCT_CODE", ds.getColumn(0, "RELATED_PRODUCT_CODE"));
					this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "RELATED_PRODUCT_NAME", ds.getColumn(0, "RELATED_PRODUCT_NAME"));
					if(this.FV_CO_CD == 'J02') {
						this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "ROYALTY_TYPE", 		ds.getColumn(0, "ROYALTY_TYPE"));
					}
				}
				else if(this.sContractType == "G")
				{
					// 연관제품 처리
					this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "RELATED_PRODUCT_CODE", ds.getColumn(0, "RELATED_PRODUCT_CODE"));
					this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "RELATED_PRODUCT_NAME", ds.getColumn(0, "RELATED_PRODUCT_NAME"));
					if(this.FV_CO_CD == 'J02') {
						this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "ROYALTY_TYPE",	 	ds.getColumn(0, "ROYALTY_TYPE"));
					}
				}
			}				
			break;
			
		case "popupProductSearch_RELATED_PRODUCT_NAME" :
			if(!this.gfnIsEmpty(popupArg))
			{
				var ds = new nexacro.Dataset();
					ds.loadXML(popupArg);
				
				if(this.sContractType == "M")
				{
					this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "RELATED_PRODUCT_CODE"	, ds.getColumn(0, "RELATED_PRODUCT_CODE"));
					this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "RELATED_PRODUCT_NAME"	, ds.getColumn(0, "RELATED_PRODUCT_NAME"));
					this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "PRODUCT_CODE"			, ds.getColumn(0, "PRODUCT_CODE"));
					this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "PRODUCT_NAME"			, ds.getColumn(0, "PRODUCT_NAME"));
					if(this.FV_CO_CD == 'J02') {
						this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "ROYALTY_TYPE",	 	ds.getColumn(0, "ROYALTY_TYPE")); //ds.getColumn(0, "RELATED_ROYALTY"));
					}
					
				}else{
					this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "RELATED_PRODUCT_CODE", ds.getColumn(0, "PRODUCT_CODE"));
					this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "RELATED_PRODUCT_NAME", ds.getColumn(0, "PRODUCT_NAME"));
					if(this.FV_CO_CD == 'J02') {
						this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "ROYALTY_TYPE",	 	ds.getColumn(0, "ROYALTY_TYPE")); //ds.getColumn(0, "RELATED_ROYALTY"));
					}
				}				
			}
			break;
		case "popupFindSiEmp" :
			if(!this.gfnIsEmpty(popupArg))
			{
				var ds = new nexacro.Dataset();
					ds.loadXML(popupArg);
				
				/*데이터 바인딩 순서 중요함 COMPANY_CODE -> EMP_NAME 바인딩 해줘야 함 */
				this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "COMPANY_CODE"	, ds.getColumn(0, "CO_CD"));
				this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "EMP_NO"	, ds.getColumn(0, "EMP_NO"));
				this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "EMP_NAME"	, ds.getColumn(0, "EMP_NAME"));
				this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "TURNKEY_NAME"	, ds.getColumn(0, "EMP_NAME"));
				this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "CO_NAME"	, ds.getColumn(0, "COMPANY_NAME"));
				this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "LEVEL_CODE"	, ds.getColumn(0, "LEVEL_CODE"));
			}
			
			break;
// 		case "popupProductReport" :
// 			if(popupArg == "save")
// 			{
// 				this.fnSave();
// 			}
// 			break;
			
		//popupCallback -> popup창 때문에 위의 코드 주석처리.
		case "popupPurchaseRegPopup" : 
			if(!this.gfnIsEmpty(popupArg))
			{
				if(this.confirm(this.gfnGetTransTxt(1719, "조기종료 변경내역을 비고에 적용하시겠습니까")))
				{
					var strRemarks = this.dsPurchase.getColumn(this.dsPurchase.rowposition, "REMARKS");
					this.dsPurchase.setColumn(this.dsPurchase.rowposition, "REMARKS", (this.gfnIsEmpty(strRemarks)?"":(strRemarks+"\n"))+popupArg);
					this.dsPurchase.setColumn(this.dsPurchase.rowposition, "CONTRACT_ADD_TYPE", "3");
					this.fnSave();
				}
			}
			break;		
		case "popupProductReportPopUp" : 
			if(popupArg == "save")
			{
				this.gfnAlert('msg.general',this.gfnGetTransTxt(1395, "저장완료"));
				this.fnSave();
			}
			//유지보수레포트에서 비고 저장후 재조회
			else if(popupArg == "UpdatePurchaseDetRemarks")
			{
				this.fnSearch();
			}
			else
			{
				//gfnAlert('msg.general',"Test 종료완료.");
			}
			break;
		case "popupPurchaseSearch":			// 이전계약서번호
			var ds = new nexacro.Dataset();
			ds.loadXML(popupArg);
			this.recentVariant = ds;
			
			if(this.dsPurchase.getColumn(0, "CONTRACT_NO_PURCHASE") == ds.getColumn(0, "CONTRACT_NO_PURCHASE"))
			{
				this.gfnAlert('msg.general',this.gfnGetTransTxt(1396, "저장완료"));
			}
			else 
			{
				this.dsPurchase.setColumn(0, "CONTRACT_NO_PURCHASE_PRE"	, ds.getColumn(0, "CONTRACT_NO_PURCHASE"));
				this.dsPurchase.setColumn(0, "CONTRACT_DOC_NO_PRE"		, ds.getColumn(0, "CONTRACT_DOC_NO"));
			}
		break;
		
		case "popupContractSearch" :
			if(this.gfnIsEmpty(popupArg))
				return;
				
			var ds = new nexacro.Dataset();
			ds.loadXML(popupArg);
			this.recentVariant = ds;

			var sContractNo = ds.getColumn(0, "CONTRACT_NO");
			var sContractType = ds.getColumn(0, "CONTRACT_TYPE");
			var sContractMain = ds.getColumn(0, "CONTRACT_MAIN");
			var sContractMainName = ds.getColumn(0, "CONTRACT_MAIN_NAME");
			var nFindRow = this.dsProdContractM.findRow("CONTRACT_NO", sContractNo);
			if (nFindRow>=0) {
				this.gfnAlert('msg.general',this.gfnGetTransTxt(1306, "해당 계약을 중복 등록 할수 없습니다."));
				return;
			}
			else if (sContractType != "P" && sContractType != "G") {
				this.gfnAlert('msg.general',this.gfnGetTransTxt(1307, "제품(상품)계약만 연결가능합니다."));
				return;
			} else {
				var sContractNoPurchse = this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CONTRACT_NO_PURCHASE");
				this.dsProdContractM.set_enableevent(false);
				var nRow = this.dsProdContractM.addRow();
				this.dsProdContractM.setColumn(nRow, "CONTRACT_NO_PURCHASE", sContractNoPurchse);				
				this.dsProdContractM.setColumn(nRow, "CLIENT_CODE",		ds.getColumn(0, "CLIENT_CODE"));
				this.dsProdContractM.setColumn(nRow, "CLIENT_NAME",		ds.getColumn(0, "CLIENT_NAME"));
				this.dsProdContractM.setColumn(nRow, "PROJECT_CODE",	ds.getColumn(0, "PROJECT_CODE"));
				this.dsProdContractM.setColumn(nRow, "PROJECT_NAME",	ds.getColumn(0, "PROJECT_NAME"));
				this.dsProdContractM.setColumn(nRow, "CONTRACT_NO",		ds.getColumn(0, "CONTRACT_NO"));
				this.dsProdContractM.setColumn(nRow, "CONTRACT_NAME",	ds.getColumn(0, "CONTRACT_NAME"));
				this.dsProdContractM.setColumn(nRow, "PRODUCT_NAME",	ds.getColumn(0, "PRODUCT_NAME"));
			
				this.dsProdContractM.set_enableevent(true);
			}
		break;	
		
		case "popupPurchaseDetBill" :
			if(popupArg != "close") {
				var ds = new nexacro.Dataset();
				ds.loadXML(popupArg);
				this.recentVariant = ds;
				
				this.dsBillPurchaseDet.copyData(ds);
				
				for(var i = 0; i < ds.rowcount; i++) {
					var sPpySeq = ds.getColumn(i, "PPY_SEQ");
					var sTaxPrice = ds.getColumn(i, "TAX_PRICE");
					var sPsdSeq = ds.getColumn(i, "PSD_SEQ");
					var sPpdSeq = ds.getColumn(i, "PPD_SEQ");
					var sPayPlanDate = ds.getColumn(i, "PAY_PLAN_DATE");
					
					var nRow = this.dsBillPurchasePay.addRow();
					this.dsBillPurchasePay.setColumn(nRow, "PPY_SEQ", sPpySeq);
					this.dsBillPurchasePay.setColumn(nRow, "TAX_PRICE", sTaxPrice);
					this.dsBillPurchasePay.setColumn(nRow, "PSD_SEQ", sPsdSeq);
					this.dsBillPurchasePay.setColumn(nRow, "PPD_SEQ", sPpdSeq);
					this.dsBillPurchasePay.setColumn(nRow, "PAY_PLAN_DATE", sPayPlanDate);
				}
				
				this.fnBillPurchasePopup("0", true);
			} 
		break;
		
		case "popupPurchaseBill" :
			if(this.sContractType == "M")
				this.fnSearchList();
			else
				this.fnSearch();
		break;
		default:
	}
}

this.fnFilterPurchasePay = function()
{
	if(this.dsPurchase.getColumn(this.dsPurchase.rowposition, "LUMP_PAY_FLAG") != "1")
	{
		if(this.dsPurchase.getRowType(0) != 2)
		{
			
			if(this.gfnIsEmpty(this.dsPurchaseDet.getColumn(this.dsPurchaseDet.rowposition, this.sPurchaseDetKeyName)))
				this.dsPurchasePay.filter(this.sPurchaseDetKeyName + " == undefined");
			else
				this.dsPurchasePay.filter(this.sPurchaseDetKeyName + " == '" + this.dsPurchaseDet.getColumn(this.dsPurchaseDet.rowposition, this.sPurchaseDetKeyName) + "'");
		}else{
			this.dsPurchasePay.filter("");
		}
	}else{
		this.dsPurchasePay.filter("");
	}
}

this.isUpdated = function()
{
	return this.gfnIsUpdateDs(this.dsPurchase) || this.gfnIsUpdateDs(this.dsPurchaseDet) || this.gfnIsUpdateDs(this.dsPurchasePay);
}

/************************************************************************************************
* TRANSACTION 및 추가 FUNCTION 영역
************************************************************************************************/
this.fnGetCode = function()
{
	this.gfnAddCodeDataset("ds_CD_PURCHASE_TYPE"	, "PURCHASE_TYPE");
	this.gfnAddCodeDataset("ds_CD_PAY_TERM"			, "PAY_TERM");
	this.gfnAddCodeDataset("ds_CD_PAY_METHOD"		, "PAY_METHOD");
	this.gfnAddCodeDataset("ds_CD_PRODUCT_UNIT"		, "PRODUCT_UNIT");
	this.gfnAddCodeDataset("ds_CD_CONTRACT_TYPE"	, "CONTRACT_TYPE");
	this.gfnAddCodeDataset("ds_CD_CONTRACT_ADD_TYPE", "CONTRACT_ADD_TYPE");
	this.gfnAddCodeDataset("ds_CD_ROYALTY_TYPE"		, "ROYALTY_TYPE");
	
	if(this.sContractType == "ZS")
	{		
		this.gfnAddCodeDataset("ds_CD_LEVEL_CODE"			, "LEVEL_CODE");		
	}
	
	this.gfnCodeTransaction();
}

this.fnSearchList = function()
{	
	if(this.sContractType == "SM")
	{
		this.gfnAddSendParameter("CONTRACT_NO_PURCHASE", this.sContractNoPurchase);
// 		this.gfnAddOutputDataset("dsList", "dsOutput");
// 		this.gfnCommonTransaction("SelectPurchaseList", "SP_PurchaseList_S03");
		
		this.gfnSetMap("projectMapper", ['SP_PurchaseList_S03'], ['dsList']);
		this.gfnCommonTransaction("SelectPurchaseList", "selectNextMultiList.do");		
	}
}

this.fnSearch = function()
{	
	this.gfnAddSendParameter("CONTRACT_NO_PURCHASE", this.sContractNoPurchase);
	/*this.gfnAddOutputDataset("dsPurchase", "dsOutput");*/
	
	if(this.sContractType == "ZS")
	{
		this.gfnSetMap("projectMapper", ['SP_PurchaseSi_S01'], ['dsPurchase']);
		this.gfnCommonTransaction("SelectPurchase", "selectNextMultiList.do");		
		/*this.gfnCommonTransaction("SelectPurchase", "SP_PurchaseSi_S01");*/
	}else{
		this.gfnSetMap("projectMapper", ['SP_PurchaseProduct_S01'], ['dsPurchase']);
		this.gfnCommonTransaction("SelectPurchase", "selectNextMultiList.do");	
		/*this.gfnCommonTransaction("SelectPurchase", "SP_PurchaseProduct_S01");*/
	}
}

this.fnSearchDet = function()
{
	this.gfnAddSendParameter("CONTRACT_NO_PURCHASE", this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CONTRACT_NO_PURCHASE"));
	/*this.gfnAddOutputDataset("dsPurchaseDet", "dsOutput");*/

	if(this.sContractType == "ZS")
	{
		this.gfnSetMap("projectMapper", ['SP_PurchaseSiDet_S01'], ['dsPurchaseDet']);
		this.gfnCommonTransaction("SelectPurchaseDet", "selectNextMultiList.do");		
		/*this.gfnCommonTransaction("SelectPurchaseDet", "SP_PurchaseSiDet_S01");*/
	}else{
		/*this.gfnCommonTransaction("SelectPurchaseDet", "SP_PurchaseProductDet_S01");*/
		this.gfnSetMap("projectMapper", ['SP_PurchaseProductDet_S01'], ['dsPurchaseDet']);
		this.gfnCommonTransaction("SelectPurchaseDet", "selectNextMultiList.do");		
	}
}

this.fnSearchPay = function()
{	
	this.gfnAddSendParameter("CONTRACT_NO_PURCHASE", this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CONTRACT_NO_PURCHASE"));
// 	this.gfnAddOutputDataset("dsPurchasePay", "dsOutput");
// 	this.gfnCommonTransaction("SelectPurchasePay", "SP_PurchasePay_S01");
	this.gfnSetMap("projectMapper", ['SP_PurchasePay_S01'], ['dsPurchasePay']);
	this.gfnCommonTransaction("SelectPurchasePay", "selectNextMultiList.do");			
}

this.fnSearchContractDet = function()
{	
	this.gfnAddSendParameter("CONTRACT_NO", this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CL_CONTRACT_NO"));
	this.gfnAddSendParameter("CONTRACT_MAIN", this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CONTRACT_MAIN"));
	this.gfnAddSendParameter("CONTRACT_NO_PURCHASE", this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CONTRACT_NO_PURCHASE"));
/*	this.gfnAddOutputDataset("dsProdContract", "dsOutput");
*/	
	if(this.sContractType == "M")
	{
/*		this.gfnCommonTransaction("SelectContractDetM", "SP_PurchaseProduct_S05");*/
		this.gfnSetMap("projectMapper", ['SP_PurchaseProduct_S05'], ['dsProdContract']);
		this.gfnCommonTransaction("SelectContractDetM", "selectNextMultiList.do");				
	}
	else if(this.sContractType == "S")
	{
// 		this.gfnAddOutputDataset("dsProdContractTotal", "dsOutput1");
// 		this.gfnCommonTransaction("SelectContractDet", "SP_PurchaseSi_S02");	//SP_PurchaseSi_S03
		
		this.gfnSetMap("projectMapper", ['SP_PurchaseSi_S02_1','SP_PurchaseSi_S02_3'], ['dsProdContract','dsProdContractTotal']);
		this.gfnCommonTransaction("SelectContractDet", "selectNextMultiList.do");			
	}
	else
	{
		/*this.gfnCommonTransaction("SelectContractDet", "SP_PurchaseProduct_S02");*/
		this.gfnSetMap("projectMapper", ['SP_PurchaseProduct_S02'], ['dsProdContract']);
		this.gfnCommonTransaction("SelectContractDet", "selectNextMultiList.do");			
	}	
}

this.fnSearchMContractDet = function()
{	
	if(this.sContractType == "M")
	{		
		if(this.gfnIsEmpty(this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CONTRACT_NO_PURCHASE")))
			return;
		
		this.gfnAddSendParameter("CONTRACT_NO_PURCHASE", this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CONTRACT_NO_PURCHASE"));
		this.gfnAddSendParameter("CONTRACT_NO", this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CL_CONTRACT_NO"));
		this.gfnAddSendParameter("CONTRACT_MAIN", this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CONTRACT_MAIN"));
// 		this.gfnAddOutputDataset("dsProdContractM", "dsOutput");
// 		this.gfnCommonTransaction("SelectMContractDet", "SP_PurchaseProduct_S04");
		
		this.gfnSetMap("projectMapper", ['SP_PurchaseProduct_S04'], ['dsProdContractM']);
		this.gfnCommonTransaction("SelectMContractDet", "SP_PurchaseProduct_S04.do");			
	}	
}

this.fnSearchNewDocNo = function()
{	
	this.dsNewDocNo.clearData();
	this.dsNewDocNo.addRow();
	this.dsNewDocNo.setColumn(0, "CONTRACT_NO_PURCHASE", this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CONTRACT_NO_PURCHASE"));
	
	this.gfnAddInputDataset("dsNewDocNo", "dsInput");
// 	this.gfnAddOutputDataset("dsNewDocNo", "dsOutput");
// 	this.gfnCommonTransaction("SelectNewDocNo", "SP_PurchaseProduct_S03", null, false);
	
	this.gfnSetMap("projectMapper", ['SP_PurchaseProduct_S03'], ['dsNewDocNo']);
	this.gfnCommonTransaction("SelectNewDocNo", "SP_PurchaseProduct_S03.do", null, false);		
}

this.fnSave = function(sAddSvcId)
{	
	if(sAddSvcId == "Delete" || this.fnCanSave())
	{
		//유지보수내역 시작일,종료일 계약상세의 시작일 종료일로 셋팅
		if(this.sContractType == "M")
		{
			this.dsPurchase.setColumn(this.dsPurchase.rowposition, "START_DATE", this.dsPurchaseDet.getMin("START_DATE"));
			this.dsPurchase.setColumn(this.dsPurchase.rowposition, "END_DATE", this.dsPurchaseDet.getMax("END_DATE"));
		}
	
		this.gfnAddSendParameter("CONTRACT_TYPE", this.dsPurchase.getColumn(0, "CONTRACT_TYPE"));
		this.gfnAddSendParameter("CONTRACT_DATE", this.dsPurchase.getColumn(0, "CONTRACT_DATE"));
		
		this.gfnAddInputDataset("dsPurchase", "dsPurchase", "A");
		this.gfnAddInputDataset("dsPurchaseDet", "dsPurchaseDet");
		this.gfnAddInputDataset("dsPurchasePay", "dsPurchasePay");
		this.gfnAddInputDataset("dsProdContractM", "dsProdContractM");	/*ubi4 버그 우회 처리용 코드 : ingyu 20181119*/
		this.gfnAddInputDataset("dsProdContract", "dsSiContractDet");
		this.gfnAddInputDataset("dsProdContractTotal", "dsProdContractTotal");
/*		this.gfnAddOutputDataset("dsNewKey", "dsNewKey");*/
		
		if(this.dsPurchase.getColumn(0, "CONTRACT_STATUS") != "3" && sAddSvcId != "Delete")
		{
			if( this.confirm(this.gfnGetTransTxt(1720, "매입계약을 확정하시겠습니까?")) )
			{
				this.dsPurchase.setColumn(0, "CONTRACT_STATUS", "3");
			}
		}
		
		var sSvcId = "SavePurchase";
		if(!this.gfnIsEmpty(sAddSvcId))
		{
			sSvcId += sAddSvcId;
		}
		if(this.sContractType == "ZS")
		{
/*			this.gfnCommonTransaction(sSvcId, "SP_PurchaseS_R01", null, false);*/

			this.gfnSetMap("projectMapper", ['saveSP_PurchaseS_R01'], ['dsNewKey']);
			this.gfnCommonTransaction(sSvcId, "saveSP_PurchaseS_R01.do", null, false);		
		}else{
			/*this.gfnCommonTransaction(sSvcId, "SP_PurchaseP_R01", null, false);*/
			
			this.gfnSetMap("projectMapper", ['saveSP_PurchaseP_R01'], ['dsNewKey']);
			this.gfnCommonTransaction(sSvcId, "saveSP_PurchaseP_R01.do", null, false);				
		}		
	}	
}

this.fnPurchaseCopy = function()
{	
	// procedure
// 	this.sContractNoPurchase = this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_NO_PURCHASE");
// 	this.gfnAddSendParameter("CONTRACT_NO_PURCHASE", this.sContractNoPurchase);
// 	this.gfnAddOutputDataset("dsNewKey", "dsNewKey");
// 	this.gfnCommonTransaction("PurchaseCopy", "SP_PurchaseCopy_R01", null, false);
}

this.fnPurchaseCopyCancel = function()
{	
// 	this.sContractNoPurchase = this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_NO_PURCHASE");
// 	var sContractNoPurchasePre = this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CONTRACT_NO_PURCHASE_PRE");
// 	this.gfnAddSendParameter("CONTRACT_NO_PURCHASE", this.sContractNoPurchase);
// 	this.gfnAddSendParameter("CONTRACT_NO_PURCHASE_PRE", sContractNoPurchasePre);
// 	this.gfnAddOutputDataset("dsNewKey", "dsNewKey");
// 	this.gfnCommonTransaction("PurchaseCopyCancel", "SP_PurchaseCopyCancel_R01", null, false);
}

this.fnCanSave = function()
{
	/*Save 가능여부 확인*/
	/*1. 컬럼별 체크 옵션 설정구조 리턴함수 선언*/
	var getCheckCond = function(col, checkRowTypeOnly, checkRowTypeNotOnly, contractTypeOnly, contractTypeNotOnly, msg, comp)
	{
		return {
					col:col										//체크할 컬럼
					,checkRowTypeOnly:col						//체크할 로우의 타입
					,checkRowTypeNotOnly:checkRowTypeNotOnly	//체크 제외할 로우의 타입
					,contractTypeOnly:contractTypeOnly			//입력된 계약구분만 체크
					,contractTypeNotOnly:contractTypeNotOnly	//입력된 계약구분만 체크 제외
					,msg:msg									//체크 실패 시 출력 메세지
					,comp:comp									//체크 실패 시 포커스 받을 컴포넌트
				};
	}
	/*2. 체크 함수 선언*/
	/*2.1 값이 비었을 경우 체크 함수*/
	var checkIsEmpty = function(ds, row, col, isGrid, comp, msg)
	{
		if( nexacro._isNull( ds.getColumn(r, col) ) ||  ds.getColumn(r, col).length == 0)
		{
			ds.set_rowposition(r);
			if(isGrid)
			{
				comp.setCellPos( comp.getBindCellIndex("body", col) );
			}
			comp.setFocus();
			this.gfnAlert('msg.general',msg);
			return false;
		}
		return true;
	}
	//getCheckCond(col, checkRowTypeOnly, checkRowTypeNotOnly, contractTypeOnly, contractTypeNotOnly, msg, comp)
	/*3. Dataset별 옵션 설정*/
	/*3.1 매입계약 정보 설정*/
	if(this.dsPurchase.getRowCount() < 1)
	{
		this.gfnAlert('msg.general',this.gfnGetTransTxt(1397, "등록할 매입계약이 없습니다."));
		return false;
	}
	if(this.dsPurchaseDet.getRowCount() < 1)
	{
		this.gfnAlert('msg.general',this.gfnGetTransTxt(1398, "매입계약상세를 등록하십시오."));
		return false;
	}
	var arrNessColPurchase 	  = {
									 isGrid:false
									,grid:null
									,ds:this.dsPurchase
									,conds:[
												 /*Any*/
												 getCheckCond("PROJECT_CODE"	, ""	, ""	, ""		, ""		, this.gfnGetTransTxt(1596, "프로젝트를 선택하십시오."), this.div_Sales_List.form.div_Project)
												,getCheckCond("CL_CONTRACT_NO"	, ""	, ""	, ""		, ""		, this.gfnGetTransTxt(1597, "매출계약을 선택하십시오."), this.div_Sales_List.form.div_Contract)
												,getCheckCond("CONTRACT_NAME"	, ""	, ""	, ""		, ""		, this.gfnGetTransTxt(1598, "매입계약명을 입력하십시오."), this.div_Sales_List.form.edt_PurchaseContractName	)
												,getCheckCond("CONTRACT_MAIN"	, ""	, ""	, ""		, ""		, this.gfnGetTransTxt(1599, "매입계약처를 선택하십시오."), this.div_Sales_List.form.div_PurchaseCompany)
												,getCheckCond("CONTRACT_DATE"	, ""	, ""	, ""		, ""		, this.gfnGetTransTxt(1600, "계약일을 입력하십시오."), this.div_Sales_List.form.cal_ContractDate)
												
												/*Only : 유지보수, OEM*/
												,getCheckCond("START_DATE"		, ""	, ""	, ["M","O"]	, ""		, this.gfnGetTransTxt(1601, "계약기간을 입력하십시오.(시작일)"), this.div_Sales_List.form.div_ContractPeriod.form.cal_ContractPeriodStartDate	)
												,getCheckCond("END_DATE"		, ""	, ""	, ["M","O"]	, ""		, this.gfnGetTransTxt(1602, "계약기간을 입력하십시오.(종료일)"), this.div_Sales_List.form.div_ContractPeriod.form.cal_ContractPeriodEndDate	)
											]
								};
	/*3.2 매입계약상세 정보 설정*/
	var arrNessColPurchaseDet = {
									isGrid:true
									,grid:this.div_PurchaseDet.form.grd_GbSales
									,ds:this.dsPurchaseDet
									,conds:[
												/*Any*/
												 getCheckCond("UNIT_COST"		, ""	, ""	, ""		, ""		, this.gfnGetTransTxt(1603, "단가를 입력하십시오.")			)
												,getCheckCond("CONTRACT_PRICE"	, ""	, ""	, ""		, ""		, this.gfnGetTransTxt(1604, "금액를 입력하십시오.")		)
												
												/*Not Only : 용역, 판매수수료, 유지보수, 총판수수료*/
												,getCheckCond("VAT_PRICE"		, ""	, ""	, ""		, ["S","C","M","D"]	, this.gfnGetTransTxt(1605, "부가세를 입력하십시오.")		)
												
												/*Only : 용역*/
												,getCheckCond("EMP_NO"			, ""	, ""	, ["S"]		, ""		, this.gfnGetTransTxt(1229, "투입인력을 선택하십시오.")		)
												,getCheckCond("TURNKEY_NAME"	, ""	, ""	, ["S"]		, ""		, this.gfnGetTransTxt(1607, "계약내용을 입력하십시오.")		)	/*원청턴키 일 경우는 계약내용(TURNKEY_NAME)을 입력한다. : 원청턴키 아닐 경우는 직원을 선택(Not Null)할 것이기에 PURCHASE_TYPE을 확인하지 않는다.*/
												,getCheckCond("LEVEL_CODE"		, ""	, ""	, ["S"]		, ""		, this.gfnGetTransTxt(1608, "등급을 선택하십시오.")			)
												,getCheckCond("MEN_MONTH"		, ""	, ""	, ["S"]		, ""		, this.gfnGetTransTxt(1609, "MM를 입력하십시오.")			)
												,getCheckCond("NONRESIDENT_FLAG", ""	, ""	, ["S"]		, ""		, this.gfnGetTransTxt(1610, "비상주여부를 입력하십시오.")			)
												
												/*Not Only : 용역*/
												,getCheckCond("PRODUCT_CODE"	, ""	, ""	, ""		, ["S"]		, this.gfnGetTransTxt(1611, "상품을 선택하십시오.")			)
												
												/*Only : 유지보수, 용역*/
												,getCheckCond("START_DATE"		, ""	, ""	, ["M","S"]	, ""		, this.gfnGetTransTxt(1612, "시작일을 입력하십시오.")		)
												,getCheckCond("END_DATE"		, ""	, ""	, ["M","S"]	, ""		, this.gfnGetTransTxt(1613, "종료일을 입력하십시오.")		)
												
												/*Not Only : 유지보수,용역*/
												,getCheckCond("QUANTITY"		, ""	, ""	, ""		, ["M","S"]	, this.gfnGetTransTxt(1614, "수량을 입력하십시오.")			)
												,getCheckCond("PRODUCT_UNIT"	, ""	, ""	, ""		, ["M","S"]	, this.gfnGetTransTxt(1615, "제품 단위를 선택하십시오.")	)										
												
												/*Only : 유지보수, 판매수수료*/
												,getCheckCond("COMMISSION_RATE"	, ""	, ""	, ["C", "M", "D", "P"], ""		, this.gfnGetTransTxt(1616, "요율(%)을 입력하십시오.")		)
											]
								};
	/*3.3 매입계약지급 정보 설정(월별)*/
	var arrNessColPurchasePay = {
									isGrid:true
									,grid:this.div_PurchasePay.form.grd_GbProvideList
									,ds:this.dsPurchasePay
									,conds:[
												/*Any*/
												 getCheckCond("PAY_PLAN_DATE"	, ""	, ""	, ""		, ""		, this.gfnGetTransTxt(1617, "지급예정일을 입력하십시오.")	)
												,getCheckCond("TAX_PRICE"	, ""	, ""	, ""		, ""			, this.gfnGetTransTxt(1618, "공급가를 입력하십시오.")		)
												,getCheckCond("VAT_PRICE"		, ""	, ""	, ""		, ""		, this.gfnGetTransTxt(1605, "부가세를 입력하십시오.")		)
												
												/*Only : 유지보수*/
												,getCheckCond("REMARKS"			, ""	, ""	, ["M"]		, ""		, this.gfnGetTransTxt(1620, "지급회차를 입력하십시오.")		)
												 
												/*Only : 유지보수, 용역*/
												,getCheckCond("START_DATE"		, ""	, ""	, ["M","S"]	, ""		, this.gfnGetTransTxt(1612, "시작일을 입력하십시오.")		)
												,getCheckCond("END_DATE"		, ""	, ""	, ["M","S"]	, ""		, this.gfnGetTransTxt(1613, "종료일을 입력하십시오.")		)
											]
								};
	/*3.4 매입계약지급 정보 설정(일시, 분할)*/
	var arrNessColPurchasePayNoTerm = {
									isGrid:true
									,grid:this.div_PurchasePay.form.grd_GbProvideList
									,ds:this.dsPurchasePay
									,conds:[
												/*Any*/
												 getCheckCond("PAY_PLAN_DATE"	, ""	, ""	, ""		, ""		, this.gfnGetTransTxt(1617, "지급예정일을 입력하십시오.")	)
												,getCheckCond("TAX_PRICE"	, ""	, ""	, ""		, ""			, this.gfnGetTransTxt(1618, "공급가를 입력하십시오.")		)
												,getCheckCond("VAT_PRICE"		, ""	, ""	, ""		, ""		, this.gfnGetTransTxt(1605, "부가세를 입력하십시오.")		)
												
												/*Only : 유지보수*/
												,getCheckCond("REMARKS"			, ""	, ""	, ["M"]		, ""		, this.gfnGetTransTxt(1620, "지급회차를 입력하십시오.")		)
												
											]
								};

	
	var val, rowtype, checkableRowType, checkableContractType;
	var cond, conds, isGrid, grid, ds, col, msg, cType;
	
	/*4. 설정값 전체 체크*/
	var arrCheckList;
	//매입계약지급 정보 체크시 월별은 시작,종료일을 체크하고 그외에는 시작,종료일 체크를 안한다.
	if(this.dsPurchase.getColumn(0, "PAY_TERM")=="M")	//월별지급
		arrCheckList = [arrNessColPurchase, arrNessColPurchaseDet, arrNessColPurchasePay];
	else
		arrCheckList = [arrNessColPurchase, arrNessColPurchaseDet, arrNessColPurchasePayNoTerm];
		
	for(var i = 0, iL = arrCheckList.length; i < iL; i++)
	{
		cond = arrCheckList[i];
		conds = cond.conds;
		cType = this.sContractType;
		
		//col, checkRowTypeOnly, checkRowTypeNotOnly, contractTypeOnly, contractTypeNotOnly, msg, comp
		isGrid = cond.isGrid;
		grid = cond.grid;
		ds = cond.ds;
		for(var c = 0, cL = conds.length; c < cL; c++)
		{
			col 				= conds[c].col;
			checkRowTypeOnly 	= conds[c].checkRowTypeOnly;
			checkRowTypeNotOnly = conds[c].checkRowTypeNotOnly;
			contractTypeOnly 	= conds[c].contractTypeOnly;
			contractTypeNotOnly = conds[c].contractTypeNotOnly;
			msg 				= conds[c].msg;
			comp 				= conds[c].comp;
			
			for(var r = 0, rL = ds.getRowCount(); r < rL; r++)
			{
				checkableRowType 		= true;
				checkableContractType 	= true;	
				/*1. 체크할 로우타입이 지정되었고, 현재로우에 포함되지 않았다. : 체크안함*/
				if(nexacro._isArray(checkRowTypeOnly) && checkRowTypeOnly.indexOf(rowtype) == -1)
				{
					checkableRowType = false;
				}
				
				/*2. 체크하지 않을 로우타입이 지정되었고, 현재로우에 포함되었다. : 체크안함*/
				if(nexacro._isArray(contractTypeNotOnly) && contractTypeNotOnly.indexOf(rowtype) != -1)
				{
					checkableRowType = false;
				}
				
				/*3. 체크할 계약구분이 지정되었고, 현재로우에 포함되지 않았다. : 체크안함*/
				if(nexacro._isArray(contractTypeOnly) && contractTypeOnly.indexOf(cType) == -1)
				{
					checkableContractType = false;
				}
				
				/*4. 체크하지 않을 계약구분이 지정되었고, 현재로우에 포함되었다. : 체크안함*/
				if(nexacro._isArray(contractTypeNotOnly) && contractTypeNotOnly.indexOf(cType) != -1)
				{
					checkableContractType = false;
				}
				
				/*원청텅키가 아닌 경우 TURNKEY_NAME (계약내용) 체크 제외*/
				if(col=="TURNKEY_NAME" && this.dsPurchase.getColumn(0, "PURCHASE_TYPE")!="1")
				{
					checkableContractType = false;
				}
				
				if(checkableRowType && checkableContractType)
				{
					rowtype = ds.getRowType(r);
					val = ds.getColumn(r, col);
					if(isGrid)
					{
						if(!checkIsEmpty(ds, r, col, true, grid, msg))
						{
							return false;
						}
					}else{
						if(!checkIsEmpty(ds, r, col, false, comp, msg))
						{
							return false;
						}				
					}
				}
			}		
		}
	}
	//지급 총액이랑, 매입총액이랑 다른 경우 저장 불가.
	return true;
}


this.fnCallBack = function(strSvcID, nErrorCode, strErrorMag)
{
	// 에러 예외처리
	if(nErrorCode != 0) 
	{
		return;
	}
	else 
	{
		if(strSvcID=="gfnGetCode") 
		{
			//PURCHASE_TYPE = 현재 계약구분에 해당하는 상품구분값 없을 시 입력콤보 숨김
			var arrVal1Group = this.ds_CD_PURCHASE_TYPE.getColumnGroupBy("VAL1");
			if(arrVal1Group.indexOf(this.sContractType) == -1)
			{
				this.div_Sales_List.form.stc_ProductType.set_visible(false);
				this.div_Sales_List.form.cmb_ProductType.set_visible(false);
			}
			this.ds_CD_PURCHASE_TYPE.filter("VAL1=='"+this.sContractType+"'");
			this.ds_CD_PAY_TERM.filter("String(VAL1).indexOf('" + this.sContractType + "') >= 0");
			
			this.ds_CD_CONTRACT_ADD_TYPE.filter("String(VAL1).indexOf('" + this.sContractType + "') >= 0");
			
			if(this.sContractType == "M")
				this.fnSearchList();
			else
				this.fnSearch();
		}
		else if(strSvcID=="SelectPurchaseList") 
		{
			//this.dsList.set_enableevent(true);
			if(this.dsList.rowcount<=1)
			{
				this.fnSearch();
			}
			else
			{
				var nFindRow = this.dsList.findRow("CONTRACT_NO_PURCHASE", this.parent.CONTRACT_NO_PURCHASE);
				this.dsList.set_rowposition(nFindRow);
			}
		}
		else if(strSvcID=="SelectPurchase") 
		{				
			if(this.dsPurchase.getColumn(this.dsPurchase.rowposition, "DELETE_FLAG")=="1")
			{
				//this.gfnAlert('msg.general',"삭제된 계약입니다.");
				this.btn_Save.set_enable(false);
				this.btn_SaveClose.set_enable(false);
				this.btn_Delete.set_enable(false);
				this.btn_CopyCancel.set_enable(false);
			}
			else
			{
				this.btn_Save.set_enable(this.bSave);
				this.btn_SaveClose.set_enable(this.bSaveClose);
				this.btn_Delete.set_enable(this.bDelete);
				if(this.bCopyCancel && !this.gfnIsEmpty(this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CONTRACT_NO_PURCHASE_PRE")))
				{
					this.btn_CopyCancel.set_enable(true);
				}
				else 
				{
					this.btn_CopyCancel.set_enable(false);
				}
			}
			/*7. 계약번호 파라미터가 없을 경우 신규등록 초기화*/
			//신규 등록 시 초기화
			var ds = this.dsPurchase;
// 			if(this.sContractType == "S")
// 			{
// 				if((this.dsPurchase.getColumn(0, "CONTRACT_MAIN") == "A104") || (this.parent.pvContractMain == "A104"))
// 				{
// 					if(this.FV_CO_CD == 'W01')
// 						this.div_Sales_List.form.cmb_PayPlanDay.set_value(15);	//15일 : 프리랜서(투비윈은 15일 지급)
// 					else
// 						this.div_Sales_List.form.cmb_PayPlanDay.set_value(10);	//10일 : 프리랜서
// 				}else if (this.dsPurchase.getColumn(0, "CONTRACT_MAIN") == "WIN" || (this.parent.pvContractMain == "WIN")){
// 					this.div_Sales_List.form.cmb_PayPlanDay.set_value(10);  //10일 : 투비윈
// 				}else{
// 					this.div_Sales_List.form.cmb_PayPlanDay.set_value(25);  //25일 : 프리랜서 외
// 				}
//			}
			if(ds.getRowCount() == 0)
			{
				var newrow = ds.addRow();
				ds.set_enableevent(false);
				ds.setColumn(newrow, "PAY_TERM"			, "A");
				ds.setColumn(newrow, "CONTRACT_DATE"	, this.gfnGetDateMaskFormatString(new Date(), "yyyyMMdd"));
				ds.setColumn(newrow, "CONTRACT_TYPE"	, this.parent.CONTRACT_TYPE);
				ds.setColumn(newrow, "CONTRACT_STATUS"	, "3");
				if(this.div_Sales_List.form.cmb_ProductType.visible)
					this.div_Sales_List.form.cmb_ProductType.set_index(0);
				
				// Flag NULL 제약조건 때문에 추가
				ds.setColumn(newrow, "NET_SALES_FLAG"		, "0");
				if(this.sContractType == "M")
					ds.setColumn(newrow, "LUMP_PAY_FLAG"		, "1");
				else
					ds.setColumn(newrow, "LUMP_PAY_FLAG"		, "0");
				ds.setColumn(newrow, "REMARKS_FLAG"			, "0");
				ds.setColumn(newrow, "PROGRESS_100_FLAG"	, "0");
				ds.setColumn(newrow, "PROGRESS_EXCEPT_FLAG"	, "0");
				ds.setColumn(newrow, "PERIOD_FLAG"			, "0");
				ds.setColumn(newrow, "MONTH_UNIT_PRICE"		, "0");
				
				if(this.sContractType == "M"||this.sContractType == "O")
				{
					var date = new Date();
					ds.setColumn(newrow, "START_DATE"	, this.gfnGetDateMaskFormatString(date, "yyyyMMdd"));
					date.addYear(1);
					date.addDate(-1);
					ds.setColumn(newrow, "END_DATE"		, this.gfnGetDateMaskFormatString(date, "yyyyMMdd"));
					ds.setColumn(newrow, "PERIOD_FLAG"	, "1");
					ds.setColumn(newrow, "CONTRACT_ADD_TYPE"		, "0");
					this.div_Sales_List.form.div_ContractPeriod.form.cmb_PayMethod.set_index(0);
				}
				else if(this.sContractType == "S")
				{
					ds.setColumn(newrow, "CONTRACT_ADD_TYPE"		, "0");
					ds.setColumn(newrow, "PAY_TERM"					, "M");
					ds.setColumn(newrow, "MAINCONTRACT_REPORT_FLAG"	, "0");
				}
				this.setContractInfo();
				ds.set_enableevent(true);
			}	
			
			if(this.FV_CO_CD == "J02") this.fnPurchaseBillSetBtn(this.dsPurchase.getColumn(0, "CONTRACT_MAIN"));
			
			this.fnSearchDet();
			//fnSearchDet 보다 fnSearchContractDet가 먼저 응답하는 경우가 있어서 this.fnSearchDet의 callback후로 함수 이동
			//this.fnSearchContractDet();
			//this.fnSearchMContractDet();			
		}
		else if(strSvcID=="SelectPurchaseDet") 
		{
			this.fnSearchContractDet();
			this.fnSearchMContractDet();
			
			
			if(this.FV_CO_CD == "J02") {
				for (var i=0; i<this.dsPurchaseDet.rowcount; i++) 
				{
					if (this.dsPurchaseDet.getColumn(i, "COMMISSION_RATE") == 0 )
					{
						var sRoyaltyType = this.dsPurchaseDet.getColumn(i, "ROYALTY_TYPE");
						//trace("sRoyaltyType:"+sRoyaltyType);
						var CommissionRate = this.ds_CD_ROYALTY_TYPE.lookup("CODE", sRoyaltyType, "VAL1");
						this.dsPurchaseDet.setColumn (i, "COMMISSION_RATE", CommissionRate);
					}
				}
			}
			
			this.fnSearchPay();
			this.setContractDetInfo();
			this.setPayPlanDay();
		}
		else if(strSvcID=="SelectPurchasePay") 
		{
			/*지급내역이 있을경우 조회한 데이터를 셋팅하고 없을경우 자동셋팅한다.*/
			if(this.dsPurchasePay.getRowCount() == 0)
				this.setPurchasePay(this.div_Sales_List.form.cmb_ProvideType.value);
			this.fnFilterPurchasePay();
		}
		else if(strSvcID=="SavePurchase") 
		{
			var sContractNoPurchaseNew = this.dsNewKey.getColumn(0, "CONTRACT_NO_PURCHASE_NEW");
			if(!this.gfnIsEmpty(sContractNoPurchaseNew))
			{
				this.sContractNoPurchase = sContractNoPurchaseNew;
			}
			this.fnSearch();
		}
		else if(strSvcID=="SavePurchaseClose") 
		{
			this.commUtil.popupClose("save");
		}
		else if(strSvcID=="SavePurchaseDelete") 
		{
			this.commUtil.popupClose("deleted");
		}
		else if(strSvcID=="SavePurchaseUpdateReport") 
		{
			
		}
		else if(strSvcID=="SelectContractDet")
		{
			//연결된 제품계약에 순매출이 체크 되어 있을경우 매입계약에 순매출 체크
			if(this.dsProdContract.getRowCount()>0)
				this.dsPurchase.setColumn(0, "NET_SALES_FLAG", this.dsProdContract.getColumn(0, "NET_SALES_FLAG"));
		}
		else if(strSvcID=="SelectContractDetM")
		{
			/*매입계약처가 있고 신규추가 계약일경우 매출상세내역이 불러와지면
			매입상세에 해당 매입처의 매출계약을 자동으로 셋팅해줌*/
			if(!this.gfnIsEmpty(this.dsPurchase.getColumn(0, "CONTRACT_MAIN")) && this.dsPurchase.getRowType(0)==2)
			{
				for(var i = 0; i < this.dsProdContract.getRowCount(); i++ )
				{
					/* 
						20230628 안수경 선임 요청 건 : 자동 생성 시 rChart 생성 안되게 요청
					*/
					if(this.dsPurchase.getColumn(0, "CONTRACT_MAIN") == this.dsProdContract.getColumn(i, "RELATED_COMPANY_CODE") && this.dsProdContract.getColumn(i, "PRODUCT_CODE") != "G010102")
					{
						var nRow = this.dsPurchaseDet.addRow();
						var ds = this.dsProdContract;
						var dsT = this.dsPurchaseDet;
						
						/*매입계약 시작일, 종료일 셋팅*/
						if(nRow==0)
						{
							this.dsPurchase.setColumn(0, "START_DATE", ds.getColumn(i, "START_DATE"));
							this.dsPurchase.setColumn(0, "END_DATE", ds.getColumn(i, "END_DATE"));
						}
												
						this.dsPurchaseDet.setColumn(nRow, "PRODUCT_CODE", "M01");
						this.dsPurchaseDet.setColumn(nRow, "PRODUCT_NAME", this.gfnGetTransTxt(46, "유지보수"));
						this.dsPurchaseDet.setColumn(nRow, "PRODUCT_UNIT", "900");
						this.dsPurchaseDet.setColumn(nRow, "QUANTITY"	 , "1");
						
						
						
						/*
						for (var i=0; i<this.dsPurchaseDet.rowcount; i++) 
						{
							if (this.dsPurchaseDet.getColumn(i, "COMMISSION_RATE") == 0 )
							{
								var sRoyaltyType = this.dsPurchaseDet.getColumn(i, "ROYALTY_TYPE");
								trace("sRoyaltyType:"+sRoyaltyType);
								var CommissionRate = this.ds_CD_ROYALTY_TYPE.lookup("CODE", sRoyaltyType, "VAL1");
								this.dsPurchaseDet.setColumn (i, "COMMISSION_RATE", CommissionRate);
							}
						}
						*/
						
						
						
						var setColumn = function(sColDes, sColSrc)
						{
							dsT.setColumn(nRow, sColDes, ds.getColumn(i, sColSrc));
						}
						setColumn("START_DATE"			, "START_DATE");
						setColumn("END_DATE"			, "END_DATE");
						setColumn("RELATED_PRODUCT_CODE", "PRODUCT_CODE");
						setColumn("RELATED_PRODUCT_NAME", "PRODUCT_NAME");
						setColumn("UNIT_COST"			, "CONTRACT_PRICE");	/*매출계약금 연결*/	
						setColumn("CMD_SEQ"				, "CMD_SEQ");
						setColumn("ROYALTY_TYPE"		, "ROYALTY_TYPE");
					}
				}
			}			
		}
		else if(strSvcID=="PurchaseCopy") 
		{
			var sContractNoPurchaseNew = this.dsNewKey.getColumn(0, "CONTRACT_NO_PURCHASE_NEW");
			if(!this.gfnIsEmpty(sContractNoPurchaseNew))
			{
				this.gfnAlert('msg.general',this.gfnGetTransTxt(1399, "계약이 복사 되었습니다."));
				this.parent.CONTRACT_NO_PURCHASE = sContractNoPurchaseNew;
				this.sContractNoPurchase = sContractNoPurchaseNew;
				this.fnSearchList();
			}
		}
		else if(strSvcID=="PurchaseCopyCancel")
		{
			var sContractNoPurchasePre = this.dsNewKey.getColumn(0, "CONTRACT_NO_PURCHASE_PRE");
			if(!this.gfnIsEmpty(sContractNoPurchasePre))
			{
				this.gfnAlert('msg.general',this.gfnGetTransTxt(1400, "계약이 복사 취소 되었습니다."));
				this.parent.CONTRACT_NO_PURCHASE = sContractNoPurchasePre;
				this.sContractNoPurchase = sContractNoPurchasePre;
				this.fnSearchList();
			}
		}
		else if(strSvcID=="fnSearchCoInfo")
		{
			this.fnDistributorFeeReport();
		}
	}
}

/* A일시지급 : 지급 한건 생성 */
this.setPayListA = function(sPayName)
{	
	this.div_PurchasePay.form.grd_GbProvideList.setBindDataset(null);
	var dsP			= this.dsPurchase;
	var dsDet		= this.dsPurchaseDet;
	var dsPay		= this.dsPurchasePay;
	var sPayPlanDay = this.div_Sales_List.form.cmb_PayPlanDay.value;
	sPayPlanDay = nexacro._isNull(sPayPlanDay) ? "25" : sPayPlanDay;
	var sCONTRACT_NO_PURCHASE	= dsP.getColumn(0, "CONTRACT_NO_PURCHASE");
	var sLUMP_PAY_FLAG			= dsP.getColumn(0, "LUMP_PAY_FLAG");	
	var sPAY_PLAN_DATE			= this.getPayPlanDate(this.gfnGetDateMaskFormatString(new Date(), "yyyyMMdd"), sPayPlanDay);	
	var newrow;
	
	
	var sRoyaltyType = dsDet.getColumn(dsDet.rowposition, "ROYALTY_TYPE");
	if (this.gfnIsEmpty(sRoyaltyType)) sRoyaltyType = "NA";
	
	if(this.dsPurchaseDet.getRowCount()==0)
		return;
		
	/*용역에 분할지급은 회차별 지급*/
	if (this.sContractType =="S")
		this.div_PurchasePay.form.grd_GbProvideList.set_formatid("CONTRACT_TYPE_ST");
	
	if(sLUMP_PAY_FLAG == "1")
	{
		newrow = dsPay.addRow();
		if(this.sContractType == "S")
		{
			/*용역에 분할지급은 역무기간 셋팅을 안함*/
			if(this.div_PurchasePay.form.grd_GbProvideList.formatid=="CONTRACT_TYPE_ST")
				dsPay.setColumn(newrow, "REMARKS"		, sPayName												);
			else
			{
				dsPay.setColumn(newrow, "START_DATE"	, dsDet.getMin("START_DATE")							);
				dsPay.setColumn(newrow, "END_DATE"		, dsDet.getMax("END_DATE")								);
			}
			dsPay.setColumn(newrow, "PAY_PLAN_DATE"	, this.getPayPlanDate(dsDet.getMax("END_DATE"), sPayPlanDay));
		}
		else if(this.sContractType == "M")
		{
			dsPay.setColumn(newrow, "REMARKS"		, sPayName														);
			dsPay.setColumn(newrow, "START_DATE"	, dsP.getColumn(0, "START_DATE")								);
			dsPay.setColumn(newrow, "END_DATE"		, dsP.getColumn(0, "END_DATE")									);
			dsPay.setColumn(newrow, "PAY_PLAN_DATE"	, this.getPayPlanDate(dsP.getColumn(0, "END_DATE"), sPayPlanDay));
		}else{
			dsPay.setColumn(newrow, "PAY_PLAN_DATE"	, sPAY_PLAN_DATE	);
		}
		
		dsPay.setColumn(newrow, "TAX_PRICE"				, dsDet.getSum("CONTRACT_PRICE"));
		var vat = nexacro.ceil(dsDet.getSum("CONTRACT_PRICE")*0.1);		
		if(this.dsPurchase.getColumn(0, "CONTRACT_MAIN")=="A104" && this.sContractType=="S")	// 프리랜서일경우 vat 0원
			vat = 	0;
		else if (this.FV_CO_CD == "J02" && sRoyaltyType != "NA")								// 일본법인 로열티 대상 vat 0원
			vat = 	0;
		
		dsPay.setColumn(newrow, "VAT_PRICE"				, vat							);
		dsPay.setColumn(newrow, "CONTRACT_NO_PURCHASE"	, sCONTRACT_NO_PURCHASE			);
			
	}else{
		//선택 매입 상세와 상관없이 지급내역을 모두 재생성하기에 선택한 매입계약상세의 지급내역만 삭제하게 변경
		//for(var i = 0, iL = dsDet.getRowCount(); i < iL; i++)
		//{
			var i = dsDet.rowposition;
			newrow = dsPay.addRow();
			if(["S", "M"].indexOf(this.sContractType) != -1)
			{
				if(this.sContractType == "S")
				{
					/*용역에 분할지급은 역무기간 셋팅을 안함*/
					if(this.div_PurchasePay.form.grd_GbProvideList.formatid=="CONTRACT_TYPE_ST")
						dsPay.setColumn(newrow, "REMARKS"		, sPayName												);
					else
					{
					dsPay.setColumn(newrow, "START_DATE"		, dsDet.getColumn(i, "START_DATE")						);
					dsPay.setColumn(newrow, "END_DATE"			, dsDet.getColumn(i, "END_DATE")						);
					}
				}
				else if(this.sContractType == "M")
				{
					dsPay.setColumn(newrow, "REMARKS"		, sPayName															);
					dsPay.setColumn(newrow, "START_DATE"		, dsDet.getColumn(i, "START_DATE")								);
					dsPay.setColumn(newrow, "END_DATE"			, dsDet.getColumn(i, "END_DATE")								);
				}
				dsPay.setColumn(newrow, "PAY_PLAN_DATE"		, this.getPayPlanDate(dsDet.getColumn(i, "END_DATE"), sPayPlanDay)	);
			}else{
				dsPay.setColumn(newrow, "PAY_PLAN_DATE"		, sPAY_PLAN_DATE	);
			}
			
			dsPay.setColumn(newrow, "TAX_PRICE"				, dsDet.getColumn(i, "CONTRACT_PRICE")								);
			var vat = nexacro.ceil(dsDet.getColumn(i, "CONTRACT_PRICE") * 0.1);		
			if(this.dsPurchase.getColumn(0, "CONTRACT_MAIN")=="A104" && this.sContractType=="S")	//프리랜서일경우 vat 0원
				vat = 0;
			else if (this.FV_CO_CD == "J02" && sRoyaltyType != "NA")								// 일본법인 로열티 대상 vat 0원
				vat = 	0;
			dsPay.setColumn(newrow, "VAT_PRICE"				, vat																);
			dsPay.setColumn(newrow, "CONTRACT_NO_PURCHASE"	, sCONTRACT_NO_PURCHASE												);
			dsPay.setColumn(newrow, this.sPurchaseDetKeyName, dsDet.getColumn(i, this.sPurchaseDetKeyName)						);
		//}
	}
	this.div_PurchasePay.form.grd_GbProvideList.setBindDataset(this.dsPurchasePay);
}

/* M월별지급 : 시작~종료 까지 월별 단가 지급 생성	(유지보수, 용역)
  - 일괄 지급 : 유지보수만 가능, (용역도 임시로 유지보수와 동일하게 처리)
  - 상세별 지급 : 유지보수, 용역만 가능*/
  
/* H반기별 : 반기단위로 시작~종료 까지 월단가 * 6 지급 생성	(유지보수, 용역)
  - 일괄 지급 : 유지보수만 가능
  - 상세별 지급 : 유지보수, 용역만 가능*/

/* Q분기별 : 분기단위로 시작~종료 까지 월단가 * 3 지급 생성	(유지보수, 용역)
  - 일괄 지급 : 유지보수만 가능
  - 상세별 지급 : 유지보수, 용역만 가능*/
this.setPayListUnit = function(mUnit)
{
	this.div_PurchasePay.form.grd_GbProvideList.setBindDataset(null);
	var dsP			= this.dsPurchase;
	var dsDet		= this.dsPurchaseDet;
	var dsPay		= this.dsPurchasePay;
	var sPayPlanDay = this.div_Sales_List.form.cmb_PayPlanDay.value;
	sPayPlanDay = nexacro._isNull(sPayPlanDay) ? "25" : sPayPlanDay;
	var sCONTRACT_NO_PURCHASE	= dsP.getColumn(0, "CONTRACT_NO_PURCHASE");
	var sLUMP_PAY_FLAG			= dsP.getColumn(0, "LUMP_PAY_FLAG");	
	var sPAY_PLAN_DATE			= this.getPayPlanDate(this.gfnGetDateMaskFormatString(new Date(), "yyyyMMdd"), sPayPlanDay, mUnit);	
	var newrow;
	
	if(this.dsPurchaseDet.getRowCount()==0)
		return;
		
	/*용역분할지급 때문에 포멧 변경*/
	if (this.sContractType =="S")
		this.div_PurchasePay.form.grd_GbProvideList.set_formatid("CONTRACT_TYPE_S");
	
	if(sLUMP_PAY_FLAG == "1")
	{
		if(["S","M"].indexOf(this.sContractType) != -1)
		{
			var fromDate, toDate, contractPriceMonthly;
			if(this.sContractType == "S")
			{
				fromDate = dsDet.getMin("START_DATE");
				toDate	 = dsDet.getMax("END_DATE");
			}
			else if(this.sContractType == "M")
			{
				fromDate = dsP.getColumn(0, "START_DATE");
				toDate	 = dsP.getColumn(0, "END_DATE");
			}
			
			var arrMonth = this.getMonthInfo(fromDate, toDate, mUnit);
			if(this.sContractType == "S")
				contractPriceMonthly = dsDet.getColumn(r, "UNIT_COST")+dsDet.getColumn(r, "EXPENSE");
			else 
				contractPriceMonthly = dsDet.getSum("CONTRACT_PRICE") / arrMonth.length;
			contractPriceMonthly = nexacro.ceil(contractPriceMonthly);
			for(var i = 0, iL = arrMonth.length; i < iL; i++ )
			{
				newrow = dsPay.addRow();
				if(this.sContractType == "M")
				{
					dsPay.setColumn(newrow, "REMARKS"				, arrMonth[i].caption							);
				}
				dsPay.setColumn(newrow, "START_DATE"			, arrMonth[i].start									);
				dsPay.setColumn(newrow, "END_DATE"				, arrMonth[i].end									);
				dsPay.setColumn(newrow, "PAY_PLAN_DATE"			, this.getPayPlanDate(arrMonth[i].end, sPayPlanDay, mUnit)	);
				dsPay.setColumn(newrow, "TAX_PRICE"				, contractPriceMonthly								);
				var vat = nexacro.ceil(contractPriceMonthly * 0.1);		
				if(this.dsPurchase.getColumn(0, "CONTRACT_MAIN")=="A104" && this.sContractType=="S")	//프리랜서일경우 vat 0원
					vat = 0;
				dsPay.setColumn(newrow, "VAT_PRICE"				, vat												);
				dsPay.setColumn(newrow, "CONTRACT_NO_PURCHASE"	, sCONTRACT_NO_PURCHASE								);
			}			
		}else{
			this.setPayListA();
		}
	}else{
		if(["S", "M"].indexOf(this.sContractType) != -1)
		{
			var fromDate, toDate, arrMonth, contractPriceMonthly;
			//선택 매입 상세와 상관없이 지급내역을 모두 재생성하기에 선택한 매입계약상세의 지급내역만 삭제하게 변경
			//for(var r = 0, rL = dsDet.getRowCount(); r < rL; r++)
			//{
				var r = dsDet.rowposition;
			
				fromDate = dsDet.getColumn(r, "START_DATE");
				toDate	 = dsDet.getColumn(r, "END_DATE");
				
				arrMonth = this.getMonthInfo(fromDate, toDate, mUnit);
				if(this.sContractType == "S")
					contractPriceMonthly = dsDet.getColumn(r, "UNIT_COST")+dsDet.getColumn(r, "EXPENSE");
				else 
					contractPriceMonthly = dsDet.getColumn(r, "CONTRACT_PRICE") / arrMonth.length;
				contractPriceMonthly = nexacro.ceil(contractPriceMonthly);
				for(var i = 0, iL = arrMonth.length; i < iL; i++ )
				{
					newrow = dsPay.addRow();
					//trace("mUnit: "+mUnit+", newrow: "+newrow+", PAY_PLAN_DATE: "+this.getPayPlanDate(arrMonth[i].end, sPayPlanDay, mUnit)+", TAX_PRICE : "+contractPriceMonthly);
					if(this.sContractType == "M")
					{
						dsPay.setColumn(newrow, "REMARKS"				, arrMonth[i].caption							);
					}
					dsPay.setColumn(newrow, "START_DATE"			, arrMonth[i].start									);
					dsPay.setColumn(newrow, "END_DATE"				, arrMonth[i].end									);
					dsPay.setColumn(newrow, "PAY_PLAN_DATE"			, this.getPayPlanDate(arrMonth[i].end, sPayPlanDay, mUnit)	);
					
					//월별지급내역 자동생성시 1달이 안될경우 공급가 , 부가세 합계 셋팅안함
					if(arrMonth[i].full_YN)
					{	
						dsPay.setColumn(newrow, "TAX_PRICE"				, contractPriceMonthly							);
						var vat = nexacro.ceil(contractPriceMonthly * 0.1);
						if(this.dsPurchase.getColumn(0, "CONTRACT_MAIN")=="A104" && this.sContractType=="S")	//프리랜서일경우 vat 0원
							vat = 0;
						dsPay.setColumn(newrow, "VAT_PRICE"				, vat											);
					}
					dsPay.setColumn(newrow, "CONTRACT_NO_PURCHASE"	, sCONTRACT_NO_PURCHASE								);
					dsPay.setColumn(newrow, this.sPurchaseDetKeyName, dsDet.getColumn(r, this.sPurchaseDetKeyName)		);
				}
			//}
		}else{
			this.setPayListA();
		}
	}
	this.div_PurchasePay.form.grd_GbProvideList.setBindDataset(this.dsPurchasePay);
}

/*지급예정일 가져오기*/
this.getPayPlanDate = function(endDate,payPlanDay, mUnit)
{
	var orgEndDate = this.gfnStrToDate(endDate.substring(0,6)+"01");
	endDate = this.gfnStrToDate(endDate.substring(0,6)+"01");
	switch(mUnit)
	{
		case "H" : 
			arrPayPlanMonth = [
							 6,6,6,6,6,6	//상반기는 7월
							,0,0,0,0,0,0	//하반기는 1월
							];
			endDate.setMonth(arrPayPlanMonth[endDate.getMonth()]);	/*반기별은 1월, 7월이 지급예정월*/
			break;
		case "Q" : 
			arrPayPlanMonth = [
							 3,3,3	//1분기는 4월
							,6,6,6	//2분기는 7월
							,9,9,9	//3분기는 10월
							,0,0,0	//4분기는 1월
							];
			endDate.setMonth(arrPayPlanMonth[endDate.getMonth()]);	/*분기별은 1월, 4월, 7월, 10월이 지급예정월*/
			break;
		default :
			endDate.addMonth(1);									/*종료월의 다음달이 지급예정월*/
			break;
	}	
	endDate.setDate(payPlanDay);
	/*년도 변경*/
	if(orgEndDate > endDate)
		endDate.addYear(1);	
	return this.gfnGetDateMaskFormatString(endDate, "yyyyMMdd");
}

/*시작, 종료일 기준 월정보 가져오기 : 월별, 분기별, 반기별*/
this.getMonthInfo = function(fromDate, toDate, mUnit)
{
	if (this.gfnIsEmpty(fromDate)||this.gfnIsEmpty(toDate)||this.gfnIsEmpty(mUnit))
	{
		return [];
	}
	var dtObj = this.gfnStrToDate(fromDate);	
	var dtStr = this.gfnGetDateMaskFormatString(dtObj, "yyyyMMdd");		
	
	var arrMonthUnit = [];
	switch(mUnit)
	{
		case "M" : 
			break;
		case "H" : 
			arrMonthUnit = [
							 {start:"0101", end:"0630"}	//상반기
							,{start:"0701", end:"1231"}	//하반기
							];
			break;
		case "Q" : 
			arrMonthUnit = [
							 {start:"0101", end:"0331"}	//1분기
							,{start:"0401", end:"0630"}	//2분기
							,{start:"0701", end:"0930"}	//3분기
							,{start:"1001", end:"1231"}	//4분기
							];
			break;
	}
					
	var arrMonth = [];
	var start, end, caption;
	
	if(arrMonthUnit.length == 0)
	{
		while( dtStr.substring(0,6) <= toDate.substring(0,6) )
		{
			if(this.div_PurchasePay.form.rdo_BaseMM.value=='2' && this.sContractType == "S")	// 용역이고 한달기준일 경우
			{
				start = dtStr;
				end = this.gfnAddDate(this.gfnAddMonth(dtStr, 1), -1);
			}
			else //월말기준
			{
				start = dtStr.substring(0, 6) + "01";
				end = dtStr.substring(0, 6) + this.gfnGetLastDayOfMonth(dtStr);
			}
			
			start	= start > fromDate ? start : fromDate;
			end		= end < toDate ? end : toDate;
			
			//한달 꽉찰경우 지급내역에 공급가를 셋팅한다.
			if(this.div_PurchasePay.form.rdo_BaseMM.value=='2' && this.sContractType == "S")
				full_YN = end <= toDate ? true : false;
			else 
				full_YN = end.substring(6,8) == this.gfnGetLastDayOfMonth(start) ? (start.substring(6,8) == "01" ? true : false) : false;
				
			arrMonth.push(	{
							 caption:start.substring(0, 4) + this.gfnGetTransTxt(2025, "년")+ " " + start.substring(4,6) + this.gfnGetTransTxt(403, "월")
							,start:start
							,end:end
							,full_YN:full_YN
							} );
		
			dtObj.addMonth(1);
			dtStr = this.gfnGetDateMaskFormatString(dtObj, "yyyyMMdd");
		}
	}else{
		while( dtStr.substring(0,4) <= toDate.substring(0,4) )
		{
			for(var i = 0, iL = arrMonthUnit.length; i < iL; i++)
			{
				start = dtStr.substring(0, 4) + arrMonthUnit[i].start;
				end = dtStr.substring(0, 4) + arrMonthUnit[i].end;
				
				start	= start > fromDate ? start : fromDate;
				end		= end < toDate ? end : toDate;
				
				if(start > end)
				{
					continue;
				}
				
				if(mUnit == "H")
				{
					caption = dtStr.substring(0, 4) + this.gfnGetTransTxt(2025, "년")+ " " + ( i == 0 ? this.gfnGetTransTxt(460,"상반기") : this.gfnGetTransTxt(461, "하반기") )
				}
				else if(mUnit == "Q")
				{
					caption = dtStr.substring(0, 4) + this.gfnGetTransTxt(2025, "년")+ " " + (i+1) + this.gfnGetTransTxt(22848, "분기")
				}			
				
				arrMonth.push(	{
								 caption:caption
								,start:start
								,end:end
								,full_YN:true
								} );
			}
			dtObj.addYear(1);
			dtStr = this.gfnGetDateMaskFormatString(dtObj, "yyyyMMdd");
		}
	}
	
	return arrMonth;
}

this.fnSearchPurchaseCompanyInfo = function(sContractMain)
{
	// 조건값 셋팅
	this.gfnAddSendParameter("COMPANY_CODE", sContractMain);
	
	// 조회용 Output dataset 세팅
// 	this.gfnAddOutputDataset("dsPurchaseCompanyInfo"	 , "dsOutput");
// 	this.gfnCommonTransaction("SearchPurchaseCompanyInfo", "SP_PurchaseCompanyInfo_S01", null, false);	
	
		this.gfnSetMap("projectMapper", ['SP_PurchaseCompanyInfo_S01'], ['dsPurchaseCompanyInfo']);
		this.gfnCommonTransaction("SearchPurchaseCompanyInfo", "selectNextMultiList.do", null, false);
		
};

this.fnCheckTurnkey = function()
{
	this.dsPurchaseCompanyInfo.clearData();
	
	var sBool = false;
	var currow = this.dsPurchase.rowposition;
	var sPurchaseType = this.dsPurchase.getColumn(currow, "PURCHASE_TYPE");
	var sContractMain = this.dsPurchase.getColumn(currow, "CONTRACT_MAIN");
	
	if(sPurchaseType == "1")
	{
		this.fnSearchPurchaseCompanyInfo(sContractMain);
		var sTurnkeyFlag = this.dsPurchaseCompanyInfo.getColumn(this.dsPurchaseCompanyInfo.rowposition, "TURNKEY_FLAG");
		if(sTurnkeyFlag == "1") sBool = true;
	}
	else 
	{
		sBool = true;
	}
	return sBool;
};

this.setTurnkeyFormat = function(sPurchaseType, addRow)
{
	if(this.sContractType == "S")
	{
		var sContractMain 		= this.dsPurchase.getColumn(0, "CONTRACT_MAIN");
		var sContractMainName 	= this.dsPurchase.getColumn(0, "CONTRACT_MAIN_NAME");
		
		var grd = this.div_PurchaseDet.form.grd_GbSales;
		var ds = grd.getBindDataset();
		
		var cellId = 1;	//직원 선택 컬럼 상수
		var cellId2 = 2; // 계약내용 컬럼 상수
		var empNo = "";
		if(grd.formatid == "CONTRACT_TYPE_S")
		{
			grd.setCellProperty("body", cellId, "edittype"		, "" 			);
			grd.setCellProperty("head", cellId, "text"			, this.gfnGetTransTxt(27, "성명") );
			if(sPurchaseType == "1")
			{
				grd.setFormatColProperty(cellId2, "size", 100);
			}
			else
			{
				grd.setFormatColProperty(cellId2, "size", 0);
			}
			grd.setCellProperty("body", cellId, "tooltiptext"	, this.gfnGetTransTxt(22847, "더블 클릭 - 인력 선택") );
			grd.setCellProperty("body", cellId, "expandshow"	, "show" 		);
			
			if(!this.gfnIsEmpty(addRow))
			{
				ds.setColumn(addRow, "EMP_NO"	, "");
				ds.setColumn(addRow, "EMP_NAME"	, "");
				ds.setColumn(addRow, "TURNKEY_NAME"	, "");
			}
			else
			{
				// 초기화
				for(var i = 0, iL = ds.getRowCount(); i < iL; i++)
				{
					empNo = ds.getColumn(i, "EMP_NO");
					ds.setColumn(i, "EMP_NO"	, "");
					ds.setColumn(i, "EMP_NAME"	, "");
					ds.setColumn(i, "TURNKEY_NAME"	, "");
				}
			}			
		}		
	}	
}

this.isUndefineCheck = function(chkVal)
{
	if(this.gfnIsEmpty(chkVal))
	{
		chkVal = "";
	}
	
	chkVal = chkVal.toString();
	
	return chkVal;
};

this.setContractInfo = function()
{
	if(!this.gfnIsEmpty(this.sProjectCode))
	{	
		var row = this.dsPurchase.rowposition;	
		this.dsPurchase.setColumn(row, "PROJECT_CODE"		, this.parent.pvProjectCode);
		this.dsPurchase.setColumn(row, "PROJECT_NAME"		, this.parent.pvProjectName);
		this.dsPurchase.setColumn(row, "CLIENT_CODE"		, this.parent.pvClientCode);
		this.dsPurchase.setColumn(row, "CLIENT_NAME"		, this.parent.pvClientName);
		this.dsPurchase.setColumn(row, "CL_CONTRACT_NO"		, this.parent.pvContractNo);
		this.dsPurchase.setColumn(row, "CL_CONTRACT_NAME"	, this.parent.pvContractName);	
		this.dsPurchase.setColumn(row, "CONTRACT_MAIN"		, this.parent.pvContractMain);
		this.dsPurchase.setColumn(row, "CONTRACT_MAIN_NAME"	, this.parent.pvContractMainName);	
		this.dsPurchase.setColumn(row, "CL_SALES_EMP_NO"	, this.parent.pvSalesEmpNo);
		this.dsPurchase.setColumn(row, "CL_SALES_EMP_NAME"	, this.parent.pvSalesEmpName);
		this.dsPurchase.setColumn(row, "CONTRACT_NAME"		, this.parent.pvContractName);	
		this.sProjectCode = "";
		
		this.dsPurchaseCompanyInfo.clearData();
		this.fnSearchPurchaseCompanyInfo(this.parent.pvContractMain);
		var sTurnkeyFlag = this.dsPurchaseCompanyInfo.getColumn(this.dsPurchaseCompanyInfo.rowposition, "TURNKEY_FLAG");
		var sPurchaseCompanyCd = this.dsPurchaseCompanyInfo.getColumn(this.dsPurchaseCompanyInfo.rowposition, "PURCHASE_COMPANY_CODE");
		this.dsPurchase.setColumn(row, "TURNKEY_FLAG"				, sTurnkeyFlag);
		this.dsPurchase.setColumn(row, "PURCHASE_COMPANY_CODE"		, sPurchaseCompanyCd);
	}
};

this.setContractDetInfo = function()
{
	if(!this.gfnIsEmpty(this.sEmpNo))
	{	
		/*투비윈에서 원청인력으로 투입한것 처리*/
		if(this.parent.pvContractMain=="WIN")
		{
			if(this.parent.pvEmpName=="원청턴키")
				this.dsPurchase.setColumn(0, "PURCHASE_TYPE", "1");
			else
				this.dsPurchase.setColumn(0, "PURCHASE_TYPE", "2");
			this.div_Sales_List.form.chb_MainContractReport.set_value("1");
		}
			
		var newrow = this.dsPurchaseDet.addRow();
		this.dsPurchaseDet.setColumn(newrow, "PRODUCT_UNIT"			, "001");
		this.dsPurchaseDet.setColumn(newrow, "UNIT_COST"			, "0");
		this.dsPurchaseDet.setColumn(newrow, "QUANTITY"				, "1");
		this.dsPurchaseDet.setColumn(newrow, "CONTRACT_PRICE"		, "0");
		this.dsPurchaseDet.setColumn(newrow, "VAT_PRICE"			, "0");	
		this.dsPurchaseDet.setColumn(newrow, "COMMISSION_RATE"		, "0");
		this.dsPurchaseDet.setColumn(newrow, "NONRESIDENT_FLAG"		, "0");
		this.dsPurchaseDet.setColumn(newrow, "EXPENSE"				, "0");
		
		this.dsPurchaseDet.setColumn(newrow, "EMP_NO"				, this.parent.pvEmpNo);
		//this.dsPurchaseDet.setColumn(newrow, "COMPANY_CODE"			, this.parent.pvContractMain);
		this.dsPurchaseDet.setColumn(newrow, "COMPANY_CODE"			, this.parent.pvEmpCompanyCd);
		this.dsPurchaseDet.setColumn(newrow, "EMP_NAME"				, this.parent.pvEmpName);		
		this.dsPurchaseDet.setColumn(newrow, "LEVEL_CODE"			, this.parent.pvLevelCode);
		this.dsPurchaseDet.setColumn(newrow, "START_DATE"			, this.parent.pvStartDate);
		this.dsPurchaseDet.setColumn(newrow, "END_DATE"				, this.parent.pvEndDate);
		this.dsPurchaseDet.setColumn(newrow, "UNIT_COST"			, this.parent.pvUnitCost);
		this.dsPurchaseDet.setColumn(newrow, "EXPENSE"				, this.parent.pvExpense);
		this.dsPurchaseDet.setColumn(newrow, "CSD_UNIT_COST"		, this.parent.pvConUnitCost);	/*투비윈은 매출단가 자동 셋팅*/
		
		this.sEmpNo = "";
	}
};

this.setPayPlanDay = function()
{
	var dsPurchase = this.dsPurchase;
	var dsPurchaseDet = this.dsPurchaseDet;
	
	trace(dsPurchaseDet.getColumn(0, "COMPANY_CODE"));
	
	if(dsPurchase.getColumn(0,"CONTRACT_MAIN") == "A104")
	{
		if(this.FV_CO_CD == 'W01')
			this.div_Sales_List.form.cmb_PayPlanDay.set_value(15);	//15일 : 프리랜서(투비윈은 15일 지급)
		else
			this.div_Sales_List.form.cmb_PayPlanDay.set_value(10);	//10일 : 프리랜서
	}else if (dsPurchase.getColumn(0,"CONTRACT_MAIN") == "WIN"){
		if(dsPurchaseDet.getColumn(0, "COMPANY_CODE") == "A104") {
			this.div_Sales_List.form.cmb_PayPlanDay.set_value(10);  //10일 : 프리랜서
		} else  if(this.FV_CO_CD == 'A01' && !this.gfnIsEmpty(dsPurchaseDet.getColumn(0, "COMPANY_CODE")) 
					&& dsPurchaseDet.getColumn(0, "COMPANY_CODE") == "WIN") {
			this.div_Sales_List.form.cmb_PayPlanDay.set_value(10);  //10일 : 투비윈
		} else {
			this.div_Sales_List.form.cmb_PayPlanDay.set_value(20);  //20일 : 매입계약처가 DX투비이고 외주직원일 경우
		}
	}else{
		this.div_Sales_List.form.cmb_PayPlanDay.set_value(25);  //25일 : 프리랜서 외
	}
};

this.setPurchasePay = function(strPayTerm)
{
	var nPayCompleteCnt = this.dsPurchasePay.getCaseCountNF("PAY_FLAG=='1'");	//필터된 로우를 포함하여 리턴한다.
	if(nPayCompleteCnt > 0)
	{
		this.gfnAlert('msg.general',this.gfnGetTransTxt(1401, "지급완료 건이 존재하여 지급내역 자동 변경을 할수 없습니다."));
		return false;
	}
	
	//this.dsPurchasePay.filter("");
	//this.dsPurchasePay.deleteAll();
	//선택 매입 상세와 상관없이 지급내역을 모두 재생성하기에 선택한 매입계약상세의 지급내역만 삭제하게 변경
	for(var i = this.dsPurchasePay.getRowCount(); i >= 0; i--)
	{
		this.dsPurchasePay.deleteRow(i);
	}
	
	//변경 시작
	switch(strPayTerm)
	{
		case "A":	/* A일시지급 : 지급 한건 생성 */
			this.setPayListA(this.gfnGetTransTxt(22844, "일시지급"));
			break;
		case "P":	/* P분할지급 : 지급 한건 생성 */
			this.setPayListA(this.gfnGetTransTxt(22845, "분할지급"));
			break;
		case "M":	/* M월별지급 : 시작~종료 까지 월단가 지급 생성	(유지보수, 용역) */
			this.setPayListUnit("M");
			break;
		case "H":	/* H반기별 : 반기단위로 시작~종료 까지 반기단가 지급 생성	(유지보수, 용역) */
			this.setPayListUnit("H");
			break;
		case "Q":	/* Q분기별 : 분기단위로 시작~종료 까지 분기단가 지급 생성	(유지보수, 용역) */
			this.setPayListUnit("Q");
			break;
			
		default:
	}
	this.fnFilterPurchasePay();
	
	//용역 지급내역합계가 매입계약금액에 자동 셋팅
	if(this.sContractType=="S")
		this.dsPurchaseDet.setColumn(this.dsPurchaseDet.rowposition, "CONTRACT_PRICE", this.dsPurchasePay.getSum("TAX_PRICE"));
		
	return true;
};

this.fnGetButtonTxt = function(nRowIdx)
{
	var sRtnVal = this.gfnGetTransTxt(1914, "상세");
	//trace("sRtnVal:"+sRtnVal);
	return sRtnVal;
}


this.btn_Popup_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var sArgument = {};
	sArgument.pv_contract_type =  this.sContractType;
	sArgument.pv_ContractNoPurchase = this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CONTRACT_NO_PURCHASE");
	sArgument.pv_ContractMainName = this.dsPurchase.getColumn(this.dsPurchase.rowposition, "CONTRACT_MAIN_NAME");
	if(this.gfnIsEmpty(sArgument.pv_ContractNoPurchase))
	{
		this.gfnAlert('msg.general',this.gfnGetTransTxt(1402, "매입계약번호생성을 위해 저장후 연결해주세요"));
		return;
	}
	this.commUtil.popupPurchaseSearch(this, "popupPurchaseSearch", "fnPopupCallBack", sArgument);
};

this.div_PurchasePay_rdo_BaseMM_onitemchanged = function(obj:nexacro.Radio,e:nexacro.ItemChangeEventInfo)
{
	this.setPurchasePay(this.div_Sales_List.form.cmb_ProvideType.value);
};

this.dsPurchase_onload = function(obj:nexacro.NormalDataset,e:nexacro.DSLoadEventInfo)
{
	/*용역에 분할지급은 회차별 지급*/
	if (this.sContractType =="S" && obj.getColumn(0, "PAY_TERM") =="P")
		this.div_PurchasePay.form.grd_GbProvideList.set_formatid("CONTRACT_TYPE_ST");
	else if (this.sContractType =="S")
		this.div_PurchasePay.form.grd_GbProvideList.set_formatid("CONTRACT_TYPE_S");
};

this.dsList_onrowposchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSRowPosChangeEventInfo)
{
	if(obj.getColumn(e.newrow, "DELETE_FLAG")=="1")
		this.div_List.form.btn_PurchaseCopy.set_enable(false);
	else
		this.div_List.form.btn_PurchaseCopy.set_enable(true);
	this.sContractNoPurchase = obj.getColumn(e.newrow, "CONTRACT_NO_PURCHASE");
	this.fnSearch();
};

this.dsList_onload = function(obj:nexacro.NormalDataset,e:nexacro.DSLoadEventInfo)
{
	//this.dsList.set_enableevent(false);
};

this.div_ProdContract_tab_ContractDet_onchanged = function(obj:nexacro.Tab,e:nexacro.TabIndexChangeEventInfo)
{
	this.div_ProdContract.form.btn_TotalRemove.set_visible(this.div_ProdContract.form.tab_ContractDet.tabindex==1?true:false);
	this.div_ProdContract.form.grd_GbProductContractDetail.set_formatid(this.div_ProdContract.form.tab_ContractDet.tabindex==1?"CONTRACT_TYPE_S_TOTAL":"CONTRACT_TYPE_S");
	this.div_ProdContract.form.grd_GbProductContractDetail.set_binddataset(this.div_ProdContract.form.tab_ContractDet.tabindex==1?"dsProdContractTotal":"dsProdContract");	
};

this.div_ProdContract_grd_GbProductContractDetail_oncellclick = function(obj:nexacro.Grid,e:nexacro.GridClickEventInfo)
{
	var sCellProp = obj.getCellProperty("body", e.cell, "displaytype");
	var ds = obj.getBindDataset();
	
	if(ds.id=="dsProdContractTotal" && sCellProp=="buttoncontrol")
	{
		var nCsdSeq = ds.getColumn(e.row, "CSD_SEQ");
		
		if(this.gfnIsEmpty(nCsdSeq))
			return;
		var Argument = {pvCsdSeq:nCsdSeq};
		this.commUtil.popup (this, "SP_PurchaseSiDet", "Sales::SP_PurchaseSiDet.xfdl", -1, -1, 600, 300, true, true, false, Argument, "fnPopupCallBack")	
	}
};

this.dsProdContractTotal_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	if(["START_DATE", "END_DATE"].indexOf(e.columnid) != -1 )
	{
		var s_yyyyMMdd = obj.getColumn(e.row, "START_DATE");
		var e_yyyyMMdd = obj.getColumn(e.row, "END_DATE");		
		var mm = nexacro.ceil(this.gfnGetMenMonth(s_yyyyMMdd, e_yyyyMMdd), 2);		
		obj.setColumn(e.row, "MEN_MONTH", mm);
		
		var uniost = obj.getColumn(e.row, "UNIT_COST");
		obj.setColumn(e.row, "CONTRACT_PRICE", uniost*mm);		
	}
	else if(["UNIT_COST", "MEN_MONTH"].indexOf(e.columnid) != -1 )
	{
		var uniost = obj.getColumn(e.row, "UNIT_COST");
		var mm = obj.getColumn(e.row, "MEN_MONTH");
		obj.setColumn(e.row, "CONTRACT_PRICE", uniost*mm);
	}
};

// 리포트용 회사 조회
this.fnSearchCoInfo = function()
{
// 	this.gfnAddOutputDataset("dsCompanyList", "dsOutput");
// 	this.gfnCommonTransaction("fnSearchCoInfo", "SP_PurchaseRegSiReport_S01", null, false);
};

// 총판 수수료 리포트
this.fnDistributorFeeReport = function()
{
	var dsPurchaseTmp = new nexacro.Dataset();
	var dsPurchaseDetTmp = new nexacro.Dataset();
	var dsPurchasePayTmp = new nexacro.Dataset();
	
	var ds_CD_PURCHASE_TYPE = this.ds_CD_PURCHASE_TYPE;
	var ds_CD_PRODUCT_UNIT = this.ds_CD_PRODUCT_UNIT;
	
	dsPurchaseTmp.copyData(this.dsPurchase);
	dsPurchaseDetTmp.copyData(this.dsPurchaseDet);
	dsPurchasePayTmp.copyData(this.dsPurchasePay);
	
	dsPurchaseDetTmp.addColumn( "PRODUCT_UNIT_NAME"	, "string" );
	var productUnit, fRow, sProductUnitName;
	for(var i = 0, iL = dsPurchaseDetTmp.getRowCount(); i < iL; i++)
	{
		productUnit = dsPurchaseDetTmp.getColumn(i, "PRODUCT_UNIT");
		fRow = ds_CD_PRODUCT_UNIT.findRow("CODE", productUnit);
		sProductUnitName = ds_CD_PRODUCT_UNIT.getColumn(fRow, "CAPTION");
		
		dsPurchaseDetTmp.setColumn(i, "PRODUCT_UNIT_NAME", sProductUnitName);
	}
	
	dsPurchasePayTmp.addColumn("TITLE1", "string");
	dsPurchasePayTmp.addColumn("TITLE2", "string");
	for(var i = 0, iL = dsPurchasePayTmp.getRowCount(); i < iL; i++)
	{
		dsPurchasePayTmp.setColumn(i, "TITLE1", " 지급조건"					);
		dsPurchasePayTmp.setColumn(i, "TITLE2", "(고객사 지급조건과 동일)"	);
	}
	
	//투비소프트 회사정보 기입
	dsPurchaseTmp.addColumn("COMPANY_ADDRESS", "STRING", 255);
	dsPurchaseTmp.addColumn("COMPANY_NAME", "STRING", 255);
	dsPurchaseTmp.addColumn("COMPANY_CEO", "STRING", 255);
	dsPurchaseTmp.addColumn("PRT_COMPANY_CEO", "STRING", 255);
	dsPurchaseTmp.addColumn("PRT_CEO_NAME", "STRING", 255);
	
	dsPurchaseTmp.setColumn(0, "COMPANY_ADDRESS", this.isUndefineCheck(this.dsCompanyList.getColumn(0, "POST_ADDR")) + this.isUndefineCheck(this.dsCompanyList.getColumn(0, "DETAIL_ADDR")));
	dsPurchaseTmp.setColumn(0, "COMPANY_NAME", this.dsCompanyList.getColumn(0, "COMPANY_NAME"));
	dsPurchaseTmp.setColumn(0, "COMPANY_CEO", this.isUndefineCheck(this.dsCompanyList.getColumn(0, "CEO_NAME")));
	dsPurchaseTmp.setColumn(0, "CONTRACT_MAIN_NAME", dsPurchaseTmp.getColumn(0, "CONTRACT_MAIN_NAME"));
	dsPurchaseTmp.setColumn(0, "PRT_COMPANY_CEO", "대표이사 " + this.isUndefineCheck(this.dsCompanyList.getColumn(0, "CEO_NAME"))); // 투비소프트 대표이사
	dsPurchaseTmp.setColumn(0, "PRT_CEO_NAME", "대표이사 " + this.isUndefineCheck(dsPurchaseTmp.getColumn(0, "CEO_NAME")));
	
	// Dataset 설정
	this.gfn_SetAddInputDs("dsPurchase"			, dsPurchaseTmp);
	this.gfn_SetAddInputDs("dsPurchaseDet"		, dsPurchaseDetTmp);
	this.gfn_SetAddInputDs("dsPurchasePay"		, dsPurchasePayTmp);
	
	this.gfnPopupReportViewer("PRINT_PUCHASE_PRODUCT_D.jrf");
};

this.btn_PurchaseBill_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var bUpdateFlag = false;
	var bDetUpdateFlag = false;
	var bPayUpdateFlag = false;
	var ds = this.dsPurchase;
	var dsDet = this.dsPurchaseDet;
	var dsPay = this.dsPurchasePay;
	var row = ds.rowposition;
	var rowType = ds.getRowType(row);
	var sContractType  = ds.getColumn(row,"CONTRACT_TYPE");
	var sContractNoPurchase = ds.getColumn(row, "CONTRACT_NO_PURCHASE");
	var sLumpPayFlag  = ds.getColumn(row,"LUMP_PAY_FLAG");
	
	if(rowType > 1 || rowType < 1 ) {
		bUpdateFlag = true;
	} 
	
	for(var i = 0; i < dsDet.rowcount; i++) {
		if(dsDet.getRowType(i) > 1 || dsDet.getRowType(i) < 1) {
			bDetUpdateFlag = true;
			break;
		}
	}
	
	for(var i = 0; i < dsPay.rowcount; i++) {
		if(dsPay.getRowType(i) > 1 || dsPay.getRowType(i) < 1) {
			bPayUpdateFlag = true;
			break;
		}
	}
	
	if(!this.fnCanSave())	//저장된 상태일 경우만 출력가능
	{
		return false;
	}
	if( !bUpdateFlag && !bDetUpdateFlag && !bPayUpdateFlag )	// Normal 상태일 경우만 출력가능
	{
		// 데이터 초기화
		this.dsBillPurchaseDet.clearData();
		this.dsBillPurchasePay.clearData();
		
		/*
			매입청구서 포커싱 flag 설정
			매입계약 일괄지급인 경우 or 일괄지급이 아니지만 상품이 단건인 경우
		*/
		if(sLumpPayFlag == "1") {
			var dsPay = this.dsPurchasePay;
			var payRow = dsPay.rowposition;
			
			dsPay.set_enableevent(false);
			var nRow = this.dsBillPurchasePay.addRow();
			this.dsBillPurchasePay.copyRow(nRow, dsPay, payRow);
			dsPay.set_enableevent(true);
			
			this.dsBillPurchaseDet.copyData(this.dsPurchaseDet);
			this.fnBillPurchasePopup("1", false);
		} else if(this.dsPurchaseDet.rowcount > 1) {
			// 조건값 셋팅
			this.gfnAddSendParameter("CONTRACT_NO_PURCHASE",	this.sContractNoPurchase);
			
			// 조회용 Output dataset 세팅
// 			this.gfnAddOutputDataset("dsBill", "dsOutput");
// 			this.gfnCommonTransaction("BillList", "SP_PurchaseBill_S01", null, false);
			this.gfnSetMap("projectMapper", ['SP_PurchaseBill_S01'], ['dsBill']);
			this.gfnCommonTransaction("BillList", "selectNextMultiList.do", null, false);			
			
			if(this.dsBill.rowcount > 0) {
				this.fnBillPurchasePopup("0", true);
			} else {
				//매입청구서 버튼 클릭 했을 때 SP_PurchaseBillPopup 팝업화면 출력.
				var sArgument = {
									sContractType: sContractType
									,sContractNoPurchase: sContractNoPurchase
								};
				this.commUtil.popup(this, "popupPurchaseDetBill", "Sales::SP_PurchaseDetBillPopup.xfdl", -1, -1, 1000, 500, true, true, true, sArgument, "fnPopupCallBack");		
			}			
		} else {
			var dsPay = this.dsPurchasePay;
			var payRow = dsPay.rowposition;
			
			dsPay.set_enableevent(false);
			var nRow = this.dsBillPurchasePay.addRow();
			this.dsBillPurchasePay.copyRow(nRow, dsPay, payRow);
			dsPay.set_enableevent(true);
			
			this.dsBillPurchaseDet.copyData(this.dsPurchaseDet);
			this.fnBillPurchasePopup("1", false);
		}
	} else {
		this.gfnAlert('msg.general',this.gfnGetTransTxt(1392, "저장 후 진행하십시오."));
	}
};

this.fnBillPurchasePopup = function(sFocFlag, bMultiFlag)
{
	var ds = this.dsPurchase;
	var dsDet = this.dsPurchaseDet;
	var dsPay = this.dsPurchasePay;
	var row = ds.rowposition;
	var payRow = dsPay.rowposition;
	var rowType = ds.getRowType(row);
	var sLumpPayFlag  = ds.getColumn(row,"LUMP_PAY_FLAG");
	
	var sContractNoPurchase = ds.getColumn(row, "CONTRACT_NO_PURCHASE");
	var sContractMain = ds.getColumn(row, "CONTRACT_MAIN");
	var sContractMainNm = ds.getColumn(row, "CONTRACT_MAIN_NAME");
	var sContractType  = ds.getColumn(row,"CONTRACT_TYPE");
	var sContractName  = ds.getColumn(row,"CONTRACT_NAME");
	var sClientName  = ds.getColumn(row,"CLIENT_NAME");
	
	var sStartDate, sEndDate;
	if(sContractType == "S") {
		if(bMultiFlag) {
 			sStartDate = this.dsBillPurchaseDet.getMin("PAY_START_DATE");
 			sEndDate = this.dsBillPurchaseDet.getMax("PAY_END_DATE");
		} else {
			sStartDate = dsPay.getColumn(payRow,"START_DATE");
			sEndDate = dsPay.getColumn(payRow,"END_DATE");
		}
	} else {
		sStartDate = ds.getColumn(row,"START_DATE");
		sEndDate = ds.getColumn(row,"END_DATE");
	}
	
	//매입청구서 버튼 클릭 했을 때 SP_PurchaseBillPopup 팝업화면 출력.
	var sArgument = {
						sContractType: sContractType
						,sContractMain: sContractMain
						,sContractMainNm : sContractMainNm
						,sClientName : sClientName
						,sContractNoPurchase: sContractNoPurchase
						,sContractName: sContractName
						,sStartDate: sStartDate
						,sEndDate: sEndDate
						,sFocusFlag : sFocFlag
						,sLumpPayFlag : sLumpPayFlag
						,dsPurchaseDet: this.dsBillPurchaseDet
						,dsPurchasePay: this.dsBillPurchasePay
					};
	this.commUtil.popup(this, "popupPurchaseBill", "Sales::SP_PurchaseBillPopup.xfdl", -1, -1, 1000, 500, true, true, true, sArgument, "fnPopupCallBack");

};
this.fnPurchaseBillSetBtn = function(sContractMain)
{
	if(sContractMain == "TOBE") this.btn_PurchaseBill.set_visible(true);
	else this.btn_PurchaseBill.set_visible(false);
};
]]></Script>
    <Objects>
      <Dataset id="dsPurchase" oncolumnchanged="dsPurchase_oncolumnchanged" cancolumnchange="dsPurchase_cancolumnchange" onrowposchanged="dsPurchase_onrowposchanged" onload="dsPurchase_onload">
        <ColumnInfo>
          <Column id="CONTRACT_NO_PURCHASE" type="STRING" size="10"/>
          <Column id="PROJECT_CODE" type="STRING" size="15"/>
          <Column id="CONTRACT_NAME" type="STRING" size="100"/>
          <Column id="CONTRACT_TYPE" type="STRING" size="20"/>
          <Column id="PURCHASE_TYPE" type="STRING" size="20"/>
          <Column id="PAY_TERM" type="STRING" size="20"/>
          <Column id="LUMP_PAY_FLAG" type="STRING" size="1"/>
          <Column id="CONTRACT_MAIN" type="STRING" size="20"/>
          <Column id="CONTRACT_MAIN_NAME" type="STRING" size="100"/>
          <Column id="CONTRACT_DATE" type="STRING" size="8"/>
          <Column id="CONTRACT_NO" type="STRING" size="10"/>
          <Column id="PROGRESS_100_FLAG" type="STRING" size="1"/>
          <Column id="PROGRESS_EXCEPT_FLAG" type="STRING" size="1"/>
          <Column id="CONTRACT_DOC_NO" type="STRING" size="50"/>
          <Column id="CONTRACT_NO_PURCHASE_PRE" type="STRING" size="10"/>
          <Column id="REMARKS" type="STRING" size="1073741823"/>
          <Column id="CONTRACT_STATUS" type="STRING" size="20"/>
          <Column id="PROJECT_NAME" type="STRING" size="100"/>
          <Column id="CLIENT_CODE" type="STRING" size="20"/>
          <Column id="CLIENT_NAME" type="STRING" size="100"/>
          <Column id="CL_CONTRACT_NO" type="STRING" size="10"/>
          <Column id="CL_CONTRACT_NAME" type="STRING" size="100"/>
          <Column id="CL_CONTRACT_MAIN" type="STRING" size="20"/>
          <Column id="CL_CONTRACT_STATUS" type="STRING" size="20"/>
          <Column id="CL_CONTRACT_TYPE" type="STRING" size="20"/>
          <Column id="CL_SALES_EMP_NO" type="STRING" size="60"/>
          <Column id="CL_SALES_EMP_NAME" type="STRING" size="255"/>
          <Column id="CL_SALES_PHONE_NO" type="STRING" size="1073741823"/>
          <Column id="CL_SALES_EMAIL" type="STRING" size="201"/>
          <Column id="PERIOD_FLAG" type="STRING" size="1"/>
          <Column id="COMMISSION_RATE" type="FLOAT" size="22"/>
          <Column id="MONTH_UNIT_PRICE" type="FLOAT" size="22"/>
          <Column id="START_DATE" type="STRING" size="8"/>
          <Column id="END_DATE" type="STRING" size="8"/>
          <Column id="PAY_METHOD" type="STRING" size="20"/>
          <Column id="NET_SALES_FLAG" type="STRING" size="1"/>
          <Column id="R_DELIVERY_CONDITION" type="STRING" size="100"/>
          <Column id="R_DELIVERY_PLACE" type="STRING" size="100"/>
          <Column id="R_ORDER_CONDITION" type="STRING" size="100"/>
          <Column id="R_DELAY" type="STRING" size="100"/>
          <Column id="R_BILLING" type="STRING" size="100"/>
          <Column id="R_PAYMENT" type="STRING" size="100"/>
          <Column id="R_WARRANTY" type="STRING" size="100"/>
          <Column id="R_ETC" type="STRING" size="200"/>
          <Column id="F_CLIENT_NAME_ENG" type="STRING" size="100"/>
          <Column id="F_CHARGE_EMPNM" type="STRING" size="100"/>
          <Column id="F_CHARGE_EMP_PHONE" type="STRING" size="100"/>
          <Column id="F_CHARGE_EMP_EMAIL" type="STRING" size="100"/>
          <Column id="PURCHASE_COMPANY_CODE" type="STRING" size="4"/>
          <Column id="ADDRESS" type="STRING" size="100"/>
          <Column id="CEO_NAME" type="STRING" size="30"/>
          <Column id="COMPANY_REG_NO" type="STRING" size="20"/>
          <Column id="CHARGE_EMPNM" type="STRING" size="100"/>
          <Column id="CHARGE_EMPPHONE" type="STRING" size="30"/>
          <Column id="CHARGE_EMPEMAIL" type="STRING" size="200"/>
          <Column id="CONTRACT_NO_PURCHASE_SEQ" type="STRING" size="1073741823"/>
          <Column id="TURNKEY_FLAG" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsPurchaseDet" oncolumnchanged="dsPurchaseDet_oncolumnchanged" onrowposchanged="dsPurchaseDet_onrowposchanged" cancolumnchange="dsPurchaseDet_cancolumnchange">
        <ColumnInfo>
          <Column id="PPD_SEQ" type="bigdecimal" size="20"/>
          <Column id="CONTRACT_NO_PURCHASE" type="string" size="10"/>
          <Column id="PRODUCT_CODE" type="string" size="20"/>
          <Column id="PRODUCT_NAME" type="string" size="100"/>
          <Column id="RELATED_PRODUCT_CODE" type="string" size="20"/>
          <Column id="RELATED_PRODUCT_NAME" type="string" size="100"/>
          <Column id="UNIT_COST" type="bigdecimal" size="20"/>
          <Column id="PRODUCT_UNIT" type="string" size="20"/>
          <Column id="QUANTITY" type="int" size="11"/>
          <Column id="COMMISSION_RATE" type="bigdecimal" size="20"/>
          <Column id="CONTRACT_PRICE" type="bigdecimal" size="20"/>
          <Column id="VAT_PRICE" type="bigdecimal" size="20"/>
          <Column id="START_DATE" type="string" size="8"/>
          <Column id="END_DATE" type="string" size="8"/>
          <Column id="REMARKS" type="string" size="1073741823"/>
          <Column id="DELETE_FLAG" type="string" size="1"/>
          <Column id="REPROT_PRODUCT_NAME" type="string" size="255"/>
          <Column id="PSD_SEQ" type="bigdecimal" size="20"/>
          <Column id="EMP_NO" type="string" size="60"/>
          <Column id="EMP_NAME" type="string" size="255"/>
          <Column id="TURNKEY_NAME" type="STRING" size="256"/>
          <Column id="LEVEL_CODE" type="string" size="20"/>
          <Column id="MEN_MONTH" type="bigdecimal" size="20"/>
          <Column id="EXPENSE" type="bigdecimal" size="20"/>
          <Column id="NONRESIDENT_FLAG" type="string" size="1"/>
          <Column id="CSD_SEQ" type="bigdecimal" size="20"/>
          <Column id="CSD_UNIT_COST" type="bigdecimal" size="20"/>
          <Column id="REGISTER_NO" type="string" size="13"/>
          <Column id="COMPANY_CODE" type="string" size="255"/>
          <Column id="CO_NAME" type="string" size="255"/>
          <Column id="ROYALTY_TYPE" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsPurchasePay" oncolumnchanged="dsPurchasePay_oncolumnchanged" onrowsetchanged="dsPurchasePay_onrowsetchanged">
        <ColumnInfo>
          <Column id="ROW_NO" type="LONG" size="20"/>
          <Column id="PPY_SEQ" type="BIGDECIMAL" size="20"/>
          <Column id="CONTRACT_NO_PURCHASE" type="STRING" size="10"/>
          <Column id="PPD_SEQ" type="BIGDECIMAL" size="20"/>
          <Column id="PSD_SEQ" type="BIGDECIMAL" size="20"/>
          <Column id="PAY_TERM" type="STRING" size="20"/>
          <Column id="PAY_PLAN_DATE" type="STRING" size="8"/>
          <Column id="PAY_DATE" type="STRING" size="8"/>
          <Column id="START_DATE" type="STRING" size="8"/>
          <Column id="END_DATE" type="STRING" size="8"/>
          <Column id="PAY_FLAG" type="STRING" size="1"/>
          <Column id="TAX_DATE" type="STRING" size="8"/>
          <Column id="TAX_PRICE" type="FLOAT" size="22"/>
          <Column id="VAT_PRICE" type="FLOAT" size="22"/>
          <Column id="REMARKS" type="STRING" size="1073741823"/>
          <Column id="DELETE_FLAG" type="STRING" size="1"/>
          <Column id="MAX_PAY_PLAN_DATE" type="STRING" size="256"/>
          <Column id="PPY_GROUP_FLAG" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_CD_PURCHASE_TYPE"/>
      <Dataset id="ds_CD_PAY_TERM"/>
      <Dataset id="ds_CD_PAY_METHOD"/>
      <Dataset id="ds_CD_PRODUCT_UNIT"/>
      <Dataset id="dsProdContract">
        <ColumnInfo>
          <Column id="PRODUCT_NAME" type="STRING" size="100"/>
          <Column id="PRODUCT_CODE" type="STRING" size="20"/>
          <Column id="PURPOSE_NAME" type="STRING" size="100"/>
          <Column id="ISDEV_FLAG" type="STRING" size="1"/>
          <Column id="CONTRACT_NO" type="STRING" size="10"/>
          <Column id="UNIT_COST" type="FLOAT" size="22"/>
          <Column id="SERVER_GRADE_NAME" type="STRING" size="100"/>
          <Column id="PRODUCT_UNIT_NAME" type="STRING" size="100"/>
          <Column id="PRODUCT_UNIT" type="STRING" size="20"/>
          <Column id="QUANTITY" type="INT" size="11"/>
          <Column id="CONTRACT_PRICE" type="FLOAT" size="22"/>
          <Column id="REMARKS" type="STRING" size="1073741823"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsNewKey"/>
      <Dataset id="dsNewDocNo">
        <ColumnInfo>
          <Column id="CONTRACT_NO_PURCHASE" type="STRING" size="256"/>
          <Column id="CONTRACT_DOC_NO_NEW" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_CD_CONTRACT_TYPE"/>
      <Dataset id="dsProdContractM">
        <ColumnInfo>
          <Column id="CLIENT_CODE" type="string" size="20"/>
          <Column id="CLIENT_NAME" type="string" size="100"/>
          <Column id="PROJECT_CODE" type="string" size="15"/>
          <Column id="PROJECT_NAME" type="string" size="100"/>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="CONTRACT_NAME" type="string" size="100"/>
          <Column id="PRODUCT_CODE" type="string" size="20"/>
          <Column id="PRODUCT_NAME" type="string" size="100"/>
          <Column id="CONTRACT_NO_PURCHASE" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_CD_LEVEL_CODE"/>
      <Dataset id="ds_CD_CONTRACT_ADD_TYPE"/>
      <Dataset id="dsList" onrowposchanged="dsList_onrowposchanged" onload="dsList_onload">
        <ColumnInfo>
          <Column id="CONTRACT_NO_PURCHASE" type="string" size="10"/>
          <Column id="CONTRACT_NAME" type="string" size="100"/>
          <Column id="UPDATE_DATE" type="datetime" size="23"/>
          <Column id="UPDATE_EMP_NAME" type="string" size="255"/>
          <Column id="DELETE_FLAG" type="string" size="1"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsProdContractTotal" oncolumnchanged="dsProdContractTotal_oncolumnchanged"/>
      <Dataset id="dsCompanyList">
        <ColumnInfo>
          <Column id="COMPANY_NAME" type="STRING" size="100"/>
          <Column id="COMPANY_REG_NO" type="STRING" size="30"/>
          <Column id="CEO_NAME" type="STRING" size="100"/>
          <Column id="BUSINESS_FORM_NAME" type="STRING" size="30"/>
          <Column id="BUSINESS_KIND_NAME" type="STRING" size="30"/>
          <Column id="PHONE_NO" type="STRING" size="30"/>
          <Column id="FAX_NO" type="STRING" size="30"/>
          <Column id="POST_NO" type="STRING" size="10"/>
          <Column id="POST_ADDR" type="STRING" size="255"/>
          <Column id="DETAIL_ADDR" type="STRING" size="255"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsPurchaseCompanyInfo">
        <ColumnInfo>
          <Column id="COMPANY_NAME" type="STRING" size="255"/>
          <Column id="TAG" type="STRING" size="255"/>
          <Column id="CLIENT_FLAG" type="STRING" size="255"/>
          <Column id="COMPANY_FLAG" type="STRING" size="255"/>
          <Column id="TMP_FLAG" type="STRING" size="255"/>
          <Column id="BLACKLIST_FLAG" type="STRING" size="255"/>
          <Column id="NATION_CODE" type="STRING" size="255"/>
          <Column id="BUSINESS_SCALE" type="STRING" size="255"/>
          <Column id="L_CATEGORY" type="STRING" size="255"/>
          <Column id="M_CATEGORY" type="STRING" size="255"/>
          <Column id="COMPANY_REG_NO" type="STRING" size="255"/>
          <Column id="CORPORATE_REG_NO" type="STRING" size="255"/>
          <Column id="INCORPORATION_DATE" type="STRING" size="255"/>
          <Column id="CEO_NAME" type="STRING" size="255"/>
          <Column id="CEO_PHONE" type="STRING" size="255"/>
          <Column id="POST_NO" type="STRING" size="255"/>
          <Column id="POST_ADDR" type="STRING" size="255"/>
          <Column id="DETAIL_ADDR" type="STRING" size="256"/>
          <Column id="PHONE_NO" type="STRING" size="255"/>
          <Column id="FAX_NO" type="STRING" size="255"/>
          <Column id="BUSINESS_FORM" type="STRING" size="255"/>
          <Column id="BUSINESS_KIND" type="STRING" size="255"/>
          <Column id="PURCHASE_COMPANY_CODE" type="STRING" size="255"/>
          <Column id="PRODUCT_FLAG" type="STRING" size="255"/>
          <Column id="SI_FLAG" type="STRING" size="255"/>
          <Column id="SOLUTION_FLAG" type="STRING" size="255"/>
          <Column id="GOODS_FLAG" type="STRING" size="255"/>
          <Column id="PARTNER_FLAG" type="STRING" size="255"/>
          <Column id="PARTNER_KIND" type="STRING" size="255"/>
          <Column id="COMPANY_STATE" type="STRING" size="255"/>
          <Column id="COMPANY_KIND" type="STRING" size="255"/>
          <Column id="BANK_CODE" type="STRING" size="255"/>
          <Column id="ACCOUNT_NO" type="STRING" size="255"/>
          <Column id="ACCOUNT_NAME" type="STRING" size="255"/>
          <Column id="SI_VIEW_FLAG" type="STRING" size="255"/>
          <Column id="COLLECTION_BOND_FLAG" type="STRING" size="255"/>
          <Column id="CL_APPROVAL_EMP_NO" type="STRING" size="255"/>
          <Column id="CL_ASSET" type="STRING" size="255"/>
          <Column id="CL_EMP_NUMBER" type="STRING" size="255"/>
          <Column id="CL_APPROVAL_DATE" type="STRING" size="255"/>
          <Column id="CL_CAPITAL" type="STRING" size="255"/>
          <Column id="CL_OPINION" type="STRING" size="255"/>
          <Column id="CL_PS" type="STRING" size="255"/>
          <Column id="CL_ANNUAL_SALES" type="STRING" size="255"/>
          <Column id="CL_SI" type="STRING" size="255"/>
          <Column id="CL_NET_INCOME" type="STRING" size="255"/>
          <Column id="CL_EVALUATION" type="STRING" size="255"/>
          <Column id="CL_LISTED_FLAG" type="STRING" size="255"/>
          <Column id="CL_EXCEPTION_CODE" type="STRING" size="255"/>
          <Column id="CL_ADD_SCORE1" type="STRING" size="255"/>
          <Column id="CL_ADD_SCORE2" type="STRING" size="255"/>
          <Column id="CL_ADD_SCORE3" type="STRING" size="255"/>
          <Column id="REMARKS" type="STRING" size="255"/>
          <Column id="DELETE_FLAG" type="STRING" size="255"/>
          <Column id="INSERT_DATE" type="STRING" size="255"/>
          <Column id="INSERT_EMP_NO" type="STRING" size="255"/>
          <Column id="INSERT_DEPT_CD" type="STRING" size="255"/>
          <Column id="INSERT_MODEL" type="STRING" size="255"/>
          <Column id="UPDATE_DATE" type="STRING" size="255"/>
          <Column id="UPDATE_EMP_NO" type="STRING" size="255"/>
          <Column id="UPDATE_DEPT_CD" type="STRING" size="255"/>
          <Column id="UPDATE_DEPT_NM" type="STRING" size="255"/>
          <Column id="UPDATE_MODEL" type="STRING" size="255"/>
          <Column id="REST" type="STRING" size="256"/>
          <Column id="CL_APPROVAL_EMP_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_CD_BaseMM">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CAPTION" type="STRING" size="256"/>
          <Column id="CAPTION_JAP" type="STRING" size="256"/>
          <Column id="CAPTION_ENG" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CODE">1</Col>
            <Col id="CAPTION">월말</Col>
            <Col id="CAPTION_JAP">月末&#13;</Col>
          </Row>
          <Row>
            <Col id="CODE">2</Col>
            <Col id="CAPTION">한달</Col>
            <Col id="CAPTION_JAP">一ヶ月</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_CD_ROYALTY_TYPE">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CAPTION" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsBillPurchaseDet" oncolumnchanged="dsPurchaseDet_oncolumnchanged" onrowposchanged="dsPurchaseDet_onrowposchanged" cancolumnchange="dsPurchaseDet_cancolumnchange"/>
      <Dataset id="dsBillPurchasePay" oncolumnchanged="dsPurchasePay_oncolumnchanged" onrowsetchanged="dsPurchasePay_onrowsetchanged">
        <ColumnInfo>
          <Column id="ROW_NO" type="LONG" size="20"/>
          <Column id="PPY_SEQ" type="BIGDECIMAL" size="20"/>
          <Column id="CONTRACT_NO_PURCHASE" type="STRING" size="10"/>
          <Column id="PPD_SEQ" type="BIGDECIMAL" size="20"/>
          <Column id="PSD_SEQ" type="BIGDECIMAL" size="20"/>
          <Column id="PAY_TERM" type="STRING" size="20"/>
          <Column id="PAY_PLAN_DATE" type="STRING" size="8"/>
          <Column id="PAY_DATE" type="STRING" size="8"/>
          <Column id="START_DATE" type="STRING" size="8"/>
          <Column id="END_DATE" type="STRING" size="8"/>
          <Column id="PAY_FLAG" type="STRING" size="1"/>
          <Column id="TAX_DATE" type="STRING" size="8"/>
          <Column id="TAX_PRICE" type="FLOAT" size="22"/>
          <Column id="VAT_PRICE" type="FLOAT" size="22"/>
          <Column id="REMARKS" type="STRING" size="1073741823"/>
          <Column id="DELETE_FLAG" type="STRING" size="1"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsBill" onrowposchanged="dsBill_onrowposchanged">
        <ColumnInfo>
          <Column id="PB_SEQ" type="INT" size="256"/>
          <Column id="CONTRACT_NO_PURCHASE" type="STRING" size="256"/>
          <Column id="YEAR" type="STRING" size="256"/>
          <Column id="CONTRACT_TYPE" type="STRING" size="256"/>
          <Column id="BILL_DELIVERY_NO" type="STRING" size="256"/>
          <Column id="PUBLISHED_DATE" type="STRING" size="256"/>
          <Column id="CONTRACT_NAME_PURCHASE" type="STRING" size="256"/>
          <Column id="START_DATE" type="STRING" size="256"/>
          <Column id="END_DATE" type="STRING" size="256"/>
          <Column id="REMARKS" type="STRING" size="256"/>
          <Column id="INSERT_EMP_NO" type="STRING" size="256"/>
          <Column id="INSERT_EMP_NAME" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item16" compid="chb_SalesDeliveryDateChangeFlag" propid="value" datasetid="dsPurchase" columnid="OVERWRITE_SALES_DELIVERY_DATE"/>
      <BindItem id="item0" compid="div_Sales_List.form.div_Remarks.form.txt_Remark" propid="value" datasetid="dsPurchase" columnid="REMARKS"/>
      <BindItem id="item1" compid="div_Sales_List.form.div_Remarks.form.txt_RemarkDet" propid="value" datasetid="dsPurchaseDet" columnid="REMARKS"/>
      <BindItem id="item2" compid="div_Sales_List.form.cmb_ProductType" propid="value" datasetid="dsPurchase" columnid="PURCHASE_TYPE"/>
      <BindItem id="item3" compid="div_Sales_List.form.edt_ResponsibilitySales" propid="value" datasetid="dsPurchase" columnid="CL_SALES_EMP_NAME"/>
      <BindItem id="item4" compid="div_Sales_List.form.chb_NetSales" propid="value" datasetid="dsPurchase" columnid="NET_SALES_FLAG"/>
      <BindItem id="item5" compid="div_Sales_List.form.edt_CompanyCode" propid="value" datasetid="dsPurchase" columnid="PURCHASE_COMPANY_CODE"/>
      <BindItem id="item6" compid="div_Sales_List.form.cmb_ProvideType" propid="value" datasetid="dsPurchase" columnid="PAY_TERM"/>
      <BindItem id="item7" compid="div_ContractPeriod.form.cal_ContractPeriodEndDate" propid="value" datasetid="dsPurchase" columnid="END_DATE"/>
      <BindItem id="item8" compid="div_ContractPeriod.form.cal_ContractPeriodStartDate" propid="value" datasetid="dsPurchase" columnid="START_DATE"/>
      <BindItem id="item9" compid="div_ContractPeriod.form.cmb_PayMethod" propid="value" datasetid="dsPurchase" columnid="PAY_METHOD"/>
      <BindItem id="item10" compid="div_ContractPeriod.form.chb_Period" propid="value" datasetid="dsPurchase" columnid="PERIOD_FLAG"/>
      <BindItem id="item11" compid="div_Sales_List.form.edt_PurchaseContractName" propid="value" datasetid="dsPurchase" columnid="CONTRACT_NAME"/>
      <BindItem id="item12" compid="div_Sales_List.form.cal_ContractDate" propid="value" datasetid="dsPurchase" columnid="CONTRACT_DATE"/>
      <BindItem id="item13" compid="div_Sales_List.form.edt_ContractDocNo" propid="value" datasetid="dsPurchase" columnid="CONTRACT_DOC_NO"/>
      <BindItem id="item14" compid="edt_ContractDocNoPre" propid="value" datasetid="dsPurchase" columnid="CONTRACT_DOC_NO_PRE"/>
      <BindItem id="item15" compid="div_Sales_List.form.chb_LumpPay" propid="value" datasetid="dsPurchase" columnid="LUMP_PAY_FLAG"/>
      <BindItem id="item17" compid="div_Sales_List.form.div_ContractPeriod.form.cal_ContractPeriodEndDate" propid="value" datasetid="dsPurchase" columnid="END_DATE"/>
      <BindItem id="item18" compid="div_Sales_List.form.div_ContractPeriod.form.cal_ContractPeriodStartDate" propid="value" datasetid="dsPurchase" columnid="START_DATE"/>
      <BindItem id="item19" compid="div_Sales_List.form.div_ContractPeriod.form.cmb_PayMethod" propid="value" datasetid="dsPurchase" columnid="PAY_METHOD"/>
      <BindItem id="item20" compid="div_Sales_List.form.div_ContractPeriod.form.chb_Period" propid="value" datasetid="dsPurchase" columnid="PERIOD_FLAG"/>
      <BindItem id="item21" compid="div_Sales_List.form.edt_ContractDocNoPre" propid="value" datasetid="dsPurchase" columnid="CONTRACT_DOC_NO_PRE"/>
      <BindItem id="item22" compid="div_Sales_List.form.cmb_ContractAddType" propid="value" datasetid="dsPurchase" columnid="CONTRACT_ADD_TYPE"/>
      <BindItem id="item23" compid="div_Sales_List.form.chb_IsIncludeRemark" propid="value" datasetid="dsPurchase" columnid="REMARKS_FLAG"/>
      <BindItem id="item24" compid="div_Sales_List.form.chb_MainContractReport" propid="value" datasetid="dsPurchase" columnid="MAINCONTRACT_REPORT_FLAG"/>
    </Bind>
  </Form>
</FDL>
