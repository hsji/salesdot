<?xml version="1.0" encoding="utf-8"?>
<FDL version="2.1">
  <Form id="SS_SalesMM" width="1290" height="600" titletext="영업관리" onload="SS_SalesMM_onload">
    <Layouts>
      <Layout height="600" mobileorientation="landscape" width="1290">
        <Tab id="tab_Progess" taborder="10" left="0" tabindex="0" scrollbars="autoboth" onchanged="Div03_Tab00_onchanged" width="554" bottom="0" height="211">
          <Tabpages>
            <Tabpage id="tpg_Progess" text="진행사항" TL_SEQ="65">
              <Layouts>
                <Layout>
                  <Grid id="grd_Date" taborder="6" left="5" top="10" width="97" autofittype="col" bottom="0" binddataset="dsScheduleList" readonly="true">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="80"/>
                        </Columns>
                        <Rows>
                          <Row size="28" band="head"/>
                          <Row size="28"/>
                        </Rows>
                        <Band id="head">
                          <Cell text="일자" TL_SEQ="67"/>
                        </Band>
                        <Band id="body">
                          <Cell text="bind:ISSUE_DATE" edittype="none" displaytype="date" calendardateformat="yyyy-MM-dd"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                  <Static id="stc_TypeCode" taborder="7" text="구분" left="101.00" top="5" width="59" height="24" cssclass="sta_WF_detailLbl01" textAlign="right" TL_SEQ="68"/>
                  <Static id="stc_IssueDate" taborder="8" text="일자" left="320.00" top="5" width="70" height="24" cssclass="sta_WF_detailLbl01" textAlign="right" TL_SEQ="67"/>
                  <Static id="stc_ProgressContent" taborder="9" text="내용" left="101.00" top="59" width="59" cssclass="sta_WF_detailLbl01" textAlign="right" bottom="0" TL_SEQ="69"/>
                  <Combo id="cmb_TypeCode" taborder="0" text="" left="stc_TypeCode:5" top="5" width="157" height="24" innerdataset="ds_cmm_Type" codecolumn="CODE" datacolumn="CAPTION"/>
                  <Calendar id="cal_IssueDate" taborder="1" left="stc_IssueDate:5" top="5" height="24" width="128" autoselect="true"/>
                  <TextArea id="txt_ProgressContent" taborder="5" left="165.00" top="66" bottom="0" right="5"/>
                  <Combo id="cmb_Importance00" taborder="2" text="" left="165.00" top="35" width="157" height="24" innerdataset="ds_cmm_Importance" codecolumn="CODE" datacolumn="CAPTION"/>
                  <CheckBox id="chb_MakePublic01" taborder="3" text="보고" left="364.00" top="35" width="54" height="24" falsevalue="0" truevalue="1" TL_SEQ="70"/>
                  <CheckBox id="chb_MakePublic02" taborder="4" text="공개" left="425.00" top="35" width="52" height="24" falsevalue="0" truevalue="1" TL_SEQ="71"/>
                  <Static id="stc_Importance00" taborder="10" text="중요도" left="101.00" top="32" width="59" height="24" cssclass="sta_WF_detailLbl01" textAlign="right" TL_SEQ="72"/>
                </Layout>
              </Layouts>
            </Tabpage>
            <Tabpage id="tpg_PersonInCharge" text="담당자" TL_SEQ="66">
              <Layouts>
                <Layout>
                  <Grid id="grd_PersonInCharge" taborder="0" scrollbars="alwaysvert" autoenter="select" useinputpanel="false" cellsizingtype="col" autofittype="col" left="0" top="4" visible="true" right="0" bottom="0" binddataset="dsAddressbookList" oncelldblclick="tab_Progess_tpg_PersonInCharge_grd_PersonInCharge_oncelldblclick">
                    <Formats>
                      <Format id="default">
                        <Columns>
                          <Column size="48"/>
                          <Column size="100"/>
                          <Column size="75"/>
                          <Column size="70"/>
                          <Column size="70"/>
                          <Column size="70"/>
                          <Column size="60"/>
                          <Column size="60"/>
                          <Column size="80"/>
                        </Columns>
                        <Rows>
                          <Row size="24" band="head"/>
                          <Row size="24" band="head"/>
                          <Row size="24"/>
                          <Row size="24"/>
                        </Rows>
                        <Band id="head">
                          <Cell colspan="2" text="회사" TL_SEQ="73"/>
                          <Cell col="2" text="부서" TL_SEQ="74"/>
                          <Cell col="3" text="담당자" TL_SEQ="66"/>
                          <Cell col="4" text="직급" TL_SEQ="26"/>
                          <Cell col="5" text="역할" TL_SEQ="75"/>
                          <Cell col="6" colspan="2" text="핸드폰" TL_SEQ="76"/>
                          <Cell col="8" text="등록일" TL_SEQ="77"/>
                          <Cell row="1" text="현황" TL_SEQ="78"/>
                          <Cell row="1" col="1" text="유선" TL_SEQ="79"/>
                          <Cell row="1" col="2" colspan="3" text="이메일" TL_SEQ="80"/>
                          <Cell row="1" col="5" colspan="3" text="비고" TL_SEQ="45"/>
                          <Cell row="1" col="8" text="등록자" TL_SEQ="81"/>
                        </Band>
                        <Band id="body">
                          <Cell colspan="2" textAlign="left" text="bind:COMPANY_NAME"/>
                          <Cell col="2" text="bind:DEPT_NAME" textAlign="left"/>
                          <Cell col="3" text="bind:EMP_NAME"/>
                          <Cell col="4" text="bind:GRADE_CODE" displaytype="combotext" combodataset="ds_cmm_CaGrade" combocodecol="CODE" combodatacol="CAPTION"/>
                          <Cell col="5" text="bind:ROLE_CODE" combodataset="ds_cmm_CaRole" combocodecol="CODE" combodatacol="CAPTION" displaytype="combotext"/>
                          <Cell col="6" colspan="2" text="bind:H_PHONE_NO" textAlign="left"/>
                          <Cell col="8" text="bind:INSERT_DATE" displaytype="date" calendardateformat="yyyy-MM-dd"/>
                          <Cell row="1" text="bind:HOLD_OFFICE" displaytype="combotext" combodataset="ds_cmm_HoldOffice" combocodecol="CODE" combodatacol="CAPTION"/>
                          <Cell row="1" col="1" text="bind:O_PHONE_NO" textAlign="left"/>
                          <Cell row="1" col="2" colspan="3" text="bind:EMAIL" textAlign="left"/>
                          <Cell row="1" col="5" colspan="3" text="bind:REMARKS" textAlign="left"/>
                          <Cell row="1" col="8" text="bind:INSERT_EMP_NAME"/>
                        </Band>
                      </Format>
                    </Formats>
                  </Grid>
                </Layout>
              </Layouts>
            </Tabpage>
          </Tabpages>
        </Tab>
        <Div id="div_search" taborder="0" text="" left="0" top="0" height="79" right="20" cssclass="div_WF_Search" formscrolltype="none">
          <Layouts>
            <Layout>
              <Static id="stc_ClientCode" taborder="10" text=" 고객사" left="0" top="12" width="89" height="24" cssclass="sta_WF_SchLabel" TL_SEQ="32"/>
              <Static id="stc_SalesRepresent" taborder="14" text="영업대표" left="0" top="stc_ClientCode:5" width="89" height="24" cssclass="sta_WF_SchLabel" TL_SEQ="55"/>
              <Combo id="cmb_SalesRepresent" taborder="0" text="" left="stc_SalesRepresent:0.00" top="41" height="24" innerdataset="ds_cond_sales_emp" codecolumn="EMP_NO" datacolumn="FULL_NAME" width="209"/>
              <Static id="stc_SalesStatus" taborder="15" text="영업상태" left="cmb_SalesRepresent:0.00" top="41" width="89" height="24" cssclass="sta_WF_SchLabel" TL_SEQ="84"/>
              <Combo id="cmb_SalesStatus" taborder="1" text="영업실패 제외" left="stc_SalesStatus:0" top="41" height="24" innerdataset="ds_SalesStatus" codecolumn="CODE" datacolumn="DATA" width="127" TL_FLAG="1" index="0" value="0"/>
              <Button id="btn_Save" taborder="3" text="저장" top="8" width="60" height="22" right="8" onclick="div_search_btn_Save_onclick" enable="false" cssclass="btn_WF_tran" TL_SEQ="115" visible="false"/>
              <Button id="btn_Add" taborder="5" text="신규" top="8" width="60" height="22" right="136" onclick="div_search_btn_Add_onclick" enable="false" cssclass="btn_WF_tran" TL_SEQ="116" visible="false"/>
              <Button id="btn_Excel" taborder="4" text="Excel" top="8" width="60" height="22" right="btn_Add:4" onclick="div_search_btn_Excel_onclick" cssclass="btn_WF_Excel" visible="false"/>
              <Button id="btn_Delete" taborder="6" text="삭제" top="8" width="60" height="22" right="btn_Save:4" onclick="div_search_btn_Delete_onclick" enable="false" cssclass="btn_WF_tran" TL_SEQ="117" visible="false"/>
              <Div id="div_ClientName" taborder="8" text="Div00" left="stc_ClientCode:0" top="12" height="24" url="sales::comm/COM_Search.xfdl" kind="CLIENT" param="" enable_keydownevent="false" user_onchanged="" onkeyup="div_search_div_ClientName_onkeyup" width="209"/>
              <Static id="stc_Project" taborder="11" text="프로젝트" left="div_ClientName:0.00" top="12" width="89" height="24" cssclass="sta_WF_SchLabel" TL_SEQ="119"/>
              <Div id="div_ProjectName" taborder="7" text="Div00" left="stc_Project:0" top="12" height="24" url="sales::comm/COM_Search.xfdl" kind="PROJECT" param="" enable_keydownevent="false" onkeyup="div_search_div_ProjectName_onkeyup" width="241"/>
              <Button id="btn_Search" taborder="9" text="조회" top="39" width="48" height="28" cssclass="btn_WF_Search" right="8" onclick="div_search_btn_Search_onclick" TL_SEQ="118"/>
              <Static id="stc_DueDate" taborder="12" text="계약기간" left="cmb_SalesStatus:114.00" top="41" width="89" height="24" cssclass="sta_WF_SchLabel" TL_SEQ="120"/>
              <Static id="stc_ContractStatus" taborder="13" text="계약상태" left="div_ProjectName:0.00" top="12" width="89" height="24" cssclass="sta_WF_SchLabel" TL_SEQ="121"/>
              <Combo id="cmb_ContractStatus" taborder="2" text="" left="stc_ContractStatus:0" top="12" height="24" innerdataset="ds_cmm_ContractStatus" codecolumn="CODE" datacolumn="CAPTION" width="127"/>
              <Div id="div_Search_yyyyMM_FromTo" taborder="16" left="stc_DueDate:0" top="41" width="221" height="24" url="sales::comm/COM_yyyyMM_FromTo2.xfdl"/>
              <CheckBox id="chk_NoneDate" taborder="17" text="기간무시" left="div_Search_yyyyMM_FromTo:10" top="41" width="74" height="24" falsevalue="0" truevalue="1" TL_SEQ="122"/>
              <Radio id="rd_EmpKind" taborder="18" left="chk_NoneDate:19.00" top="41" width="154" height="24" innerdataset="ds_EmpKind" codecolumn="CODE" datacolumn="DATA" columncount="2" rowcount="1" index="0" text="영업대표" value="E" visible="false" TL_FLAG="1"/>
              <Static id="stc_ContractType" taborder="19" text="계약구분" left="cmb_ContractStatus:0.00" top="12" width="89" height="24" cssclass="sta_WF_SchLabel" TL_SEQ="123"/>
              <Combo id="cmb_ContractType" taborder="20" text="" left="stc_ContractType:0" top="12" height="24" codecolumn="CODE" datacolumn="DATA" innerdataset="ds_ContractType" width="127" TL_FLAG="1"/>
            </Layout>
          </Layouts>
        </Div>
        <Button id="btn_Order_Confirm" taborder="1" text="계약확정" top="89" width="84" height="28" right="20" onclick="btn_Order_Confirm_onclick" enable="false" TL_SEQ="128"/>
        <Button id="btn_CostSheet" taborder="2" text="매출원가표" top="89" height="28" right="btn_Order_Confirm:5" width="84" onclick="btn_CostSheet_onclick" enable="false" TL_SEQ="129"/>
        <Button id="btn_RequestLicense" taborder="4" text="라이선스요청" top="89" height="22" right="btn_CostSheet:8" width="0" enable="false" onclick="btn_RequestLicense_onclick" TL_SEQ="130"/>
        <Button id="btn_Affirmation" taborder="5" text="확약서" top="89" height="28" right="btn_CostSheet:5" width="84" onclick="btn_Affirmation_onclick" enable="false" TL_SEQ="131"/>
        <Div id="div_Attachment" taborder="3" top="89" height="28" async="false" SOURCE_CD="P" USE_NEXT_FILE_TYPE="true" USE_LINK_TYPE="true" USE_MULTI_FILE="true" USE_OPEN_ADD_DIALOG="false" USE_DELETE_ALL="false" USE_BUTTON_ONLY="true" enable="false" right="btn_Affirmation:5" width="93">
          <Layouts>
            <Layout/>
          </Layouts>
        </Div>
        <Button id="btn_Estimate" taborder="6" text="견적서" top="99" height="28" enable="false" visible="false" right="btn_CostSheet:5" width="84" onclick="btn_Estimate_onclick" TL_SEQ="12430"/>
        <Static id="staTitle01" taborder="7" text="프리세일즈 현황" left="0" width="342" height="44" cssclass="sta_WF_Title" top="div_search:0"/>
        <Static id="stc_Sales_List" taborder="8" cssclass="sta_WF_detailBg" top="122" text="" left="558.00" right="20" height="168"/>
        <Grid id="grd_Presales" taborder="9" binddataset="dsList" useinputpanel="false" left="0" autofittype="col" width="554" top="122" bottom="tab_Progess:0" cellsizingtype="col" readonly="true">
          <Formats>
            <Format id="default">
              <Columns>
                <Column size="120"/>
                <Column size="200"/>
                <Column size="60"/>
                <Column size="85"/>
                <Column size="85"/>
              </Columns>
              <Rows>
                <Row size="30" band="head"/>
                <Row size="30"/>
                <Row size="30" band="summ"/>
              </Rows>
              <Band id="head">
                <Cell displaytype="text" edittype="text" wordWrap="char" text="고객사" TL_SEQ="32"/>
                <Cell col="1" wordWrap="char" text="계약명" TL_SEQ="33"/>
                <Cell col="2" text="분류" TL_SEQ="62"/>
                <Cell col="3" text="예상매출" TL_SEQ="63"/>
                <Cell col="4" text="계약예정일" TL_SEQ="64"/>
              </Band>
              <Band id="body">
                <Cell displaytype="text" text="bind:CLIENT_NAME" textAlign="left"/>
                <Cell col="1" text="bind:CONTRACT_NAME" textAlign="left"/>
                <Cell col="2" text="bind:PRODUCT_NAME_SHORT"/>
                <Cell col="3" textAlign="right" text="bind:CONTRACT_AMT" displaytype="mask" maskedittype="expr:comp.parent.gfn_getPriceMaskEdtType()" maskeditformat="expr:comp.parent.gfn_getPriceMaskformat(CONTRACT_AMT)"/>
                <Cell col="4" text="bind:CONTRACT_DATE" displaytype="date" calendardateformat="yyyy-MM-dd"/>
              </Band>
              <Band id="summary">
                <Cell colspan="2" text="합계" TL_SEQ="437"/>
                <Cell col="2"/>
                <Cell col="3" expr="dataset.getSum('CONTRACT_AMT')" displaytype="mask" maskeditformat="#,##0"/>
                <Cell col="4"/>
              </Band>
            </Format>
          </Formats>
        </Grid>
        <Static id="stc_Remark" taborder="11" text="비고" left="559.00" top="241" width="66" height="47" textAlign="right" cssclass="sta_WF_DetailTit" TL_SEQ="45"/>
        <Div id="div_ClientName" taborder="28" left="635" top="129" width="12.48062015503876%" height="24" url="sales::comm/COM_Search.xfdl" kind="CLIENT" param="" binddataset="dsList" codecolumn="CLIENT_CODE" datacolumn="CLIENT_NAME" compReg="true" maxwidth="250" minwidth="" user_onchanged="fnSelectCustomer"/>
        <Combo id="cmb_SalesProduct" taborder="16" text="" left="635" top="div_ClientName:4" width="12.48062015503876%" height="24" innerdataset="ds_cmm_BusinessType" codecolumn="CODE" datacolumn="CAPTION" onitemchanged="cmb_SalesProduct_onitemchanged" maxwidth="250" minwidth=""/>
        <Div id="div_ContractMain" taborder="13" left="635" top="cmb_SalesProduct:4" width="12.48062015503876%" height="24" url="sales::comm/COM_Search.xfdl" kind="COMPANY" param="" binddataset="dsList" codecolumn="CONTRACT_MAIN" datacolumn="CONTRACT_MAIN_NAME" user_onchanged="Com_Search_onChanged" compReg="true" maxwidth="250" minwidth=""/>
        <Combo id="cmb_SalesEmpNo" taborder="27" text="" left="635" top="div_ContractMain:4" height="24" innerdataset="ds_cmm_SalesEmp" codecolumn="EMP_NO" datacolumn="EMP_NAME" onitemchanged="cmb_SalesEmpNo_onitemchanged" width="12.48062015503876%" displayrowcount="15"/>
        <Static id="stc_ContractDate" taborder="23" text="계약예정일" left="cmb_SalesEmpNo:0" top="213" width="74" height="24" textAlign="right" cssclass="sta_WF_DetailTit" TL_SEQ="64"/>
        <Calendar id="cal_ContractDate" taborder="25" left="stc_ContractDate:10" top="213" height="24" dateformat="yyyy-MM-dd" autoselect="true" onchanged="cal_ContractDate_onchanged" minwidth="" width="130"/>
        <Static id="stc_BusinessType" taborder="36" text="사업구분" left="cal_ContractDate:0" top="213" width="82" height="24" textAlign="right" cssclass="sta_WF_DetailTit" TL_SEQ="112" visible="false"/>
        <Combo id="cmb_BusinessType" taborder="37" text="" left="stc_BusinessType:10" top="213" height="24" innerdataset="ds_cmm_BusinessType" codecolumn="CODE" datacolumn="CAPTION" onitemchanged="cmb_BusinessType_onitemchanged" width="12.33%" maxwidth="250" minwidth="" visible="false"/>
        <TextArea id="txt_Remark" taborder="12" left="635" top="cmb_SalesEmpNo:4" height="43" right="30"/>
        <Static id="stc_ContractName" taborder="14" text="계약명" left="div_ContractMain:0" top="185" width="74" height="24" textAlign="right" cssclass="sta_WF_DetailTit" TL_SEQ="33"/>
        <Static id="stc_ClientCode" taborder="21" text="고객사" left="559.00" top="129" width="66" height="24" textAlign="right" cssclass="sta_WF_DetailTit" TL_SEQ="32"/>
        <Static id="stc_ProductCode" taborder="15" text="계약구분" left="559" top="stc_ClientCode:4" width="66" height="24" textAlign="right" cssclass="sta_WF_DetailTit" TL_SEQ="83"/>
        <Static id="stc_SalesStatus" taborder="17" text="영업상태" left="cmb_SalesProduct:0" top="157" width="74" height="24" textAlign="right" cssclass="sta_WF_DetailTit" TL_SEQ="84"/>
        <Combo id="cmb_SalesStatus" taborder="18" text="" left="stc_SalesStatus:10.00" top="157" height="24" innerdataset="ds_cmm_SalesStatus" codecolumn="CODE" datacolumn="CAPTION" width="130"/>
        <Static id="stc_RelatedProject" taborder="19" text="연결프로젝트" left="cmb_SalesStatus:0" top="157" width="82" height="24" textAlign="right" cssclass="sta_WF_DetailTit" TL_SEQ="82"/>
        <Static id="stc_ContractMain" taborder="20" text="계약처" left="559" top="stc_ProductCode:4" width="66" height="24" textAlign="right" cssclass="sta_WF_DetailTit" TL_SEQ="34"/>
        <Edit id="edt_ContractName" taborder="22" left="stc_ContractName:10" top="185" height="24" width="16.434108527131784%" onchanged="edt_ContractName_onchanged"/>
        <Static id="stc_SalesEmpNo" taborder="24" text="담당영업" left="559" top="213" width="66" height="24" textAlign="right" cssclass="sta_WF_DetailTit" TL_SEQ="37"/>
        <Edit id="edt_ContractNo" taborder="26" left="1434.00" top="135" width="97" height="22" readonly="true" visible="false"/>
        <Static id="stc_ProjectName" taborder="29" text="프로젝트명" left="div_ClientName:0" top="129" width="74" height="24" textAlign="right" cssclass="sta_WF_DetailTit" TL_SEQ="114"/>
        <Edit id="edt_ProjectName" taborder="30" left="stc_ProjectName:10" top="129" height="24" width="16.434108527131784%"/>
        <Edit id="edt_ProjectCode" taborder="31" left="edt_ProjectName:5.00" top="129" height="24" width="96" readonly="true" textAlign="center" value="201909016" text="201909016"/>
        <CheckBox id="ckb_PipeLineFlag" taborder="32" text="PIPE 라인" left="edt_ContractName:10" top="185" width="75" height="24" textAlign="right" TL_SEQ="85"/>
        <Button id="btn_Add" taborder="33" width="16" height="16" onclick="CommAddRow_onclick" bottom="168" left="508.00" cssclass="btn_POP_Add"/>
        <Button id="btn_Del" taborder="34" width="16" height="16" onclick="CommDelRow_onclick" bottom="168" left="532.00" cssclass="btn_POP_Del"/>
        <Div id="divDet" taborder="35" left="558.00" top="290" right="20" bottom="0">
          <Layouts>
            <Layout>
              <Div id="divDet1" taborder="0" left="0" top="0" width="385" formscrolltype="none" formscrollbartype="none none" bottom="0">
                <Layouts>
                  <Layout>
                    <Div id="divProd" taborder="0" left="0" top="0" right="0" height="50%">
                      <Layouts>
                        <Layout>
                          <Static id="stc_SalesProd1" taborder="0" text="제품 매출 상세내역" left="10.00" top="6" width="152" height="19" visible="true" cssclass="sta_POP_GroupTit" TL_SEQ="88"/>
                          <Button id="btn_ProdDel" taborder="3" top="7" width="16" height="16" onclick="CommDelRow_onclick" right="8" cssclass="btn_POP_Del" text=""/>
                          <Button id="btn_ProdAdd" taborder="2" top="7" width="16" height="16" onclick="CommAddRow_onclick" right="32" cssclass="btn_POP_Add"/>
                          <Button id="btn_ContractUnion" taborder="4" text="계약연결" top="5" width="70" height="22" right="btn_ProdAdd:9" onclick="divDet_divDet1_divProd_btn_ContractUnion_onclick" TL_SEQ="89" visible="false"/>
                          <Grid id="grd_SalesProd" taborder="1" binddataset="dsContractProd" scrollbars="alwaysvert" autoenter="select" useinputpanel="false" cellsizingtype="col" autofittype="col" top="32" visible="true" left="0" right="0" bottom="0" onexpandup="divDet_divDet1_divProd_grd_SalesProd_onexpandup">
                            <Formats>
                              <Format id="default">
                                <Columns>
                                  <Column size="240"/>
                                  <Column size="143"/>
                                </Columns>
                                <Rows>
                                  <Row size="30" band="head"/>
                                  <Row size="30"/>
                                </Rows>
                                <Band id="head">
                                  <Cell text="항목" displaytype="text" edittype="text" TL_SEQ="86"/>
                                  <Cell col="1" displaytype="text" edittype="text" text="예상매출액" TL_SEQ="87"/>
                                </Band>
                                <Band id="body">
                                  <Cell editautoselect="true" text="bind:PRODUCT_NAME" expandshow="show" textAlign="left" expandsize="20" expandimage="URL(&quot;theme://images/btn_WF_Sch_P.png&quot;)"/>
                                  <Cell col="1" edittype="mask" editautoselect="true" editdisplay="edit" text="bind:CONTRACT_PRICE" textAlign="right" maskeditformat="#,##0"/>
                                </Band>
                              </Format>
                              <Format id="PRODUCT_JAP">
                                <Columns>
                                  <Column size="240"/>
                                  <Column size="60"/>
                                  <Column size="143"/>
                                </Columns>
                                <Rows>
                                  <Row size="25" band="head"/>
                                  <Row size="24"/>
                                </Rows>
                                <Band id="head">
                                  <Cell text="항목(제품/상품)" displaytype="text" edittype="text" TL_SEQ="86"/>
                                  <Cell col="1" text="수량" TL_SEQ="103"/>
                                  <Cell col="2" displaytype="text" edittype="text" text="예상매출액" TL_SEQ="87"/>
                                </Band>
                                <Band id="body">
                                  <Cell editautoselect="true" text="bind:PRODUCT_NAME" expandshow="show" textAlign="left" expandsize="20" expandimage="URL(&quot;theme://images/btn_WF_Sch_P.png&quot;)"/>
                                  <Cell col="1" text="bind:QUANTITY" edittype="text"/>
                                  <Cell col="2" edittype="mask" editautoselect="true" editdisplay="edit" text="bind:CONTRACT_PRICE" textAlign="right" displaytype="expr:comp.parent.parent.parent.parent.parent.parent.parent.gfn_getPriceDisplayType('normal')" maskeditformat="expr:comp.parent.parent.parent.parent.parent.parent.parent.gfn_getPriceMaskformat(CONTRACT_PRICE)" maskedittype="expr:comp.parent.parent.parent.parent.parent.parent.parent.gfn_getPriceMaskEdtType()"/>
                                </Band>
                              </Format>
                            </Formats>
                          </Grid>
                        </Layout>
                      </Layouts>
                    </Div>
                    <Div id="divGoods" taborder="1" text="Div00" left="0" top="divProd:4" right="0" bottom="0">
                      <Layouts>
                        <Layout>
                          <Grid id="grd_Salesgoods" taborder="3" binddataset="dsContractGoods" scrollbars="alwaysvert" autoenter="select" useinputpanel="false" cellsizingtype="col" autofittype="col" left="0" visible="true" right="0" top="32" bottom="0" onexpandup="divDet_divDet1_divGoods_grd_Salesgoods_onexpandup">
                            <Formats>
                              <Format id="default">
                                <Columns>
                                  <Column size="240"/>
                                  <Column size="143"/>
                                </Columns>
                                <Rows>
                                  <Row size="30" band="head"/>
                                  <Row size="30"/>
                                </Rows>
                                <Band id="head">
                                  <Cell text="항목(제품/상품)" displaytype="text" edittype="text" TL_SEQ="86"/>
                                  <Cell col="1" displaytype="text" edittype="text" text="예상매출액" TL_SEQ="87"/>
                                </Band>
                                <Band id="body">
                                  <Cell edittype="none" editautoselect="true" text="bind:PRODUCT_NAME" expandshow="show" textAlign="left" expandsize="20" expandimage="URL(&quot;theme://images/btn_WF_Sch_P.png&quot;)"/>
                                  <Cell col="1" edittype="mask" editautoselect="true" editdisplay="edit" text="bind:CONTRACT_PRICE" textAlign="right" displaytype="mask" maskeditformat="#,##0"/>
                                </Band>
                              </Format>
                              <Format id="format00">
                                <Columns>
                                  <Column size="99"/>
                                  <Column size="99"/>
                                  <Column size="99"/>
                                  <Column size="99"/>
                                  <Column size="99"/>
                                  <Column size="99"/>
                                  <Column size="99"/>
                                </Columns>
                                <Rows>
                                  <Row size="24" band="head"/>
                                  <Row size="24"/>
                                </Rows>
                                <Band id="head">
                                  <Cell text="역할" TL_SEQ="75"/>
                                  <Cell col="1" text="등급" TL_SEQ="92"/>
                                  <Cell col="2" text="예상단가" TL_SEQ="93"/>
                                  <Cell col="3" text="MM"/>
                                  <Cell col="4" text="금액" TL_SEQ="97"/>
                                  <Cell col="5" text="근무지역" TL_SEQ="98"/>
                                  <Cell col="6" text="비고" TL_SEQ="45"/>
                                </Band>
                                <Band id="body">
                                  <Cell/>
                                  <Cell col="1"/>
                                  <Cell col="2"/>
                                  <Cell col="3"/>
                                  <Cell col="4"/>
                                  <Cell col="5"/>
                                  <Cell col="6"/>
                                </Band>
                              </Format>
                              <Format id="format01">
                                <Columns>
                                  <Column size="138"/>
                                  <Column size="138"/>
                                  <Column size="138"/>
                                  <Column size="138"/>
                                </Columns>
                                <Rows>
                                  <Row size="24" band="head"/>
                                  <Row size="24"/>
                                </Rows>
                                <Band id="head">
                                  <Cell text="항목" TL_SEQ="105"/>
                                  <Cell col="1" text="예상매입액" TL_SEQ="107"/>
                                  <Cell col="2" text="매입처" TL_SEQ="108"/>
                                  <Cell col="3" text="판매수수료율" TL_SEQ="1911"/>
                                </Band>
                                <Band id="body">
                                  <Cell/>
                                  <Cell col="1"/>
                                  <Cell col="2"/>
                                  <Cell col="3"/>
                                </Band>
                              </Format>
                            </Formats>
                          </Grid>
                          <Static id="stc_SalesProd2" taborder="2" text="상품 매출 상세내역" left="10.00" width="167" height="19" visible="true" cssclass="sta_POP_GroupTit" top="7" TL_SEQ="90"/>
                          <Button id="btn_GoodsDel" taborder="0" width="16" height="16" onclick="CommDelRow_onclick" right="8" top="7" cssclass="btn_POP_Del"/>
                          <Button id="btn_GoodsAdd" taborder="1" width="16" height="16" onclick="CommAddRow_onclick" right="32" top="7" cssclass="btn_POP_Add"/>
                        </Layout>
                      </Layouts>
                    </Div>
                  </Layout>
                </Layouts>
              </Div>
              <Div id="divDet2" taborder="1" text="Div00" top="0" bottom="0" left="divDet1:4" right="0">
                <Layouts>
                  <Layout>
                    <Div id="divSi" taborder="0" text="Div00" left="0" top="0" right="0" bottom="66.78%">
                      <Layouts>
                        <Layout>
                          <Static id="stc_SalesSi" taborder="0" text="용역 상세내역" top="6" width="134" height="19" visible="true" cssclass="sta_POP_GroupTit" left="8.00" TL_SEQ="91"/>
                          <Button id="btn_SiAdd" taborder="2" top="7" width="16" height="16" onclick="CommAddRow_onclick" right="32" cssclass="btn_POP_Add"/>
                          <Button id="btn_SiDel" taborder="3" top="7" width="16" height="16" onclick="CommDelRow_onclick" right="8" cssclass="btn_POP_Del"/>
                          <Button id="btn_Labor_Require" taborder="4" text="인력요청" top="5" height="22" right="btn_SiAdd:8" width="70" enable="true" onclick="divDet_divDet2_divSi_btn_Labor_Require_onclick" TL_SEQ="99" visible="false"/>
                          <Grid id="grd_SalesSi" taborder="1" binddataset="dsContractSi" scrollbars="alwaysvert" autoenter="select" useinputpanel="false" cellsizingtype="col" visible="true" top="32" right="0" left="0" oncellclick="divDet_divDet2_divSi_grd_SalesSi_oncellclick" bottom="0">
                            <Formats>
                              <Format id="default">
                                <Columns>
                                  <Column size="75"/>
                                  <Column size="75"/>
                                  <Column size="80"/>
                                  <Column size="90"/>
                                  <Column size="90"/>
                                  <Column size="50"/>
                                  <Column size="100"/>
                                  <Column size="100"/>
                                  <Column size="130"/>
                                </Columns>
                                <Rows>
                                  <Row size="30" band="head"/>
                                  <Row size="30"/>
                                </Rows>
                                <Band id="head">
                                  <Cell text="역할" TL_SEQ="75"/>
                                  <Cell col="1" text="등급" TL_SEQ="92"/>
                                  <Cell col="2" text="예상단가" TL_SEQ="93"/>
                                  <Cell col="3" text="시작일자" TL_SEQ="94"/>
                                  <Cell col="4" text="종료일자" TL_SEQ="95"/>
                                  <Cell col="5" text="MM"/>
                                  <Cell col="6" text="금액" TL_SEQ="97"/>
                                  <Cell col="7" text="근무지역" TL_SEQ="98"/>
                                  <Cell col="8" text="비고" TL_SEQ="45"/>
                                </Band>
                                <Band id="body">
                                  <Cell text="bind:ROLE_CODE" displaytype="combotext" edittype="combo" combodataset="ds_cmm_Role" combocodecol="CODE" combodatacol="CAPTION"/>
                                  <Cell col="1" text="bind:LEVEL_CODE" combodataset="ds_cmm_Level" combocodecol="CODE" combodatacol="CAPTION" displaytype="combotext" edittype="combo"/>
                                  <Cell col="2" text="bind:UNIT_COST" textAlign="right" displaytype="number" edittype="mask"/>
                                  <Cell col="3" displaytype="date" edittype="date" text="bind:START_DATE" calendardateformat="yyyy-MM-dd" calendarautoselect="true"/>
                                  <Cell col="4" text="bind:END_DATE" displaytype="date" edittype="date" calendardateformat="yyyy-MM-dd" calendarautoselect="true"/>
                                  <Cell col="5" text="bind:MEN_MONTH" displaytype="mask" textAlign="right" edittype="mask" maskeditformat="90.90"/>
                                  <Cell col="6" text="bind:CONTRACT_PRICE" textAlign="right" displaytype="expr:comp.parent.parent.parent.parent.parent.parent.parent.gfn_getPriceDisplayType('number')" edittype="mask" maskeditformat="expr:comp.parent.parent.parent.parent.parent.parent.parent.gfn_getPriceMaskformat(CONTRACT_PRICE)" maskedittype="expr:comp.parent.parent.parent.parent.parent.parent.parent.gfn_getPriceMaskEdtType()"/>
                                  <Cell col="7" text="bind:AREA_CODE" textAlign="left" combodataset="ds_cmm_Area" combocodecol="CODE" combodatacol="CAPTION" displaytype="combotext" edittype="combo"/>
                                  <Cell col="8" text="bind:REMARKS" textAlign="left" edittype="normal"/>
                                </Band>
                              </Format>
                            </Formats>
                          </Grid>
                        </Layout>
                      </Layouts>
                    </Div>
                    <Div id="divCS" taborder="2" text="Div00" left="0" top="divSi:-1" right="0" bottom="33.22%">
                      <Layouts>
                        <Layout>
                          <Static id="stc_GbSalesCS" taborder="0" cssclass="sta_POP_GroupBg" left="0" top="0" height="32" right="0" text=""/>
                          <Static id="stc_SalesCS" taborder="1" text="기술서비스 상세내역" top="7" width="155" height="19" visible="true" cssclass="sta_POP_GroupTit" left="8.00" TL_SEQ="2307"/>
                          <Grid id="grd_SalesCS" taborder="2" binddataset="dsContractCS" scrollbars="alwaysvert" autoenter="select" useinputpanel="false" cellsizingtype="col" visible="true" top="32" right="0" left="0" bottom="0" oncellclick="divDet_divDet2_divSi_grd_SalesSi_oncellclick">
                            <Formats>
                              <Format id="default">
                                <Columns>
                                  <Column size="75"/>
                                  <Column size="75"/>
                                  <Column size="80"/>
                                  <Column size="110"/>
                                  <Column size="110"/>
                                  <Column size="100"/>
                                  <Column size="40"/>
                                  <Column size="70"/>
                                  <Column size="110"/>
                                  <Column size="100"/>
                                  <Column size="130"/>
                                </Columns>
                                <Rows>
                                  <Row size="30" band="head"/>
                                  <Row size="30"/>
                                </Rows>
                                <Band id="head">
                                  <Cell text="역할" TL_SEQ="75"/>
                                  <Cell col="1" text="등급" TL_SEQ="92"/>
                                  <Cell col="2" text="수행방식" TL_SEQ="101"/>
                                  <Cell col="3" text="시작일자" TL_SEQ="94"/>
                                  <Cell col="4" text="종료일자" TL_SEQ="95"/>
                                  <Cell col="5" text="단가" TL_SEQ="102"/>
                                  <Cell col="6" text="수량" TL_SEQ="103"/>
                                  <Cell col="7" text="단위" TL_SEQ="104"/>
                                  <Cell col="8" text="금액" TL_SEQ="97"/>
                                  <Cell col="9" text="근무지역" TL_SEQ="98"/>
                                  <Cell col="10" text="비고" TL_SEQ="45"/>
                                </Band>
                                <Band id="body">
                                  <Cell text="bind:ROLE_CODE" displaytype="combotext" edittype="combo" combodataset="ds_cmm_Role2" combocodecol="CODE" combodatacol="CAPTION"/>
                                  <Cell col="1" text="bind:LEVEL_CODE" combodataset="ds_cmm_Level" combocodecol="CODE" combodatacol="CAPTION" displaytype="combotext" edittype="combo"/>
                                  <Cell col="2" text="bind:EXECUTION_TYPE" displaytype="combotext" edittype="combo" combodataset="ds_cmm_ExecutionType" combocodecol="CODE" combodatacol="CAPTION"/>
                                  <Cell col="3" displaytype="date" edittype="date" text="bind:START_DATE" calendardateformat="yyyy-MM-dd" comboautoselect="true" calendarautoselect="true"/>
                                  <Cell col="4" text="bind:END_DATE" displaytype="date" edittype="date" calendardateformat="yyyy-MM-dd" comboautoselect="true" calendarautoselect="true"/>
                                  <Cell col="5" text="bind:UNIT_COST" edittype="mask" displaytype="expr:comp.parent.parent.parent.parent.parent.parent.parent.gfn_getPriceDisplayType('number')" textAlign="right" maskeditformat="expr:comp.parent.parent.parent.parent.parent.parent.parent.gfn_getPriceMaskformat(UNIT_COST)" maskedittype="expr:comp.parent.parent.parent.parent.parent.parent.parent.gfn_getPriceMaskEdtType()"/>
                                  <Cell col="6" text="bind:MEN_MONTH" displaytype="mask" textAlign="right" edittype="mask" maskeditformat="90.90"/>
                                  <Cell col="7" text="bind:TECH_SUPPORT_UNIT" displaytype="combotext" edittype="combo" calendarautoselect="true" combodataset="ds_cmm_TechSupportUnit" combocodecol="CODE" combodatacol="CAPTION"/>
                                  <Cell col="8" text="bind:CONTRACT_PRICE" textAlign="right" displaytype="expr:comp.parent.parent.parent.parent.parent.parent.parent.gfn_getPriceDisplayType('number')" edittype="mask" maskeditformat="expr:comp.parent.parent.parent.parent.parent.parent.parent.gfn_getPriceMaskformat(CONTRACT_PRICE)" maskedittype="expr:comp.parent.parent.parent.parent.parent.parent.parent.gfn_getPriceMaskEdtType()"/>
                                  <Cell col="9" text="bind:AREA_CODE" textAlign="left" combodataset="ds_cmm_Area" combocodecol="CODE" combodatacol="CAPTION" displaytype="combotext" edittype="combo"/>
                                  <Cell col="10" text="bind:REMARKS" textAlign="left" edittype="normal"/>
                                </Band>
                              </Format>
                            </Formats>
                          </Grid>
                          <Button id="btn_CSAdd" taborder="3" top="7" width="16" height="16" onclick="CommAddRow_onclick" right="32" cssclass="btn_POP_Add"/>
                          <Button id="btn_CSDel" taborder="4" top="7" width="16" height="16" onclick="CommDelRow_onclick" right="8" cssclass="btn_POP_Del"/>
                          <Button id="btn_Labor_Require2" taborder="5" text="인력요청" top="5" height="22" right="btn_CSAdd:8" width="70" enable="true" onclick="divDet_divDet2_divCS_btn_Labor_Require2_onclick" TL_SEQ="99" visible="false"/>
                        </Layout>
                      </Layouts>
                    </Div>
                    <Div id="divPur" taborder="1" text="Div00" left="0" top="divCS:-1" right="0" bottom="0%">
                      <Layouts>
                        <Layout>
                          <Grid id="grd_SalesPurchase" taborder="0" binddataset="dsPurchaseList" scrollbars="alwaysvert" autoenter="select" useinputpanel="false" cellsizingtype="col" visible="true" top="32" left="0" right="0" onexpandup="divDet_divDet2_divPur_grd_SalesPurchase_onexpandup" autofittype="col" bottom="0">
                            <Formats>
                              <Format id="default">
                                <Columns>
                                  <Column size="100"/>
                                  <Column size="100"/>
                                  <Column size="100"/>
                                  <Column size="110"/>
                                  <Column size="90"/>
                                </Columns>
                                <Rows>
                                  <Row size="30" band="head"/>
                                  <Row size="30"/>
                                </Rows>
                                <Band id="head">
                                  <Cell text="구분" TL_SEQ="105"/>
                                  <Cell col="1" text="항목" TL_SEQ="105"/>
                                  <Cell col="2" text="예상매입액" TL_SEQ="107"/>
                                  <Cell col="3" text="매입처" TL_SEQ="108"/>
                                  <Cell col="4" text="요율(%)" TL_SEQ="109"/>
                                </Band>
                                <Band id="body">
                                  <Cell text="bind:CONTRACT_TYPE" textAlign="left" expandshow="hide" expandsize="20" displaytype="combotext" edittype="combo" combodataset="ds_cmm_PurchaseType" combocodecol="CODE" combodatacol="CAPTION"/>
                                  <Cell col="1" text="bind:PRODUCT_NAME" textAlign="left" expandshow="show" expandsize="20" expandimage="URL(&quot;theme://images/btn_WF_Sch_P.png&quot;)"/>
                                  <Cell col="2" textAlign="right" text="bind:CONTRACT_PRICE" displaytype="number" edittype="mask"/>
                                  <Cell col="3" text="bind:CONTRACT_MAIN_NAME" textAlign="left" expandshow="show" expandsize="20" expandimage="URL(&quot;theme://images/btn_WF_Sch_P.png&quot;)"/>
                                  <Cell col="4" text="bind:COMMISSION_RATE" displaytype="number" textAlign="right" edittype="mask"/>
                                </Band>
                              </Format>
                              <Format id="PURCHASE_JAP">
                                <Columns>
                                  <Column size="100"/>
                                  <Column size="89"/>
                                  <Column size="100"/>
                                  <Column size="110"/>
                                  <Column size="90"/>
                                  <Column size="90"/>
                                </Columns>
                                <Rows>
                                  <Row size="25" band="head"/>
                                  <Row size="24"/>
                                </Rows>
                                <Band id="head">
                                  <Cell text="항목" TL_SEQ="105"/>
                                  <Cell col="1" text="연관제품" TL_SEQ="106"/>
                                  <Cell col="2" text="예상매입액" TL_SEQ="107"/>
                                  <Cell col="3" text="매입처" TL_SEQ="108"/>
                                  <Cell col="4" text="요율(%)" TL_SEQ="109"/>
                                  <Cell col="5" text="로열티" TL_SEQ="22569"/>
                                </Band>
                                <Band id="body">
                                  <Cell text="bind:PRODUCT_NAME" textAlign="left" expandshow="show" expandsize="20" expandimage="URL(&quot;theme://images/btn_WF_Sch_P.png&quot;)"/>
                                  <Cell col="1" text="bind:RELATED_PRODUCT_NAME" expandimage="url('theme://images/btn_WF_Sch_P.png')" expandshow="show" expandsize="20"/>
                                  <Cell col="2" textAlign="right" text="bind:CONTRACT_PRICE" displaytype="expr:comp.parent.parent.parent.parent.parent.parent.parent.gfn_getPriceDisplayType('number')" edittype="mask" maskeditformat="expr:comp.parent.parent.parent.parent.parent.parent.parent.gfn_getPriceMaskformat(CONTRACT_PRICE)" maskedittype="expr:comp.parent.parent.parent.parent.parent.parent.parent.gfn_getPriceMaskEdtType()"/>
                                  <Cell col="3" text="bind:CONTRACT_MAIN_NAME" textAlign="left" expandshow="show" expandsize="20" expandimage="URL(&quot;theme://images/btn_WF_Sch_P.png&quot;)"/>
                                  <Cell col="4" text="bind:COMMISSION_RATE" displaytype="number" textAlign="right" edittype="mask"/>
                                  <Cell col="5" text="bind:ROYALTY_TYPE" displaytype="combotext" combodataset="ds_cmm_RoyaltyType" combocodecol="CODE" combodatacol="CAPTION"/>
                                </Band>
                              </Format>
                            </Formats>
                          </Grid>
                          <Static id="stc_SalesPurchase" taborder="1" text="매입 상세내역" width="155" height="19" visible="true" cssclass="sta_POP_GroupTit" left="8.00" top="7" TL_SEQ="110"/>
                          <Button id="btn_PurDel" taborder="2" width="16" height="16" onclick="CommDelRow_onclick" right="8" top="7" cssclass="btn_POP_Del"/>
                          <Button id="btn_PurAdd" taborder="3" width="16" height="16" onclick="CommAddRow_onclick" right="32" top="7" cssclass="btn_POP_Add"/>
                          <Button id="btn_ContractLink" taborder="4" text="매출연결" top="5" height="22" right="btn_PurAdd:8" width="70" enable="true" onclick="divDet_divDet2_divPur_btn_ContractLink_onclick" TL_SEQ="111"/>
                        </Layout>
                      </Layouts>
                    </Div>
                  </Layout>
                </Layouts>
              </Div>
            </Layout>
          </Layouts>
        </Div>
        <Div id="div_RelatedProject" taborder="38" top="157" height="24" url="sales::comm/COM_Search.xfdl" kind="PROJECT" binddataset="dsList" codecolumn="RELATED_PROJECT_CODE" datacolumn="RELATED_PROJECT_NAME" user_onchanged="Com_Search_onChanged" searchtype="P" left="stc_RelatedProject:10" enable="true" right="25" maxwidth="400" minwidth=""/>
        <Div id="div_InConfirm" taborder="39" left="1330.00" top="341" width="150" height="89" cssclass="div_WF_detailBg" visible="false">
          <Layouts>
            <Layout>
              <Radio id="rd_kind" taborder="0" left="20" top="4" height="42" innerdataset="ds_Kind" codecolumn="CODE" datacolumn="CAPTION" index="0" text="확인" value="01" right="16" TL_FLAG="1"/>
              <Static id="stc_BottomFrame" taborder="1" left="0" height="37" right="0" bottom="0" cssclass="sta_POP_BtnBg" text=""/>
              <Button id="btn_Confirm" taborder="2" text="선택" cssclass="btn_WF_tran" height="22" width="60" bottom="7" right="68" defaultbutton="true" onclick="div_InConfirm_btn_Confirm_onclick" TL_SEQ="113"/>
              <Button id="btn_Exit" taborder="3" text="닫기" cssclass="btn_WF_tran" width="60" height="22" bottom="7" right="4" onclick="div_InConfirm_btn_Exit_onclick" TL_SEQ="59"/>
            </Layout>
          </Layouts>
        </Div>
      </Layout>
    </Layouts>
    <Script type="xscript5.1"><![CDATA[/************************************************************************************************
 * 01. 업무구분 : 영업관리 - 영업관리
 * 02. 화면명   : 영업관리(SS_SalesMM)
 * 03. 화면설명 : 영업관리
 * 04. 작성일   : 2018.08.19
 * 05. 작성자   : 채종한
 * 06. 수정이력 :
 ***********************************************************************************************
 *     수정일          이  름    사유
 ***********************************************************************************************
 *
 *
 *
 ***********************************************************************************************/


/************************************************************************************************
 * 공통 라이브러리 INCLUDE 영역
 ************************************************************************************************/
include "Script::CommTrans.xjs"
include "Script::CommGrid.xjs"
include "Script::CommUtil.xjs"
include "Script::CommSystem.xjs"
include "Script::ext_CommEco.xjs"

/************************************************************************************************
 * 전역 변수 영역
 ************************************************************************************************/

this.nRowPosition = 0;
this.FV_BUTTON_TYPE = "";
this.sObjDs;
this.FV_CO_CD = "";
this.FV_AUTH_PRICE_MASK = false;
this.SAVE_FLAG = false;
this.sInsertType = ""; // insert 계약 구분  
  
 /************************************************************************************************
 * FORM 영역
 ************************************************************************************************/
this.SS_SalesMM_onload = function(obj:nexacro.Form,e:nexacro.LoadEventInfo)
{
	this.gfnCompInit(obj);  	// Grid 공통함수 호출
	this.fnSetComCmbConfig();	// 공통 코드찾기 설정 처리
	this.fnAuthConfig(1);		// 화면 권한 처리
	
	this.fnGetCode();
	this.fnProductQueryData();	// 대표제품
	
	var sToday = this.gfnToday();
	var sStartDt = this.gfnAddMonth(sToday, -12);
	this.div_search.form.div_Search_yyyyMM_FromTo.setFromYYYYMM(sStartDt.substr(0, 6));	// 계약기간 시작
	this.div_search.form.div_Search_yyyyMM_FromTo.setToYYYYMM(sToday.substr(0, 6));		// 계약기간 종료
	this.div_search.form.chk_NoneDate.set_value("1");			// 기간무시 체크
	
	this.fnsetInit();
};

this.fnsetInit = function ()
{
	var sCocd = this.gfnGetCompanyCode();
	
	this.btn_RequestLicense.set_enable(true);
	//this.tab_Sales.tpg_Presales.form.fnAuthConfig();

	this.div_search.form.cmb_ContractStatus.set_visible(false);	// 계약 상태
	this.div_search.form.stc_ContractStatus.set_visible(false);
	this.div_search.form.stc_ContractType.set_visible(false);
	this.div_search.form.cmb_ContractType.set_visible(false);
	this.div_Attachment.set_enable(true);
	this.btn_Order_Confirm.set_text(this.gfnGetTransTxt (128, "계약확정"));
	
	// 프로젝트 검색 팝업 가계약만 조회 처리
	this.div_search.form.div_ProjectName.param = "searchtype:P,contractstatus:0";
	
	this.div_ClientName.param = "pvMode:1";
	this.div_ContractMain.param = "pvMode:2";
	
// 	if(sCocd == "J02") {
// 		var sRight = this.btn_Affirmation.right;
// 		
// 		// 견적서
// 		this.btn_Estimate.set_visible(true);
// 		this.div_Attachment.set_right(sRight);
// 		
// 		// 확약서
// 		this.btn_Affirmation.set_visible(false);
// 		// 라이선스 요청
// 		this.btn_RequestLicense.set_visible(false);
// 	}
	
}

//조회
this.cfnSearch = function ()
{
	if (this.gfnDsIsUpdated(this.dsList) || 
		this.gfnDsIsUpdated(this.dsContractProd) ||
		this.gfnDsIsUpdated(this.dsContractGoods) ||
		this.gfnDsIsUpdated(this.dsContractSi) ||
		this.gfnDsIsUpdated(this.dsContractCS) ||
		this.gfnDsIsUpdated(this.dsPurchaseList) ||
		this.gfnDsIsUpdated(this.dsScheduleList) ||
		this.gfnDsIsUpdated(this.dsAddressbookList) ) {
		// 검색을 진행하면 변경된 데이터가 사라집니다. \n계속 진행 하시겠습니까?
		var sMsgId = "confirm.before.search";					//메세지ID
		var arrArg = [""];										//메세지취환될값 배열[생략가능]
		var sPopId = "beforeSearch";									//메세지팝업ID[생략가능]	*해당화면에서 메시지 중복사용시 구분되는값을 넣어줘야함
		var sMsgCallback = "fnMsgCallback";						//메세지콜백[생략가능] 		* confirm성 메시지를 사용 시 반드시 필요
	
		// 변경된 정보가 있습니다.\n저장 하시겠습니까?
		this.gfnAlert(sMsgId, arrArg, sPopId, sMsgCallback);
	}
	else {
		this.fnQueryData();
	}
};


//신규
this.cfnAdd = function ()
{
	this.fnAddContract();
};

//삭제
this.cfnDel = function ()
{
	this.fnDeleteData();
};

//저장
this.cfnSave = function ()
{
	// 변경된 정보없으면 리턴
	if (this.gfnDsIsUpdated(this.dsList) == false &&
		this.gfnDsIsUpdated(this.dsContractProd) == false &&
		this.gfnDsIsUpdated(this.dsContractGoods) == false &&
		this.gfnDsIsUpdated(this.dsContractSi) == false &&
		this.gfnDsIsUpdated(this.dsContractCS) == false &&
		this.gfnDsIsUpdated(this.dsPurchaseList) == false &&
		this.gfnDsIsUpdated(this.dsScheduleList) == false &&
		this.gfnDsIsUpdated(this.dsAddressbookList) == false) {
		// 저장할 데이터가 없습니다.
		this.gfnAlert("msg.save.nochange");
		return;
	}

	this.fnSaveData();
}; 
 /************************************************************************************************
 * TRANSACTION 및 추가 FUNCTION 영역
 ************************************************************************************************/
  
 // 공통코드 조회
this.fnGetCode = function()
{
	this.gfnAddCodeDataset("ds_cmm_ContractStatus", "CONTRACTSTATUS", true);	// 계약상태 코드
 	this.gfnAddCodeDataset("ds_cmm_SalesStatus",	"SALESSTATUS"); 	// 영업상태 코드
	
	this.gfnAddCodeDataset("ds_cmm_Type",			"TYPE_CODE");		// 일정 구분
	this.gfnAddCodeDataset("ds_cmm_Importance",		"IMPORTANCE");		// 일정 중요도 코드
	this.gfnAddCodeDataset("ds_cmm_Role", 			"PROJECTROLE");		// 역할 코드 CA_ROLE_CODE
	this.gfnAddCodeDataset("ds_cmm_Level",			"LEVEL_CODE");		// 등급 코드
	this.gfnAddCodeDataset("ds_cmm_Area",			"AREA_CODE");		// 근무지역 코드
	
	this.gfnAddCodeDataset("ds_cmm_CaGrade",		"CA_GRADE_CODE");	// 담당자 직급	SM05
	this.gfnAddCodeDataset("ds_cmm_CaRole",			"PROJECTROLE");	// 담당자 역할 CA_ROLE_CODE
	this.gfnAddCodeDataset("ds_cmm_BusinessType",	"BUSINESS_TYPE");	// 사업구분
	this.gfnAddCodeDataset("ds_cmm_HoldOffice",		"SM08"/*"CM0009"*/);			// 재직여부
	
	this.gfnAddCodeDataset("ds_cmm_ExecutionType",	"EXECUTION_TYPE");		// 수행방법
	this.gfnAddCodeDataset("ds_cmm_TechSupportUnit","TECH_SUPPORT_UNIT");	// 단위(기술서비스)
	this.gfnAddCodeDataset("ds_cmm_PurchaseType","CONTRACT_TYPE");	
	
	
	
	//this.gfnAddCodeDataset("ds_cmm_RoyaltyType",	"ROYALTY_TYPE");	// 로열티종류
	
	//this.gfnAddCodeDataset("ds_SalesStatus", "SALESSTATUS", true);	// 영업상태 코드
	this.gfnCodeTransaction();	// 공통코드 조회
	
	// 조회용 Output dataset 세팅
	//this.gfnAddOutputDataset("ds_cond_sales_emp", 	"ds_output");
	this.gfnAddSendParameter("COMPANY_CODE", this.gfnGetCompanyCode());
	this.gfnSetMap("salesManagerMapper", "SalesmanCombo", "ds_cond_sales_emp");
	this.gfnCommonTransaction("SalesEmp", 	"selectNextList.do"/*		"CO_SalesEmp_S01"*/);
 }
 
this.fnProductQueryData = function()
{
	//	this.gfnAddSendParameter("CONTRACT_TYPE",		"P");
	this.gfnAddSendParameter("MAIN_PRODUCT_FLAG",	"1");
	this.gfnAddSendParameter("E03",					"E03");
	this.gfnAddSendParameter("COMPANY_CODE",		this.gfnGetCompanyCode());
	this.gfnAddSendParameter("EMP_NO",		this.gfnGetUserInfo("EMP_NO"));
	//	this.gfnAddOutputDataset("ds_cmm_Product", 	"dsOutput");
	//	this.gfnCommonTransaction("AP_SalesProductMM_S01", "AP_SalesProductMM_S01");
	
	this.gfnSetMap("salesManagerMapper", "SalesProductList", "ds_cmm_ProductAll");
	this.gfnCommonTransaction("AP_SalesProductMM_S01", 	"selectNextList.do");
}


//message callback
this.fnMsgCallback = function (sPopupId, sRtn)
{
	// 저장 하시겠습니까?
	if (sPopupId == "save") {
		if (this.gfnIsNull(sRtn)|| sRtn=="false"||sRtn == false) {
			return;
		}
		else {
			// 데이터 저장 서비스를 호출한다.
			this.fnTranSave();
		}
	}
	// 검색을 진행하면 변경된 데이터가 사라집니다. \n계속 진행 하시겠습니까?
	else if (sPopupId == "beforeSearch") {
		if (this.gfnIsNull(sRtn)|| sRtn=="false"||sRtn == false) {
			return;	
		}
		else {
			// 조회
			this.fnQueryData();
		}
	}
};

 // 화면 콜백
this.fnCallBack = function (strSvcID, nErrorCode, strErrorMag)
{
	switch (strSvcID) 
	{
		case "AP_SalesProductMM_S01" :
			this.ds_cmm_ProductAll.filter("PRODUCT_LVL==0");
			this.ds_cmm_Product.copyData(this.ds_cmm_ProductAll, true);	// 0 level만 복사
			break;
		case "SalesEmp" : 
			this.ds_cmm_SalesEmp.copyData(this.ds_cond_sales_emp);
			var nAddRow = this.ds_cond_sales_emp.insertRow(0);
			this.ds_cond_sales_emp.setColumn(nAddRow, "EMP_NAME",	this.gfnGetTransTxt(350,"전체"));
			this.ds_cond_sales_emp.setColumn(nAddRow, "FULL_NAME",	this.gfnGetTransTxt(350,"전체"));
			this.ds_cond_sales_emp.setColumn(nAddRow, "EMP_NO",		"");
			this.ds_cond_sales_emp.setColumn(nAddRow, "DEPT_CD",	"");
			
			// 일반영업(팀장이상x)인 경우
			var sLoginEmpNo = this.gfnGetUserInfo("EMP_NO");
			if (this.commUtil.getFormAuthority(235,1)) {
				var nFindRow = this.ds_cond_sales_emp.findRow("EMP_NO", sLoginEmpNo);
				if (nFindRow<0) nFindRow = 0;
				this.div_search.form.cmb_SalesRepresent.set_index(nFindRow);
			} else {
				this.div_search.form.cmb_SalesRepresent.set_index(0);
			}
			
			this.div_search.form.cmb_SalesStatus.set_index(0);
			
			this.div_search.form.btn_Search.click();
			break;
		case "SS_SalesMM_S02" :
			break;
		case "SearchEstimateCnt" : 
			break;
		case "gfnGetCode":
			this.div_search.form.cmb_ContractStatus.set_index(0);
			this.ds_cmm_PurchaseType.filter("CODE=='GD' || CODE=='CM' || CODE=='DM'");	// 상품,수수료
		
			this.ds_cmm_Role2.assign(this.ds_cmm_Role);
			this.ds_cmm_Role.filter("GRP_CD_1=='S'");
			this.ds_cmm_Role2.filter("GRP_CD_2=='T'");
			
			break;		
		case "SS_Presales_S01":
			this.dsList.set_rowposition(this.nRowPosition);
			
			if(this.dsList.rowcount == 0) {
				this.div_Attachment.enable = false;
				this.btn_Affirmation.enable = false;
				this.btn_CostSheet.enable = false;
				this.btn_Order_Confirm.enable = false;
				//this.btn_ContractReport.enable = false;
			} else {
				this.div_Attachment.enable = true;
				this.btn_Affirmation.enable = true;
				this.btn_CostSheet.enable = true;
				this.btn_Order_Confirm.enable = true;
				//this.btn_ContractReport.enable = true;
			}
			break;
		case "SS_Presales_S02":
			break;
		case "SS_Presales_S06":
			//this.fnCheckCostSheet(this.FV_BUTTON_TYPE);
			break;
		case "SS_Presales_R01":
			this.fnQueryData("Save");
			break;
		case "SS_Presales_R02":
			this.gfnAlert('msg.general',this.gfnGetTransTxt(1499,"계약확정이 완료 되었습니다."), null,
			function(srvId,rtn) {
				//this.fnSendSMS();			// 메시지 전송 (일본법인 제외)
				
				//this.fnContractOkSendEmail();	// 메일 전송
				this.fnQueryData("Save");
				
				// 계약확정에 있는놈 이동
				if(this.dsFileCnt.getColumn(0, "CNT")==0)
				{
					this.gfnAlert('msg.general',this.gfnGetTransTxt(1203,"견적서 파일이 첨부 되지 않았습니다.\n확인바랍니다."));// 견적서 첨부 후 진행 바랍니다.");
				}
			});
			
			break;
		case "getMM":
			if (this.ds_MM.rowcount>0) {
				var nMM = this.ds_MM.getColumn(0, "MM");
				var nROW = this.ds_MM.getColumn(0, "ROW");
				this.sObjDs.setColumn(nROW, "MEN_MONTH", nMM);
			}			
	}
};


// 팝업 콜백
this.fnPopupCallBack = function(sPopupId, Variant)
{
	this.gfnDebugLog("fnPopupCallBack=-===========", sPopupId, Variant);
	if (sPopupId == "ContractLicenseUnionReg" || sPopupId == "SS_ContractLink") {
			// 계약 및 세부 정보 조회
			var sProjectCd = this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE");
			this.fnSSearch(sProjectCd);
	}
	
	//Variant = this.commUtil.popupReturn();
	if(this.gfnIsEmpty(Variant)) {
		return;
	} else {	
		this.recentVariant = Variant;
		switch(sPopupId)
		{
			case "newProjectType" :
				this.fnSelectNewProject(Variant);
				break;
			case "popupCostSheet" : // 제품
				//사전원가표 상신이후 계약확정 버튼 상태확인
				this.fnCheckOrderConfirm(-1, Variant);
			break;	
			
			case "popupEstimateConfirm" : // 견적서 선택
				if(Variant != "close") this.fnEstimateRegPopup(Variant);
			break;
			case "popupProductSearch" : // 제품
				var ds = new nexacro.Dataset();
				ds.loadJSON(Variant);
				console.log(ds.saveXML());
				this.recentVariant = ds;
				
				var findRow = this.dsContractProd.findRow("PRODUCT_CODE", ds.getColumn(0, "PRODUCT_CODE"));
				
				if(findRow == -1) {
					/*바인딩 순서 중요*/
					this.dsContractProd.setColumn(this.dsContractProd.rowposition, "NO_PURCHASE_FLAG", ds.getColumn(0, "NO_PURCHASE_FLAG"));
					this.dsContractProd.setColumn(this.dsContractProd.rowposition, "PRODUCT_NAME", ds.getColumn(0, "PRODUCT_NAME"));
					this.dsContractProd.setColumn(this.dsContractProd.rowposition, "ROYALTY_TYPE", ds.getColumn(0, "ROYALTY_TYPE"));
					
					this.dsContractProd.setColumn(this.dsContractProd.rowposition, "RELATED_COMPANY_CODE", ds.getColumn(0, "RELATED_COMPANY_CODE"));
					this.dsContractProd.setColumn(this.dsContractProd.rowposition, "RELATED_COMPANY_NAME", ds.getColumn(0, "RELATED_COMPANY_NAME"));

					this.dsContractProd.setColumn(this.dsContractProd.rowposition, "PRODUCT_CODE", ds.getColumn(0, "PRODUCT_CODE"));
					if(ds.getColumn(0, "PRODUCT_CODE").indexOf(this.cmb_SalesProduct.value)<0)
						this.gfnAlert(this.gfnGetTransTxt(1504,"제품명 및 버전이 다릅니다. 다시 확인해주세요."));
				} else {
					this.gfnAlert('msg.err.validator.duplcation',[findRow]);
					return;
				}
				
			break;	
			case "popupGoodsSearch" :	// 상품
				var ds = new nexacro.Dataset();
				ds.loadJSON(Variant);
				this.recentVariant = ds;
				
				var findRow = this.dsContractGoods.findRow("PRODUCT_CODE", ds.getColumn(0, "PRODUCT_CODE"));
				
				if(findRow == -1) {
					/*바인딩 순서 중요*/
					this.dsContractGoods.setColumn(this.dsContractGoods.rowposition, "NO_PURCHASE_FLAG", ds.getColumn(0, "NO_PURCHASE_FLAG"));
					this.dsContractGoods.setColumn(this.dsContractGoods.rowposition, "PRODUCT_NAME", ds.getColumn(0, "PRODUCT_NAME"));
					this.dsContractGoods.setColumn(this.dsContractGoods.rowposition, "ROYALTY_TYPE", ds.getColumn(0, "ROYALTY_TYPE"));
					
					this.dsContractGoods.setColumn(this.dsContractGoods.rowposition, "RELATED_COMPANY_CODE", ds.getColumn(0, "RELATED_COMPANY_CODE"));
					this.dsContractGoods.setColumn(this.dsContractGoods.rowposition, "RELATED_COMPANY_NAME", ds.getColumn(0, "RELATED_COMPANY_NAME"));

					this.dsContractGoods.setColumn(this.dsContractGoods.rowposition, "PRODUCT_CODE", ds.getColumn(0, "PRODUCT_CODE"));
				} else {
					this.gfnAlert('msg.general', ["동일한 상품이 존재합니다."]);
					return;
				}
			break;
			case "popupPurProductSearch":	// 매입상품
				var ds = new nexacro.Dataset();
				ds.loadJSON(Variant);
				this.recentVariant = ds;
				
				//var sContractType = this.dsPurchaseList.getColumn(this.dsPurchaseList.rowposition, "CONTRACT_TYPE");
				//var sContractType = ds.getColumn(0, "PRODUCT_CODE").substring(0, 1);
				// this.dsPurchaseList.setColumn(this.dsPurchaseList.rowposition, "CONTRACT_TYPE",sContractType);
				this.dsPurchaseList.setColumn(this.dsPurchaseList.rowposition, "PRODUCT_CODE", ds.getColumn(0, "PRODUCT_CODE"));
				this.dsPurchaseList.setColumn(this.dsPurchaseList.rowposition, "PRODUCT_NAME", ds.getColumn(0, "PRODUCT_NAME"));
				
				// 연관제품 처리
				
				var sRelatedProductCd = ds.getColumn(0, "RELATED_PRODUCT_CODE");
				var sRelatedProductNm = ds.getColumn(0, "RELATED_PRODUCT_NAME");
				if (this.gfnIsEmpty(sRelatedProductCd)) {
					sRelatedProductCd = this.dsContractProd.getColumn(0, "PRODUCT_CODE");
					sRelatedProductNm = this.dsContractProd.getColumn(0, "PRODUCT_NAME");
				}
				
				this.dsPurchaseList.setColumn(this.dsPurchaseList.rowposition, "RELATED_PRODUCT_CODE", sRelatedProductCd);
				this.dsPurchaseList.setColumn(this.dsPurchaseList.rowposition, "RELATED_PRODUCT_NAME", sRelatedProductNm);
				
				
				// 상품의 매칭된 거래처 처리
				if (sContractType == "CM") {					
					this.dsPurchaseList.setColumn(this.dsPurchaseList.rowposition, "CONTRACT_MAIN", ds.getColumn(0, "RELATED_COMPANY_CODE"));
					this.dsPurchaseList.setColumn(this.dsPurchaseList.rowposition, "CONTRACT_MAIN_NAME", ds.getColumn(0, "RELATED_COMPANY_NAME"));
				}
			break;
			case "popupPurRelatedProductSearch":	// 매입연관상품
				var ds = new nexacro.Dataset();
				ds.loadXML(Variant);
				this.recentVariant = ds;
				
				this.dsPurchaseList.setColumn(this.dsPurchaseList.rowposition, "RELATED_PRODUCT_CODE", ds.getColumn(0, "PRODUCT_CODE"));
				this.dsPurchaseList.setColumn(this.dsPurchaseList.rowposition, "RELATED_PRODUCT_NAME", ds.getColumn(0, "PRODUCT_NAME"));
			break;
			
			case "popupClientSearch":	// 고개사
				var ds = new nexacro.Dataset();
				ds.loadJSON(Variant);
				this.recentVariant = ds;
				
				this.dsPurchaseList.setColumn(this.dsPurchaseList.rowposition, "CONTRACT_MAIN", ds.getColumn(0, "COMPANY_CODE"));
				this.dsPurchaseList.setColumn(this.dsPurchaseList.rowposition, "CONTRACT_MAIN_NAME", ds.getColumn(0, "COMPANY_NAME"));
			break;
			case "CompanyTypeSelect":	// 담당자
				var ds = new nexacro.Dataset();
				ds.loadJSON(Variant);
				this.recentVariant = ds;
				
				// return 정보가 없으면 종료
				if (ds.rowcount<=0) return;
				
				var nDupCnt = 0;
				for (var i=0; i<ds.rowcount; i++) {
					var nfindRow = this.dsAddressbookList.findRow("CA_SEQ", ds.getColumn(i, "CA_SEQ"));
					if(nfindRow>=0)
					{
						nDupCnt++;
						//this.gfnAlert(this.gfnGetTransTxt(1982,"@1@의 중복데이터가 존재 합니다.",[ds.getColumn(i, "EMP_NAME")]));
						continue;
					}
// 					nfindRow = this.dsAddressbookList.findRow("EMP_NAME", ds.getColumn(i, "EMP_NAME"));
// 					if(nfindRow>=0)
// 					{
// 						nDupCnt++;
// 						if(!this.confirm(this.gfnGetTransTxt(1983,"@1@의 동명이인이 있습니다. 등록하시겠습니까?",[ds.getColumn(i, "EMP_NAME")])))
// 							continue;
// 					}				
					// 담당자 정보 세팅
					this.dsAddressbookList.set_enableevent(false);
					var nRow = this.dsAddressbookList.addRow();
					this.dsAddressbookList.setColumn(nRow, "CA_SEQ",		ds.getColumn(i, "CA_SEQ"));
					this.dsAddressbookList.setColumn(nRow, "SOURCE_CD",		"PL");
					this.dsAddressbookList.setColumn(nRow, "SOURCE_DATA",	this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE"));
					this.dsAddressbookList.setColumn(nRow, "COMPANY_NAME",	ds.getColumn(i, "COMPANY_NAME"));
					this.dsAddressbookList.setColumn(nRow, "DEPT_NAME",		ds.getColumn(i, "DEPT_NAME"));
					this.dsAddressbookList.setColumn(nRow, "EMP_NAME",		ds.getColumn(i, "EMP_NAME"));
					this.dsAddressbookList.setColumn(nRow, "GRADE_CODE",	ds.getColumn(i, "GRADE_CODE"));
					this.dsAddressbookList.setColumn(nRow, "ROLE_CODE",		ds.getColumn(i, "ROLE_CODE"));
					this.dsAddressbookList.setColumn(nRow, "H_PHONE_NO",	ds.getColumn(i, "H_PHONE_NO"));
					this.dsAddressbookList.setColumn(nRow, "HOLD_OFFICE",	ds.getColumn(i, "HOLD_OFFICE"));
					this.dsAddressbookList.setColumn(nRow, "O_PHONE_NO",	ds.getColumn(i, "O_PHONE_NO"));
					this.dsAddressbookList.setColumn(nRow, "EMAIL",			ds.getColumn(i, "EMAIL"));
					this.dsAddressbookList.setColumn(nRow, "REMARKS",		ds.getColumn(i, "REMARKS"));
					this.dsAddressbookList.set_enableevent(true);
				}
				if(nDupCnt > 0) {
					this.gfnAlert('msg.general',this.gfnGetTransTxt(1982,nDupCnt + "건의 중복데이터는 제거 되었습니다."));
				}
			break;
			case "popupProjectSearch":		// 계약추가시 프로젝트 검색
				var ds = new nexacro.Dataset();
				ds.loadXML(Variant);				
				
				this.dsList.set_enableevent(false);
				var nAddRow = this.dsList.insertRow(0);// addRow();
				
				this.dsList.setColumn(nAddRow, "PROJECT_CODE",		ds.getColumn(0, "PROJECT_CODE"));
				this.dsList.setColumn(nAddRow, "PROJECT_NAME",		ds.getColumn(0, "PROJECT_NAME"));
				this.dsList.setColumn(nAddRow, "CLIENT_CODE",		ds.getColumn(0, "CLIENT_CODE"));
				this.dsList.setColumn(nAddRow, "CLIENT_NAME",		ds.getColumn(0, "CLIENT_NAME"));
				
				this.dsList.setColumn(nAddRow, "CONTRACT_NAME",		ds.getColumn(0, "CONTRACT_NAME"));
				this.dsList.setColumn(nAddRow, "CONTRACT_MAIN",		ds.getColumn(0, "CONTRACT_MAIN"));
				this.dsList.setColumn(nAddRow, "CONTRACT_MAIN_NAME",ds.getColumn(0, "CONTRACT_MAIN_NAME"));
				this.dsList.setColumn(nAddRow, "PIPELINE_FLAG",		"0");
				this.dsList.setColumn(nAddRow, "BUSINESS_TYPE",		this.ds_cmm_BusinessType.getColumn(0, "CODE"));
				this.dsList.setColumn(nAddRow, "SALES_STATUS",		"001");
				this.dsList.setColumn(nAddRow, "CONTRACT_STATUS",	"0");
				
				this.dsList.setColumn(nAddRow, "RELATED_PROJECT_CODE",		ds.getColumn(0, "PROJECT_CODE"));
				this.dsList.setColumn(nAddRow, "RELATED_PROJECT_NAME",		ds.getColumn(0, "PROJECT_NAME"));
				this.dsList.setColumn(nAddRow, "PROJECT_CONTRACT_STATUS",	ds.getColumn(0, "PROJECT_CONTRACT_STATUS"));
				this.dsList.setColumn(nAddRow, "SAVE_TYPE",					"A");
				
				//추가 계약시 영업대표가 등록할경우 담당영업에 영업대표 셋팅
				//영업대표가 아닐경우 기존계약 영업대표 셋팅
				var sEmpNo = nexacro.getApplication().gdsUserInfo.getColumn(0, "EMP_NO");
				var nFindRow = this.ds_cmm_SalesEmp.findRow("EMP_NO", sEmpNo);
				if(nFindRow<0)
					sEmpNo = ds.getColumn(0, "BIZ_STAFF");
					
				this.dsList.setColumn(nAddRow, "SALES_EMP_NO",		sEmpNo);
				this.dsList.setColumn(nAddRow, "SALES_EMP_NAME",	this.ds_cmm_SalesEmp.getColumn(nFindRow, "EMP_NAME"));
				this.dsList.setColumn(nAddRow, "SALES_DEPT_CD",		this.ds_cmm_SalesEmp.getColumn(nFindRow, "DEPT_CD"));
				this.dsList.setColumn(nAddRow, "SALES_DEPT_NAME",	this.ds_cmm_SalesEmp.getColumn(nFindRow, "DEPT_NAME"));
				this.dsList.setColumn(nAddRow, "SALES_CO_CD",		this.ds_cmm_SalesEmp.lookup("EMP_NO", sEmpNo, "CO_CD"));
				
				
				/*	CONTRACT_SEQ MAX 값 조회 처리	*/
				// 조건값(Rarameter) 셋팅
				this.gfnAddSendParameter("PROJECT_CODE", ds.getColumn(0, "PROJECT_CODE"));

				// 조회용 Output dataset 세팅
				this.gfnAddOutputDataset("dsContractSeq", "ds_output");
				this.gfnCommonTransaction("Get_MaxContractSeq", "SS_Presales_S04", null, false);
				
				var sContractSeq = this.dsContractSeq.getColumn(0, "CONTRACT_SEQ");
				if (this.gfnIsEmpty(sContractSeq)) sContractSeq = "1";
				this.dsList.setColumn(nAddRow, "CONTRACT_SEQ",	sContractSeq);
				
				
				this.dsContractProd.clearData();
				this.dsContractGoods.clearData();
				this.dsContractSi.clearData();
				this.dsPurchaseList.clearData();
				this.dsScheduleList.clearData();
				this.dsAddressbookList.clearData();
				this.dsList.set_enableevent(true);
				this.div_RelatedProject.set_enable(true);	// 연결 프로젝트 활성화
				
				//계약추가 시 파일 초기화
				this.div_Attachment.set_url("");
				this.div_Attachment.SOURCE_SEQ = this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE");
				this.div_Attachment.set_url("sales::comm/COM_Attachment.xfdl");		
				// 견적서 버튼 활성화
				this.btn_Estimate.set_enable(true);
			break;
			case "SP_PurchaseContractTypeSelect":	// 매입계약 (연관) 제품 검색
				var sContractType = Variant;
				
				if(sContractType == "cancel" || this.gfnIsEmpty(sContractType) == true) {	//팝업 리턴값이 없거나 cancel일 경우 return 
					return;
				}
				
				this.dsPurchaseList.set_enableevent(false);
				var nAddRow = this.dsPurchaseList.addRow();
				this.dsPurchaseList.setColumn(nAddRow, "PROJECT_CODE",	this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE"));
				this.dsPurchaseList.setColumn(nAddRow, "CONTRACT_NAME",	this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_NAME"));
				this.dsPurchaseList.setColumn(nAddRow, "CONTRACT_DATE",	this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_DATE"));
				this.dsPurchaseList.setColumn(nAddRow, "CONTRACT_TYPE",	sContractType.substr(0,2));
				this.dsPurchaseList.setColumn(nAddRow, "PURCHASE_CONTRACT_STATUS",	"0")
				
				// trace("sContractType:["+sContractType+"]");
				
				this.dsPurchaseList.setColumn(nAddRow, sContractType);;
// 				if (sContractType == "C") {			//	판매 수수료
// 					this.dsPurchaseList.setColumn(nAddRow, sContractType);;
// 				} else if (sContractType == "D") {	//	총판 수수료
// 					this.dsPurchaseList.setColumn(nAddRow, "PRODUCT_CODE", "D01");;
// 				}
				this.dsPurchaseList.set_enableevent(true);
			break;
			case "popupRequestLicenseConfirm":
				if (Variant != "CANCEL") {
					this.fnPopupRequestLicense (Variant[0], Variant[1], Variant[2], Variant[3]);
				}
			break;
			case "SS_ContractLink":					// 상품 매출 매입 연결
				//			
		}
	}

};
 /************************************************************************************************
 * FORM 공통 FUNCTION 영역
 ************************************************************************************************/
// 공통 검색 Popup 설정 처리
this.fnSetComCmbConfig = function ()
{
	this.div_search.form.div_ClientName.param = "pvMode:1";
	this.div_search.form.div_ProjectName.param = "searchtype:P";
}
 
// 화면 권한 설정 처리
this.fnAuthConfig = function(nTabIndx)
{
	
	if( (this.commUtil.getFormAuthority(235,1) == true) 
		|| (this.commUtil.getFormAuthority(235,2) == true))	//저장권한
	{
		this.div_search.form.btn_Add.set_enable(true);
		this.div_search.form.btn_Delete.set_enable(true);
		this.div_search.form.btn_Save.set_enable(true);
		
		//this.btn_File_Upload.set_enable(true);
		this.btn_CostSheet.set_enable(true);
		//this.btn_ContractReport.set_enable(false);
		this.btn_Order_Confirm.set_enable(true);
		this.div_search.form.rd_EmpKind.set_visible(false);
	}
	
	this.btn_Affirmation.set_enable(false);	// 확약서
	this.btn_RequestLicense.set_enable(false);	// 라이선스요청

	this.div_search.form.cmb_ContractStatus.set_visible(false);	// 계약 상태
	this.div_search.form.stc_ContractStatus.set_visible(false);	
	this.div_search.form.stc_ContractType.set_visible(false);
	this.div_search.form.cmb_ContractType.set_visible(false);
	this.div_Attachment.set_enable(true);	
	
	// this.btn_Order_Confirm.set_width(70);
	this.btn_Order_Confirm.set_text(this.gfnGetTransTxt (128, "계약확정"));
	
	this.fnAuthConfigSales();
	
	// Presales탭 조회
	//this.fnQueryData();
	this.div_search.form.div_ProjectName.param = "searchtype:P,contractstatus:0";	
	
	
};

this.fnAuthConfigSales = function()
{
	var sAuthKind = "N";
	
	if (this.commUtil.getFormAuthority(235,2))		sAuthKind = "LS";	// 영업팀장이상
	else {
		if(this.commUtil.getFormAuthority(235,1))	sAuthKind = "S";	// 일반영업
		else 										sAuthKind = "N";	// 일반사용자
	}
	//if (this.commUtil.getFormAuthority(235,11))	this.FV_AUTH_PRICE_MASK = true;	// 계약금액 마스킹 처리 권한
	
	
	var nCurrow = this.dsList.rowposition;
	var bDisableFlag;
	
	// 예외대상 목록
	var arrCompInfo = new Array();
	arrCompInfo[0] = this.edt_ProjectCode;			// 프로젝트 코드
	//arrCompInfo[1] = this.div_InConfirm;			// 프로젝트 코드
	
	if (nCurrow < 0) {		// 최초 onLoad
		if (sAuthKind == "LS")	bDisableFlag = false;
		else					bDisableFlag = true;
		
		// this.gfnCompDisable(this, bDisableFlag, arrCompInfo);
	} else {				// Row변경시 재설정
		var sLoginEmpNo = this.gfnGetUserInfo("EMP_NO");
		var sTargetEmpNo = this.dsList.getColumn(nCurrow, "SALES_EMP_NO");
		
		if (sAuthKind == "LS") bDisableFlag = false;		// 영업팀장이상은 등록가능
		else if (sAuthKind == "S" && (sTargetEmpNo == sLoginEmpNo)) bDisableFlag = false;	// (일반영업) 담당영업이 본인인 경우만 등록가능
		else bDisableFlag = true;	// 일반사용자 수정불가
		
		// this.gfnCompDisable(this, bDisableFlag, arrComp);
	}
	this.gfnCompDisable(this, bDisableFlag, arrCompInfo);
	
	var bBtnCtr;
	if (bDisableFlag)	bBtnCtr = false;
	else				bBtnCtr = true;
	
	this.div_search.form.btn_Delete.set_enable(bBtnCtr);
	this.div_search.form.btn_Save.set_enable(bBtnCtr);	
	this.btn_CostSheet.set_enable(bBtnCtr);
	
	// 라이선스 발급요청 권한
// 	if (this.commUtil.getFormAuthority(235,4)) {
// 		this.btn_RequestLicense.set_enable(true);
// 	}
// 	
	
	var sSaveType = this.dsList.getColumn(this.dsList.rowposition, "SAVE_TYPE");
	if (sSaveType == "A") {
		this.div_ClientName.set_enable(false);
		this.edt_ProjectName.set_readonly(true);
	} else {
		this.div_ClientName.set_enable(true);
		this.edt_ProjectName.set_readonly(false);
	}	
	
}



 /************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역
 ************************************************************************************************/
// 조회 버튼 클릭 
this.div_search_btn_Search_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.cfnSearch();	// Presales탭 조회 버튼 이벤트
};

// 저장 버튼 클릭 
this.div_search_btn_Save_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.fnSaveData();
};

// 신규 버튼 클릭 
this.div_search_btn_Add_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	 this.fnAddContract();
};

// 삭제 버튼 클릭 
this.div_search_btn_Delete_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.fnDeleteData();
};

// 엑셀 Export
this.div_search_btn_Excel_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var objGrd;
	var sFileNm;
	objGrd = this.grd_Presales;
	sFileNm = "ExcelPresles";
	
	this.gfn_excelExport(this, objGrd, sFileNm);
};
	
// 매출원가표(사전)
this.btn_CostSheet_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var nCurrow =  this.dsList.rowposition;
	var sProjectCd = this.dsList.getColumn(nCurrow, "PROJECT_CODE");
	var sContractMain = this.dsList.getColumn(nCurrow, "CONTRACT_MAIN");
	
	var ObjDs = this.dsPurchaseList;
	
	for (var i=0; i<ObjDs.rowcount; i++)
	{
		// 매입계약중 매출연결 되지 않을 경우 안내 처리 (판매수수료 예외처리)
		var sContractType = ObjDs.getColumn(i, "CONTRACT_TYPE");
		if (sContractType != "CM" && sContractType != "DM") {
			if ( this.gfnIsEmpty(ObjDs.getColumn(i, "CRD_SEQ")))
			{
				this.gfnAlert('confirm.general',this.gfnGetTransTxt (1856,"연결되지 않은 상품 매출(또는 매입)이 있습니다.\n진행 하시겠습니까?"),null,
						function(srvId,rtn) {
							if(this.gfnIsNull(rtn) || rtn == "false" || rtn == false) return;
							this.divDet.form.divDet2.form.divPur.form.btn_ContractLink.click();
							return;
						});
				return;
			}
		}
	}
	
	if (this.gfnIsEmpty(sProjectCd)) {
		this.gfnAlert('msg.general',this.gfnGetTransTxt (1508, "선택된 프로젝트가 없습니다."));
		return;
	}
	
	if (this.gfnIsEmpty(sContractMain) || sContractMain == "Z02371") {
		this.gfnAlert('msg.general',this.gfnGetTransTxt (1509, "계약처 선택 후 진행 바랍니다."));
		return;
	}
	
	var objSiDs = this.dsContractSi;
	var sSiContractNo = "";
	if (objSiDs.rowcount > 0) {
		sSiContractNo = objSiDs.getColumn(0, "CONTRACT_NO");
	}
	
	if (this.fnContractMainInfoSearch(obj.name) == "1") {
		var Argument = {pv_project_cd:sProjectCd, pv_costsheet_type:"1", PV_si_contract_no:sSiContractNo};
		Argument.title = "매출원가표";
		this.commUtil.popup(this, "popupCostSheet", "sales::sales/SP_CostSheet.xfdl", -1, -1, -1, -1, true, true, false, Argument, "fnPopupCallBack");
	}
	
};

// 수주확정(Presales 탭), 계약확정취소(계약 탭)
this.btn_Order_Confirm_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	if(this.dsList.rowcount == 0) return;
	
	if (obj.text == this.gfnGetTransTxt (128, "계약확정")) {
		if (this.fnContractMainInfoSearch(obj.name) == "1") {
			this.fnContractOk();	// Presales탭 수주확정(계약확정) 처리
		}
	} else if (obj.text == this.gfnGetTransTxt (660, "계약확정취소")) {
		this.fnContractCancel();	// 계약탭 계약확정취소 처리
	}
};


// 탭 변경시
this.tab_Sales_onchanged = function(obj:nexacro.Tab,e:nexacro.TabIndexChangeEventInfo)
{
	this.fnAuthConfig(e.postindex);	// 권한 처리
	
	if (e.postindex == 0) {
	// 영업현황
		this.div_search.form.cmb_ContractStatus.set_visible(true);	// 계약 상태
		this.div_search.form.stc_ContractStatus.set_visible(true);
		this.div_search.form.stc_ContractType.set_visible(true);
		this.div_search.form.cmb_ContractType.set_visible(true);
		this.ds_cmm_ContractStatus.filter("");
		this.div_search.form.cmb_ContractStatus.set_index(0);
		
		this.div_Attachment.set_enable(false);
		this.div_Attachment.set_url("");
		this.btn_RequestLicense.set_enable(false);	// 라이선스요청
		this.btn_Affirmation.set_enable(true);		// 확약서
		this.btn_Estimate.set_enable(false); // 견적서
		
		// 영업현황탭 조회
		if(this.tab_Sales.tpg_sales.form.all.length>0)
			this.tab_Sales.tpg_sales.form.fnQueryData();	
		this.div_search.form.div_ProjectName.param = "searchtype:P";
		
	} else if (e.postindex == 1) {
	// Presales
		// 권한 처리
		this.btn_Affirmation.set_enable(false);	// 확약서
		this.btn_RequestLicense.set_enable(true);	// 라이선스요청
		this.tab_Sales.tpg_Presales.form.fnAuthConfig();
	
		this.div_search.form.cmb_ContractStatus.set_visible(false);	// 계약 상태
		this.div_search.form.stc_ContractStatus.set_visible(false);	
		this.div_search.form.stc_ContractType.set_visible(false);
		this.div_search.form.cmb_ContractType.set_visible(false);
		this.div_Attachment.set_enable(true);	
		
		// this.btn_Order_Confirm.set_width(70);
		this.btn_Order_Confirm.set_text(this.gfnGetTransTxt (128, "계약확정"));
		
		// Presales탭 조회
		this.tab_Sales.tpg_Presales.form.fnQueryData();
		this.div_search.form.div_ProjectName.param = "searchtype:P,contractstatus:0";
	} else {
	// 계약
		this.div_search.form.cmb_ContractStatus.set_visible(true);	// 계약 상태
		this.div_search.form.stc_ContractStatus.set_visible(true);
		this.div_search.form.stc_ContractType.set_visible(true);
		this.div_search.form.cmb_ContractType.set_visible(true);
		
		this.ds_cmm_ContractStatus.filter("CODE==''||CODE=='2'||CODE=='3'");
		this.div_search.form.cmb_ContractStatus.set_index(0);
		
		this.div_Attachment.set_enable(false);
		this.div_Attachment.set_url("");
		
		this.btn_Order_Confirm.set_text(this.gfnGetTransTxt (660, "계약확정취소"));
		this.btn_RequestLicense.set_enable(false);	// 라이선스요청
		this.btn_Affirmation.set_enable(false);	// 확약서
		this.btn_Estimate.set_enable(false); // 견적서
		
		// 계약탭 조회
		if(this.tab_Sales.tpg_Contract.form.all.length>0)
			this.tab_Sales.tpg_Contract.form.fnQueryData();
		this.div_search.form.div_ProjectName.param = "searchtype:P";
	}
};

this.div_search_div_ClientName_onkeyup = function(obj:nexacro.Div,e:nexacro.KeyEventInfo)
{
	if(e.keycode == 13)
	{
		this.div_search.form.btn_Search.click();
	}	
};

this.div_search_div_ProjectName_onkeyup = function(obj:nexacro.Div,e:nexacro.KeyEventInfo)
{
	if(e.keycode == 13)
	{
		this.div_search.form.btn_Search.click();
	}
};



// 라이선스 요청
this.btn_RequestLicense_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.tab_Sales.tpg_Presales.form.fnRequestLicense();	
};


// 확약서 Popup
this.btn_Affirmation_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.alert("준비중입니다.");
	return;
	var nCurrow = this.tab_Sales.tpg_sales.form.ds_list.rowposition;
	var objDs = this.tab_Sales.tpg_sales.form.ds_list;
	var sContractNo = "";
	if (objDs.rowcount > 0) {
		sContractNo = objDs.getColumn(nCurrow, "CONTRACT_NO");
	}
	
	var Argument = {pvContractNo:sContractNo};
	this.commUtil.popup(this, "popupAffirmation", "Sales::SS_AffirmationReport.xfdl", -1, -1, 1300, 830, true, false, false, Argument, "fnPopupCallBack");
};

this.btn_ContractReport_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.tab_Sales.tpg_Contract.form.fnPopupContractReport();
};

// 견적서 Popup
this.fnEstimateRegPopup = function()
{
	var nCurrow =  this.tab_Sales.tpg_Presales.form.dsList.rowposition;
	var sProjectCd = this.tab_Sales.tpg_Presales.form.dsList.getColumn(nCurrow, "PROJECT_CODE");
	var sSalesEmpNo = this.tab_Sales.tpg_Presales.form.dsList.getColumn(nCurrow, "SALES_EMP_NO");
	var sSalesEmpName = this.tab_Sales.tpg_Presales.form.dsList.getColumn(nCurrow, "SALES_EMP_NAME");
	
	if (this.gfnIsEmpty(sProjectCd)) {
		this.alert(this.gfnGetTransTxt (1508, "선택된 프로젝트가 없습니다."));
		return;
	}
	
	var Argument =  {
						pvProjectCode:sProjectCd
					   ,pvSalesEmpNo:sSalesEmpNo
					   ,pvsSalesEmpName:sSalesEmpName
					   ,pvSalesDocType:"ESTIMATE"
					   ,pvEstimateType:"NEW_ESTIMATE"
					   ,pvEstimateKind:"PRODUCT"
					   ,pvAutoSearch : true
					};
	this.commUtil.popup(this, "popupEstimate", "Sales::SS_EstimateReg.xfdl", -1, -1, 1400, 916, true, true, true, Argument, "fnPopupCallBack");
};

this.btn_Estimate_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	this.fnEstimateRegPopup();
};

/*-------------------------------------------------------------*/

// 마스터(프로젝트, 계약) 조회
this.fnQueryData = function(sKind)
{	
	this.dsContractProd.clearData();
	this.dsContractSi.clearData();
	this.dsContractCS.clearData();
	this.dsContractGoods.clearData();
	this.dsPurchaseList.clearData();
	this.dsScheduleList.clearData();
	this.dsAddressbookList.clearData();
	
	if(sKind != "Save")
	{
		this.nRowPosition = 0;
	}
	else 
	{
		this.SAVE_FLAG = true;
	}

	// 세부 DS 초기화
	// 	this.dsContractProd.clearData();
	// 	this.dsContractSi.clearData();
	// 	this.dsContractGoods.clearData();
	// 	this.dsScheduleList.clearData();
	// 	this.dsAddressbookList.clearData();


	// 조건값(Rarameter) 셋팅
	this.gfnAddSendParameter("PROJECT_NAME",		this.div_search.form.div_ProjectName.getData());
	this.gfnAddSendParameter("CLIENT_NAME",			this.div_search.form.div_ClientName.getData());
	this.gfnAddSendParameter("NONE_DATE",			this.div_search.form.chk_NoneDate.value);
	this.gfnAddSendParameter("FROM_CONTRACT_DT",	this.div_search.form.div_Search_yyyyMM_FromTo.getFromYYYYMM());
	this.gfnAddSendParameter("TO_CONTRACT_DT",		this.div_search.form.div_Search_yyyyMM_FromTo.getToYYYYMM());
	this.gfnAddSendParameter("SALES_EMP_NO",		this.div_search.form.cmb_SalesRepresent.value);
	this.gfnAddSendParameter("SALES_STATUS",		this.div_search.form.cmb_SalesStatus.value);
	this.gfnAddSendParameter("ATM_SEQ",				162);

	this.gfnSetMap("salesManagerMapper", "PresalesList", "dsList");
	this.gfnCommonTransaction("SS_Presales_S01", 	"selectNextList.do"/*		"SS_Presales_S01"*/, this.grd_Presales);
	
	// 조회용 Output dataset 세팅
// 	this.gfnAddOutputDataset("dsList",		"ds_output");
// 	this.gfnCommonTransaction("SS_Presales_S01", "SS_Presales_S01", this.grd_Presales);
};



// 공통 검색 Popup 설정 처리
this.fnSetComCmbConfig = function ()
{
	this.div_ClientName.param = "pvMode:1";
	this.div_ContractMain.param = "pvMode:2";
}

 this.fnFormInit = function()
 {
	if(this.FV_CO_CD == "J02") {
		this.divDet.form.divDet1.form.divProd.form.grd_SalesProd.set_formatid("PRODUCT_JAP");
		this.divDet.form.divDet2.form.divPur.form.grd_SalesPurchase.set_formatid("PURCHASE_JAP");
	}
	else this.divDet.form.divDet1.form.divProd.form.grd_SalesProd.set_formatid("default");
 };

 /************************************************************************************************
 * TRANSACTION 및 추가 FUNCTION 영역
 ************************************************************************************************/
 this.fnSalesEmpSerch = function()
{
	this.gfnAddSendParameter("COMPANY_CODE", this.gfnGetCompanyCode());
	this.gfnSetMap("salesManagerMapper", "SalesmanCombo", "ds_cmm_SalesEmp");
	this.gfnCommonTransaction("CO_SalesEmp_S01", 	"selectNextList.do"/*		"CO_SalesEmp_S01"*/);
	
// 	// 조회용 Output dataset 세팅
// 	this.gfnAddOutputDataset("ds_cmm_SalesEmp"	, "ds_output");
// 	this.gfnCommonTransaction("CO_SalesEmp_S01", "CO_SalesEmp_S01");
}


// 시작 종료일에 대한 MEN_MONTH 조회
this.fnGetMM = function(sStartDt, sEndDt, nRow) {
	if (this.gfnIsEmpty(sStartDt) || this.gfnIsEmpty(sEndDt)) {
		return;	
	}
	if (sStartDt>sEndDt)
	{
		return;
	}
	
	this.gfnAddSendParameter("START_DATE",	sStartDt);
	this.gfnAddSendParameter("END_DATE",	sEndDt);
	this.gfnAddSendParameter("ROW",			nRow);
// 	this.gfnAddOutputDataset("ds_MM", "ds_output");
// 	this.gfnCommonTransaction("getMM", "CO_GetMM_S01");
	
	this.gfnSetMap("nextBaseMapper", "CO_GetMM_S01", "ds_MM");
	this.gfnCommonTransaction("getMM", 	"selectNextList.do");	
};
 
  // 세부(제품, 상품, 용역, 매입계약, 진행사항, 담당자) 조회
this.fnSSearch = function(sProjectCd)
{
	this.dsContractProd.clearData();
	this.dsContractSi.clearData();
	this.dsContractCS.clearData();
	this.dsContractGoods.clearData();
	this.dsPurchaseList.clearData();
	this.dsScheduleList.clearData();
	this.dsAddressbookList.clearData();
	
	// 조건값(Rarameter) 셋팅
	this.gfnAddSendParameter("PROJECT_CODE", sProjectCd);
	
	// 조회용 Output dataset 세팅
// 	this.gfnAddOutputDataset("dsContractProd",		"ds_output1");
// 	this.gfnAddOutputDataset("dsContractSi",		"ds_output2");
// 	this.gfnAddOutputDataset("dsContractCS",		"ds_output7");
// 	this.gfnAddOutputDataset("dsContractGoods",		"ds_output3");
// 	this.gfnAddOutputDataset("dsPurchaseList",		"ds_output4");
// 	this.gfnAddOutputDataset("dsScheduleList",		"ds_output5");
// 	this.gfnAddOutputDataset("dsAddressbookList",	"ds_output6");
// 	this.gfnCommonTransaction("SS_Presales_S02", 	"SS_Presales_S02");
	
	var arrMap = [];
	arrMap[0] = "Contract_product";
	arrMap[1] = "Contract_si";
	arrMap[2] = "Contract_goods";
	arrMap[3] = "Purchase";
	arrMap[4] = "Sales_schedule";
	arrMap[5] = "Company_addressbook";
	arrMap[6] = "Contract_cs";
	var arrDs = ['dsContractProd','dsContractSi','dsContractGoods','dsPurchaseList','dsScheduleList'
					,'dsAddressbookList','dsContractCS'];

	this.gfnSetMap("salesManagerMapper", arrMap, arrDs);
	this.gfnCommonTransaction("SS_Presales_S02", "selectNextMultiList.do");	/*SS_Presales_S02*/
	
 };
 
// 저장
 this.fnSaveData = function()
 {
	if (!this.fn_getValidation("T"))
	{
		return;
	}

	this.fn_setInsertStatus(this.dsContractProd);
	this.fn_setInsertStatus(this.dsContractGoods);
		
	// 계약연결 알림 메시지 1회만 띄우기 위해 PROJECT_LIST 테이블 LINK_CONFIRM_FLAG 컬럼으로 확인 및 처리
	// 저장, 계약연결(제품매출 상단 버튼) 작업시 LINK_CONFIRM_FLAG 컬럼을 "1" 등록함
	var sLinkConfirmFlag = this.dsList.getColumn(this.dsList.rowposition, "LINK_CONFIRM_FLAG");
// 	if (sLinkConfirmFlag == "0") {
// 		var bNexaNFlag = this.fn_getNexaNCheck(this.dsContractProd);		// nexacro N 여부 확인
// 		if (bNexaNFlag) {
// 			var bUnionFlag = false;
// 			
// 			// 매출제품계약(nexacro N)은 이전 계약 중 nexacro 17(17.1)과 연결 할건지 확인
// 			for (var i=0; i<this.dsContractProd.rowcount; i++) {
// 				var nUnionCnt = this.dsContractProd.getColumn(i, "UNION_CNT");
// 				if (nUnionCnt > 0) {
// 					bUnionFlag = true;
// 					break;
// 				}
// 			}
// 			
// 			if (!bUnionFlag && this.FV_CO_CD == "A01") {
// 				this.alert(this.gfnGetTransTxt(1463,"기존계약이 있으면 '계약연결'버튼을 통해 계약을 연결해 주세요"));
// 			}
// 		}
// 	}
	
	
	this.nRowPosition = this.dsList.rowposition;
	
	this.gfnAddSendParameter("BUSINESS_TYPE",		this.cmb_BusinessType.value);
	this.gfnAddSendParameter("SALES_STATUS",		this.cmb_SalesStatus.value);
	this.gfnAddSendParameter("CONTRACT_NAME",		this.edt_ContractName.value);
	this.gfnAddSendParameter("CONTRACT_DATE",		this.cal_ContractDate.value);
	this.gfnAddSendParameter("PIPELINE_FLAG",		this.ckb_PipeLineFlag.value);
	this.gfnAddSendParameter("CONTRACT_MAIN",		this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_MAIN"));
	this.gfnAddSendParameter("PRODUCT_CODE",		this.dsList.getColumn(this.dsList.rowposition, "PRODUCT_CODE"));
	this.gfnAddSendParameter("SALES_EMP_NO",		this.dsList.getColumn(this.dsList.rowposition, "SALES_EMP_NO"));
	this.gfnAddSendParameter("SALES_DEPT_CD",		this.dsList.getColumn(this.dsList.rowposition, "SALES_DEPT_CD"));
	this.gfnAddSendParameter("SALES_DEPT_NAME",		this.dsList.getColumn(this.dsList.rowposition, "SALES_DEPT_NAME"));
	this.gfnAddSendParameter("SALES_CO_CD",			this.dsList.getColumn(this.dsList.rowposition, "SALES_CO_CD"));

	// 입력용 Input Dataset 세팅
// 	this.gfnAddInputDataset ("dsList",					"ds_contract");
// 	this.gfnAddInputDataset ("dsContractProd",		"ds_contract_prod");
// 	this.gfnAddInputDataset ("dsContractGoods",	"ds_contract_goods");
// 	this.gfnAddInputDataset ("dsContractSi",		"ds_contract_si");
// 	this.gfnAddInputDataset ("dsContractCS",		"ds_contract_cs");
// 	this.gfnAddInputDataset ("dsPurchaseList",		"ds_purchase");
// 	this.gfnAddInputDataset ("dsScheduleList",		"ds_schedule");
// 	this.gfnAddInputDataset ("dsAddressbookList",	"ds_addressbook");

	
	if(this.dsList.getRowType(this.dsList.rowposition) == Dataset.ROWTYPE_NORMAL) {
		this.dsList.setColumn(this.dsList.rowposition, "UPDATEFLAG", parseInt(this.dsList.getColumn(this.dsList.rowposition,"UPDATEFLAG"))+1);
	}
	
	this.gfnAddInputDataset ("dsList",					"dsInput1");
	this.gfnAddInputDataset ("dsContractProd",		"dsInput2");
	this.gfnAddInputDataset ("dsContractGoods",	"dsInput3");
	this.gfnAddInputDataset ("dsContractSi",		"dsInput4");
	this.gfnAddInputDataset ("dsContractCS",		"dsInput5");
	this.gfnAddInputDataset ("dsPurchaseList",		"dsInput6");
	this.gfnAddInputDataset ("dsScheduleList",		"dsInput7");
	this.gfnAddInputDataset ("dsAddressbookList",	"dsInput8");	
// 	
// 	this.gfnCommonTransaction("SS_Presales_R01", "SS_Presales_R01");
	

	this.gfnCommonTransaction("Save", "savePresalseList.do");
 }
 
 
 // Validation check
this.fn_getValidation = function(sMode)
{
	var bRtnVal = true;
	if (sMode == "T") {
// 		if (!this.fnGetChangeDs() && !this.gfnIsUpdateDs(this.dsList)) {
// 			this.alert(this.gfnGetTransTxt(1243,"변경된 데이터가 없습니다."));
// 			return false;
// 		}
		
		var nContrProdCnt = this.dsContractProd.rowcount;
		var nContrSiCnt = this.dsContractSi.rowcount;
		var nContrGoodsCnt = this.dsContractGoods.rowcount;
		var nContrCsCnt = this.dsContractCS.rowcount;
		var nTotCnt = nContrProdCnt + nContrSiCnt + nContrGoodsCnt + nContrCsCnt;
		if (nTotCnt <= 0) {
			this.gfnAlert('msg.general',[this.gfnGetTransTxt(1464,"매출 상세내역을 최소 한건이라도 입력 하세요")]);
			return false;
		}

		this.gfnClearValidation(this.dsList);

		this.gfnSetValidation(this.dsList, "CLIENT_CODE", "고객사"	, "required");
		this.gfnSetValidation(this.dsList, "PROJECT_NAME", "프로젝트명"	, "required");
		this.gfnSetValidation(this.dsList, "PRODUCT_CODE", "사업분류"	, "required");
		this.gfnSetValidation(this.dsList, "CONTRACT_MAIN", "계약처"	, "required");
		this.gfnSetValidation(this.dsList, "CONTRACT_NAME", "계약명"	, "required");
		this.gfnSetValidation(this.dsList, "SALES_STATUS", "영업상태"	, "required");
		this.gfnSetValidation(this.dsList, "CONTRACT_DATE", "계약(예정)일"	, "required");
		this.gfnSetValidation(this.dsList, "BUSINESS_TYPE", "사업구분"	, "required");
		this.gfnSetValidation(this.dsList, "SALES_EMP_NO", "담당영업"	, "required");
		
		// Dataset의 변경된 Row Validation check
		if (this.gfnValidation(this.dsList, "U") == false) return false;

		this.gfnClearValidation(this.dsContractProd);

		this.gfnSetValidation(this.dsContractProd, "PRODUCT_CODE", "매출상세항목"	, "required");
		this.gfnSetValidation(this.dsContractProd, "CONTRACT_PRICE", "예상매출액"	, "required");
		
		// Dataset의 변경된 Row Validation check
		if (this.gfnValidation(this.divDet.form.divDet1.form.divProd.form.grd_SalesProd, "U") == false) return false;
		
		this.gfnClearValidation(this.dsContractSi);

		this.gfnSetValidation(this.dsContractSi, "ROLE_CODE", "[용역매출]역할"	, "required");
		this.gfnSetValidation(this.dsContractSi, "LEVEL_CODE", "[용역매출]등급"	, "required");
		this.gfnSetValidation(this.dsContractSi, "START_DATE", "[용역매출]시작일자"	, "required");
		this.gfnSetValidation(this.dsContractSi, "END_DATE", "[용역매출]종료일자"	, "required");
		this.gfnSetValidation(this.dsContractSi, "CONTRACT_PRICE", "[용역매출]금액"	, "required");
		
		// Dataset의 변경된 Row Validation check
		if (this.gfnValidation(this.divDet.form.divDet2.form.divSi.form.grd_SalesSi, "U") == false) return false;
		
		this.gfnClearValidation(this.dsContractCS);

		this.gfnSetValidation(this.dsContractCS, "ROLE_CODE", "[기술서비스]역할"	, "required");
		this.gfnSetValidation(this.dsContractCS, "LEVEL_CODE", "[기술서비스]등급"	, "required");
		this.gfnSetValidation(this.dsContractCS, "EXECUTION_TYPE", "[기술서비스]수행방식"	, "required");
		this.gfnSetValidation(this.dsContractCS, "TECH_SUPPORT_UNIT", "[기술서비스]단위"	, "required");
		this.gfnSetValidation(this.dsContractCS, "START_DATE", "[기술서비스]시작일자"	, "required");
		this.gfnSetValidation(this.dsContractCS, "END_DATE", "[기술서비스]종료일자"	, "required");
		this.gfnSetValidation(this.dsContractCS, "CONTRACT_PRICE", "[기술서비스]금액"	, "required");
		
		// Dataset의 변경된 Row Validation check
		if (this.gfnValidation(this.divDet.form.divDet2.form.divCS.form.grd_SalesCS, "U") == false) return false;
	
		// 매입계약 입력값 확인
		for (var i=0; i<this.dsPurchaseList.rowcount; i++)
		{
			var sContractType = this.dsPurchaseList.getColumn(i, "CONTRACT_TYPE");
			if (this.gfnIsEmpty(this.dsPurchaseList.getColumn(i, "PRODUCT_CODE"))) {
				this.gfnAlert('msg.err.validator.input',[this.gfnGetTransTxt(1490,("[매입] 항목(제품)을 입력하세요"))]);
				return false;
			}
			if (this.gfnIsEmpty(this.dsPurchaseList.getColumn(i, "CONTRACT_PRICE"))) {
				this.gfnAlert('msg.err.validator.input',[this.gfnGetTransTxt(1491,("[매입] 예상매입액을 입력하세요"))]);
				return false;
			}
			if (this.gfnIsEmpty(this.dsPurchaseList.getColumn(i, "CONTRACT_MAIN"))) {
				this.gfnAlert('msg.err.validator.input',[this.gfnGetTransTxt(1492,("[매입] 매입처를 입력하세요"))]);
				return false;
			}
			
			if (sContractType == "C") {				// 판매수수료
				if (this.gfnIsEmpty(this.dsPurchaseList.getColumn(i, "COMMISSION_RATE"))) {
					this.gfnAlert('msg.err.validator.input',[this.gfnGetTransTxt(1493,("[매입] 판매수수료율을 입력하세요"))]);
					return false;
				}
				if (this.gfnIsEmpty(this.dsPurchaseList.getColumn(i, "RELATED_PRODUCT_CODE"))) {
					this.gfnAlert('msg.err.validator.input',[this.gfnGetTransTxt(1494,("[매입] 연관제품을 입력하세요"))]);
					return false;
				}
			} else if (sContractType == "D") {		// 총판수수료
				if (this.gfnIsEmpty(this.dsPurchaseList.getColumn(i, "COMMISSION_RATE"))) {
					this.gfnAlert('msg.err.validator.input',[this.gfnGetTransTxt(1495,("[매입] 총판수수료율을 입력하세요"))]);
					return false;
				}
				if (this.gfnIsEmpty(this.dsPurchaseList.getColumn(i, "RELATED_PRODUCT_CODE"))) {
					this.gfnAlert('msg.err.validator.input',[this.gfnGetTransTxt(1494,("[매입] 연관제품"))]);
					return false;
				}
			}
		}	
	}
	return true;
}
 
this.fn_getCompareProductCode = function()
{
	this.ds_checkProduct.clearData();
	
	var sProductCodeList = "";
	var sProdProductCodeList = "";
	var sGoodsProductCodeList = "";
	for(var i = 0; i < this.dsContractProd.rowcount; i++) {
		var sProductCode = this.dsContractProd.getColumn(i, "PRODUCT_CODE");
		sProdProductCodeList += sProductCode;
		if(this.dsContractProd.rowcount - 1  > i || this.dsContractGoods.rowcount > 0) sProdProductCodeList += ",";
	}
	
	for(var i = 0; i < this.dsContractGoods.rowcount; i++) {
		var sProductCode = this.dsContractGoods.getColumn(i, "PRODUCT_CODE");
		sGoodsProductCodeList += sProductCode;
		if(this.dsContractGoods.rowcount > i) sGoodsProductCodeList += ",";
	}
	
	sProductCodeList = sProdProductCodeList + sGoodsProductCodeList;
	
	this.gfnAddSendParameter("PROJECT_CODE",  this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE"));
	this.gfnAddSendParameter("CONTRACT_STATUS",  "0");
	this.gfnAddSendParameter("PRODUCT_LIST",  sProductCodeList);
	this.gfnAddOutputDataset("ds_checkProduct",	"ds_output");
	this.gfnCommonTransaction("SS_Presales_S08", "SS_Presales_S08", null, false);
};
 
  // 인력 요청 처리 여부 확인
 this.fnRequestStaffSearch = function(sProjectCd, sContractNo)
 {
	// 조건값(Rarameter) 셋팅
	this.gfnAddSendParameter("PROJECT_CODE", sProjectCd);
	this.gfnAddSendParameter("CONTRACT_NO",  sContractNo);
	
	// 조회용 Output dataset 세팅
// 	this.gfnAddOutputDataset("ds_RequestStaff",	"ds_output");
// 	this.gfnCommonTransaction("SS_Presales_S03", "SS_Presales_S03", null, false);
	
	this.gfnSetMap("salesManagerMapper", "SS_Presales_S03", "ds_RequestStaff");
	this.gfnCommonTransaction("SS_Presales_S03", "selectNextList.do",null, false);		
 };
  
this.fnContractMainInfoSearch = function(sBtnId)
{
	if (this.fnGetChangeDs() || this.gfnIsUpdateDs(this.dsList)) {
		this.gfnAlert('msg.general', [this.gfnGetTransTxt(1364,"변경된 데이터가 존재 합니다. 저장후 진행해 주세요")]);
		return "0";
	}

	/*	여신프로세스 처리	*/
	this.FV_BUTTON_TYPE = sBtnId;
	this.gfnAddSendParameter("CONTRACT_MAIN",  this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_MAIN"));
	this.gfnAddSendParameter("PROJECT_CODE",  this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE"));
// 	this.gfnAddOutputDataset("ds_ContractMainInfo",	"ds_output");
// 	this.gfnAddOutputDataset("ds_CostsheetInfo",	"ds_output2");
// 	this.gfnCommonTransaction("SS_Presales_S06", "SS_Presales_S06", null, false);
	
	this.gfnSetMap("salesManagerMapper", ["SS_Presales_S06_1","SS_Presales_S06_2"], ["ds_ContractMainInfo","ds_CostsheetInfo"]);
	this.ErrorCode = 0;
	this.gfnCommonTransaction("SS_Presales_S06", 	"selectNextMultiList.do", null, false);		

	if(this.ErrorCode == 0) {
		return this.fnCheckCostSheet(this.FV_BUTTON_TYPE);
	} else {
		return "0";
	}
}
 
this.fnCheckCostSheet = function(sBtnId)
{
	var sRtnVal = "1";
	var nRowIdx = this.dsList.rowposition;
	var sContractAmt = this.dsList.getColumn(nRowIdx, "CONTRACT_AMT");				// 매출(예상)금액
	var sClPsAmt = this.ds_ContractMainInfo.getColumn(0, "CL_PS");					// 여신한도_제품/제품+용역
	var sRestmt = this.ds_ContractMainInfo.getColumn(0, "REST");					// 잔여
	var sCompanyState = this.ds_ContractMainInfo.getColumn(0, "COMPANY_STATE");		// 회사상태
	var sClExceptionCd = this.ds_ContractMainInfo.getColumn(0, "CL_EXCEPTION_CODE");// 회사여신 예외항목	
	var sCcSeq = this.ds_CostsheetInfo.getColumn(0, "CC_SEQ");						// 사전원가표 작업여부 확인용

	var nOverbudget = 0;

	if (nexacro.toNumber(sClPsAmt) > 0 && !this.gfnIsEmpty(sRestmt)) {
		nOverbudget = nexacro.toNumber(sRestmt) - nexacro.floor((nexacro.toNumber(sContractAmt) * 0.9));
	}	

	if (sBtnId == "btn_Order_Confirm")
	{
// 		if (sCompanyState != "001") {			// 회사상태가 (N/A)정상이 아닌 경우 
// 			if (this.gfnIsEmpty(sCcSeq)) {		// 사전원가표 작업 없는 경우
// 				this.gfnAlert('msg.general',this.gfnGetTransTxt(1635,"계약처 회사상태:" + this.ds_ContractMainInfo.getColumn(0, "COMPANY_STATE_NAME") + " 를 확인 바랍니다. 사전원가표 진행 대상입니다."));
// 				return "0";
// 			}
// 		}
		
		// 여신 초과 알림
// 		if (nOverbudget < 0 ) {
// 		/*			
// 			회사 여신 예외항목(CL_EXCEPTION_CODE) 기타(상계가능)(006), 정부/공공기관(007), 해외기업(008)
// 			경우는 예외로 계약확정 가능(이외는 사전원가표 작성필)
// 		*/		
// 			if (sClExceptionCd != "006" && sClExceptionCd != "007" && sClExceptionCd != "008") {
// 				if (this.gfnIsEmpty(sCcSeq)) {		// 사전원가표 작업 없는 경우
// 					this.gfnAlert('msg.general',this.gfnGetTransTxt(1971,this.ds_ContractMainInfo.getColumn(0, "COMPANY_NAME") + " 여신이 초과 되었습니다. 사전원가표 진행 바랍니다."));
// 					return "0";
// 				}
// 			}
// 		} 
	}

// 	if (sClExceptionCd != "006" && sClExceptionCd != "007" && sClExceptionCd != "008") {	
// 		if (this.gfnIsEmpty(this.ds_ContractMainInfo.getColumn(0, "CL_APPROVAL_DATE"))) {
// 			if (this.confirm(this.gfnGetTransTxt(1972,"(@1@)의 여신평가 미진행 되었습니다.\n완료 후 진행 바랍니다.\n사업지원팀에 여신평가 요청 하시겠습니까?",[this.ds_ContractMainInfo.getColumn(0, "COMPANY_NAME")]))) {
// 				// [Y] (자동 메일발송)
// 				this.fn_SendMail("1");
// 			}
// 			sRtnVal = "0";
// 		} else if (this.gfnIsEmpty(this.ds_ContractMainInfo.getColumn(0, "CLH_SEQ"))) {
// 			var sMaxYear = this.ds_ContractMainInfo.getColumn(0, "MAX_YEAR");
// 			if (this.gfnIsEmpty(sMaxYear)) {
// 				if (this.confirm(this.gfnGetTransTxt(1972,"(@1@)의 여신평가 미진행 되었습니다.\n완료 후 진행 바랍니다.\n사업지원팀에 여신평가 요청 하시겠습니까?",[this.ds_ContractMainInfo.getColumn(0, "COMPANY_NAME")]))) {
// 					// [Y] (자동 메일발송)
// 					this.fn_SendMail("1");
// 				}
// 			} else {
// 				if (this.confirm(this.gfnGetTransTxt(1973,"(@1@)의 여신평가 [@2@]년 입니다.\n최근 재무정보 업데이트 후 진행 바랍니다.\n사업지원팀에 여신평가 요청 하시겠습니까?",[this.ds_ContractMainInfo.getColumn(0, "COMPANY_NAME"),sMaxYear]))) {
// 					// [Y] (자동 메일발송)
// 					this.fn_SendMail("2");
// 				}
// 			}
// 			sRtnVal = "0";
// 		}
// 	}

	return sRtnVal
}
  
  // 삭제 처리
 this.fnDeleteData = function()
 {
	if (this.dsList.rowcount<=0) {
		this.gfnAlert('msg.err.nodata',[]);
		return;
	}
	
	this.gfnAlert('confirm.info.delete', ['선택한 계약'], null,
		function(srvId, rtn) {
			if(this.gfnIsNull(rtn) || rtn == false || rtn == "false") return;
			var sProjectCd = this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE");
			if (!this.gfnIsEmpty(sProjectCd)) {
				this.fnRequestStaffSearch(sProjectCd, null);
				if (this.ds_RequestStaff.rowcount > 0)
				//if (this.ds_RequestStaff.rowcount > 0 && objDs.rowcount==1)
				{
					this.gfnAlert('msg.general',["해당 프로젝트에 지원인력 요청 건이 있어 삭제 할수 없습니다.\n지원요청 삭제후 처리하세요"]);
					return;
				}
			}
			this.dsList.enableevent = false;
			this.dsList.deleteRow(this.dsList.rowposition);
			this.dsPurchaseList.deleteAll();		
			this.dsList.enableevent = true;
		});

 }
 
 this.fnSendSMS = function ()
 {
	var sSendType = "SELF";
	var sTelNoKind = "M";
	
	var sAlimTalkService = "PRESALES_CONTRACT";
	
	// Massage 처리
	var sClientNm = this.div_ClientName.getData();
	var sContractNm = this.edt_ContractName.value;
	var sMsg = sClientNm+":"+sContractNm;
	if (this.commUtil.getByteSize(sMsg) > 75) {
		sMsg = sMsg.substr(0, 75);
	}
	sMsg = "수주:" + sMsg;	
	
	
	var arrSmsInfo = new Array();
	// [화면별 권한] 계약확정 SMS 
	arrSmsInfo[0] = {};
	arrSmsInfo[0].pvUserKind = "FORM_AUTH";
	

	if (this.FV_CO_CD == "W01") {
		arrSmsInfo[0].pvUserCode = "235,8";
	} else {
		arrSmsInfo[0].pvUserCode = "235,3";
	}
	
	//this.gfnAddSmsList(arrSmsInfo);		// 수신자 처리 
	this.gfnAddAlimTalkList(arrSmsInfo);		// 수신자 처리 
	//this.gfnSendSms ("SendSMS", sSendType, sTelNoKind, "", sMsg, "");	// SMS 발송
	this.gfnSendAlimTalk ("SendSMS", sSendType, sTelNoKind, "", sMsg, "", sAlimTalkService);	// 알림톡 발송
 }
 
 
 this.fnContractOkSendEmail = function ()
 {
	//받는사람 중복된는 경우가 있어서 초기화 한번 해줌 [SRH_SEQ:84209]
	nexacro.getApplication().gdsEmailList.clearData();
	var arrEmailInfo = new Array();
	
	//계약확정 Email 수신
	arrEmailInfo[0] = {};
	arrEmailInfo[0].pvType = "TO";
	arrEmailInfo[0].pvUserKind = "FORM_AUTH";
	
	if (this.FV_CO_CD == "W01") {
		arrEmailInfo[0].pvUserCode = "235,9";
	} else if(this.FV_CO_CD == "J02") {
		arrEmailInfo[0].pvUserCode = "235,10"; // 김진희 책임
		
		var sEmpNo = this.dsList.getColumn(this.dsList.rowposition, "SALES_EMP_NO");
	} else {
		arrEmailInfo[0].pvUserCode = "235,7";
	}
	this.gfnAddEmailList(arrEmailInfo);
	
	// Massage 처리
	var sClientNm = this.div_ClientName.getData();
	var sProjectNm = this.edt_ProjectName.value;
	var sContractNm = this.edt_ContractName.value;
	var sSalesEmpNm = this.cmb_SalesEmpNo.text;
	var sContractDate = this.cal_ContractDate.text;
	var strTitle = "";
	var strContents = "";
	
		strTitle = sClientNm+" 계약확정 확정 안내";
		strContents = 
		 '<html> \n'
		+'<head> \n'
		+'<meta charset="utf-8"/> \n'
		+'<title>계약확정</title> \n'
		+'<body> \n'
		+'<p style="margin: 0px; font-family: 돋움, Dotum, Helvetica, sans-serif; font-size: 12px; text-align: center;"><b>계약 확정 안내</b></p> <p> \n'
		+'<p style="margin: 0px; font-family: 돋움, Dotum, Helvetica, sans-serif; font-size: 12px;">＊고&nbsp;&nbsp;&nbsp;객&nbsp;&nbsp;&nbsp;사 : '+sClientNm+'</p> \n'
		+'<p style="margin: 0px; font-family: 돋움, Dotum, Helvetica, sans-serif; font-size: 12px;">＊프&nbsp;로&nbsp;젝&nbsp;트 : '+sProjectNm+'</p> \n'
		+'<p style="margin: 0px; font-family: 돋움, Dotum, Helvetica, sans-serif; font-size: 12px;">＊담&nbsp;당&nbsp;영&nbsp;업 : '+sSalesEmpNm+'</p>\n'
		+'<p style="margin: 0px; font-family: 돋움, Dotum, Helvetica, sans-serif; font-size: 12px;">＊계약예정일 : '+sContractDate+'</p> <p>\n'
		+'</body> \n'
		+'</html> \n';

	this.gfnSendEmail("ContractOkSendEmail", "SELF", "", strTitle, strContents);
 }
 
  
 /************************************************************************************************
 * FORM 공통 FUNCTION 영역
 ************************************************************************************************/
this.fnAddContract = function ()
{
	var nFindRow = this.fnGetFindRowType(this.dsList, "INSERT");
	if (nFindRow>=0) {
		this.gfnAlert('msg.info.alreadydata',['신규건']);
		return;
	}
	
	var sTitle = "신규 프로젝트 유형";
	var oArg   = {pvIndex : 0};
	var oOption = {title:sTitle
				,titlebar:true};
	var sPopupCallBack = "fnPopupCallBack";
	this.gfnOpenPopup("newProjectType", "sales::sales/SM_PresaleType.xfdl", oArg, sPopupCallBack, oOption);
	
	//this.div_InConfirm.form.rd_kind.set_index(0);
}


this.fnGetFindRowType = function(objDs, sRowType)
{
	var nRtnVal = -1;
	var nRowCnt = objDs.rowcount;
	for (i=0; i<nRowCnt; i++) {
		var nRowType = objDs.getRowType(i);
		
		if (sRowType == "INSERT") {
			if (nRowType == 2) {	// Dataset.ROWTYPE_INSERT
				nRtnVal = i;
				break;
			}
		} else if (sRowType == "UPDATE") {
			if (nRowType == 4) {	// Dataset.ROWTYPE_INSERT
				nRtnVal = i;
				break;
			}
		}
	}
	return nRtnVal;	
}
	

this.fnGetChangeDs = function()
{
	var objDsList = {
		ContProd: this.dsContractProd,
		ContGoods: this.dsContractGoods,
		ContSi: this.dsContractSi,
		Purchase: this.dsPurchaseList,
		Schedule: this.dsScheduleList,
		AddrBook: this.dsAddressbookList,
		ContTech:this.dsContractCS
	}
	
	return this.gfnIsUpdateDsList(objDsList);
}

this.fnGetChangeMainDs = function()
{
	var objDsList = {
		ContMainDs: this.dsList
	}
	
	return this.gfnIsUpdateDsList(objDsList);
};

// 수주확정(계약확정) 처리
this.fnContractOk = function()
{
	var sContractNo = this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_NO");
	if (this.gfnIsEmpty(sContractNo)) {
		this.gfnAlert('msg.general',this.gfnGetTransTxt(1501,"신규건은 계약확정을 진행 할수 없습니다. 저장후 진행하세요"));
		return;
	}

	//견적서 파일 유무 확인
	this.gfnAddSendParameter("PROJECT_CODE", this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE"));
	// 조회용 Output dataset 세팅
// 	this.gfnAddOutputDataset("dsFileCnt", "dsOutput");
// 	this.gfnCommonTransaction("Get_FileCnt", "SS_Presales_S05", null, false);
	
	this.gfnSetMap("salesManagerMapper", ["SS_Presales_S05"], ["dsFileCnt"]);
	this.ErrorCode = 0;
	this.gfnCommonTransaction("Get_FileCnt", 	"selectNextMultiList.do", null, false);		
	if(this.ErrorCode < 0) return;
	
// 	
	if(this.dsFileCnt.getColumn(0, "CNT")==0)
	{
		this.gfnAlert('msg.general',this.gfnGetTransTxt(1203,"견적서 파일이 첨부 되지 않았습니다."));// 견적서 첨부 후 진행 바랍니다.");
		return;
	}
// 	
	this.dsList.set_enableevent(false);
	this.dsList.setColumn(this.dsList.rowposition, "CONTRACT_STATUS",	"2");
	this.dsList.set_enableevent(true);

	// 입력용 Input Dataset 세팅
	this.gfnAddInputDataset ("dsList", "dsInput1","U");
	this.gfnAddInputDataset ("dsList", "dsInput2","U");
	this.gfnAddInputDataset ("dsList", "dsInput3","U");
	//this.gfnCommonTransaction("SS_Presales_R02", "SS_Presales_R02");
	
	this.gfnSetMap("salesManagerMapper", ["SS_Presales_R02_1","SS_Presales_R02_2","SS_Presales_R02_3"]);
	this.gfnCommonTransaction("SS_Presales_R02", 	"saveNextList.do");			
}

this.fnRequestLicense = function() 
{
	var nCurrow		= this.dsContractProd.rowposition;
	var sProductCd	= this.dsContractProd.getColumn(nCurrow, "PRODUCT_CODE");
	var sProductName= this.dsContractProd.getColumn(nCurrow, "PRODUCT_NAME");
	
	var Argument = {pvProductCode:sProductCd, pvProductName:sProductName};
	this.commUtil.popup(this, "popupRequestLicenseConfirm", "Sales::SS_RequestLicenseConfirm.xfdl", -1, -1, 450, 200, true, false, false, Argument, "fnPopupCallBack");
}

this.fnPopupRequestLicense = function(sProductCode, sProductName, sProdShortName, sProductVer)
{
	if (this.dsContractProd.rowcount<=0) {
		this.alert(this.gfnGetTransTxt(1502,"제품매출 상세내역을 등록 하세요"));
		return;
	}
	
	if (this.fnGetChangeDs()) {
		this.alert(this.gfnGetTransTxt(1333,"저장후 라이센스 요청하시기 바랍니다"));
		return;
	}
	
	var bAppend = true;
	var nCurrow = this.dsContractProd.rowposition;
	var sContractNo		= this.dsContractProd.getColumn(nCurrow, "CONTRACT_NO");
	var sContractName	= this.dsContractProd.getColumn(nCurrow, "CONTRACT_NAME");
	var sLicenseKind =  "";
	
	if (sProductCode.substr(0, 5) == "G0101")	sLicenseKind = "Chart";
	else if (sProdShortName.indexOf("MP")>=0)	sLicenseKind = "MP";
	else if (sProdShortName.indexOf("XP ")>=0)	sLicenseKind = "XP";
	else if (sProdShortName.indexOf("NP")>=0)	sLicenseKind = "NP";
	else 										sLicenseKind = sProdShortName;
	
	// Chart 예외처리
	if (this.gfnIsEmpty(sProdShortName)) {
		if (sProductCode.substr(0, 5) == "G0101")	sLicenseKind = "Chart";
	}
	
	
	var nRow			= this.dsList.rowposition;
	var sProjectCode	= this.dsList.getColumn(nRow, "PROJECT_CODE");
	var sProjectName	= this.dsList.getColumn(nRow, "PROJECT_NAME");
	var sClientCode		= this.div_ClientName.getCode();
	var sClientName		= this.div_ClientName.getData();
	
	if (this.gfnIsEmpty(sContractNo)) {
		alert(this.gfnGetTransTxt(1334,"먼저 계약내용을 저장하십시요."));
		return;
	}
	
	
	// 선택된 제품계약 세부 정보 복사
	this.ds_ParamLic.clearData();
	this.ds_ParamLic.addRow();
	
	var nCurrow = this.dsContractProd.rowposition;
	this.ds_ParamLic.setColumn(0, "PRODUCT_CODE",	sProductCode);
	this.ds_ParamLic.setColumn(0, "PRODUCT_NAME",	sProductName);
	this.ds_ParamLic.setColumn(0, "PRODUCT_VERSION",sProductVer);
	this.ds_ParamLic.setColumn(0, "PRODUCT_LIST",	"");
	this.ds_ParamLic.setColumn(0, "PLATFORM_LIST",	"");
	this.ds_ParamLic.setColumn(0, "FUNCTION_LIST",	"");
	this.ds_ParamLic.setColumn(0, "ISDEV_FLAG",		"1");
	// bSucc = this.ds_ParamLic.copyRow(0, this.dsContractProd, this.dsContractProd.rowposition);

	var Argument = {pvLicenseKind:sLicenseKind, pvProjectCode:sProjectCode, pvProjectName:sProjectName, pvContractNo:sContractNo, pvContractName:sContractName, pvClientCode:sClientCode, pvClientName:sClientName, pvParamDsj:this.ds_ParamLic};
	this.commUtil.popup(this, "popupSalesRequestLicense", "Sales::SP_RequestLicense_pop.xfdl", -1, -1, 1200, 600, true, false, false, Argument, "fnPopupCallBack");
}

 /************************************************************************************************
 * 각 COMPONENT 별 EVENT 영역
 ************************************************************************************************/
this.dsList_onrowposchangedAfter = function(obj,e)
{
	this.sInsertType = "";
	
	// 권한 처리
	var bBtnCtr = this.fnAuthConfigSales();
	var evtRow = e.newrow;
	
	if(this.SAVE_FLAG) {
		evtRow = this.nRowPosition;
		this.SAVE_FLAG = false;
	}
	
	// 파일 Upload 처리 (SOURCE_SEQ=="CONTRACT_NO")
	//this.div_Attachment.BINDDATASET = "dsList";
	this.div_Attachment.set_url("");
	this.div_Attachment.SOURCE_SEQ = this.dsList.getColumn(evtRow, "PROJECT_CODE");
	this.div_Attachment.PROJECT_CODE = this.dsList.getColumn(evtRow, "PROJECT_CODE");
	this.div_Attachment.set_url("sales::comm/COM_Attachment.xfdl");
	// 견적서 버튼 활성화
	this.btn_Estimate.set_enable(true);
	
	// 연결 프로젝트 활성화 처리
	var sRelatedProjectCd = obj.getColumn(evtRow, "RELATED_PROJECT_CODE");
	if (this.gfnIsEmpty(sRelatedProjectCd)) { this.div_RelatedProject.set_enable(false); }
	else 									{ this.div_RelatedProject.set_enable(true); }	
	
	// 계약 및 세부 정보 조회
	var sProjectCd = obj.getColumn(evtRow, "PROJECT_CODE");
	this.fnSSearch(sProjectCd);
	
	// 계약확정 버튼 활성화
	this.fnCheckOrderConfirm(evtRow);
	
	if(this.gfnIsNull(this.dsList.getColumn(evtRow, "PROJECT_CODE"))) {
		this.divDet.form.divDet2.form.divPur.form.btn_ContractLink.set_enable(false);
	} else {
		this.divDet.form.divDet2.form.divPur.form.btn_ContractLink.set_enable(true);
	}
	
};

// 목록 Row 변경시 세부 목록 조회
this.dsList_onrowposchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSRowPosChangeEventInfo)
{
	// 추가계약인 상태에서 Row 변경 시 Validation 체크
	if(this.fnGetChangeDs() || this.fnGetChangeMainDs()) {
		this.gfnAlert('confirm.before.moveropos',[],null,
			function(srvId, rtn) {
				if(this.gfnIsNull(rtn) || rtn == false || rtn == "false") {
					this.dsList.set_enableevent(false);
					obj.set_rowposition(e.oldrow);
					this.div_Attachment.SOURCE_SEQ = this.dsList.getColumn(e.oldrow, "CONTRACT_NO");
					this.dsList.set_enableevent(true);
					return;
				} else {
					obj.enableevent = false;
					obj.deleteRow(e.oldrow);
					this.sInsertType = "";				
					obj.enableevent = true;
					this.dsList_onrowposchangedAfter(obj, e);
				}
			});
	} else {
		this.dsList_onrowposchangedAfter(obj, e);
	}

};

this.fnCheckOrderConfirm = function(nRow, sDocStatus)
{
	// 권한 처리
	var bBtnCtr = this.fnAuthConfigSales();
	
	//사전원가표 상신후 처리
 	if(nRow==-1 && !this.gfnIsEmpty(sDocStatus))
 	{
 		this.dsList.set_enableevent(false);
		nRow = this.dsList.rowposition;
 		this.dsList.setColumn(nRow, "DOC_STATUS", sDocStatus);
		this.dsList.set_enableevent(true);
 	}
		
	// 계약확정 버튼 활성화
	if (((this.dsList.getColumn(nRow, "DOC_STATUS") == "FINISH")		//사전원가표 전자결재 완료이거나
		|| this.gfnIsEmpty(this.dsList.getColumn(nRow, "DOC_STATUS")) 	//사전원가표 전자결재가 없을 경우
		&& bBtnCtr)
		|| this.commUtil.getFormAuthority(235,6))					//전자결제 무관하게 계약확정
		this.btn_Order_Confirm.set_enable(true);
	else
		this.btn_Order_Confirm.set_enable(false);
}

// 사업구분 변경시 담당영업 변경
this.cmb_BusinessType_onitemchanged = function(obj:nexacro.Combo,e:nexacro.ItemChangeEventInfo)
{
	this.fnSalesEmpSerch(e.postvalue);
};

// 담당영업 변경
this.cmb_SalesEmpNo_onitemchanged = function(obj:nexacro.Combo,e:nexacro.ItemChangeEventInfo)
{
	var nCurrow = this.dsList.rowposition;
	this.dsList.setColumn(nCurrow, "SALES_EMP_NO",		this.ds_cmm_SalesEmp.getColumn(e.postindex, "EMP_NO"));
	this.dsList.setColumn(nCurrow, "SALES_CO_CD",		this.ds_cmm_SalesEmp.getColumn(e.postindex, "CO_CD"));
	
	if (this.dsList.getRowType(nCurrow) != 2) {
		this.dsList.setColumn(nCurrow, "SALES_DEPT_CD",		this.ds_cmm_SalesEmp.getColumn(e.postindex, "DEPT_CD"));
		this.dsList.setColumn(nCurrow, "SALES_DEPT_NAME",	this.ds_cmm_SalesEmp.getColumn(e.postindex, "DEPT_NAME"));
	}
};

this.CommAddRow_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var nAddRow = 0;
	
	if (this.dsList.rowcount<=0) {
		this.gfnAlert('msg.info.noatdata',['계약']);
		return;
	}
	
	
	switch (obj.name)
	{
		case "btn_Add":
			nTabIdx = this.tab_Progess.tabindex;
			if (nTabIdx == 0) {
				var sContractNo = this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_NO");
				if(!this.gfnIsEmpty(sContractNo)) {
					// 진행상황
					nAddRow = this.dsScheduleList.addRow();
					this.tab_Progess.tpg_Progess.form.cal_IssueDate.set_value(this.gfnToday());
					this.dsScheduleList.setColumn(nAddRow, "PROJECT_CODE",	this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE"));
					this.dsScheduleList.setColumn(nAddRow, "CONTRACT_NO", 	sContractNo);
					this.dsScheduleList.setColumn(nAddRow, "REPORT_FLAG",	"0");
					this.dsScheduleList.setColumn(nAddRow, "OPEN_FLAG",		"0");
				}
				
			} else {
				// 담당자
				var sClientCd = this.dsList.getColumn(this.dsList.rowposition, "CLIENT_CODE");
				var sCompanyCd = this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_MAIN");

				if (this.gfnIsEmpty(sClientCd)) {
					this.gfnAlert('msg.general',[this.gfnGetTransTxt(1465,"고객사를 입력하세요.")]);
					return;
				}
				if (this.gfnIsEmpty(sCompanyCd)) {
					this.gfnAlert('msg.general',[this.gfnGetTransTxt(1465,"계약처를 입력하세요.")]);
					return;
				}

				var sArgument = {CLIENT_CODE:sClientCd, COMPANY_CODE:sCompanyCd};
				sArgument.title = "고객타입선택";
				this.commUtil.popup(this, "CompanyTypeSelect", "sales::sales/SC_CompanyTypeSelect.xfdl", -1, -1, null, null, true, true, false, sArgument, "fnPopupCallBack");
			}
		break;
		case "btn_ProdAdd":
			if(this.gfnIsNull(this.cmb_SalesProduct.value)) {
				this.gfnAlert('msg.noselect', ['사업분류'],"",function() {this.cmb_SalesProduct.setFocus();});
				return;
			}
			var nRowIdx = this.dsContractProd.rowcount -1;
			if (this.gfnIsEmpty(this.dsContractProd.getColumn(nRowIdx, "PRODUCT_CODE")) && nRowIdx>=0) {
				
				this.gfnAlert('msg.err.validator.input', ['사업상세분류']);
				return;
			}
			
			nAddRow = this.dsContractProd.addRow();
			this.dsContractProd.setColumn(nAddRow, "PROJECT_CODE", this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE"));
			//this.dsContractProd.setColumn(nAddRow, "CONTRACT_NO", this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_NO"));
			this.dsContractProd.setColumn(nAddRow, "CONTRACT_TYPE", "PD");
			this.dsContractProd.setColumn(nAddRow, "ANNUAL_FLAG", "0");
			this.dsContractProd.setColumn(nAddRow, "STRATEGY_SALES_FLAG", "0");
			this.dsContractProd.setColumn(nAddRow, "INSERT_STATUS", "I");
			
			this.dsContractProd.setColumn(nAddRow, "CONTRACT_SEQ", this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_SEQ"));
			
		break;
		case "btn_GoodsAdd":
		
			if(this.gfnIsNull(this.cmb_SalesProduct.value)) {
				this.gfnAlert('msg.noselect', ['사업분류'],"",function() {this.cmb_SalesProduct.setFocus();});
				return;
			}
			
			var nRowIdx = this.dsContractGoods.rowcount -1;
			if (this.gfnIsEmpty(this.dsContractGoods.getColumn(nAddRow, "PRODUCT_CODE")) && nRowIdx>=0) {
				
				this.alert(this.gfnGetTransTxt(1476,"[상품매출] 상품정보를 입력하세요"));
				return;
			}
			
			nAddRow = this.dsContractGoods.addRow();
			this.dsContractGoods.setColumn(nAddRow, "PROJECT_CODE", this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE"));
			//this.dsContractGoods.setColumn(nAddRow, "CONTRACT_NO", this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_NO"));
			this.dsContractGoods.setColumn(nAddRow, "CONTRACT_TYPE", "GD");
			this.dsContractGoods.setColumn(nAddRow, "ANNUAL_FLAG", "0");
			this.dsContractGoods.setColumn(nAddRow, "STRATEGY_SALES_FLAG", "0");
			this.dsContractGoods.setColumn(nAddRow, "INSERT_STATUS", "I");
			
			//trace("CONTRACT_SEQ:"+this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_SEQ"));
			this.dsContractGoods.setColumn(nAddRow, "CONTRACT_SEQ", this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_SEQ"));
			
		break;
		case "btn_SiAdd":
			nAddRow = this.dsContractSi.addRow();
			this.dsContractSi.setColumn(nAddRow, "PROJECT_CODE", this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE"));
			if (this.dsContractSi.rowcount > 0) {
				this.dsContractSi.setColumn(nAddRow, "CONTRACT_NO", this.dsContractSi.getColumn(0, "CONTRACT_NO"));
			}
			this.dsContractSi.setColumn(nAddRow, "CONTRACT_TYPE", "ZS");
			this.dsContractSi.setColumn(nAddRow, "STRATEGY_SALES_FLAG", "0");
			
			//trace("CONTRACT_SEQ:"+this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_SEQ"));
			this.dsContractSi.setColumn(nAddRow, "CONTRACT_SEQ", this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_SEQ"));

		break;
		case "btn_CSAdd":
			nAddRow = this.dsContractCS.addRow();
			this.dsContractCS.setColumn(nAddRow, "PROJECT_CODE", this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE"));
			this.dsContractCS.setColumn(nAddRow, "CONTRACT_NO", this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_NO"));
			this.dsContractCS.setColumn(nAddRow, "CONTRACT_TYPE", "ZT");
			this.dsContractCS.setColumn(nAddRow, "STRATEGY_SALES_FLAG", "0");
			
			//trace("CONTRACT_SEQ:"+this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_SEQ"));
			this.dsContractCS.setColumn(nAddRow, "CONTRACT_SEQ", this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_SEQ"));

		break;
		case "btn_PurAdd":
		
			// 24.10.3
				this.dsPurchaseList.set_enableevent(false);
				var sContractType = "CM";
				var nAddRow = this.dsPurchaseList.addRow();
				this.dsPurchaseList.setColumn(nAddRow, "PROJECT_CODE",	this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE"));
				this.dsPurchaseList.setColumn(nAddRow, "CONTRACT_NAME",	this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_NAME"));
				this.dsPurchaseList.setColumn(nAddRow, "CONTRACT_DATE",	this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_DATE"));
				this.dsPurchaseList.setColumn(nAddRow, "CONTRACT_TYPE",	"CM");
				this.dsPurchaseList.setColumn(nAddRow, "PURCHASE_CONTRACT_STATUS",	"0")
				
				// trace("sContractType:["+sContractType+"]");
				
				this.dsPurchaseList.setColumn(nAddRow, sContractType);;
				this.dsPurchaseList.set_enableevent(true);
				return;
			var expr = "CODE == 'CM'";
			expr = "";
			var sArgument = {sFilterExpr:expr};
			sArgument.title = "매입항목";
			sArgument.sContractType = "CM";
			this.commUtil.popup(this, "SP_PurchaseContractTypeSelect", "sales::sales/SP_PurchaseContractTypeSelect.xfdl", -1, -1, -1, -1, true, true, false, sArgument, "fnPopupCallBack");
		break;
	}
};


this.CommDelRow_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	var sConfirmMsg = "";
	var objDs;
	switch (obj.name)
	{
		case "btn_Del":
			nTabIdx = this.tab_Progess.tabindex;
			if (nTabIdx == 0) {
				objDs = this.objects["dsScheduleList"];
				sConfirmMsg = this.gfnGetTransTxt(1974,"해당 일정");
			} else {
				objDs = this.objects["dsAddressbookList"];
				sConfirmMsg = this.gfnGetTransTxt(1975,"해당 담당자");
			}
		break;
		case "btn_ProdDel":
			objDs = this.objects["dsContractProd"];
			sConfirmMsg = this.gfnGetTransTxt(1976,"해당 매출 상세");
		break;
		case "btn_GoodsDel":
			objDs = this.objects["dsContractGoods"];
			sConfirmMsg = this.gfnGetTransTxt(1977,"해당 기타매출 상세");
		break;
		case "btn_SiDel":
			objDs = this.objects["dsContractSi"];
			sConfirmMsg = this.gfnGetTransTxt(1978,"해당 용역매출 상세");
		break;
		case "btn_CSDel":
			objDs = this.objects["dsContractCS"];
			sConfirmMsg = this.gfnGetTransTxt(1979,"서비스매출 상세");
		break;
		case "btn_PurDel":
			objDs = this.objects["dsPurchaseList"];
			sConfirmMsg = this.gfnGetTransTxt(1980,"해당 매입내역");
		break;
	}
	
	if (objDs.rowcount<=0) {
		this.gfnAlert('msg.err.nodata',[this.gfnGetTransTxt(1497,"삭제할 데이터가 존재 하지 않습니다.")]);
		return;
	}
	
	this.gfnAlert('confirm.info.delete', [sConfirmMsg],"",
		function(sId, rtn) {
			if(this.gfnIsNull(rtn) || rtn == false || rtn == "false") return;
			var nDelRow = objDs.rowposition;
			
			if (obj.name == "btn_ProdDel" || obj.name == "btn_GoodsDel" || obj.name == "btn_SiDel" || obj.name == "btn_CSDel")
			{
				var sContractNo = objDs.getColumn(objDs.rowposition, "CONTRACT_NO");
				if (obj.name == "btn_ProdDel")		objDs = this.dsContractProd;
				else if (obj.name == "btn_GoodsDel") objDs = this.dsContractGoods;
				else if (obj.name == "btn_SiDel")	objDs = this.dsContractSi;
				else if (obj.name == "btn_CSDel")	objDs = this.dsContractCS;
				
				
				if (!this.gfnIsEmpty(sContractNo) && objDs.rowcount<=1) {
					this.fnRequestStaffSearch(null, sContractNo);
					
					if (this.ds_RequestStaff.rowcount > 0)
					{
						this.gfnAlert('msg.general', [this.gfnGetTransTxt(1326,"해당 매출계약의 지원인력 요청 건이 있어 삭제 할수 없습니다.\n지원요청 삭제후 처리하세요")]);
						return;
					}
				}
			}
			
			//var sCocd =this.gfnGetUserInfo(0, "CO_CD");
			//if(sCocd == "J02" && (obj.name == "btn_ProdDel" || obj.name == "btn_GoodsDel")) this.fnDelPurchase(objDs, nDelRow);
			objDs.deleteRow(nDelRow);			
		});
	return;

};

// 공통검색 component callback 처리
this.Com_Search_onChanged = function (obj, e)
{	
	if (!this.gfnIsEmpty(e.newCode)) {
		if (obj.name == "div_ContractMain") {
			// 고객사 변경시 처리
			var ds = new nexacro.Dataset();
			ds = this.div_ContractMain.form.recentVariant;
			
			var sCompStatus = ds.getColumn(0, "COMPANY_STATE");
			if (sCompStatus == "002") {
				this.alert(this.gfnGetTransTxt(1505,"폐업된 업체 입니다."));
			}
			
			
			/*	정부/공공기관(007), 해외기업(008) 예외처리 */
			var sClExceptionCd = ds.getColumn(0, "CL_EXCEPTION_CODE");// 회사여신 예외항목
			if (sClExceptionCd != "007" && sClExceptionCd != "008")
			{
				var nRestAmt = ds.getColumn(0, "REST");
				if (nexacro.toNumber(nRestAmt) < 0) {
					this.alert(this.gfnGetTransTxt(1335,"여신한도 금액 초과 업체 입니다.\n지급 보증각서 또는 내부품의 진행 바랍니다."));
				}
			}
		} else if (obj.name == "div_RelatedProject") {
			var ds = new nexacro.Dataset();
			ds = this.div_RelatedProject.form.recentVariant;
			this.dsList.setColumn(this.dsList.rowposition, "RELATED_PROJECT_CODE", ds.getColumn(0, "PROJECT_CODE"));
			this.dsList.setColumn(this.dsList.rowposition, "RELATED_PROJECT_NAME", ds.getColumn(0, "PROJECT_NAME"));
		}
	}	
};


// 제품매출 제품 검색 팝업 처리
this.divDet_divDet1_divProd_grd_SalesProd_onexpandup = function(obj:nexacro.Grid,e:nexacro.GridMouseEventInfo)
{
	if (e.cell == 0) {
		var sArgument = {};		//{pvMode:this.parent.mode}
		var sProductCd = this.dsContractProd.getColumn(e.row, "PRODUCT_CODE");
		
		// 매출 제품 선택 되지 않은 경우 대표제품으로 처리
		if (this.gfnIsEmpty(sProductCd))	sProductCd = this.dsList.getColumn(this.dsList.rowposition, "PRODUCT_CODE");
		
		sArgument.sProductCd = sProductCd;
		sArgument.sContractType = this.cmb_SalesProduct.value;
		this.commUtil.popupProductSearch(this, "popupProductSearch", "fnPopupCallBack", sArgument);
	}
};

// 상품매출 상품 검색 팝업 처리
this.divDet_divDet1_divGoods_grd_Salesgoods_onexpandup = function(obj:nexacro.Grid,e:nexacro.GridMouseEventInfo)
{
	if (e.cell == 0) {
		var sArgument = {};		//{pvMode:this.parent.mode}
		sArgument.sProductCd = this.dsContractGoods.getColumn(e.row, "PRODUCT_CODE");
		sArgument.sContractType = "ALL";
		sArgument.sFilterExpr = "CODE!='" + this.cmb_SalesProduct.value + "'";
		this.commUtil.popupProductSearch(this, "popupGoodsSearch", "fnPopupCallBack", sArgument);
	}
};

// 매입 상품, 연관제품 검색 팝업 처리
this.divDet_divDet2_divPur_grd_SalesPurchase_onexpandup = function(obj:nexacro.Grid,e:nexacro.GridMouseEventInfo)
{
	if (e.cell == 1) {
		var sContractType = this.dsPurchaseList.getColumn(e.row, "CONTRACT_TYPE");
		
		var sArgument = {};
		sArgument.sProductCd = this.dsPurchaseList.getColumn(e.row, "PRODUCT_CODE");
		sArgument.sProductCd2 = this.dsPurchaseList.getColumn(e.row, "RELATED_PRODUCT_CODE");
		
		if(this.gfnIsNull(sContractType)) {
			sArgument.sFilterExpr = "CODE=='"+sContractType+"'";
			sArgument.sContractType = sContractType;
		}
		
		//제품검색창 연관제품나오게 처리
		//sArgument.userelatedproduct = true;
		sArgument.sContractType = sContractType;
		//sArgument.sContractType = "CM";
		this.commUtil.popupProductSearch(this, "popupPurProductSearch", "fnPopupCallBack", sArgument);
		
// 	}else if (e.cell == 1) {
// 		var sArgument = {};
// 		sArgument.sProductCd = this.dsPurchaseList.getColumn(e.row, "RELATED_PRODUCT_CODE");
// 		this.commUtil.popupProductSearch(this, "popupPurRelatedProductSearch", "fnPopupCallBack", sArgument);
	} else if (e.cell == 3){
		var sArgument = {};
		sArgument.pvMode = "2";		
		sArgument.title = "매입처선택";
		this.commUtil.popupCompanySearch(this, "popupClientSearch", "fnPopupCallBack", sArgument);
	}
};


this.divDet_divDet2_divSi_grd_SalesSi_oncellclick = function(obj:nexacro.Grid,e:nexacro.GridClickEventInfo)
{
	this.ds_cmm_Level.filter("GRP_CD_1=='DEV' || GRP_CD_1=='ALL' ");
	
	//역할에 맞는 등급만 나오고 필터
// 	var sCellProp = obj.getCellProperty("body", e.cell, "text");
// 	var sColNm = sCellProp.split(":")[1];
// 	var ds = obj.getBindDataset();
// 	if(sColNm == "LEVEL_CODE")
// 	{
// 		var strRoleCode = ds.getColumn(e.row, "ROLE_CODE");
// 		var nRow = this.ds_cmm_Role.findRow("CODE", strRoleCode);
// 		var strKind = this.ds_cmm_Role.getColumn(nRow, "GRP_CD_1");	
// 		if (obj.name == "grd_SalesCS") {
// 			this.ds_cmm_Level.filter("GRP_CD_1=='DEV' || GRP_CD_1=='ALL' ");
// 		} else {
// 			//this.ds_cmm_Level.filter("VAL1=='"+strKind+"'");
// 			if (strKind == "ALL") {
// 				this.ds_cmm_Level.filter("GRP_CD_1!='ALL'");
// 			} else {
// 				this.ds_cmm_Level.filter("GRP_CD_1=='"+strKind+"'");
// 			}
// 		}
// 	}
};


// 인력 요청
this.divDet_divDet2_divSi_btn_Labor_Require_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	if (this.dsContractSi.rowcount == 0 ) {
		return;
	}
	
	var sArgument = {
			 pvKind			: "Si"
			,pvFormType		: "TR"
			,pvProjectCode	: this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE")
			,pvProjectName	: this.dsList.getColumn(this.dsList.rowposition, "PROJECT_NAME")
			,pvClientCode	: this.dsList.getColumn(this.dsList.rowposition, "CLIENT_CODE")
			,pvClientName	: this.dsList.getColumn(this.dsList.rowposition, "CLIENT_NAME")
			,pvProductCode	: this.dsList.getColumn(this.dsList.rowposition, "PRODUCT_CODE")
			,pvContractNo	: this.dsContractSi.getColumn(this.dsContractSi.rowposition, "CONTRACT_NO")
			,pvContractName	: this.dsContractSi.getColumn(this.dsContractSi.rowposition, "CONTRACT_NAME")		
			,pvStartDate	: this.dsContractSi.getColumn(this.dsContractSi.rowposition, "START_DATE")
			,pvEndDate		: this.dsContractSi.getColumn(this.dsContractSi.rowposition, "END_DATE")
			,pvAreacode		: this.dsContractSi.getColumn(this.dsContractSi.rowposition, "AREA_CODE")
			,pvdsContractSi	: this.dsContractSi.saveXML()
			};
		
	this.commUtil.popup (this, "SP_RequestEmpList", "Sales::SP_RequestEmpList.xfdl", -1, -1, 1200, 300, true, true, false, sArgument, "fnPopupCallBack");
};


this.divDet_divDet2_divCS_btn_Labor_Require2_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	if (this.dsContractCS.rowcount == 0 ) {
		return;
	}
	
	var sKind = "";
	var sFormID = "Sales::SP_RequestEmpList.xfdl";
	var nContCSRow = this.dsContractCS.rowposition;
	var sRoleCd = this.dsContractCS.getColumn(nContCSRow, "ROLE_CODE");
	if (sRoleCd == "016") {
		sKind = "Edu";
	} else {
		sKind = "Tech";	
	}
	
	var sArgument = {
			 pvKind			: sKind
			,pvFormType		: "TR"
			,pvProjectCode	: this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE")
			,pvProjectName	: this.dsList.getColumn(this.dsList.rowposition, "PROJECT_NAME")
			,pvClientCode	: this.dsList.getColumn(this.dsList.rowposition, "CLIENT_CODE")
			,pvClientName	: this.dsList.getColumn(this.dsList.rowposition, "CLIENT_NAME")
			,pvProductCode	: this.dsList.getColumn(this.dsList.rowposition, "PRODUCT_CODE")
			,pvContractNo	: this.dsContractCS.getColumn(nContCSRow, "CONTRACT_NO")
			,pvContractName	: this.dsContractCS.getColumn(nContCSRow, "CONTRACT_NAME")		
			,pvStartDate	: this.dsContractCS.getColumn(nContCSRow, "START_DATE")
			,pvEndDate		: this.dsContractCS.getColumn(nContCSRow, "END_DATE")
			,pvAreacode		: this.dsContractCS.getColumn(nContCSRow, "AREA_CODE")
			,pvRoleCode		: this.dsContractCS.getColumn(nContCSRow, "ROLE_CODE")
			};
			
	this.commUtil.popup (this, "SP_RequestEmpList", "Sales::SP_RequestEmpList.xfdl", -1, -1, 1200, 300, true, true, false, sArgument, "fnPopupCallBack");
};

// 매입 매출 연결 팝업
this.divDet_divDet2_divPur_btn_ContractLink_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	if (this.dsPurchaseList.rowcount == 0 ) {
		return;
	}
	
	var prjtCd = this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE");
	if(this.gfnIsNull(prjtCd)) {
		this.gfnAlert('msg.er.nono',['프로젝트번호','저장']);
		return;
	}
	
	var sArgument = {
			 pvProjectCode	: prjtCd
			,pvBusinessType	: this.dsList.getColumn(this.dsList.rowposition, "BUSINESS_TYPE")
			};
	sArgument.title = "매출연결";
	this.commUtil.popup (this, "SS_ContractLink", "sales::sales/SS_ContractLinkPopup.xfdl", -1, -1, -1, -1, true, true, false, sArgument, "fnPopupCallBack");
};

this.fnSelectNewProject = function(sInsertType)
{
	//var sInsertType = this.div_InConfirm.form.rd_kind.value;
	//this.div_InConfirm.set_visible(false);
	if (sInsertType == "01") {	// 신규 프로젝트 생성
		this.dsList.set_enableevent(false);
		var nAddRow = this.dsList.insertRow(0);// addRow();
		this.dsList.setColumn(nAddRow, "PROJECT_CONTRACT_STATUS", 	"0");
		this.dsList.setColumn(nAddRow, "CONTRACT_STATUS", 	"0");
		this.dsList.setColumn(nAddRow, "SALES_STATUS",		"001");	// 프로젝트인지
		this.dsList.setColumn(nAddRow, "BUSINESS_TYPE",		this.ds_cmm_BusinessType.getColumn(0, "CODE"));
		this.dsList.setColumn(nAddRow, "PIPELINE_FLAG",		"0");
		this.dsList.setColumn(nAddRow, "LINK_CONFIRM_FLAG",	"0");
		
		var sEmpNo = this.gfnGetUserInfo("EMP_NO");
		
		this.dsList.setColumn(nAddRow, "SALES_EMP_NO",		sEmpNo);
		this.dsList.setColumn(nAddRow, "SALES_EMP_NAME",	this.gfnGetUserInfo(0, "USER_NAME"));
		this.dsList.setColumn(nAddRow, "SALES_DEPT_CD",		this.gfnGetUserInfo(0, "DEPT_CD"));
		this.dsList.setColumn(nAddRow, "SALES_DEPT_NAME",	this.gfnGetUserInfo(0, "DEPT_NM"));
		this.dsList.setColumn(nAddRow, "SALES_CO_CD",		this.gfnGetUserInfo(0, "COMPANY_CD"));
		this.dsList.setColumn(nAddRow, "SAVE_TYPE",			"N");
		this.dsList.setColumn(nAddRow, "CONTRACT_SEQ",		"1");
		
		this.dsContractProd.clearData();
		this.dsContractGoods.clearData();
		this.dsContractSi.clearData();
		this.dsContractCS.clearData();
		this.dsPurchaseList.clearData();
		this.dsScheduleList.clearData();
		this.dsAddressbookList.clearData();

		this.dsList.set_enableevent(true);
		this.fnAuthConfigSales();
		
		//연결프로젝트 초기화
		this.div_RelatedProject.set_enable(false);
		
		//계약추가 시 파일 초기화
		this.div_Attachment.set_url("");
		this.div_Attachment.SOURCE_SEQ = this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE");
		this.div_Attachment.set_url("sales::comm/COM_Attachment.xfdl");			
	} else {				// 계약추가
		var sArgument = {};
		sArgument.searchtype = "P"
		this.commUtil.popupProjectSearch(this, "popupProjectSearch", "fnPopupCallBack", sArgument);
		this.div_ClientName.set_enable(false);
		this.edt_ProjectName.set_readonly(true);
	}
	
	this.sInsertType = sInsertType;
};


// this.div_InConfirm_btn_Exit_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
// {
// 	this.div_InConfirm.set_visible(false);
// };

this.dsContractProd_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	var sCocd = this.gfnGetUserInfo("CO_CD");
	
	if (e.columnid == "PRODUCT_CODE") {
		
		var nRowType = obj.getRowType(e.row);
		if (nRowType == Dataset.ROWTYPE_INSERT && obj.rowcount>1) {
			// this.fn_setInsertStatus(obj, e.newvalue, obj);
		}
	} else if(e.columnid == "PRODUCT_NAME") {
	} else if(e.columnid == "CONTRACT_PRICE") {
	}
};


this.dsContractGoods_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	var sCocd = this.gfnGetUserInfo("CO_CD");
	
	if (e.columnid == "PRODUCT_CODE") {
		
		var nRowType = obj.getRowType(e.row);
		if (nRowType == Dataset.ROWTYPE_INSERT && obj.rowcount>1) {
			// this.fn_setInsertStatus(obj, e.newvalue);
		}
// 		if(sCocd == "J02") {
// 			this.fnCheckPurchase(obj, e.row, e.columnid, e.newvalue, e.oldvalue);
// 		}
	} else if(e.columnid == "PRODUCT_NAME") {
// 		if(sCocd == "J02") {
// 			this.fnCheckPurchase(obj, e.row, e.columnid, e.newvalue, e.oldvalue);
// 		}
	} else if(e.columnid == "CONTRACT_PRICE") {
//		var sProductCode = this.dsContractProd.getColumn(e.row, "PRODUCT_CODE");
// 		if(sCocd == "J02") {
// 			this.fnCheckPurchase(obj, e.row, e.columnid, e.newvalue, e.oldvalue);
// 		}
	}
};

this.fnCheckPurchase = function(objDs, curRow, colId, newValue, oldValue)
{
	var targetDs = this.dsPurchaseList;
	var findRow, findOldRow;
	
	objDs.set_enableevent(false);
	
	var sContractType = objDs.getColumn(curRow, "CONTRACT_TYPE");
	var sProductCode = objDs.getColumn(curRow, "PRODUCT_CODE");
	var sOldProductCode = objDs.getOrgColumn(curRow, "PRODUCT_CODE");
	var sProductName = objDs.getColumn(curRow, "PRODUCT_NAME");
	var sOldProductName = objDs.getOrgColumn(curRow, "PRODUCT_NAME");
	var sRoyaltyType = objDs.getColumn(curRow, "ROYALTY_TYPE");
	var sRelatedCompanyCode = objDs.getColumn(curRow, "RELATED_COMPANY_CODE");
	var sRelatedCompanyName = objDs.getColumn(curRow, "RELATED_COMPANY_NAME");
	var sContractPrice = objDs.getColumn(curRow, "CONTRACT_PRICE");
	var sNoPurchaseFlag = objDs.getColumn(curRow, "NO_PURCHASE_FLAG");
	
	if(sNoPurchaseFlag != "1") {
		if(colId == "PRODUCT_CODE") {
			sProductCode = newValue;
			sOldProductCode = oldValue;
		} 
		
		var cmmFindRow = this.ds_cmm_RoyaltyType.findRow("CODE", sRoyaltyType);
		var commissionRate = this.ds_cmm_RoyaltyType.getColumn(cmmFindRow, "VAL1");
		
		var nAddRow, targetRow;
		if(colId == "PRODUCT_CODE") {
			if(sProductCode == sOldProductCode) {
				findRow = targetDs.findRow("PRODUCT_CODE", sProductCode);
				
				if(findRow == -1) {
					targetRow = targetDs.addRow();
				} else {
					targetRow = findRow;
				}
				targetDs.setColumn(targetRow, "PROJECT_CODE",		this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE"));
				targetDs.setColumn(targetRow, "CONTRACT_NAME",	this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_NAME"));
				targetDs.setColumn(targetRow, "CONTRACT_DATE",	this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_DATE"));
				targetDs.setColumn(targetRow, "CONTRACT_TYPE",	sContractType);
				targetDs.setColumn(targetRow, "PRODUCT_CODE",		sProductCode);
				targetDs.setColumn(targetRow, "PRODUCT_NAME",		sProductName);
				targetDs.setColumn(targetRow, "ROYALTY_TYPE",		sRoyaltyType);
				targetDs.setColumn(targetRow, "COMMISSION_RATE",	commissionRate);
				targetDs.setColumn(targetRow, "CONTRACT_MAIN",	sRelatedCompanyCode);
				targetDs.setColumn(targetRow, "CONTRACT_MAIN_NAME",	sRelatedCompanyName);
				targetDs.setColumn(targetRow, "CONTRACT_PRICE",	sContractPrice * commissionRate / 100);
				targetDs.setColumn(targetRow, "PURCHASE_CONTRACT_STATUS",	"0");	
				
			} else {
				findRow = targetDs.findRow("PRODUCT_CODE", sProductCode);
				findOldRow = targetDs.findRow("PRODUCT_CODE", sOldProductCode);
				
				if(findOldRow == -1 && findOldRow == -1) {
					targetRow = targetDs.addRow();
				} else if(findOldRow > -1) {
					//targetDs.deleteRow(findOldRow);
					
					for(var i = targetDs.rowcount; i >= 0; i--) {
						var sProductCodeTmp = targetDs.getColumn(i, "PRODUCT_CODE");
						if(sProductCodeTmp == sOldProductCode) targetDs.deleteRow(i);
					}
					
					if(findRow == -1) {
						targetRow = targetDs.addRow();
					} 
				} 
				targetDs.setColumn(targetRow, "PROJECT_CODE",	this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE"));
				targetDs.setColumn(targetRow, "CONTRACT_NAME",	this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_NAME"));
				targetDs.setColumn(targetRow, "CONTRACT_DATE",	this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_DATE"));
				targetDs.setColumn(targetRow, "CONTRACT_TYPE",	sContractType);
				targetDs.setColumn(targetRow, "PRODUCT_CODE",		sProductCode);
				targetDs.setColumn(targetRow, "PRODUCT_NAME",		sProductName);
				targetDs.setColumn(targetRow, "ROYALTY_TYPE",		sRoyaltyType);
				targetDs.setColumn(targetRow, "COMMISSION_RATE",	commissionRate);
				targetDs.setColumn(targetRow, "CONTRACT_MAIN",	sRelatedCompanyCode);
				targetDs.setColumn(targetRow, "CONTRACT_MAIN_NAME",	sRelatedCompanyName);
				targetDs.setColumn(targetRow, "CONTRACT_PRICE",	sContractPrice * commissionRate / 100);
				targetDs.setColumn(targetRow, "PURCHASE_CONTRACT_STATUS",	"0");	
			}
		} else if(colId == "CONTRACT_PRICE") {
			findRow = targetDs.findRow("PRODUCT_CODE", sProductCode);
			targetRow = findRow;
			
			targetDs.setColumn(targetRow, "PROJECT_CODE",		this.dsList.getColumn(this.dsList.rowposition, "PROJECT_CODE"));
			targetDs.setColumn(targetRow, "CONTRACT_NAME",	this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_NAME"));
			targetDs.setColumn(targetRow, "CONTRACT_DATE",	this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_DATE"));
			targetDs.setColumn(targetRow, "CONTRACT_TYPE",	sContractType);
			targetDs.setColumn(targetRow, "PRODUCT_CODE",		sProductCode);
			targetDs.setColumn(targetRow, "PRODUCT_NAME",		sProductName);
			targetDs.setColumn(targetRow, "ROYALTY_TYPE",		sRoyaltyType);
			targetDs.setColumn(targetRow, "COMMISSION_RATE",	commissionRate);
			targetDs.setColumn(targetRow, "CONTRACT_MAIN",	sRelatedCompanyCode);
			targetDs.setColumn(targetRow, "CONTRACT_MAIN_NAME",	sRelatedCompanyName);
			targetDs.setColumn(targetRow, "CONTRACT_PRICE",	sContractPrice * commissionRate / 100);
			targetDs.setColumn(targetRow, "PURCHASE_CONTRACT_STATUS",	"0");	
		}
		
		
	}
	
	objDs.set_enableevent(true);
};

this.fnDelPurchase = function(objDs, curRow)
{
	var sProductCode = objDs.getColumn(curRow, "PRODUCT_CODE");
	var targetDs = this.dsPurchaseList;
	
	for(var i = targetDs.rowcount; i >= 0; i--) {
		var delProductCode = targetDs.getColumn(i, "PRODUCT_CODE");
		if(sProductCode == delProductCode) targetDs.deleteRow(i);
	}
	
	//var findRow = this.dsPurchaseList.findRow("PRODUCT_CODE", sProductCode);
	
	//if(findRow > -1) this.dsPurchaseList.deleteRow(findRow);
};




this.fn_setInsertStatus = function(obj)
{
	if (obj.rowcount<=0) return;		// 입력데이터 없으면 리턴
	
	this.dsTmpProdInfo.clearData();
	for (var i=0; i<obj.rowcount; i++) {
		var prod_cd = obj.getColumn(i, "PRODUCT_CODE");				// 제품코드
		var main_prod_cd = prod_cd.substring(0, prod_cd.length-2);		
		var nFindRow = this.dsTmpProdInfo.findRow("MAIN_PRODUCT_CODE", main_prod_cd);
		if (nFindRow<0) {
			var nAddRow = this.dsTmpProdInfo.addRow();
			this.dsTmpProdInfo.setColumn(nAddRow, "PRODUCT_CODE", prod_cd);
			this.dsTmpProdInfo.setColumn(nAddRow, "MAIN_PRODUCT_CODE", main_prod_cd);
			this.dsTmpProdInfo.setColumn(nAddRow, "ROW_IDX", i);
		}
	}
	
	for (var i=0; i<this.dsTmpProdInfo.rowcount; i++)
	{
		var sMainProdCd = this.dsTmpProdInfo.getColumn(i, "MAIN_PRODUCT_CODE");
		var nRowIdx = this.dsTmpProdInfo.getColumn(i, "ROW_IDX");
		
		var sContractNo = obj.getColumn(nRowIdx, "CONTRACT_NO");
		
		for (var j=0; j<obj.rowcount; j++)
		{
			var sTarProdCd = obj.getColumn(j, "PRODUCT_CODE");
			var sTarMainProdCd = sTarProdCd.substring(0, sTarProdCd.length-2);
			
			if (sMainProdCd == sTarMainProdCd && obj.getRowType(j) != Dataset.ROWTYPE_NORMAL)
			{
				if (nRowIdx == j) {
					obj.setColumn(j, "INSERT_STATUS", "I");
					obj.setColumn(j, "CONTRACT_NO", "");
				} else {
// 					if (this.dsTmpProdInfo.getRowType(i) == 2) {		//	ROWTYPE_INSERT
// 						
// 						if (!this.gfnIsEmpty(sContractNo)) {
// 							obj.setColumn(j, "CONTRACT_NO", sContractNo);
// 						}
// 						
// 						obj.setColumn(j, "INSERT_STATUS", "A");
// 					} else  {											//	ROWTYPE_UPDATE
// 						obj.setColumn(j, "INSERT_STATUS", "N");
// 					} 
				}
			
			}
		}
	}
}


this.dsContractSi_onload = function(obj:nexacro.NormalDataset,e:nexacro.DSLoadEventInfo)
{
	var bEnable = false;
	if (obj.rowcount >  0 ) {
		bEnable = true;
	}
	this.divDet.form.divDet2.form.divSi.form.btn_Labor_Require.set_enable(bEnable);
};


this.dsContractCS_onload = function(obj:nexacro.NormalDataset,e:nexacro.DSLoadEventInfo)
{
	var bEnable = false;
	if (obj.rowcount >  0 ) {
		bEnable = true;
	}
	this.divDet.form.divDet2.form.divCS.form.btn_Labor_Require2.set_enable(bEnable);
};


this.dsContractSi_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	var sObjDsId = obj.name;
	this.sObjDs = obj;
	
	if (e.columnid == "START_DATE" || e.columnid == "END_DATE") {
		var strStartDt = obj.getColumn(e.row, "START_DATE");
		var strEndDt = obj.getColumn(e.row, "END_DATE");
		
		// 시작일, 종료일 변경시 M/M계산 조회
		this.fnGetMM(strStartDt, strEndDt, e.row);
	}
	if (e.columnid == "UNIT_COST" || e.columnid == "MEN_MONTH") {
		var nUnitCost = obj.getColumn(e.row, "UNIT_COST");
		var nMenMonth = obj.getColumn(e.row, "MEN_MONTH");
		var nContractPrice = nUnitCost*nMenMonth;
		obj.setColumn(e.row, "CONTRACT_PRICE", nContractPrice)
	}
	if (sObjDsId == "dsContractCS") {
		
		if (e.columnid == "EXECUTION_TYPE") {
			var sTechSupprotUnit = obj.getColumn(e.row, "TECH_SUPPORT_UNIT");
			if (this.gfnIsEmpty(sTechSupprotUnit)) {
				obj.set_enableevent(false);
				if (e.newvalue == "001") {
					obj.setColumn(e.row, "TECH_SUPPORT_UNIT", "1");
				} else if (e.newvalue == "002") {
					obj.setColumn(e.row, "TECH_SUPPORT_UNIT", "3");
				} else if (e.newvalue == "003") {
					obj.setColumn(e.row, "TECH_SUPPORT_UNIT", "4");
				} 
				obj.set_enableevent(true);
			}
		}
	}
	if (e.columnid == "EXECUTION_TYPE") {
		var sTechSupprotUnit = obj.getColumn(e.row, "TECH_SUPPORT_UNIT");
		if (this.gfnIsEmpty(sTechSupprotUnit)) {
			obj.set_enableevent(false);
			if (e.newvalue == "001") {
				obj.setColumn(e.row, "TECH_SUPPORT_UNIT", "1");
			} else if (e.newvalue == "002") {
				obj.setColumn(e.row, "TECH_SUPPORT_UNIT", "3");
			} else if (e.newvalue == "003") {
				obj.setColumn(e.row, "TECH_SUPPORT_UNIT", "4");
			} 
			obj.set_enableevent(true);
		}
	}
};

this.fn_SendMail = function(sKind)
{
	var nCurrow = this.dsList.rowposition;
	var sProjectCd = this.dsList.getColumn(nCurrow, "PROJECT_CODE");
	var sSalesEmpNm = this.dsList.getColumn(nCurrow, "SALES_EMP_NAME");
	var sSalesEmpNo = this.dsList.getColumn(nCurrow, "SALES_EMP_NO");
	var sSalesEmpEmail = this.dsList.getColumn(nCurrow, "SALES_EMP_EMAIL");	
	var sContractMain = this.dsList.getColumn(nCurrow, "CONTRACT_MAIN");
	var sContractMainNm = this.dsList.getColumn(nCurrow, "CONTRACT_MAIN_NAME");
	var sSubject = "("+sContractMainNm+")"+this.gfnGetTransTxt(22732,"여신평가 요청의 건");
	
	if (this.gfnIsEmpty(sSalesEmpEmail)) {
		alert(this.gfnGetTransTxt(1506,"담당영업의 Email 주소를 확인후 입력해 주세요"));
		return;
	}
	
	if (this.gfnIsEmpty(sSalesEmpNo)) {
		alert(this.gfnGetTransTxt(1507,"담당영업을 입력해 주세요"));
		return;
	}
	
	this.gfnAddSendParameter("PROJECT_CODE",	sProjectCd);
	this.gfnAddSendParameter("SALES_EMP_NO",	sSalesEmpNo);
	this.gfnAddSendParameter("CONTRACT_MAIN",	sContractMain);
	this.gfnAddSendParameter("TO_ADDRESS",		"tax@tobesoft.com");
	this.gfnAddSendParameter("TO_NAME",			"tax@tobesoft.com");
	this.gfnAddSendParameter("FROM_ADDRESS",	sSalesEmpEmail);
	this.gfnAddSendParameter("FROM_NAME",		sSalesEmpNm);
	this.gfnAddSendParameter("SUBJECT",			sSubject);
	this.gfnAddSendParameter("CONTENTS",		this.fn_getMailContents());
	this.gfnCommonTransaction("SendMail", 		"SS_PresalesSendMail_R01");
}

this.fn_getMailContents = function()
{
	var nCurrow = this.dsList.rowposition;
	var sContractMain = this.dsList.getColumn(nCurrow, "CONTRACT_MAIN");
	var sContractMainNm = this.dsList.getColumn(nCurrow, "CONTRACT_MAIN_NAME");
	var sClientNm = this.dsList.getColumn(nCurrow, "CLIENT_NAME");
	var sProjectNm = this.dsList.getColumn(nCurrow, "PROJECT_NAME");
	var sSalesEmpNm = this.dsList.getColumn(nCurrow, "SALES_EMP_NAME");
	
	var contents =
	'<table width="700" border="0" cellspacing="0" cellpadding="0" style="table-layout">'+
		'<tbody>'+
			'<tr>'+
				'<td width="800" height="100" align="left" valign="top" bgcolor="#FFFFFF">'+
				'<table width="800" height="100" border="0" cellpadding="0" cellspacing="0">'+
					'<tbody>'+
						'<tr>'+
							'<td align="left" valign="top"><font size="2" face="돋움">'+
							'<p></p>'+
							'<p>여신한도평가 요청건이 도착하였습니다.<br /><br />'+
							'<br />'+
							'</font>'+
							
							'<table border="0" width="800">'+
								'<tbody>'+
									'<tr>'+
										'<td width="130"><span style="font-size:10.0pt;font-family:돋움">ㆍ계약처</span></td>'+
										'<td width="10"><span style="font-size:10.0pt;font-family:돋움"> : </span></td>'+
										'<td><span style="font-size:10.0pt;font-family:돋움"> '+sContractMainNm+' </span></td>'+
									'</tr>'+
									'<tr>'+
										'<td width="130"><span style="font-size:10.0pt;font-family:돋움">ㆍ고객사/프로젝트</span></td>'+
										'<td width="10"><span style="font-size:10.0pt;font-family:돋움"> : </span></td>'+
										'<td><span style="font-size:10.0pt;font-family:돋움"> '+sClientNm+' / '+sProjectNm+' </span></td>'+
									'</tr>'+
									'<tr>'+
										'<td width="130"><span style="font-size:10.0pt;font-family:돋움">ㆍ요청자</span></td>'+
										'<td width="10"><span style="font-size:10.0pt;font-family:돋움"> : </span></td>'+
										'<td><span style="font-size:10.0pt;font-family:돋움"> '+sSalesEmpNm+' </span></td>'+
									'</tr>'+
								'</tbody>'+
							'</table>'+
							'</td>'+
						'</tr>'+
						'<table border="0" width="800"><tbody>'+
							'<tr>'+
								'<td><span style="font-size:10.0pt;font-family:돋움"><br /><br />[화면연결]</span></td>'+
							'</tr>'+
							'<tr>'+
								'<td><span style="font-size:10.0pt;font-family:돋움">'+
									'<a href="' + nexacro.getEnvironment().services["ServiceURL"].url + 'index.jsp?FRM_SEQ=254&CONTRACT_MAIN='+sContractMain+'" style="font-size:10.0pt;font-family:돋움">'+ nexacro.getEnvironment().services["ServiceURL"].url + 'index.jsp?FRM_SEQ=254&CONTRACT_MAIN='+sContractMain + '</a>'+
								'</span></td>'+
							'</tr>'+
						'</tbody></table>'+
					'</tbody>'+
				'</table>'+
				'</td>'+
			'</tr>'+
		'</tbody>'+
	'</table>';
	
	return contents;
}

this.tab_Progess_tpg_PersonInCharge_grd_PersonInCharge_oncelldblclick = function(obj:nexacro.Grid,e:nexacro.GridClickEventInfo)
{
	var sArgument = {COMPANY_CODE : this.dsAddressbookList.getColumn(e.row, "COMPANY_CODE"), TAB_INDEX:3, MODE:"E"};
	this.commUtil.popup(this, "CompanyReg", "Sales::SC_CompanyReg.xfdl", -1, -1, null, null, true, true, false, sArgument, "fnPopupCallBack");
};


this.fn_getNexaNCheck = function(objDs)
{
	var bRtnVal = false;
	if (objDs.rowcount > 0) {
		
		for (var i=0; i<objDs.rowcount; i++) {
			var sProductCd = objDs.getColumn(i, "PRODUCT_CODE");
			if(!this.gfnIsEmpty(sProductCd))
			{
				if (sProductCd.substr(0, 3) == "P06") {
					bRtnVal = true;
					break;
				}
			}
		}
	}
	return bRtnVal;
}

this.divDet_divDet1_divProd_btn_ContractUnion_onclick = function(obj:nexacro.Button,e:nexacro.ClickEventInfo)
{
	if (this.dsContractProd.rowcount > 0)
	{
		var ctrtNo = this.dsContractProd.getColumn(this.dsContractProd.rowposition, "CONTRACT_NO");
		if(this.gfnIsNull(ctrtNo)) {
			this.gfnAlert('msg.er.nono',['계약번호','저장']);
			return;
		}
	
		var prjtCd = this.dsContractProd.getColumn(this.dsContractProd.rowposition, "PROJECT_CODE");
		if(this.gfnIsNull(prjtCd)) {
			this.gfnAlert('msg.er.nono',['프로젝트번호','저장']);
			return;
		}
		
		var sArgument = {pvContractNo : this.dsContractProd.getColumn(this.dsContractProd.rowposition, "CONTRACT_NO"), pvProjectCd : this.dsContractProd.getColumn(this.dsContractProd.rowposition, "PROJECT_CODE")};
		this.commUtil.popup(this, "ContractLicenseUnionReg", "Sales::SS_ContractLicenseUnionPopup.xfdl", -1, -1, null, null, true, true, false, sArgument, "fnPopupCallBack");
	}
};

this.dsContractProd_onrowposchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSRowPosChangeEventInfo)
{
	if(this.dsContractProd.rowcount > 0) {
		var bNexaNFlag = this.fn_getNexaNCheck(this.dsContractProd);
		if (bNexaNFlag) {
			this.divDet.form.divDet1.form.divProd.form.btn_ContractUnion.set_enable(true);
		} else {
			this.divDet.form.divDet1.form.divProd.form.btn_ContractUnion.set_enable(false);
		}
	} else {
		this.divDet.form.divDet1.form.divProd.form.btn_ContractUnion.set_enable(false);
	}
};

this.cmb_SalesProduct_onitemchanged = function(obj:nexacro.Combo,e:nexacro.ItemChangeEventInfo)
{
	var sProdCD = this.ds_cmm_Product.getColumn(e.postindex, "PRODUCT_CODE");
	var nRow = this.ds_cmm_BusinessType.findRow("VAL1", sProdCD);
	this.cmb_BusinessType.set_index(nRow<0?0:nRow);
};

this.dsPurchaseList_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	var sCocd = nexacro.getApplication().gdsUserInfo.getColumn(0, "CO_CD");
	
	if(sCocd == "J02") {
		if(e.columnid == "COMMISSION_RATE") {
			var sProductCode = this.dsPurchaseList.getColumn(e.row, "PRODUCT_CODE");
			var sContractPrice = this.fnGetContractPrice(sProductCode);
			
			if(!this.gfnIsEmpty(sContractPrice)) {
				obj.setColumn(e.row, "CONTRACT_PRICE", sContractPrice * e.newvalue / 100);
			}
		} else if(e.columnid == "CONTRACT_PRICE") {
			var sProductCode = this.dsPurchaseList.getColumn(e.row, "PRODUCT_CODE");
			var sContractPrice = this.fnGetContractPrice(sProductCode);
			
			if(!this.gfnIsEmpty(sContractPrice)) {
				obj.setColumn(e.row, "COMMISSION_RATE", e.newvalue * 100 / sContractPrice);
			}
		}
	}
};

this.fnGetContractPrice = function(sProductCode)
{
	var findRow = this.dsContractProd.findRow("PRODUCT_CODE", sProductCode);
	if(findRow > -1) return this.dsContractProd.getColumn(findRow, "CONTRACT_PRICE");
	else findRow = this.dsContractGoods.findRow("PRODUCT_CODE", sProductCode);
	
	if(findRow > -1) return this.dsContractGoods.getColumn(findRow, "CONTRACT_PRICE");
};

this.cal_ContractDate_onchanged = function(obj:nexacro.Calendar,e:nexacro.ChangeEventInfo)
{
	var sContractDate = e.postvalue;
	var sPurchaseCnt = this.dsPurchaseList.rowcount;
	
	if(!this.gfnIsEmpty(sContractDate)) {
		if(sPurchaseCnt > 0) {
			for(var i = 0; i < sPurchaseCnt; i++) {
				this.dsPurchaseList.setColumn(i, "CONTRACT_DATE", sContractDate);
			}
		}
	}
};

this.edt_ContractName_onchanged = function(obj:nexacro.Edit,e:nexacro.ChangeEventInfo)
{
	var sContractName = e.postvalue;
	var sPurchaseCnt = this.dsPurchaseList.rowcount;
	
	if(!this.gfnIsEmpty(sContractName)) {
		if(sPurchaseCnt > 0) {
			for(var i = 0; i < sPurchaseCnt; i++) {
				this.dsPurchaseList.setColumn(i, "CONTRACT_NAME", sContractName);
			}
		}
	}
};

this.fnSelectCustomer = function(comp, e) {
	if(this.gfnIsNull(this.dsList.getColumn(this.dsList.rowposition, "CONTRACT_MAIN"))) {
		this.dsList.setColumn(this.dsList.rowposition, "CONTRACT_MAIN", e.newCode);
		this.dsList.setColumn(this.dsList.rowposition, "CONTRACT_MAIN_NAME", e.newName);
	}
};


this.dsList_oncolumnchanged = function(obj:nexacro.NormalDataset,e:nexacro.DSColChangeEventInfo)
{
	if(e.columnid == "PROJECT_NAME") {
		if(this.gfnIsNull(this.dsList.getColumn(e.row, "CONTRACT_NAME"))) {
			this.dsList.setColumn(e.row, "CONTRACT_NAME", e.newvalue);
		}	
	}
};
]]></Script>
    <Objects>
      <Dataset id="ds_cond_SalesStatus">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cond_sales_emp">
        <ColumnInfo>
          <Column id="EMP_NO" type="string" size="60"/>
          <Column id="EMP_NAME" type="string" size="262"/>
          <Column id="CO_CD" type="string" size="60"/>
          <Column id="DEPT_CD" type="string" size="60"/>
          <Column id="DEPT_NAME" type="string" size="100"/>
          <Column id="BUSINESS_TYPE" type="string" size="20"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_ContractStatus">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_SalesStatus">
        <ColumnInfo>
          <Column id="CODE" size="256" type="STRING"/>
          <Column id="DATA" size="256" type="STRING"/>
          <Column id="DATA_JAP" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="DATA">영업실패 제외</Col>
            <Col id="CODE">0</Col>
            <Col id="DATA_JAP">営業失敗除外</Col>
          </Row>
          <Row>
            <Col id="DATA">장기홀딩 제외</Col>
            <Col id="CODE">1</Col>
            <Col id="DATA_JAP">長期ホールディング除外</Col>
          </Row>
          <Row>
            <Col id="DATA">영실/장홀 제외</Col>
            <Col id="CODE">2</Col>
            <Col id="DATA_JAP">営業失敗/長期ホールディング除外</Col>
          </Row>
          <Row>
            <Col id="DATA">삭제상태 보기</Col>
            <Col id="CODE">3</Col>
            <Col id="DATA_JAP">削除状態を見る</Col>
          </Row>
          <Row>
            <Col id="DATA">모두보기</Col>
            <Col id="CODE">4</Col>
            <Col id="DATA_JAP">全て見る</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_EmpKind">
        <ColumnInfo>
          <Column id="CODE" size="256" type="STRING"/>
          <Column id="DATA" size="256" type="STRING"/>
          <Column id="DATA_JAP" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="DATA">영업대표</Col>
            <Col id="CODE">E</Col>
            <Col id="DATA_JAP">営業代表</Col>
          </Row>
          <Row>
            <Col id="DATA">팀</Col>
            <Col id="CODE">D</Col>
            <Col id="DATA_JAP">チーム</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_ContractType">
        <ColumnInfo>
          <Column id="CODE" size="256" type="STRING"/>
          <Column id="DATA" size="256" type="STRING"/>
          <Column id="DATA_JAP" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="DATA">전체</Col>
            <Col id="DATA_JAP">全体</Col>
          </Row>
          <Row>
            <Col id="DATA">유지보수 제외</Col>
            <Col id="CODE">M</Col>
            <Col id="DATA_JAP">保守除外</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_cmm_SalesStatus">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_ContractStatus00">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_Type">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_Importance">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_Role">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_Level">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_Area">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_SalesEmp">
        <ColumnInfo>
          <Column id="EMP_NO" type="string" size="60"/>
          <Column id="EMP_NAME" type="string" size="262"/>
          <Column id="CO_CD" type="string" size="60"/>
          <Column id="DEPT_CD" type="string" size="60"/>
          <Column id="DEPT_NAME" type="string" size="100"/>
          <Column id="BUSINESS_TYPE" type="string" size="20"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_CaGrade">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_CaRole">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_HoldOffice">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="30"/>
          <Column id="CAPTION" type="STRING" size="255"/>
          <Column id="VAL1" type="STRING" size="100"/>
          <Column id="VAL2" type="STRING" size="100"/>
          <Column id="VAL3" type="STRING" size="100"/>
          <Column id="VAL4" type="STRING" size="100"/>
          <Column id="REMARK" type="STRING" size="1073741823"/>
          <Column id="ORD" type="STRING" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_BusinessType">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="30"/>
          <Column id="CAPTION" type="STRING" size="255"/>
          <Column id="VAL1" type="STRING" size="100"/>
          <Column id="VAL2" type="STRING" size="100"/>
          <Column id="VAL3" type="STRING" size="100"/>
          <Column id="VAL4" type="STRING" size="100"/>
          <Column id="REMARK" type="STRING" size="1073741823"/>
          <Column id="ORD" type="STRING" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsList" onrowposchanged="dsList_onrowposchanged" oncolumnchanged="dsList_oncolumnchanged">
        <ColumnInfo>
          <Column id="PROJECT_CODE" type="string" size="15"/>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="PROJECT_NAME" type="string" size="100"/>
          <Column id="CONTRACT_NAME" type="string" size="100"/>
          <Column id="CLIENT_CODE" type="string" size="20"/>
          <Column id="CLIENT_NAME" type="string" size="100"/>
          <Column id="CONTRACT_MAIN" type="string" size="20"/>
          <Column id="CONTRACT_MAIN_NAME" type="string" size="100"/>
          <Column id="CONTRACT_DATE" type="string" size="8"/>
          <Column id="PRODUCT_CODE" type="string" size="20"/>
          <Column id="PRODUCT_NAME" type="string" size="100"/>
          <Column id="PRODUCT_NAME_SHORT" type="STRING" size="100"/>
          <Column id="SALES_STATUS" type="string" size="20"/>
          <Column id="RELATED_PROJECT_CODE" type="string" size="15"/>
          <Column id="RELATED_PROJECT_NAME" type="STRING" size="256"/>
          <Column id="PROJECT_CONTRACT_STATUS" type="string" size="20"/>
          <Column id="CONTRACT_STATUS" type="string" size="20"/>
          <Column id="INCENTIVE_EMP_NO" type="string" size="60"/>
          <Column id="SALES_EMP_NO" type="string" size="60"/>
          <Column id="SALES_EMP_NAME" type="string" size="255"/>
          <Column id="SALES_EMP_EMAIL" type="STRING" size="256"/>
          <Column id="SALES_DEPT_CD" type="string" size="60"/>
          <Column id="SALES_DEPT_NAME" type="string" size="100"/>
          <Column id="SALES_CO_CD" type="STRING" size="256"/>
          <Column id="DEPT_CD" type="string" size="60"/>
          <Column id="PIPELINE_FLAG" type="string" size="1"/>
          <Column id="REMARKS" type="string" size="1073741823"/>
          <Column id="CONTRACT_AMT" type="BIGDECIMAL" size="22"/>
          <Column id="BLACKLIST_FLAG" type="string" size="1"/>
          <Column id="BUSINESS_TYPE" type="string" size="20"/>
          <Column id="SAVE_TYPE" type="string" size="1"/>
          <Column id="CONTRACT_SEQ" type="STRING" size="256"/>
          <Column id="LINK_CONFIRM_FLAG" type="STRING" size="1"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsContractProd" oncolumnchanged="dsContractProd_oncolumnchanged" onrowposchanged="dsContractProd_onrowposchanged">
        <ColumnInfo>
          <Column id="PROJECT_CODE" type="string" size="15"/>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="CONTRACT_NAME" type="string" size="100"/>
          <Column id="CRD_SEQ" type="bigdecimal" size="20"/>
          <Column id="PRODUCT_CODE" type="string" size="20"/>
          <Column id="PRODUCT_NAME" type="string" size="100"/>
          <Column id="ROYALTY_TYPE" type="STRING" size="256"/>
          <Column id="NO_PURCHASE_FLAG" type="STRING" size="256"/>
          <Column id="RELATED_COMPANY_CODE" type="STRING" size="256"/>
          <Column id="RELATED_COMPANY_NAME" type="STRING" size="256"/>
          <Column id="CONTRACT_PRICE" type="bigdecimal" size="20"/>
          <Column id="QUANTITY" type="STRING" size="256"/>
          <Column id="CONTRACT_TYPE" type="string" size="20"/>
          <Column id="CONTRACT_MAIN_NAME" type="string" size="100"/>
          <Column id="BLACKLIST_FLAG" type="string" size="1"/>
          <Column id="CL_PS" type="bigdecimal" size="20"/>
          <Column id="CL_SI" type="bigdecimal" size="20"/>
          <Column id="P_UNRECV_PRICE" type="bigdecimal" size="40"/>
          <Column id="ETC_UNRECV_PRICE" type="bigdecimal" size="40"/>
          <Column id="SUM_UNRECV_PRICE" type="bigdecimal" size="40"/>
          <Column id="F_CHK_YEOSHIN" type="int" size="11"/>
          <Column id="PRODUCT_NAME_SHORT" type="string" size="100"/>
          <Column id="PRODUCT_VERSION" type="string" size="10"/>
          <Column id="INSERT_STATUS" type="string" size="255"/>
          <Column id="CONTRACT_SEQ" type="INT" size="11"/>
          <Column id="UNION_CNT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsContractSi" oncolumnchanged="dsContractSi_oncolumnchanged" onload="dsContractSi_onload">
        <ColumnInfo>
          <Column id="PROJECT_CODE" type="string" size="15"/>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="CONTRACT_NAME" type="string" size="100"/>
          <Column id="CSD_SEQ" type="bigdecimal" size="20"/>
          <Column id="ROLE_CODE" type="string" size="20"/>
          <Column id="LEVEL_CODE" type="string" size="20"/>
          <Column id="UNIT_COST" type="BIGDECIMAL" size="22"/>
          <Column id="START_DATE" type="string" size="8"/>
          <Column id="END_DATE" type="string" size="8"/>
          <Column id="MEN_MONTH" type="float" size="22"/>
          <Column id="CONTRACT_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="AREA_CODE" type="string" size="20"/>
          <Column id="REMARKS" type="string" size="1073741823"/>
          <Column id="CONTRACT_TYPE" type="string" size="20"/>
          <Column id="CONTRACT_MAIN_NAME" type="string" size="100"/>
          <Column id="BLACKLIST_FLAG" type="string" size="1"/>
          <Column id="CL_PS" type="float" size="22"/>
          <Column id="CL_SI" type="float" size="22"/>
          <Column id="P_UNRECV_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="ETC_UNRECV_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="SUM_UNRECV_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="F_CHK_YEOSHIN" type="int" size="11"/>
          <Column id="CONTRACT_SEQ" type="INT" size="11"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsContractCS" onload="dsContractCS_onload" oncolumnchanged="dsContractSi_oncolumnchanged">
        <ColumnInfo>
          <Column id="PROJECT_CODE" type="string" size="15"/>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="CONTRACT_NAME" type="string" size="100"/>
          <Column id="CSD_SEQ" type="bigdecimal" size="20"/>
          <Column id="ROLE_CODE" type="string" size="20"/>
          <Column id="LEVEL_CODE" type="string" size="20"/>
          <Column id="UNIT_COST" type="BIGDECIMAL" size="22"/>
          <Column id="START_DATE" type="string" size="8"/>
          <Column id="END_DATE" type="string" size="8"/>
          <Column id="MEN_MONTH" type="float" size="22"/>
          <Column id="CONTRACT_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="AREA_CODE" type="string" size="20"/>
          <Column id="REMARKS" type="string" size="1073741823"/>
          <Column id="CONTRACT_TYPE" type="string" size="20"/>
          <Column id="CONTRACT_MAIN_NAME" type="string" size="100"/>
          <Column id="BLACKLIST_FLAG" type="string" size="1"/>
          <Column id="CL_PS" type="float" size="22"/>
          <Column id="CL_SI" type="float" size="22"/>
          <Column id="EXECUTION_TYPE" type="string" size="20"/>
          <Column id="TECH_SUPPORT_UNIT" type="string" size="20"/>
          <Column id="P_UNRECV_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="ETC_UNRECV_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="SUM_UNRECV_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="F_CHK_YEOSHIN" type="int" size="11"/>
          <Column id="CONTRACT_SEQ" type="INT" size="11"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsContractGoods" oncolumnchanged="dsContractGoods_oncolumnchanged">
        <ColumnInfo>
          <Column id="PROJECT_CODE" type="string" size="15"/>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="CONTRACT_NAME" type="string" size="100"/>
          <Column id="CRD_SEQ" type="bigdecimal" size="20"/>
          <Column id="PRODUCT_CODE" type="string" size="20"/>
          <Column id="PRODUCT_NAME" type="string" size="100"/>
          <Column id="ROYALTY_TYPE" type="STRING" size="256"/>
          <Column id="NO_PURCHASE_FLAG" type="STRING" size="256"/>
          <Column id="RELATED_COMPANY_CODE" type="STRING" size="256"/>
          <Column id="RELATED_COMPANY_NAME" type="STRING" size="256"/>
          <Column id="CONTRACT_PRICE" type="bigdecimal" size="20"/>
          <Column id="CONTRACT_TYPE" type="string" size="20"/>
          <Column id="CONTRACT_MAIN_NAME" type="string" size="100"/>
          <Column id="BLACKLIST_FLAG" type="string" size="1"/>
          <Column id="CL_PS" type="bigdecimal" size="20"/>
          <Column id="CL_SI" type="bigdecimal" size="20"/>
          <Column id="P_UNRECV_PRICE" type="bigdecimal" size="20"/>
          <Column id="ETC_UNRECV_PRICE" type="bigdecimal" size="20"/>
          <Column id="SUM_UNRECV_PRICE" type="bigdecimal" size="20"/>
          <Column id="F_CHK_YEOSHIN" type="int" size="11"/>
          <Column id="INSERT_STATUS" type="string" size="255"/>
          <Column id="CONTRACT_SEQ" type="INT" size="11"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsPurchaseList" oncolumnchanged="dsPurchaseList_oncolumnchanged">
        <ColumnInfo>
          <Column id="PROJECT_CODE" type="string" size="15"/>
          <Column id="CONTRACT_NO_PURCHASE" type="string" size="10"/>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="CONTRACT_NAME" type="string" size="100"/>
          <Column id="CONTRACT_TYPE" type="string" size="20"/>
          <Column id="CONTRACT_DATE" type="string" size="8"/>
          <Column id="PURCHASE_CONTRACT_STATUS" type="string" size="20"/>
          <Column id="PPD_SEQ" type="bigdecimal" size="20"/>
          <Column id="PRODUCT_CODE" type="string" size="20"/>
          <Column id="PRODUCT_NAME" type="string" size="100"/>
          <Column id="ROYALTY_TYPE" type="STRING" size="256"/>
          <Column id="RELATED_PRODUCT_CODE" type="string" size="20"/>
          <Column id="RELATED_PRODUCT_NAME" type="string" size="100"/>
          <Column id="CONTRACT_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="VAT_PRICE" type="BIGDECIMAL" size="22"/>
          <Column id="CONTRACT_MAIN" type="string" size="20"/>
          <Column id="CONTRACT_MAIN_NAME" type="string" size="100"/>
          <Column id="COMMISSION_RATE" type="float" size="22"/>
          <Column id="UNIT_COST" type="BIGDECIMAL" size="22"/>
          <Column id="QUANTITY" type="int" size="11"/>
          <Column id="CRD_SEQ" type="BIGDECIMAL" size="20"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsScheduleList">
        <ColumnInfo>
          <Column id="PROJECT_CODE" type="string" size="15"/>
          <Column id="CONTRACT_NO" type="string" size="10"/>
          <Column id="TYPE_CODE" type="string" size="20"/>
          <Column id="ISSUE_DATE" type="string" size="8"/>
          <Column id="REPORT_FLAG" type="string" size="1"/>
          <Column id="IMPORTANCE" type="int" size="11"/>
          <Column id="OPEN_FLAG" type="string" size="1"/>
          <Column id="CONTENTS" type="string" size="1073741823"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsAddressbookList">
        <ColumnInfo>
          <Column id="PROJECT_CODE" type="string" size="15"/>
          <Column id="CA_SEQ" type="bigdecimal" size="20"/>
          <Column id="COMPANY_CODE" type="string" size="20"/>
          <Column id="COMPANY_NAME" type="STRING" size="256"/>
          <Column id="EMP_NAME" type="string" size="100"/>
          <Column id="DEPT_NAME" type="string" size="100"/>
          <Column id="GRADE_CODE" type="string" size="100"/>
          <Column id="ROLE_CODE" type="string" size="100"/>
          <Column id="H_PHONE_NO" type="string" size="30"/>
          <Column id="O_PHONE_NO" type="string" size="30"/>
          <Column id="HOLD_OFFICE" type="string" size="20"/>
          <Column id="EMAIL" type="string" size="200"/>
          <Column id="ETAX_FLAG" type="string" size="1"/>
          <Column id="ORDER_FLAG" type="string" size="1"/>
          <Column id="REMARKS" type="string" size="1073741823"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_Product">
        <ColumnInfo>
          <Column id="PRODUCT_CODE" type="string" size="20"/>
          <Column id="PRODUCT_CODE_LEVEL" type="int" size="11"/>
          <Column id="P_PRODUCT_CODE" type="string" size="255"/>
          <Column id="PRODUCT_NAME" type="string" size="100"/>
          <Column id="PRODUCT_NAME_SHORT" type="string" size="100"/>
          <Column id="MAIN_PRODUCT_FLAG" type="string" size="1"/>
          <Column id="UNIT_COST" type="float" size="22"/>
          <Column id="REMARKS" type="string" size="1073741823"/>
          <Column id="DELETE_FLAG" type="string" size="1"/>
          <Column id="ORD" type="string" size="10"/>
          <Column id="RELATED_COMPANY_CODE" type="string" size="20"/>
          <Column id="RELATED_COMPANY_NAME" type="string" size="100"/>
          <Column id="INSERT_DATE" type="string" size="8"/>
          <Column id="INSERT_EMP_NO" type="string" size="60"/>
          <Column id="INSERT_EMP_NM" type="string" size="255"/>
          <Column id="INSERT_DEPT_CD" type="string" size="60"/>
          <Column id="INSERT_DEPT_NM" type="string" size="100"/>
          <Column id="INSERT_MODEL" type="string" size="100"/>
          <Column id="UPDATE_DATE" type="datetime" size="23"/>
          <Column id="UPDATE_EMP_NO" type="string" size="60"/>
          <Column id="UPDATE_DEPT_CD" type="string" size="60"/>
          <Column id="UPDATE_DEPT_NM" type="string" size="100"/>
          <Column id="UPDATE_MODEL" type="string" size="100"/>
          <Column id="PTYPE" type="string" size="1"/>
          <Column id="SELECT_FLAG" type="string" size="1"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_MM"/>
      <Dataset id="ds_ParamLic">
        <ColumnInfo>
          <Column id="PRODUCT_CODE" type="STRING" size="256"/>
          <Column id="PRODUCT_NAME" type="STRING" size="256"/>
          <Column id="PRODUCT_VERSION" type="STRING" size="256"/>
          <Column id="PRODUCT_LIST" type="STRING" size="256"/>
          <Column id="PLATFORM_LIST" type="STRING" size="256"/>
          <Column id="FUNCTION_LIST" type="STRING" size="256"/>
          <Column id="ISDEV_FLAG" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_RequestStaff"/>
      <Dataset id="ds_cmm_ExecutionType">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="30"/>
          <Column id="CAPTION" type="STRING" size="255"/>
          <Column id="VAL1" type="STRING" size="100"/>
          <Column id="VAL2" type="STRING" size="100"/>
          <Column id="VAL3" type="STRING" size="100"/>
          <Column id="VAL4" type="STRING" size="100"/>
          <Column id="REMARK" type="STRING" size="1073741823"/>
          <Column id="ORD" type="STRING" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_TechSupportUnit">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="30"/>
          <Column id="CAPTION" type="STRING" size="255"/>
          <Column id="VAL1" type="STRING" size="100"/>
          <Column id="VAL2" type="STRING" size="100"/>
          <Column id="VAL3" type="STRING" size="100"/>
          <Column id="VAL4" type="STRING" size="100"/>
          <Column id="REMARK" type="STRING" size="1073741823"/>
          <Column id="ORD" type="STRING" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_Role2">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsContractSeq">
        <ColumnInfo>
          <Column id="CONTRACT_SEQ" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsFileCnt"/>
      <Dataset id="ds_ContractMainInfo">
        <ColumnInfo>
          <Column id="COMPANY_CODE" type="string" size="20"/>
          <Column id="COMPANY_NAME" type="string" size="100"/>
          <Column id="COMPANY_STATE" type="string" size="20"/>
          <Column id="COMPANY_STATE_NAME" type="string" size="255"/>
          <Column id="CL_APPROVAL_DATE" type="string" size="8"/>
          <Column id="CL_PS" type="bigdecimal" size="20"/>
          <Column id="CL_ASSET" type="bigdecimal" size="20"/>
          <Column id="CL_CAPITAL" type="bigdecimal" size="20"/>
          <Column id="CL_ANNUAL_SALES" type="bigdecimal" size="20"/>
          <Column id="REST" type="bigdecimal" size="20"/>
          <Column id="CL_EXCEPTION_CODE" type="string" size="20"/>
          <Column id="CL_EXCEPTION_NAME" type="string" size="255"/>
          <Column id="CLH_SEQ" type="bigdecimal" size="20"/>
          <Column id="YEAR" type="string" size="4"/>
          <Column id="EVALUATION_DATE" type="string" size="8"/>
          <Column id="MAX_YEAR" type="string" size="4"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_CostsheetInfo">
        <ColumnInfo>
          <Column id="CC_SEQ" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_Kind">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="256"/>
          <Column id="CAPTION" type="STRING" size="256"/>
          <Column id="CAPTION_JAP" type="STRING" size="256"/>
          <Column id="CAPTION_ENG" type="STRING" size="256"/>
        </ColumnInfo>
        <Rows>
          <Row>
            <Col id="CODE">01</Col>
            <Col id="CAPTION">신규 프로젝트</Col>
            <Col id="CAPTION_JAP">新規プロジェクト</Col>
          </Row>
          <Row>
            <Col id="CODE">02</Col>
            <Col id="CAPTION">추가 계약</Col>
            <Col id="CAPTION_JAP">追加契約</Col>
          </Row>
        </Rows>
      </Dataset>
      <Dataset id="ds_cmm_RoyaltyType">
        <ColumnInfo>
          <Column id="CODE" type="string" size="30"/>
          <Column id="CAPTION" type="string" size="255"/>
          <Column id="VAL1" type="string" size="100"/>
          <Column id="VAL2" type="string" size="100"/>
          <Column id="VAL3" type="string" size="100"/>
          <Column id="VAL4" type="string" size="100"/>
          <Column id="REMARK" type="string" size="1073741823"/>
          <Column id="ORD" type="string" size="10"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsTmpProdInfo">
        <ColumnInfo>
          <Column id="PRODUCT_CODE" type="STRING" size="256"/>
          <Column id="MAIN_PRODUCT_CODE" type="STRING" size="256"/>
          <Column id="ROW_IDX" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsEstimateContract">
        <ColumnInfo>
          <Column id="CONTRACT_NO" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="dsEstimateCnt">
        <ColumnInfo>
          <Column id="CNT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_checkProduct">
        <ColumnInfo>
          <Column id="PRODUCT_CODE" type="STRING" size="256"/>
          <Column id="CNT" type="STRING" size="256"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_ProductAll">
        <ColumnInfo>
          <Column id="PRODUCT_CODE" type="string" size="20"/>
          <Column id="PRODUCT_CODE_LEVEL" type="int" size="11"/>
          <Column id="P_PRODUCT_CODE" type="string" size="255"/>
          <Column id="PRODUCT_NAME" type="string" size="100"/>
          <Column id="PRODUCT_NAME_SHORT" type="string" size="100"/>
          <Column id="MAIN_PRODUCT_FLAG" type="string" size="1"/>
          <Column id="UNIT_COST" type="float" size="22"/>
          <Column id="REMARKS" type="string" size="1073741823"/>
          <Column id="DELETE_FLAG" type="string" size="1"/>
          <Column id="ORD" type="string" size="10"/>
          <Column id="RELATED_COMPANY_CODE" type="string" size="20"/>
          <Column id="RELATED_COMPANY_NAME" type="string" size="100"/>
          <Column id="INSERT_DATE" type="string" size="8"/>
          <Column id="INSERT_EMP_NO" type="string" size="60"/>
          <Column id="INSERT_EMP_NM" type="string" size="255"/>
          <Column id="INSERT_DEPT_CD" type="string" size="60"/>
          <Column id="INSERT_DEPT_NM" type="string" size="100"/>
          <Column id="INSERT_MODEL" type="string" size="100"/>
          <Column id="UPDATE_DATE" type="datetime" size="23"/>
          <Column id="UPDATE_EMP_NO" type="string" size="60"/>
          <Column id="UPDATE_DEPT_CD" type="string" size="60"/>
          <Column id="UPDATE_DEPT_NM" type="string" size="100"/>
          <Column id="UPDATE_MODEL" type="string" size="100"/>
          <Column id="PTYPE" type="string" size="1"/>
          <Column id="SELECT_FLAG" type="string" size="1"/>
        </ColumnInfo>
      </Dataset>
      <Dataset id="ds_cmm_PurchaseType">
        <ColumnInfo>
          <Column id="CODE" type="STRING" size="30"/>
          <Column id="CAPTION" type="STRING" size="255"/>
          <Column id="VAL1" type="STRING" size="100"/>
          <Column id="VAL2" type="STRING" size="100"/>
          <Column id="VAL3" type="STRING" size="100"/>
          <Column id="VAL4" type="STRING" size="100"/>
          <Column id="REMARK" type="STRING" size="1073741823"/>
          <Column id="ORD" type="STRING" size="10"/>
        </ColumnInfo>
      </Dataset>
    </Objects>
    <Bind>
      <BindItem id="item0" compid="stc_Sales_List.tpg_Progess.form.cmb_TypeCode" propid="value" datasetid="dsScheduleList" columnid="TYPE_CODE"/>
      <BindItem id="item1" compid="stc_Sales_List.tpg_Progess.form.txt_ProgressContent" propid="value" datasetid="dsScheduleList" columnid="CONTENTS"/>
      <BindItem id="item2" compid="stc_Sales_List.tpg_Progess.form.cal_IssueDate" propid="value" datasetid="dsScheduleList" columnid="ISSUE_DATE"/>
      <BindItem id="item3" compid="stc_Sales_List.tpg_Progess.form.chb_MakePublic01" propid="value" datasetid="dsScheduleList" columnid="REPORT_FLAG"/>
      <BindItem id="item4" compid="stc_Sales_List.tpg_Progess.form.chb_MakePublic02" propid="value" datasetid="dsScheduleList" columnid="OPEN_FLAG"/>
      <BindItem id="item5" compid="stc_Sales_List.tpg_Progess.form.cmb_Importance00" propid="value" datasetid="dsScheduleList" columnid="IMPORTANCE"/>
      <BindItem id="item6" compid="stc_Sales_List" propid="value" datasetid="dsList" columnid="BUSINESS_TYPE"/>
      <BindItem id="item7" compid="edt_ProjectName" propid="value" datasetid="dsList" columnid="PROJECT_NAME"/>
      <BindItem id="item8" compid="edt_ProjectCode" propid="value" datasetid="dsList" columnid="PROJECT_CODE"/>
      <BindItem id="item9" compid="ckb_PipeLineFlag" propid="value" datasetid="dsList" columnid="PIPELINE_FLAG"/>
      <BindItem id="item10" compid="cmb_SalesProduct" propid="value" datasetid="dsList" columnid="PRODUCT_CODE"/>
      <BindItem id="item11" compid="cmb_SalesStatus" propid="value" datasetid="dsList" columnid="SALES_STATUS"/>
      <BindItem id="item12" compid="edt_ContractName" propid="value" datasetid="dsList" columnid="CONTRACT_NAME"/>
      <BindItem id="item13" compid="cal_ContractDate" propid="value" datasetid="dsList" columnid="CONTRACT_DATE"/>
      <BindItem id="item14" compid="cmb_BusinessType" propid="value" datasetid="dsList" columnid="BUSINESS_TYPE"/>
      <BindItem id="item15" compid="cmb_SalesEmpNo" propid="value" datasetid="dsList" columnid="SALES_EMP_NO"/>
      <BindItem id="item16" compid="txt_Remark" propid="value" datasetid="dsList" columnid="REMARKS"/>
      <BindItem id="item17" compid="tab_Progess.tpg_Progess.form.cmb_TypeCode" propid="value" datasetid="dsScheduleList" columnid="TYPE_CODE"/>
      <BindItem id="item18" compid="tab_Progess.tpg_Progess.form.cal_IssueDate" propid="value" datasetid="dsScheduleList" columnid="ISSUE_DATE"/>
      <BindItem id="item19" compid="tab_Progess.tpg_Progess.form.cmb_Importance00" propid="value" datasetid="dsScheduleList" columnid="IMPORTANCE"/>
      <BindItem id="item20" compid="tab_Progess.tpg_Progess.form.chb_MakePublic01" propid="value" datasetid="dsScheduleList" columnid="REPORT_FLAG"/>
      <BindItem id="item21" compid="tab_Progess.tpg_Progess.form.chb_MakePublic02" propid="value" datasetid="dsScheduleList" columnid="OPEN_FLAG"/>
      <BindItem id="item22" compid="tab_Progess.tpg_Progess.form.txt_ProgressContent" propid="value" datasetid="dsScheduleList" columnid="CONTENTS"/>
    </Bind>
  </Form>
</FDL>
